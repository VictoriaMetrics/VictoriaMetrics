
{
   "annotations": {
      "list": [
         {
            "builtIn": 1,
            "datasource": {
               "type": "grafana",
               "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations \u0026 Alerts",
            "type": "dashboard"
         }
      ]
   },
   "description": "**VictoriaMetrics Status Page** - Health matrix for VictoriaMetrics components.\n\n**Reading the Table:**\n- **Instance Count** (Blue): Number of detected instances per component\n- **100%** (Green): All instances are healthy for this alert\n- **\u003c100%** (Red): Some instances are experiencing issues (percentage shows healthy instances)\n- **-** (Gray): Alert not applicable to this component\n\n**Component Prefixes:**\n- **ALL:** Applies to all VictoriaMetrics components\n- **cluster:** Applies to vminsert, vmselect, vmstorage\n- **single:** Applies to victoria-metrics (single-node)\n- **vmagent/vmalert/vmauth/vmanomaly:** Component-specific alerts\n\n**Alert Rules Sources:**\n- [VictoriaMetrics Alerts Overview](https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/deployment/docker#alerts)\n- [vmalert Rules](https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/rules/vmalert.yml)\n- [vmagent Rules](https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/rules/vmagent.yml)\n- [VM Cluster Rules](https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/rules/cluster.yml)\n- [VM Single Rules](https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/rules/single.yml)\n- [VM Operator Rules](https://github.com/VictoriaMetrics/operator/blob/master/config/alerting/vmoperator-rules.yaml)\n- [VMAnomaly Rules](https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/rules/vmanomaly.yml)\n",
   "editable": true,
   "fiscalYearStartMonth": 0,
   "graphTooltip": 0,
   "id": 0,
   "links": [
      {
         "asDropdown": false,
         "icon": "external link",
         "includeVars": false,
         "keepTime": false,
         "tags": [],
         "targetBlank": true,
         "title": "Alert Rules Source",
         "tooltip": "View official VictoriaMetrics alert rules on GitHub",
         "type": "link",
         "url": "https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/deployment/docker/rules"
      }
   ],
   "panels": [
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Number of instances detected per component",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "fixed",
                  "fixedColor": "#1F60C4"
               },
               "custom": {
                  "align": "center",
                  "cellOptions": {
                     "applyToRow": false,
                     "type": "color-background"
                  },
                  "filterable": false,
                  "inspect": false,
                  "minWidth": 80
               },
               "mappings": [],
               "noValue": "-",
               "thresholds": {
                  "mode": "absolute",
                  "steps": [
                     {
                        "color": "#1F60C4",
                        "value": null
                     }
                  ]
               },
               "unit": "none"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Metric"
                  },
                  "properties": [
                     {
                        "id": "custom.hidden",
                        "value": true
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 4,
            "w": 24,
            "x": 0,
            "y": 0
         },
         "id": 8000,
         "options": {
            "cellHeight": "md",
            "showHeader": true
         },
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "count by (svc_name) (label_replace(vm_app_version{job=~\"$job\", instance=~\"$instance\", version!~\"(victoria-(logs|traces)|vl|vt).*\"}, \"svc_name\", \"$1\", \"version\", \"^(.+)-\\\\d{8}-.*\"))",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "InstanceCount"
            }
         ],
         "title": "Instance Count",
         "transformations": [
            {
               "id": "merge",
               "options": {}
            },
            {
               "id": "organize",
               "options": {
                  "excludeByName": {
                     "Time": true
                  },
                  "includeByName": {},
                  "indexByName": {}
               }
            },
            {
               "id": "transpose",
               "options": {
                  "firstFieldName": "Metric",
                  "restFieldsName": ""
               }
            },
            {
               "id": "organize",
               "options": {
                  "excludeByName": {
                     "Metric": true
                  },
                  "includeByName": {},
                  "indexByName": {}
               }
            }
         ],
         "type": "table"
      },
      {
         "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
         },
         "description": "Shows **worst health state** over the selected time range.\n\n**Values:** 100% = all healthy, \u003c100% = issues detected, - = not applicable for this component\n\n**Prefixes:** ALL = all components, cluster = vminsert/vmselect/vmstorage, single = victoria-metrics, or component-specific (vmagent, vmalert, vmauth, vmanomaly)\n\n**Sources:** [Alerts Overview](https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/deployment/docker#alerts) | [Alert Rules](https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/deployment/docker/rules)\n",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "custom": {
                  "align": "center",
                  "cellOptions": {
                     "applyToRow": false,
                     "type": "color-background"
                  },
                  "filterable": true,
                  "footer": {
                     "reducers": [
                        "min"
                     ]
                  },
                  "inspect": false,
                  "minWidth": 80,
                  "wrapHeaderText": true,
                  "wrapText": false
               },
               "mappings": [
                  {
                     "options": {
                        "from": 100,
                        "to": 100,
                        "result": {
                           "color": "green",
                           "index": 0,
                           "text": "100%"
                        }
                     },
                     "type": "range"
                  },
                  {
                     "options": {
                        "from": 0,
                        "to": 99.99,
                        "result": {
                           "color": "red",
                           "index": 1
                        }
                     },
                     "type": "range"
                  },
                  {
                     "options": {
                        "from": -999999,
                        "to": -0.01,
                        "result": {
                           "color": "red",
                           "index": 2,
                           "text": "ERR"
                        }
                     },
                     "type": "range"
                  },
                  {
                     "options": {
                        "match": "null",
                        "result": {
                           "color": "#3D3D3D",
                           "index": 3,
                           "text": "-"
                        }
                     },
                     "type": "special"
                  }
               ],
               "noValue": "-",
               "thresholds": {
                  "mode": "absolute",
                  "steps": [
                     {
                        "color": "#3D3D3D",
                        "value": null
                     },
                     {
                        "color": "red",
                        "value": 0
                     },
                     {
                        "color": "green",
                        "value": 100
                     }
                  ]
               },
               "unit": "percent"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "Alert"
                  },
                  "properties": [
                     {
                        "id": "custom.cellOptions",
                        "value": {
                           "type": "auto"
                        }
                     },
                     {
                        "id": "custom.width",
                        "value": 280
                     },
                     {
                        "id": "custom.filterable",
                        "value": true
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 20,
            "w": 24,
            "x": 0,
            "y": 4
         },
         "id": 9000,
         "options": {
            "cellHeight": "sm",
            "enablePagination": false,
            "showHeader": true
         },
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmalert_alerting_rules_errors_total[5m])) without(id) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmalert_alerting_rules_errors_total[5m])) without(id) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertAlertingRulesError"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vmalert_alerts_send_errors_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vmalert_alerts_send_errors_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertAlertmanagerErrors"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((avg_over_time(vm_concurrent_insert_current[1m]) \u003e= vm_concurrent_insert_capacity) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((avg_over_time(vm_concurrent_insert_current[1m]) \u003e= vm_concurrent_insert_capacity) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLConcurrentInsertsHitTheLimit"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmauth-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmauth_concurrent_requests_limit_reached_total[1m])) by (instance) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmauth_concurrent_requests_limit_reached_total[1m])) by (instance) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmauthConcurrentRequestsLimitReached"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((vmalert_config_last_reload_successful != 1) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((vmalert_config_last_reload_successful != 1) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertConfigurationReloadFailure"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((vm_promscrape_config_last_reload_successful != 1\nor\nvmagent_relabel_config_last_reload_successful != 1) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((vm_promscrape_config_last_reload_successful != 1\nor\nvmagent_relabel_config_last_reload_successful != 1) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentConfigurationReloadFailure"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_data_size_bytes) by(job, instance) /\n(\n sum(vm_free_disk_space_bytes) by(job, instance) +\n sum(vm_data_size_bytes) by(job, instance)\n) \u003e 0.8) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_data_size_bytes) by(job, instance) /\n(\n sum(vm_free_disk_space_bytes) by(job, instance) +\n sum(vm_data_size_bytes) by(job, instance)\n) \u003e 0.8) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterDiskRunsOutOfSpace"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_data_size_bytes) by(job, instance) /\n(\n sum(vm_free_disk_space_bytes) by(job, instance) +\n sum(vm_data_size_bytes) by(job, instance)\n) \u003e 0.8) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_data_size_bytes) by(job, instance) /\n(\n sum(vm_free_disk_space_bytes) by(job, instance) +\n sum(vm_data_size_bytes) by(job, instance)\n) \u003e 0.8) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleDiskRunsOutOfSpace"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes) without(path) /\n(\n  (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n    sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n    sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n  )\n  +\n  rate(vm_new_timeseries_created_total[1d]) * (\n    sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type)/\n    sum(vm_rows{type=\"indexdb/file\"}) without(type)\n  )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes) without(path) /\n(\n  (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n    sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n    sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n  )\n  +\n  rate(vm_new_timeseries_created_total[1d]) * (\n    sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type)/\n    sum(vm_rows{type=\"indexdb/file\"}) without(type)\n  )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleDiskRunsOutOfSpaceIn3Days"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes) without(path) /\n(\n  (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n    sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n    sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n  )\n  +\n  rate(vm_new_timeseries_created_total[1d]) * (\n    sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type) /\n    sum(vm_rows{type=\"indexdb/file\"}) without(type)\n  )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes) without(path) /\n(\n  (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n    sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n    sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n  )\n  +\n  rate(vm_new_timeseries_created_total[1d]) * (\n    sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type) /\n    sum(vm_rows{type=\"indexdb/file\"}) without(type)\n  )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterDiskRunsOutOfSpaceIn3Days"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n  sum(increase(vmanomaly_reader_responses_total{job=~\".*vmanomaly.*\", code=~\"2..\"}[5m])) by (job, instance, url) /\n  sum(increase(vmanomaly_reader_responses_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, url)\n) \u003c 0.95) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n  sum(increase(vmanomaly_reader_responses_total{job=~\".*vmanomaly.*\", code=~\"2..\"}[5m])) by (job, instance, url) /\n  sum(increase(vmanomaly_reader_responses_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, url)\n) \u003c 0.95) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyHighReadErrorRate"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n  sum(increase(vmanomaly_writer_responses_total{job=~\".*vmanomaly.*\", code=~\"2..\"}[5m])) by (job, instance, url) /\n  sum(increase(vmanomaly_writer_responses_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, url)\n) \u003c 0.95) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n  sum(increase(vmanomaly_writer_responses_total{job=~\".*vmanomaly.*\", code=~\"2..\"}[5m])) by (job, instance, url) /\n  sum(increase(vmanomaly_writer_responses_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, url)\n) \u003c 0.95) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyHighWriteErrorRate"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_indexdb_items_dropped_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_indexdb_items_dropped_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLIndexDBRecordsDrop"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((vmanomaly_config_last_reload_successful == 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((vmanomaly_config_last_reload_successful == 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyLastConfigReloadFailed"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((lag(vmanomaly_start_time_seconds{job=\"vmanomaly\"}[24h]) \u003e 900) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((lag(vmanomaly_start_time_seconds{job=\"vmanomaly\"}[24h]) \u003e 900) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyNoSelfMonitoringMetrics"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes - vm_free_disk_space_limit_bytes) without(path) /\n(\n    (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n      sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n      sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n    )\n    +\n    rate(vm_new_timeseries_created_total[1d]) * (\n      sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type) /\n      sum(vm_rows{type=\"indexdb/file\"}) without(type)\n    )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes - vm_free_disk_space_limit_bytes) without(path) /\n(\n    (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n      sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n      sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n    )\n    +\n    rate(vm_new_timeseries_created_total[1d]) * (\n      sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type) /\n      sum(vm_rows{type=\"indexdb/file\"}) without(type)\n    )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleNodeBecomesReadonlyIn3Days"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes - vm_free_disk_space_limit_bytes) without(path) /\n(\n    (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n      sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n      sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n    )\n    +\n    rate(vm_new_timeseries_created_total[1d]) * (\n      sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type) /\n      sum(vm_rows{type=\"indexdb/file\"}) without(type)\n    )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_free_disk_space_bytes - vm_free_disk_space_limit_bytes) without(path) /\n(\n    (rate(vm_rows_added_to_storage_total[1d]) - sum(rate(vm_deduplicated_samples_total[1d])) without(type)) * (\n      sum(vm_data_size_bytes{type!~\"indexdb.*\"}) without(type) /\n      sum(vm_rows{type!~\"indexdb.*\"}) without(type)\n    )\n    +\n    rate(vm_new_timeseries_created_total[1d]) * (\n      sum(vm_data_size_bytes{type=\"indexdb/file\"}) without(type) /\n      sum(vm_rows{type=\"indexdb/file\"}) without(type)\n    )\n) \u003c 3 * 24 * 3600 \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterNodeBecomesReadonlyIn3Days"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((rate(vm_persistentqueue_read_duration_seconds_total[5m]) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((rate(vm_persistentqueue_read_duration_seconds_total[5m]) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentPersistentQueueForReadsIsSaturated"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((rate(vm_persistentqueue_write_duration_seconds_total[5m]) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((rate(vm_persistentqueue_write_duration_seconds_total[5m]) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentPersistentQueueForWritesIsSaturated"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vm_persistentqueue_bytes_dropped_total[5m])) without (path) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vm_persistentqueue_bytes_dropped_total[5m])) without (path) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentPersistentQueueIsDroppingData"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((process_max_fds - process_open_fds) \u003c 100) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((process_max_fds - process_open_fds) \u003c 100) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLProcessNearFDLimits"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((process_max_fds{job=~\".*vmanomaly.*\"} - process_open_fds{job=~\".*vmanomaly.*\"}) \u003c 100) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((process_max_fds{job=~\".*vmanomaly.*\"} - process_open_fds{job=~\".*vmanomaly.*\"}) \u003c 100) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyProcessNearFDLimits"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n sum(increase(vm_rpc_connection_errors_total[5m])) by(job, instance)\n +\n sum(increase(vm_rpc_dial_errors_total[5m])) by(job, instance)\n +\n sum(increase(vm_rpc_handshake_errors_total[5m])) by(job, instance)\n) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n sum(increase(vm_rpc_connection_errors_total[5m])) by(job, instance)\n +\n sum(increase(vm_rpc_dial_errors_total[5m])) by(job, instance)\n +\n sum(increase(vm_rpc_handshake_errors_total[5m])) by(job, instance)\n) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterRPCErrors"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmalert_recording_rules_errors_total[5m])) without(id) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmalert_recording_rules_errors_total[5m])) without(id) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertRecordingRulesError"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vmalert_recording_rules_last_evaluation_samples) without(id) \u003c 1) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vmalert_recording_rules_last_evaluation_samples) without(id) \u003c 1) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertRecordingRulesNoData"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmagent_remotewrite_packets_dropped_total[5m])) without (url) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmagent_remotewrite_packets_dropped_total[5m])) without (url) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentRejectedRemoteWriteDataBlocksAreDropped"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n rate(vmagent_remotewrite_send_duration_seconds_total[5m])\n / \n vmagent_remotewrite_queues\n) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n rate(vmagent_remotewrite_send_duration_seconds_total[5m])\n / \n vmagent_remotewrite_queues\n) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentRemoteWriteConnectionIsSaturated"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vmalert_remotewrite_dropped_rows_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vmalert_remotewrite_dropped_rows_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertRemoteWriteDroppingData"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vmalert_remotewrite_errors_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vmalert_remotewrite_errors_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertRemoteWriteErrors"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_http_request_errors_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_http_request_errors_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleRequestErrorsToAPI"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_http_request_errors_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_http_request_errors_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterRequestErrorsToAPI"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((rate(vm_rows_ignored_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((rate(vm_rows_ignored_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLRowsRejectedOnIngestion"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(vm_promscrape_scrape_pool_targets) without (status, instance, pod) == 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(vm_promscrape_scrape_pool_targets) without (status, instance, pod) == 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentScrapePoolHasNoTargets"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((vmagent_daily_series_limit_current_series / vmagent_daily_series_limit_max_series) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((vmagent_daily_series_limit_current_series / vmagent_daily_series_limit_max_series) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentSeriesLimitDayReached"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((vmagent_hourly_series_limit_current_series / vmagent_hourly_series_limit_max_series) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((vmagent_hourly_series_limit_current_series / vmagent_hourly_series_limit_max_series) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentSeriesLimitHourReached"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((up{job=~\".*vmanomaly.*\"} == 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((up{job=~\".*vmanomaly.*\"} == 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyServiceDown"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((up{job=~\".*(victoriametrics|vmselect|vminsert|vmstorage|vmagent|vmalert|vmsingle|vmalertmanager|vmauth).*\"} == 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((up{job=~\".*(victoriametrics|vmselect|vminsert|vmstorage|vmagent|vmalert|vmsingle|vmalertmanager|vmauth).*\"} == 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLServiceDown"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmanomaly_model_run_errors_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, stage) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmanomaly_model_run_errors_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, stage) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyServiceErrorsDetected"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmanomaly_model_runs_skipped_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, stage) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmanomaly_model_runs_skipped_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance, stage) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalySkippedModelRunsDetected"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_streamaggr_dedup_flush_timeouts_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_streamaggr_dedup_flush_timeouts_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentStreamAggrDedupFlushTimeout"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_streamaggr_flush_timeouts_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_streamaggr_flush_timeouts_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentStreamAggrFlushTimeout"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((rate(process_cpu_seconds_total[5m]) / process_cpu_cores_available \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((rate(process_cpu_seconds_total[5m]) / process_cpu_cores_available \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooHighCPUUsage"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(rate(process_cpu_seconds_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance) / sum(vmanomaly_cpu_cores_available{job=~\".*vmanomaly.*\"}[5m]) by (job, instance) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(rate(process_cpu_seconds_total{job=~\".*vmanomaly.*\"}[5m])) by (job, instance) / sum(vmanomaly_cpu_cores_available{job=~\".*vmanomaly.*\"}[5m]) by (job, instance) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyTooHighCPUUsage"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n   sum(rate(vm_new_timeseries_created_total[5m])) by(instance)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(instance)\n ) \u003e 0.1) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n   sum(rate(vm_new_timeseries_created_total[5m])) by(instance)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(instance)\n ) \u003e 0.1) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleTooHighChurnRate"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n   sum(rate(vm_new_timeseries_created_total[5m])) by(job)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(job)\n ) \u003e 0.1) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n   sum(rate(vm_new_timeseries_created_total[5m])) by(job)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(job)\n ) \u003e 0.1) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterTooHighChurnRate"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vm_new_timeseries_created_total[24h])) by(job)\n\u003e\n(sum(vm_cache_entries{type=\"storage/hour_metric_ids\"}) by(job) * 3)) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vm_new_timeseries_created_total[24h])) by(job)\n\u003e\n(sum(vm_cache_entries{type=\"storage/hour_metric_ids\"}) by(job) * 3)) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterTooHighChurnRate24h"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vm_new_timeseries_created_total[24h])) by(instance)\n\u003e\n(sum(vm_cache_entries{type=\"storage/hour_metric_ids\"}) by(instance) * 3)) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vm_new_timeseries_created_total[24h])) by(instance)\n\u003e\n(sum(vm_cache_entries{type=\"storage/hour_metric_ids\"}) by(instance) * 3)) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleTooHighChurnRate24h"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((histogram_quantile(0.99, sum(rate(go_sched_latencies_seconds_bucket{job=~\".*(victoriametrics|vmselect|vminsert|vmstorage|vmagent|vmalert|vmsingle|vmalertmanager|vmauth).*\"}[5m])) by (le, job, instance)) \u003e 0.1) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((histogram_quantile(0.99, sum(rate(go_sched_latencies_seconds_bucket{job=~\".*(victoriametrics|vmselect|vminsert|vmstorage|vmagent|vmalert|vmsingle|vmalertmanager|vmauth).*\"}[5m])) by (le, job, instance)) \u003e 0.1) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooHighGoroutineSchedulingLatency"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((min_over_time(process_resident_memory_anon_bytes[10m]) / vm_available_memory_bytes) \u003e 0.8) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((min_over_time(process_resident_memory_anon_bytes[10m]) / vm_available_memory_bytes) \u003e 0.8) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooHighMemoryUsage"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((min_over_time(process_resident_memory_bytes[10m]) / vmanomaly_available_memory_bytes) \u003e 0.85) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((min_over_time(process_resident_memory_bytes[10m]) / vmanomaly_available_memory_bytes) \u003e 0.85) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyTooHighMemoryUsage"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_concurrent_select_limit_timeout_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_concurrent_select_limit_timeout_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooHighQueryLoad"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n   sum(rate(vm_slow_row_inserts_total[5m])) by(job)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(job)\n ) \u003e 0.05) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n   sum(rate(vm_slow_row_inserts_total[5m])) by(job)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(job)\n ) \u003e 0.05) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterTooHighSlowInsertsRate"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"victoria-metrics-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((\n   sum(rate(vm_slow_row_inserts_total[5m])) by(instance)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(instance)\n ) \u003e 0.05) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((\n   sum(rate(vm_slow_row_inserts_total[5m])) by(instance)\n   /\n   sum(rate(vm_rows_inserted_total[5m])) by(instance)\n ) \u003e 0.05) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "singleTooHighSlowInsertsRate"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vm_log_messages_total{level=\"error\"}[5m])) without (app_version, location) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vm_log_messages_total{level=\"error\"}[5m])) without (app_version, location) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooManyLogs"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmalert-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vmalert_iteration_missed_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vmalert_iteration_missed_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmalertTooManyMissedIterations"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((rate(vmagent_remotewrite_retries_count_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((rate(vmagent_remotewrite_retries_count_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentTooManyRemoteWriteErrors"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmanomaly-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((changes(process_start_time_seconds{job=~\".*vmanomaly.*\"}[15m]) \u003e 2) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((changes(process_start_time_seconds{job=~\".*vmanomaly.*\"}[15m]) \u003e 2) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmanomalyTooManyRestarts"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((changes(process_start_time_seconds{job=~\".*(victoriametrics|vmselect|vminsert|vmstorage|vmagent|vmalert|vmsingle|vmalertmanager|vmauth).*\"}[15m]) \u003e 2) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((changes(process_start_time_seconds{job=~\".*(victoriametrics|vmselect|vminsert|vmstorage|vmagent|vmalert|vmsingle|vmalertmanager|vmauth).*\"}[15m]) \u003e 2) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooManyRestarts"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_promscrape_scrapes_failed_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_promscrape_scrapes_failed_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentTooManyScrapeErrors"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\".*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((increase(vm_missing_tsids_for_metric_id_total[5m]) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((increase(vm_missing_tsids_for_metric_id_total[5m]) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "ALLTooManyTSIDMisses"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmagent-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        (((sum(increase(vm_ingestserver_request_errors_total[5m])) without (name,net,type)\n+\nsum(increase(vmagent_http_request_errors_total[5m])) without (path,protocol)) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        (((sum(increase(vm_ingestserver_request_errors_total[5m])) without (name,net,type)\n+\nsum(increase(vmagent_http_request_errors_total[5m])) without (path,protocol)) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmagentTooManyWriteErrors"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"vmauth-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((sum(increase(vmauth_user_concurrent_requests_limit_reached_total[1m])) by (username) \u003e 0) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((sum(increase(vmauth_user_concurrent_requests_limit_reached_total[1m])) by (username) \u003e 0) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "vmauthUserConcurrentRequestsLimitReached"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "${datasource}"
               },
               "editorMode": "code",
               "expr": "min_over_time(\n  (\n    WITH (\n      vm_svc = label_replace(\n        vm_app_version{version=~\"(vminsert|vmselect|vmstorage)-.*\", version!~\"(victoria-(logs|traces)|vl|vt).*\", job=~\"$job\", instance=~\"$instance\"},\n        \"svc_name\",\n        \"$1\",\n        \"version\",\n        \"^(.+)-\\\\d{8}-.*\"\n      ),\n      total = count by (svc_name) (vm_svc),\n      firing_pod = count by (svc_name) (\n        ((rate(vm_rpc_send_duration_seconds_total[5m]) \u003e 0.9) \u003e 0) * on(pod, instance, job) group_left(svc_name) vm_svc\n      ),\n      firing_inst = count by (svc_name) (\n        ((rate(vm_rpc_send_duration_seconds_total[5m]) \u003e 0.9) \u003e 0) * on(instance, job) group_left(svc_name) vm_svc\n      ),\n      firing = (firing_pod or firing_inst or total * 0)\n    )\n    clamp_min(100 * (total - firing) / total, 0)\n  )[$__range:]\n)",
               "format": "table",
               "hide": false,
               "instant": true,
               "legendFormat": "{{svc_name}}",
               "range": false,
               "refId": "clusterVminsertVmstorageConnectionIsSaturated"
            }
         ],
         "title": "Service Health Matrix",
         "transformations": [
            {
               "id": "merge",
               "options": {}
            },
            {
               "id": "organize",
               "options": {
                  "excludeByName": {
                     "Time": true
                  },
                  "includeByName": {},
                  "indexByName": {},
                  "renameByName": {
                     "Value #ALLConcurrentInsertsHitTheLimit": "ALL: ConcurrentInsertsHitTheLimit",
                     "Value #ALLIndexDBRecordsDrop": "ALL: IndexDBRecordsDrop",
                     "Value #ALLProcessNearFDLimits": "ALL: ProcessNearFDLimits",
                     "Value #ALLRowsRejectedOnIngestion": "ALL: RowsRejectedOnIngestion",
                     "Value #ALLServiceDown": "ALL: ServiceDown",
                     "Value #ALLTooHighCPUUsage": "ALL: TooHighCPUUsage",
                     "Value #ALLTooHighGoroutineSchedulingLatency": "ALL: TooHighGoroutineSchedulingLatency",
                     "Value #ALLTooHighMemoryUsage": "ALL: TooHighMemoryUsage",
                     "Value #ALLTooHighQueryLoad": "ALL: TooHighQueryLoad",
                     "Value #ALLTooManyLogs": "ALL: TooManyLogs",
                     "Value #ALLTooManyRestarts": "ALL: TooManyRestarts",
                     "Value #ALLTooManyTSIDMisses": "ALL: TooManyTSIDMisses",
                     "Value #clusterDiskRunsOutOfSpace": "cluster: DiskRunsOutOfSpace",
                     "Value #clusterDiskRunsOutOfSpaceIn3Days": "cluster: DiskRunsOutOfSpaceIn3Days",
                     "Value #clusterNodeBecomesReadonlyIn3Days": "cluster: NodeBecomesReadonlyIn3Days",
                     "Value #clusterRPCErrors": "cluster: RPCErrors",
                     "Value #clusterRequestErrorsToAPI": "cluster: RequestErrorsToAPI",
                     "Value #clusterTooHighChurnRate": "cluster: TooHighChurnRate",
                     "Value #clusterTooHighChurnRate24h": "cluster: TooHighChurnRate24h",
                     "Value #clusterTooHighSlowInsertsRate": "cluster: TooHighSlowInsertsRate",
                     "Value #clusterVminsertVmstorageConnectionIsSaturated": "cluster: VminsertVmstorageConnectionIsSaturated",
                     "Value #singleDiskRunsOutOfSpace": "single: DiskRunsOutOfSpace",
                     "Value #singleDiskRunsOutOfSpaceIn3Days": "single: DiskRunsOutOfSpaceIn3Days",
                     "Value #singleNodeBecomesReadonlyIn3Days": "single: NodeBecomesReadonlyIn3Days",
                     "Value #singleRequestErrorsToAPI": "single: RequestErrorsToAPI",
                     "Value #singleTooHighChurnRate": "single: TooHighChurnRate",
                     "Value #singleTooHighChurnRate24h": "single: TooHighChurnRate24h",
                     "Value #singleTooHighSlowInsertsRate": "single: TooHighSlowInsertsRate",
                     "Value #vmagentConfigurationReloadFailure": "vmagent: ConfigurationReloadFailure",
                     "Value #vmagentPersistentQueueForReadsIsSaturated": "vmagent: PersistentQueueForReadsIsSaturated",
                     "Value #vmagentPersistentQueueForWritesIsSaturated": "vmagent: PersistentQueueForWritesIsSaturated",
                     "Value #vmagentPersistentQueueIsDroppingData": "vmagent: PersistentQueueIsDroppingData",
                     "Value #vmagentRejectedRemoteWriteDataBlocksAreDropped": "vmagent: RejectedRemoteWriteDataBlocksAreDropped",
                     "Value #vmagentRemoteWriteConnectionIsSaturated": "vmagent: RemoteWriteConnectionIsSaturated",
                     "Value #vmagentScrapePoolHasNoTargets": "vmagent: ScrapePoolHasNoTargets",
                     "Value #vmagentSeriesLimitDayReached": "vmagent: SeriesLimitDayReached",
                     "Value #vmagentSeriesLimitHourReached": "vmagent: SeriesLimitHourReached",
                     "Value #vmagentStreamAggrDedupFlushTimeout": "vmagent: StreamAggrDedupFlushTimeout",
                     "Value #vmagentStreamAggrFlushTimeout": "vmagent: StreamAggrFlushTimeout",
                     "Value #vmagentTooManyRemoteWriteErrors": "vmagent: TooManyRemoteWriteErrors",
                     "Value #vmagentTooManyScrapeErrors": "vmagent: TooManyScrapeErrors",
                     "Value #vmagentTooManyWriteErrors": "vmagent: TooManyWriteErrors",
                     "Value #vmalertAlertingRulesError": "vmalert: AlertingRulesError",
                     "Value #vmalertAlertmanagerErrors": "vmalert: AlertmanagerErrors",
                     "Value #vmalertConfigurationReloadFailure": "vmalert: ConfigurationReloadFailure",
                     "Value #vmalertRecordingRulesError": "vmalert: RecordingRulesError",
                     "Value #vmalertRecordingRulesNoData": "vmalert: RecordingRulesNoData",
                     "Value #vmalertRemoteWriteDroppingData": "vmalert: RemoteWriteDroppingData",
                     "Value #vmalertRemoteWriteErrors": "vmalert: RemoteWriteErrors",
                     "Value #vmalertTooManyMissedIterations": "vmalert: TooManyMissedIterations",
                     "Value #vmanomalyHighReadErrorRate": "vmanomaly: HighReadErrorRate",
                     "Value #vmanomalyHighWriteErrorRate": "vmanomaly: HighWriteErrorRate",
                     "Value #vmanomalyLastConfigReloadFailed": "vmanomaly: LastConfigReloadFailed",
                     "Value #vmanomalyNoSelfMonitoringMetrics": "vmanomaly: NoSelfMonitoringMetrics",
                     "Value #vmanomalyProcessNearFDLimits": "vmanomaly: ProcessNearFDLimits",
                     "Value #vmanomalyServiceDown": "vmanomaly: ServiceDown",
                     "Value #vmanomalyServiceErrorsDetected": "vmanomaly: ServiceErrorsDetected",
                     "Value #vmanomalySkippedModelRunsDetected": "vmanomaly: SkippedModelRunsDetected",
                     "Value #vmanomalyTooHighCPUUsage": "vmanomaly: TooHighCPUUsage",
                     "Value #vmanomalyTooHighMemoryUsage": "vmanomaly: TooHighMemoryUsage",
                     "Value #vmanomalyTooManyRestarts": "vmanomaly: TooManyRestarts",
                     "Value #vmauthConcurrentRequestsLimitReached": "vmauth: ConcurrentRequestsLimitReached",
                     "Value #vmauthUserConcurrentRequestsLimitReached": "vmauth: UserConcurrentRequestsLimitReached",
                     "svc_name": ""
                  }
               }
            },
            {
               "id": "transpose",
               "options": {
                  "firstFieldName": "Alert",
                  "restFieldsName": ""
               }
            },
            {
               "id": "sortBy",
               "options": {
                  "sort": [
                     {
                        "field": "Alert"
                     }
                  ]
               }
            }
         ],
         "type": "table"
      }
   ],
   "preload": false,
   "refresh": "30s",
   "schemaVersion": 42,
   "tags": [
      "victoriametrics",
      "status-page",
      "alerts",
      "health"
   ],
   "templating": {
      "list": [
         {
            "current": {
               "text": "default",
               "value": "default"
            },
            "includeAll": false,
            "label": "Datasource",
            "name": "datasource",
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
         },
         {
            "current": {
               "text": [
                  "All"
               ],
               "value": [
                  "$__all"
               ]
            },
            "includeAll": true,
            "label": "Job",
            "name": "job",
            "query": {
               "query": "label_values(vm_app_version, job)",
               "refId": "StandardVariableQuery"
            },
            "refresh": 1,
            "regex": "",
            "type": "query",
            "allValue": ".*",
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "definition": "label_values(vm_app_version, job)",
            "multi": true,
            "sort": 1
         },
         {
            "current": {
               "text": [
                  "All"
               ],
               "value": [
                  "$__all"
               ]
            },
            "includeAll": true,
            "label": "Instance",
            "name": "instance",
            "query": {
               "query": "label_values(vm_app_version{job=~\"$job\"}, instance)",
               "refId": "StandardVariableQuery"
            },
            "refresh": 1,
            "regex": "",
            "type": "query",
            "allValue": ".*",
            "datasource": {
               "type": "prometheus",
               "uid": "${datasource}"
            },
            "definition": "label_values(vm_app_version{job=~\"$job\"}, instance)",
            "multi": true,
            "sort": 1
         }
      ]
   },
   "time": {
      "from": "now-5m",
      "to": "now"
   },
   "timepicker": {
      "refresh_intervals": [
         "10s",
         "30s",
         "1m",
         "5m"
      ]
   },
   "timezone": "",
   "title": "VictoriaMetrics - Status Page",
   "uid": "vm-status-page",
   "version": 1
}
