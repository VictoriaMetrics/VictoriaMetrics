import{d as U,t as wo,a as No,u as So,r as To,q as or,K as dt,h as Ct,T as I,b as e,x as De,N as Ea,c as k,A as W,y as L,e as b,k as F,f as X,g as gn,i as tt,$ as wt,M as Ao,D as yn,I as Eo,j as me,F as ir,O as La,l as bn,m as _n,n as lr,_ as Lo,L as Cn,H as Ma,R as xa,o as he,p as Mo}from"./vendor-BVRvRxZ2.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();U.extend(wo);U.extend(No);U.extend(So);U.extend(To);const J={home:"/",metrics:"/metrics",dashboards:"/dashboards",cardinality:"/cardinality",topQueries:"/top-queries",trace:"/trace",withTemplate:"/expand-with-exprs",relabel:"/relabeling",activeQueries:"/active-queries",queryAnalyzer:"/query-analyzer",icons:"/icons",anomaly:"/anomaly",query:"/query",rawQuery:"/raw-query",downsamplingDebug:"/downsampling-filters-debug",retentionDebug:"/retention-filters-debug"},Lt={header:{tenant:!0,stepControl:!0,timeSelector:!0,executionControls:!0}},mt={[J.home]:{title:"Query",...Lt},[J.rawQuery]:{title:"Raw query",...Lt},[J.metrics]:{title:"Explore Prometheus metrics",header:{tenant:!0,stepControl:!0,timeSelector:!0}},[J.cardinality]:{title:"Explore cardinality",header:{tenant:!0,cardinalityDatePicker:!0}},[J.topQueries]:{title:"Top queries",header:{tenant:!0}},[J.trace]:{title:"Trace analyzer",header:{}},[J.queryAnalyzer]:{title:"Query analyzer",header:{}},[J.dashboards]:{title:"Dashboards",...Lt},[J.withTemplate]:{title:"WITH templates",header:{}},[J.relabel]:{title:"Metric relabel debug",header:{}},[J.activeQueries]:{title:"Active Queries",header:{}},[J.icons]:{title:"Icons",header:{}},[J.anomaly]:{title:"Anomaly exploration",...Lt},[J.query]:{title:"Query",...Lt},[J.downsamplingDebug]:{title:"Downsampling filters debug",header:{}},[J.retentionDebug]:{title:"Retention filters debug",header:{}}},zt=()=>{const t=document.getElementById("root")?.dataset.params||"{}";try{return JSON.parse(t)}catch(n){return console.error(n),{}}},Se=()=>!!Object.keys(zt()).length,cr=/(\/select\/)(\d+|\d.+)(\/)(.+)/,ka=(t,n)=>t.replace(cr,`$1${n}/$4`),Ot=t=>t.match(cr)?.[2]||"",xo=t=>t.replace(cr,"");var Ht=(t=>(t.victoriametrics="victoriametrics",t.vmanomaly="vmanomaly",t))(Ht||{});const Ft="victoriametrics",ko=Ft==="vmanomaly",ke=(t,n)=>{n?window.localStorage.setItem(t,JSON.stringify({value:n})):dr([t]),window.dispatchEvent(new Event("storage"))},Oe=t=>{const n=window.localStorage.getItem(t);if(n!==null)try{return JSON.parse(n)?.value}catch{return n}},dr=t=>t.forEach(n=>window.localStorage.removeItem(n)),Io=t=>{const{serverURL:n}=zt(),r=Oe("SERVER_URL"),a=`${window.location.origin}${window.location.pathname.replace(/^\/vmui/,"")}`,s=window.location.href.replace(/(\/(?:prometheus\/)?(?:graph|vmui)\/.*|\/#\/.*)/,"/prometheus"),o=n||r||s;switch(Ft){case Ht.vmanomaly:return r||a;default:return t?ka(o,t):o}},sn=10,Ia=25,Da={table:100,chart:20,code:1e3},on=[{id:"small",isDefault:!0,height:()=>window.innerHeight*.2},{id:"medium",height:()=>window.innerHeight*.4},{id:"large",height:()=>window.innerHeight*.8}],mr=["min","median","max"],Ee=(t,n)=>{const r=window.location.hash.split("?")[1];return or.parse(r,{ignoreQueryPrefix:!0})?.[t]||n||""},Ra=()=>{const n=(window.location.hash.split("?")[1]||"").match(/g\d+\.expr/g)?.length||1;return new Array(n>sn?sn:n).fill(1).map((r,a)=>Ee(`g${a}.expr`,""))};var ee=(t=>(t.yhat="yhat",t.yhatUpper="yhat_upper",t.yhatLower="yhat_lower",t.anomaly="vmui_anomalies_points",t.training="vmui_training_data",t.actual="actual",t.anomalyScore="anomaly_score",t))(ee||{}),pe=(t=>(t.table="table",t.chart="chart",t.code="code",t))(pe||{}),ye=(t=>(t.emptyServer="Please enter Server URL",t.validServer="Please provide a valid Server URL",t.validQuery="Please enter a valid Query and execute it",t.traceNotFound="Not found the tracing information",t.emptyTitle="Please enter title",t.positiveNumber="Please enter positive number",t.validStep="Please enter a valid step",t.unknownType="Unknown server response format: must have 'errorType'",t))(ye||{}),ze=(t=>(t.system="system",t.light="light",t.dark="dark",t))(ze||{}),we=(t=>(t.empty="empty",t.metricsql="metricsql",t.label="label",t.labelValue="labelValue",t))(we||{});const We=t=>getComputedStyle(document.documentElement).getPropertyValue(`--${t}`),gt=(t,n)=>{document.documentElement.style.setProperty(`--${t}`,n)},ln=()=>window.matchMedia("(prefers-color-scheme: dark)").matches,Do=t=>t===ze.system&&ln()||t===ze.dark,ur=t=>{let n;try{n=new URL(t)}catch{return!1}return n.protocol==="http:"||n.protocol==="https:"},$a=t=>t.replace(/\/$/,""),Ro=(t,n)=>{if(Array.from(t.entries()).length!==Array.from(n.entries()).length)return!1;for(const[r,a]of t)if(n.get(r)!==a)return!1;return!0},$o=t=>{try{const n=t.match(/\/api\/v1\/[^?]+/);return n?n[0]:null}catch(n){return console.error("Invalid URL:",n),null}},Kr=Ee("g0.tenantID",""),Po={serverUrl:$a(Io(Kr)),tenantId:Kr,theme:Oe("THEME")||ze.system,isDarkTheme:null,flags:{},appConfig:{}};function zo(t,n){switch(n.type){case"SET_SERVER":return{...t,serverUrl:$a(n.payload)};case"SET_TENANT_ID":return{...t,tenantId:n.payload};case"SET_THEME":return ke("THEME",n.payload),{...t,theme:n.payload};case"SET_DARK_THEME":return{...t,isDarkTheme:Do(t.theme)};case"SET_FLAGS":return{...t,flags:n.payload};case"SET_APP_CONFIG":return{...t,appConfig:n.payload};default:throw new Error}}const hr=dt({}),ne=()=>De(hr).state,ut=()=>De(hr).dispatch,Oo=Object.entries(Po).reduce((t,[n,r])=>({...t,[n]:Ee(n)||r}),{}),Ho=({children:t})=>{const[n,r]=Ct(zo,Oo),a=I(()=>({state:n,dispatch:r}),[n,r]);return e(hr.Provider,{value:a,children:t})},st="YYYY-MM-DD",Ve="YYYY-MM-DD HH:mm:ss",cn="YYYY-MM-DD HH:mm:ss:SSS (Z)",pr="YYYY-MM-DD[T]HH:mm:ss",Pa="YYYY-MM-DD_HHmmss",Fo=["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmera","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/La_Rioja","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Buenos_Aires","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Catamarca","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Coral_Harbour","America/Cordoba","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fort_Nelson","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Indianapolis","America/Inuvik","America/Iqaluit","America/Jamaica","America/Jujuy","America/Juneau","America/Kentucky/Monticello","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Louisville","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Mendoza","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Punta_Arenas","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Atyrau","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Barnaul","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Calcutta","Asia/Chita","Asia/Choibalsan","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Famagusta","Asia/Gaza","Asia/Hebron","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Katmandu","Asia/Khandyga","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qostanay","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Saigon","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Srednekolymsk","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Tomsk","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faeroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Andorra","Europe/Astrakhan","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Kirov","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Saratov","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Ulyanovsk","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Bougainville","Pacific/Chatham","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Ponape","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Truk","Pacific/Wake","Pacific/Wallis"],Vo=window.innerWidth/4,Uo=window.innerWidth/40,Zr={min:1,max:1578e8},Xr=Intl.supportedValuesOf,qo=Xr?Xr("timeZone"):Fo,vr=[{long:"years",short:"y",possible:"year"},{long:"weeks",short:"w",possible:"week"},{long:"days",short:"d",possible:"day"},{long:"hours",short:"h",possible:"hour"},{long:"minutes",short:"m",possible:"min"},{long:"seconds",short:"s",possible:"sec"},{long:"milliseconds",short:"ms",possible:"millisecond"}],Bo=vr.map(t=>t.short),rn=t=>Math.round(t*1e3)/1e3,fr=t=>wn(U.duration(t,"seconds").asMilliseconds()),Zn=t=>{let n=rn(t);const r=Math.round(t);return t>=100&&(n=r-r%10),t<100&&t>=10&&(n=r-r%5),t<10&&t>=1&&(n=r),t<1&&t>.01&&(n=Math.round(t*40)/40),fr(n||.001).replace(/\s/g,"")},za=t=>{const n=t.match(/\d+/g),r=t.match(/[a-zA-Z]+/g);if(r&&n&&Bo.includes(r[0]))return{[r[0]]:n[0]}},gr=t=>{const n=vr.map(o=>o.short).join("|"),r=new RegExp(`\\d+(\\.\\d+)?[${n}]+`,"g"),s=(t.match(r)||[]).reduce((o,i)=>{const c=za(i);return c?{...o,...c}:{...o}},{});return U.duration(s).asSeconds()},Qo=[pe.table,pe.code],Vt=(t,n,r)=>r&&Qo.includes(r)?Zn(t):Zn(t/(n?Uo:Vo)),yt=(t,n)=>{const r=(n||U().toDate()).valueOf()/1e3,a=gr(t);return{start:r-a,end:r,step:Vt(a),date:Oa(n||U().toDate())}},Yo=t=>U(t).utcOffset(0,!0).toDate(),Oa=t=>U.tz(t).utc().format(pr),xt=t=>U.tz(t).format(pr),jo=()=>U().utc().format(pr),wn=t=>{const n=Math.floor(t%1e3),r=Math.floor(t/1e3%60),a=Math.floor(t/1e3/60%60),s=Math.floor(t/1e3/3600%24),o=Math.floor(t/(1e3*60*60*24)),i=["d","h","m","s","ms"];return[o,s,a,r,n].map((l,m)=>l?`${l}${i[m]}`:"").filter(l=>l).join("")},Go=t=>{const n=t.to.valueOf()-t.from.valueOf();return wn(n)},He=t=>{const n=U(t*1e3);return n.isValid()?n.toDate():new Date},Wo=()=>U().tz().subtract(1,"day").endOf("day").toDate(),Jo=()=>U().tz().endOf("day").toDate(),dn=[{title:"Last 5 minutes",duration:"5m"},{title:"Last 15 minutes",duration:"15m"},{title:"Last 30 minutes",duration:"30m",isDefault:!0},{title:"Last 1 hour",duration:"1h"},{title:"Last 3 hours",duration:"3h"},{title:"Last 6 hours",duration:"6h"},{title:"Last 12 hours",duration:"12h"},{title:"Last 24 hours",duration:"24h"},{title:"Last 2 days",duration:"2d"},{title:"Last 7 days",duration:"7d"},{title:"Last 30 days",duration:"30d"},{title:"Last 90 days",duration:"90d"},{title:"Last 180 days",duration:"180d"},{title:"Last 1 year",duration:"1y"},{title:"Yesterday",duration:"1d",until:Wo},{title:"Today",duration:"1d",until:Jo}].map(t=>({id:t.title.replace(/\s/g,"_").toLocaleLowerCase(),until:t.until?t.until:()=>U().tz().toDate(),...t})),yr=({relativeTimeId:t,defaultDuration:n,defaultEndInput:r})=>{const a=dn.find(i=>i.isDefault)?.id,s=t||Ee("g0.relative_time",a),o=dn.find(i=>i.id===s);return{relativeTimeId:o?s:"none",duration:o?o.duration:n,endInput:o?o.until():r}},It=t=>`UTC${U().tz(t).format("Z")}`,ea=(t="")=>{const n=new RegExp(t,"i");return qo.reduce((r,a)=>{const s=(a.match(/^(.*?)\//)||[])[1]||"unknown",o=It(a),i=o.replace(/UTC|0/,""),c=a.replace(/[/_]/g," "),l={region:a,utc:o,search:`${a} ${o} ${c} ${i}`},m=!t||t&&n.test(l.search);return m&&r[s]?r[s].push(l):m&&(r[s]=[l]),r},{})},Ha=t=>{U.tz.setDefault(t)},Ko=t=>{try{return U().tz(t),!0}catch{return!1}},br=()=>{const t=U.tz.guess(),n=Ko(t);return{isValid:n,title:n?`Browser Time (${t})`:"Browser timezone (UTC)",region:n?t:"UTC"}},ta=t=>{if(!t)return 0n;const n=U(t).valueOf();if(!t.includes("."))return BigInt(n)*1000000n;const r=t.match(/\.(\d+)Z/);if(!r)return BigInt(n)*1000000n;let a=r[1];a=a.padEnd(9,"0");const s=parseInt(a.slice(3),10);return BigInt(n)*1000000n+BigInt(s)},Fa=Oe("TIMEZONE")||br().region;Ha(Fa);const Va=()=>{const t=Ee("g0.range_input"),{duration:n,endInput:r,relativeTimeId:a}=yr({defaultDuration:t||"1h",defaultEndInput:Yo(Ee("g0.end_input",jo())),relativeTimeId:t?Ee("g0.relative_time","none"):void 0});return{duration:n,period:yt(n,r),relativeTime:a}},Zo={...Va(),timezone:Fa};function Xo(t,n){switch(n.type){case"SET_TIME_STATE":return{...t,...n.payload};case"SET_DURATION":return{...t,duration:n.payload,period:yt(n.payload,He(t.period.end)),relativeTime:"none"};case"SET_RELATIVE_TIME":return{...t,duration:n.payload.duration,period:yt(n.payload.duration,n.payload.until),relativeTime:n.payload.id};case"SET_PERIOD":const r=Go(n.payload);return{...t,duration:r,period:yt(r,n.payload.to),relativeTime:"none"};case"RUN_QUERY":const{duration:a,endInput:s}=yr({relativeTimeId:t.relativeTime,defaultDuration:t.duration,defaultEndInput:He(t.period.end)});return{...t,period:yt(a,s)};case"RUN_QUERY_TO_NOW":return{...t,period:yt(t.duration)};case"SET_TIMEZONE":return Ha(n.payload),ke("TIMEZONE",n.payload),t.defaultTimezone&&ke("DISABLED_DEFAULT_TIMEZONE",n.payload!==t.defaultTimezone),{...t,timezone:n.payload};case"SET_DEFAULT_TIMEZONE":return{...t,defaultTimezone:n.payload};default:throw new Error}}const _r=dt({}),ve=()=>De(_r).state,Ue=()=>De(_r).dispatch,ei=({children:t})=>{const[n,r]=Ct(Xo,Zo),a=I(()=>({state:n,dispatch:r}),[n,r]);return e(_r.Provider,{value:a,children:t})},Nn=t=>{const n=Oe(t);return n?JSON.parse(n):{}},Ua=(t,n,r)=>{const a=Nn(t);ke(t,JSON.stringify({...a,[n]:r}))},Mt=(t,n)=>Nn(t)[n]||[],ti=(t,n)=>{const r=n.map(l=>l.values[l.index]),a=Nn(t),s=a.QUERY_HISTORY||[];s[0]||(s[0]=[]);const o=s[0],i=Ia*sn;r.forEach(l=>{!o.includes(l)&&l&&o.unshift(l),o.length>i&&o.pop()});const c={...a,QUERY_HISTORY:[o]};ke(t,JSON.stringify(c))},ni=(t,n)=>{Ua(t,"QUERY_FAVORITES",n)},ri=(t,n)=>{const r=Nn(t);ke(t,JSON.stringify({...r,[n]:[]}))},ai=(t,n)=>{const r=n||{values:[]},a=t===r.values[r.values.length-1],s=!a&&t?[...r.values,t]:r.values;return s.length>Ia&&s.shift(),{index:r.values.length-Number(a),values:s}},si=()=>{const t=n=>{const r=Oe(n);if(r){const a=JSON.parse(r);Ua("METRICS_QUERY_HISTORY",n,a),dr([n])}};t("QUERY_HISTORY"),t("QUERY_FAVORITES")};si();const mn={displayResults:50,queryLimit:1e3,cacheLimit:1e3};class oi{maxSize;map;constructor(){this.maxSize=mn.cacheLimit,this.map=new Map}get(n){for(const[r,a]of this.map){const s=JSON.parse(r),o=s.start===n.start&&s.end===n.end,i=s.type===n.type,c=n.value&&s.value&&n.value.includes(s.value),l=s.match===n.match||c,m=a.length<mn.queryLimit;if(l&&o&&i&&m)return a}return this.map.get(JSON.stringify(n))}put(n,r){if(this.map.size>=this.maxSize){const a=this.map.keys().next().value;a&&this.map.delete(a)}this.map.set(JSON.stringify(n),r)}}const na=Ra(),ii={query:na,queryHistory:na.map(t=>({index:0,values:[t]})),autocomplete:Oe("AUTOCOMPLETE")||!1,autocompleteQuick:!1,autocompleteCache:new oi,metricsQLFunctions:[]};function li(t,n){switch(n.type){case"SET_QUERY":return{...t,query:n.payload.map(r=>r)};case"SET_QUERY_HISTORY":return ti(n.payload.key,n.payload.history),{...t,queryHistory:n.payload.history};case"SET_QUERY_HISTORY_BY_INDEX":return t.queryHistory.splice(n.payload.queryNumber,1,n.payload.value),{...t,queryHistory:t.queryHistory};case"TOGGLE_AUTOCOMPLETE":return ke("AUTOCOMPLETE",!t.autocomplete),{...t,autocomplete:!t.autocomplete};case"SET_AUTOCOMPLETE_QUICK":return{...t,autocompleteQuick:n.payload};case"SET_AUTOCOMPLETE_CACHE":return t.autocompleteCache.put(n.payload.key,n.payload.value),{...t};case"SET_METRICSQL_FUNCTIONS":return{...t,metricsQLFunctions:n.payload};default:throw new Error}}const Cr=dt({}),Te=()=>De(Cr).state,Ut=()=>De(Cr).dispatch,ci=({children:t})=>{const[n,r]=Ct(li,ii),a=I(()=>({state:n,dispatch:r}),[n,r]);return e(Cr.Provider,{value:a,children:t})},qa=()=>e("svg",{viewBox:"0 0 74 24",fill:"currentColor",children:e("path",{d:"M6.12 10.48c.36.28.8.43 1.26.43h.05c.48 0 .96-.19 1.25-.44 1.5-1.28 5.88-5.29 5.88-5.29C15.73 4.1 12.46 3.01 7.43 3h-.06C2.33 3-.93 4.1.24 5.18c0 0 4.37 4 5.88 5.3Zm2.56 2.16c-.36.28-.8.44-1.26.45h-.04c-.46 0-.9-.17-1.26-.45-1.04-.88-4.74-4.22-6.12-5.5v1.94c0 .21.08.5.22.63l.07.06c1.05.96 4.55 4.16 5.83 5.25.36.28.8.43 1.26.44h.04c.49-.02.96-.2 1.26-.44 1.3-1.11 4.94-4.45 5.88-5.31.15-.14.23-.42.23-.63V7.15a454.94 454.94 0 0 1-6.11 5.5Zm-1.26 4.99c.46 0 .9-.16 1.26-.44a454.4 454.4 0 0 0 6.1-5.5v1.94c0 .2-.07.48-.22.62-.94.87-4.57 4.2-5.88 5.3-.3.26-.77.44-1.26.45h-.04c-.46 0-.9-.16-1.26-.44-1.2-1.02-4.38-3.92-5.62-5.06l-.28-.25c-.14-.14-.22-.42-.22-.62v-1.94c1.38 1.26 5.08 4.6 6.12 5.5.36.28.8.43 1.26.44h.04ZM35 5l-5.84 14.46h-2.43L20.89 5h2.16a.9.9 0 0 1 .9.61l3.41 8.82a18.8 18.8 0 0 1 .62 2.02 19.44 19.44 0 0 1 .57-2.02l3.39-8.82c.05-.15.16-.3.31-.42a.9.9 0 0 1 .58-.19H35Zm17.18 0v14.46H49.8v-9.34c0-.37.02-.78.06-1.21l-4.37 8.21c-.21.4-.53.59-.95.59h-.38c-.43 0-.75-.2-.95-.59L38.8 8.88a22.96 22.96 0 0 1 .07 1.24v9.34H36.5V5h2.03l.3.01c.1 0 .17.02.24.05.07.03.13.07.19.13a1 1 0 0 1 .17.24l4.33 8.03a16.97 16.97 0 0 1 .6 1.36 14.34 14.34 0 0 1 .6-1.38l4.28-8.01c.05-.1.1-.18.17-.24.06-.06.12-.1.19-.13a.9.9 0 0 1 .24-.05l.3-.01h2.04Zm8.88 13.73a4.5 4.5 0 0 0 1.82-.35 3.96 3.96 0 0 0 2.22-2.47c.2-.57.3-1.19.3-1.85V5.31h1.02v8.75c0 .78-.12 1.51-.37 2.19a4.88 4.88 0 0 1-2.76 2.95c-.66.29-1.4.43-2.23.43-.82 0-1.57-.14-2.24-.43a5.01 5.01 0 0 1-2.75-2.95 6.37 6.37 0 0 1-.37-2.19V5.31h1.03v8.74c0 .66.1 1.28.3 1.85a3.98 3.98 0 0 0 2.21 2.47c.53.24 1.14.36 1.82.36Zm10.38.73h-1.03V5.31h1.03v14.15Z"})}),Ba=()=>e("svg",{viewBox:"0 0 85 38",fill:"currentColor",children:e("path",{d:"M11.118 10.476c.36.28.801.433 1.257.436h.052c.48-.007.961-.192 1.25-.444 1.509-1.279 5.88-5.287 5.88-5.287 1.168-1.087-2.093-2.174-7.13-2.181h-.06c-5.036.007-8.298 1.094-7.13 2.181 0 0 4.372 4.008 5.88 5.295zm2.559 2.166c-.359.283-.801.439-1.258.444h-.044a2.071 2.071 0 0 1-1.257-.444C10.082 11.755 6.384 8.42 5 7.148v1.93c0 .215.081.496.222.629l.07.064c1.045.955 4.546 4.154 5.825 5.245.358.283.8.438 1.257.444h.044c.489-.015.962-.2 1.258-.444 1.309-1.11 4.948-4.444 5.887-5.31.148-.132.222-.413.222-.628v-1.93a455.127 455.127 0 0 1-6.11 5.494zm-1.258 4.984a2.071 2.071 0 0 0 1.258-.436c2.053-1.815 4.09-3.65 6.11-5.502v1.938c0 .207-.075.488-.223.621-.94.873-4.578 4.2-5.887 5.31-.296.25-.77.436-1.258.443h-.044a2.071 2.071 0 0 1-1.257-.436c-1.204-1.027-4.376-3.928-5.616-5.062l-.28-.255c-.14-.133-.221-.414-.221-.621v-1.938c1.383 1.265 5.081 4.607 6.117 5.495.358.282.8.438 1.257.443h.044zM40 5l-5.84 14.46h-2.43L25.89 5h2.16c.233 0 .423.057.57.17.146.113.256.26.33.44l3.41 8.82c.113.287.22.603.32.95.106.34.206.697.3 1.07.08-.373.166-.73.26-1.07a8.84 8.84 0 0 1 .31-.95l3.39-8.82a.959.959 0 0 1 .31-.42.906.906 0 0 1 .58-.19H40zm17.176 0v14.46h-2.37v-9.34c0-.373.02-.777.06-1.21l-4.37 8.21c-.206.393-.523.59-.95.59h-.38c-.426 0-.743-.197-.95-.59l-4.42-8.24c.02.22.037.437.05.65.014.213.02.41.02.59v9.34h-2.37V5h2.03c.12 0 .224.003.31.01a.778.778 0 0 1 .23.05c.074.027.137.07.19.13.06.06.117.14.17.24l4.33 8.03c.114.213.217.433.31.66.1.227.197.46.29.7.094-.247.19-.483.29-.71.1-.233.207-.457.32-.67l4.27-8.01c.054-.1.11-.18.17-.24a.57.57 0 0 1 .19-.13.903.903 0 0 1 .24-.05c.087-.007.19-.01.31-.01h2.03zm8.887 13.73c.68 0 1.286-.117 1.82-.35.54-.24.996-.57 1.37-.99a4.28 4.28 0 0 0 .85-1.48c.2-.573.3-1.19.3-1.85V5.31h1.02v8.75c0 .78-.124 1.51-.37 2.19a5.248 5.248 0 0 1-1.07 1.77c-.46.5-1.024.893-1.69 1.18-.66.287-1.404.43-2.23.43-.827 0-1.574-.143-2.24-.43a5.012 5.012 0 0 1-1.69-1.18 5.33 5.33 0 0 1-1.06-1.77 6.373 6.373 0 0 1-.37-2.19V5.31h1.03v8.74c0 .66.096 1.277.29 1.85.2.567.483 1.06.85 1.48.373.42.826.75 1.36.99.54.24 1.15.36 1.83.36zm10.38.73h-1.03V5.31h1.03v14.15zM4.242 35v-5.166l-.672-.078a.595.595 0 0 1-.21-.09.23.23 0 0 1-.078-.186v-.438h.96v-.588c0-.348.048-.656.144-.924.1-.272.24-.5.42-.684a1.79 1.79 0 0 1 .66-.426c.256-.096.544-.144.864-.144.272 0 .522.04.75.12l-.024.534c-.008.096-.062.148-.162.156a4.947 4.947 0 0 1-.39.012c-.184 0-.352.024-.504.072a.949.949 0 0 0-.384.234c-.108.108-.192.25-.252.426a2.184 2.184 0 0 0-.084.654v.558h1.752v.774H5.316V35H4.242zM10.416 28.826a3.1 3.1 0 0 1 1.2.222c.356.148.66.358.912.63s.444.602.576.99c.136.384.204.814.204 1.29 0 .48-.068.912-.204 1.296a2.735 2.735 0 0 1-.576.984 2.572 2.572 0 0 1-.912.63 3.175 3.175 0 0 1-1.2.216c-.448 0-.852-.072-1.212-.216a2.572 2.572 0 0 1-.912-.63 2.805 2.805 0 0 1-.582-.984 3.972 3.972 0 0 1-.198-1.296c0-.476.066-.906.198-1.29.136-.388.33-.718.582-.99.252-.272.556-.482.912-.63.36-.148.764-.222 1.212-.222zm0 5.424c.6 0 1.048-.2 1.344-.6.296-.404.444-.966.444-1.686 0-.724-.148-1.288-.444-1.692-.296-.404-.744-.606-1.344-.606-.304 0-.57.052-.798.156a1.507 1.507 0 0 0-.564.45c-.148.196-.26.438-.336.726a3.941 3.941 0 0 0-.108.966c0 .72.148 1.282.444 1.686.3.4.754.6 1.362.6zM15.677 30.14c.192-.416.428-.74.708-.972.28-.236.622-.354 1.026-.354.128 0 .25.014.366.042.12.028.226.072.318.132l-.078.798c-.024.1-.084.15-.18.15-.056 0-.138-.012-.246-.036a1.694 1.694 0 0 0-.366-.036c-.192 0-.364.028-.516.084-.148.056-.282.14-.402.252a1.782 1.782 0 0 0-.318.408c-.092.16-.176.344-.252.552V35h-1.074v-6.078h.612c.116 0 .196.022.24.066.044.044.074.12.09.228l.072.924zM26.761 28.922 24.283 35h-.96l-2.478-6.078h.87a.33.33 0 0 1 .33.222l1.542 3.912c.048.148.09.292.126.432.036.14.07.28.102.42.032-.14.066-.28.102-.42.036-.14.08-.284.132-.432l1.56-3.912a.33.33 0 0 1 .12-.156.311.311 0 0 1 .198-.066h.834zM27.74 35v-6.078h.643c.152 0 .246.074.282.222l.078.624c.224-.276.476-.502.756-.678.28-.176.604-.264.972-.264.408 0 .738.114.99.342.256.228.44.536.552.924.088-.22.2-.41.336-.57a1.987 1.987 0 0 1 1.014-.624c.196-.048.394-.072.594-.072.32 0 .604.052.852.156.252.1.464.248.636.444.176.196.31.438.402.726.092.284.138.61.138.978V35H34.91v-3.87c0-.476-.104-.836-.312-1.08-.208-.248-.508-.372-.9-.372-.176 0-.344.032-.504.096-.156.06-.294.15-.414.27-.12.12-.216.272-.288.456-.068.18-.102.39-.102.63V35h-1.074v-3.87c0-.488-.098-.852-.294-1.092-.196-.24-.482-.36-.858-.36-.264 0-.508.072-.732.216a2.38 2.38 0 0 0-.618.576V35H27.74zM40.746 32.372c-.428.02-.788.058-1.08.114-.292.052-.526.12-.702.204a.923.923 0 0 0-.378.294.639.639 0 0 0-.114.366c0 .26.076.446.228.558.156.112.358.168.606.168.304 0 .566-.054.786-.162.224-.112.442-.28.654-.504v-1.038zm-3.396-2.67c.708-.648 1.56-.972 2.556-.972.36 0 .682.06.966.18.284.116.524.28.72.492.196.208.344.458.444.75.104.292.156.612.156.96V35h-.672a.708.708 0 0 1-.324-.06c-.076-.044-.136-.13-.18-.258l-.132-.444c-.156.14-.308.264-.456.372a2.804 2.804 0 0 1-.462.264c-.16.072-.332.126-.516.162-.18.04-.38.06-.6.06-.26 0-.5-.034-.72-.102a1.618 1.618 0 0 1-.57-.318 1.414 1.414 0 0 1-.372-.522 1.852 1.852 0 0 1-.132-.726 1.419 1.419 0 0 1 .33-.906c.12-.14.274-.272.462-.396s.418-.232.69-.324c.276-.092.596-.166.96-.222.364-.06.78-.096 1.248-.108v-.36c0-.412-.088-.716-.264-.912-.176-.2-.43-.3-.762-.3-.24 0-.44.028-.6.084-.156.056-.294.12-.414.192l-.33.186a.631.631 0 0 1-.324.084.439.439 0 0 1-.264-.078.716.716 0 0 1-.174-.192l-.264-.474zM44.974 29.6c.124-.124.254-.238.39-.342a2.395 2.395 0 0 1 .936-.444c.176-.044.368-.066.576-.066.336 0 .634.058.894.174.26.112.476.272.648.48.176.204.308.45.396.738.092.284.138.598.138.942V35H47.47v-3.918c0-.376-.086-.666-.258-.87-.172-.208-.434-.312-.786-.312-.256 0-.496.058-.72.174a2.58 2.58 0 0 0-.636.474V35h-1.482v-6.156h.906c.192 0 .318.09.378.27l.102.486zM53.085 28.748c.456 0 .87.074 1.242.222a2.692 2.692 0 0 1 1.578 1.626c.144.392.216.83.216 1.314 0 .488-.072.928-.216 1.32-.144.392-.35.726-.618 1.002a2.653 2.653 0 0 1-.96.636 3.333 3.333 0 0 1-1.242.222c-.46 0-.878-.074-1.254-.222a2.712 2.712 0 0 1-.966-.636 2.922 2.922 0 0 1-.618-1.002 3.807 3.807 0 0 1-.216-1.32c0-.484.072-.922.216-1.314.148-.392.354-.724.618-.996.268-.272.59-.482.966-.63a3.397 3.397 0 0 1 1.254-.222zm0 5.202c.512 0 .89-.172 1.134-.516.248-.344.372-.848.372-1.512s-.124-1.17-.372-1.518c-.244-.348-.622-.522-1.134-.522-.52 0-.906.176-1.158.528-.248.348-.372.852-.372 1.512s.124 1.164.372 1.512c.252.344.638.516 1.158.516zM57.252 35v-6.156h.906c.192 0 .318.09.378.27l.096.456c.108-.12.22-.23.336-.33a2.017 2.017 0 0 1 1.32-.492c.388 0 .706.106.954.318.252.208.44.486.564.834a1.93 1.93 0 0 1 .834-.882c.172-.092.354-.16.546-.204.196-.044.392-.066.588-.066.34 0 .642.052.906.156.264.104.486.256.666.456.18.2.316.444.408.732.096.288.144.618.144.99V35h-1.482v-3.918c0-.392-.086-.686-.258-.882-.172-.2-.424-.3-.756-.3-.152 0-.294.026-.426.078a1.026 1.026 0 0 0-.342.228 1.019 1.019 0 0 0-.228.366 1.435 1.435 0 0 0-.084.51V35h-1.488v-3.918c0-.412-.084-.712-.252-.9-.164-.188-.406-.282-.726-.282-.216 0-.418.054-.606.162a1.979 1.979 0 0 0-.516.432V35h-1.482zM70.558 32.372c-.428.02-.788.058-1.08.114-.292.052-.526.12-.702.204a.923.923 0 0 0-.378.294.639.639 0 0 0-.114.366c0 .26.076.446.228.558.156.112.358.168.606.168.304 0 .566-.054.786-.162.224-.112.442-.28.654-.504v-1.038zm-3.396-2.67c.708-.648 1.56-.972 2.556-.972.36 0 .682.06.966.18.284.116.524.28.72.492.196.208.344.458.444.75.104.292.156.612.156.96V35h-.672a.708.708 0 0 1-.324-.06c-.076-.044-.136-.13-.18-.258l-.132-.444c-.156.14-.308.264-.456.372a2.804 2.804 0 0 1-.462.264c-.16.072-.332.126-.516.162-.18.04-.38.06-.6.06-.26 0-.5-.034-.72-.102a1.618 1.618 0 0 1-.57-.318 1.414 1.414 0 0 1-.372-.522 1.852 1.852 0 0 1-.132-.726 1.419 1.419 0 0 1 .33-.906c.12-.14.274-.272.462-.396s.418-.232.69-.324c.276-.092.596-.166.96-.222.364-.06.78-.096 1.248-.108v-.36c0-.412-.088-.716-.264-.912-.176-.2-.43-.3-.762-.3-.24 0-.44.028-.6.084-.156.056-.294.12-.414.192l-.33.186a.631.631 0 0 1-.324.084.439.439 0 0 1-.264-.078.716.716 0 0 1-.174-.192l-.264-.474zM74.9 26.084V35h-1.482v-8.916H74.9zM81.969 28.844l-3.354 7.848a.538.538 0 0 1-.174.234c-.068.056-.174.084-.318.084h-1.104l1.152-2.472-2.49-5.694h1.302c.116 0 .206.028.27.084.068.056.118.12.15.192l1.308 3.192c.044.108.08.216.108.324.032.108.062.218.09.33a32.3 32.3 0 0 1 .108-.33c.036-.112.076-.222.12-.33l1.236-3.186a.437.437 0 0 1 .408-.276h1.188z"})}),Qa=()=>e("svg",{viewBox:"0 0 15 17",fill:"currentColor",children:e("path",{d:"M6.11767 7.47586C6.47736 7.75563 6.91931 7.90898 7.37503 7.91213H7.42681C7.90756 7.90474 8.38832 7.71987 8.67677 7.46846C10.1856 6.18921 14.5568 2.18138 14.5568 2.18138C15.7254 1.09438 12.4637 0.00739 7.42681 0H7.36764C2.3308 0.00739 -0.930935 1.09438 0.237669 2.18138C0.237669 2.18138 4.60884 6.18921 6.11767 7.47586ZM8.67677 9.64243C8.31803 9.92483 7.87599 10.0808 7.41941 10.0861H7.37503C6.91845 10.0808 6.47641 9.92483 6.11767 9.64243C5.0822 8.75513 1.38409 5.42018 0.000989555 4.14832V6.07829C0.000989555 6.29273 0.0823481 6.57372 0.222877 6.70682L0.293316 6.7712L0.293344 6.77122C1.33784 7.72579 4.83903 10.9255 6.11767 12.0161C6.47641 12.2985 6.91845 12.4545 7.37503 12.4597H7.41941C7.90756 12.4449 8.38092 12.2601 8.67677 12.0161C9.9859 10.9069 13.6249 7.57198 14.5642 6.70682C14.7121 6.57372 14.7861 6.29273 14.7861 6.07829V4.14832C12.7662 5.99804 10.7297 7.82949 8.67677 9.64243ZM7.41941 14.6263C7.87513 14.6232 8.31708 14.4698 8.67677 14.19C10.7298 12.3746 12.7663 10.5407 14.7861 8.68853V10.6259C14.7861 10.8329 14.7121 11.1139 14.5642 11.247C13.6249 12.1196 9.9859 15.4471 8.67677 16.5563C8.38092 16.8077 7.90756 16.9926 7.41941 17H7.37503C6.91931 16.9968 6.47736 16.8435 6.11767 16.5637C4.91427 15.5373 1.74219 12.6364 0.502294 11.5025C0.393358 11.4029 0.299337 11.3169 0.222877 11.247C0.0823481 11.1139 0.000989555 10.8329 0.000989555 10.6259V8.68853C1.38409 9.95303 5.0822 13.2953 6.11767 14.1827C6.47641 14.4651 6.91845 14.6211 7.37503 14.6263H7.41941Z"})}),it=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),Ie=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),Nt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"})}),et=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),qt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})}),wr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})}),Nr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),Ya=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),Sn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})}),Ne=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"})}),Be=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m7 10 5 5 5-5z"})}),Dt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[e("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),e("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),un=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"})}),ja=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m22 5.72-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39 6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})}),Ga=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"})}),nt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M8 5v14l11-7z"})}),Tn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m10 16.5 6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"})}),Sr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m3.5 18.49 6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"})}),An=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5v11zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2zM3 19c0 1.1.9 2 2 2h3V10H3v9z"})}),Bt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})}),En=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),Tr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),Wa=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 13H5v-2h14v2z"})}),Ln=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M8.9999 14.7854L18.8928 4.8925C19.0803 4.70497 19.3347 4.59961 19.5999 4.59961C19.8651 4.59961 20.1195 4.70497 20.307 4.8925L21.707 6.2925C22.0975 6.68303 22.0975 7.31619 21.707 7.70672L9.70701 19.7067C9.31648 20.0972 8.68332 20.0972 8.2928 19.7067L2.6928 14.1067C2.50526 13.9192 2.3999 13.6648 2.3999 13.3996C2.3999 13.1344 2.50526 12.88 2.6928 12.6925L4.0928 11.2925C4.48332 10.902 5.11648 10.902 5.50701 11.2925L8.9999 14.7854Z"})}),Ar=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})}),Ja=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})}),Ka=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 9l1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25L19 9zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25L19 15z"})}),ht=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),Er=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"})}),hn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"})}),lt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21 5C19.89 4.65 18.67 4.5 17.5 4.5C15.55 4.5 13.45 4.9 12 6C10.55 4.9 8.45 4.5 6.5 4.5C5.33 4.5 4.11 4.65 3 5C2.25 5.25 1.6 5.55 1 6V20.6C1 20.85 1.25 21.1 1.5 21.1C1.6 21.1 1.65 21.1 1.75 21.05C3.15 20.3 4.85 20 6.5 20C8.2 20 10.65 20.65 12 21.5C13.35 20.65 15.8 20 17.5 20C19.15 20 20.85 20.3 22.25 21.05C22.35 21.1 22.4 21.1 22.5 21.1C22.75 21.1 23 20.85 23 20.6V6C22.4 5.55 21.75 5.25 21 5ZM21 18.5C19.9 18.15 18.7 18 17.5 18C15.8 18 13.35 18.65 12 19.5C10.65 18.65 8.2 18 6.5 18C5.3 18 4.1 18.15 3 18.5V7C4.1 6.65 5.3 6.5 6.5 6.5C8.2 6.5 10.65 7.15 12 8C13.35 7.15 15.8 6.5 17.5 6.5C18.7 6.5 19.9 6.65 21 7V18.5Z"}),e("path",{d:"M17.5 10.5C18.38 10.5 19.23 10.59 20 10.76V9.24C19.21 9.09 18.36 9 17.5 9C15.8 9 14.26 9.29 13 9.83V11.49C14.13 10.85 15.7 10.5 17.5 10.5ZM13 12.49V14.15C14.13 13.51 15.7 13.16 17.5 13.16C18.38 13.16 19.23 13.25 20 13.42V11.9C19.21 11.75 18.36 11.66 17.5 11.66C15.8 11.66 14.26 11.96 13 12.49ZM17.5 14.33C15.8 14.33 14.26 14.62 13 15.16V16.82C14.13 16.18 15.7 15.83 17.5 15.83C18.38 15.83 19.23 15.92 20 16.09V14.57C19.21 14.41 18.36 14.33 17.5 14.33Z"}),e("path",{d:"M6.5 10.5C5.62 10.5 4.77 10.59 4 10.76V9.24C4.79 9.09 5.64 9 6.5 9C8.2 9 9.74 9.29 11 9.83V11.49C9.87 10.85 8.3 10.5 6.5 10.5ZM11 12.49V14.15C9.87 13.51 8.3 13.16 6.5 13.16C5.62 13.16 4.77 13.25 4 13.42V11.9C4.79 11.75 5.64 11.66 6.5 11.66C8.2 11.66 9.74 11.96 11 12.49ZM6.5 14.33C8.2 14.33 9.74 14.62 11 15.16V16.82C9.87 16.18 8.3 15.83 6.5 15.83C5.62 15.83 4.77 15.92 4 16.09V14.57C4.79 14.41 5.64 14.33 6.5 14.33Z"})]}),Za=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"})}),Xa=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 6C9.79 6 8 7.79 8 10H10C10 8.9 10.9 8 12 8C13.1 8 14 8.9 14 10C14 10.8792 13.4202 11.3236 12.7704 11.8217C11.9421 12.4566 11 13.1787 11 15H13C13 13.9046 13.711 13.2833 14.4408 12.6455C15.21 11.9733 16 11.2829 16 10C16 7.79 14.21 6 12 6ZM13 16V18H11V16H13Z"})}),pn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M4 20h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2s.9 2 2 2zm0-3h2v2H4v-2zM2 6c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2zm4 1H4V5h2v2zm-2 7h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2s.9 2 2 2zm0-3h2v2H4v-2z"})}),Lr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})}),es=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),Qt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M7 20h4c0 1.1-.9 2-2 2s-2-.9-2-2zm-2-1h8v-2H5v2zm11.5-9.5c0 3.82-2.66 5.86-3.77 6.5H5.27c-1.11-.64-3.77-2.68-3.77-6.5C1.5 5.36 4.86 2 9 2s7.5 3.36 7.5 7.5zm4.87-2.13L20 8l1.37.63L22 10l.63-1.37L24 8l-1.37-.63L22 6l-.63 1.37zM19 6l.94-2.06L22 3l-2.06-.94L19 0l-.94 2.06L16 3l2.06.94L19 6z"})}),di=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M3 14h4v-4H3v4zm0 5h4v-4H3v4zM3 9h4V5H3v4zm5 5h13v-4H8v4zm0 5h13v-4H8v4zM8 5v4h13V5H8z"})}),ts=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"})}),ns=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})}),rs=()=>e("svg",{viewBox:"0 0 16 16",fill:We("color-error"),children:e("path",{d:"M13.5095 4L8.50952 1H7.50952L2.50952 4L2.01953 4.85999V10.86L2.50952 11.71L7.50952 14.71H8.50952L13.5095 11.71L13.9995 10.86V4.85999L13.5095 4ZM7.50952 13.5601L3.00952 10.86V5.69995L7.50952 8.15002V13.5601ZM3.26953 4.69995L8.00952 1.85999L12.7495 4.69995L8.00952 7.29004L3.26953 4.69995ZM13.0095 10.86L8.50952 13.5601V8.15002L13.0095 5.69995V10.86Z"})}),as=()=>e("svg",{viewBox:"0 0 16 16",fill:We("color-primary"),children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 5H4V4H1.5L1 4.5V12.5L1.5 13H4V12H2V5ZM14.5 4H12V5H14V12H12V13H14.5L15 12.5V4.5L14.5 4ZM11.76 6.56995L12 7V9.51001L11.7 9.95996L7.19995 11.96H6.73999L4.23999 10.46L4 10.03V7.53003L4.30005 7.06995L8.80005 5.06995H9.26001L11.76 6.56995ZM5 9.70996L6.5 10.61V9.28003L5 8.38V9.70996ZM5.57996 7.56006L7.03003 8.43005L10.42 6.93005L8.96997 6.06006L5.57996 7.56006ZM7.53003 10.73L11.03 9.17004V7.77002L7.53003 9.31995V10.73Z"})}),ss=()=>e("svg",{viewBox:"0 0 16 16",fill:We("color-warning"),children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14 2H8L7 3V6H8V3H14V8H10V9H14L15 8V3L14 2ZM9 6H13V7H9.41L9 6.59V6ZM7 7H2L1 8V13L2 14H8L9 13V8L8 7H7ZM8 13H2V8H8V9V13ZM3 9H7V10H3V9ZM3 11H7V12H3V11ZM9 4H13V5H9V4Z"})}),os=()=>e("svg",{viewBox:"0 0 16 16",fill:We("color-primary"),children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 3L8 2H14L15 3V8L14 9H10V8H14V3H8V6H7V3ZM9 9V8L8 7H7H2L1 8V13L2 14H8L9 13V9ZM8 8V9V13H2V8H7H8ZM9.41421 7L9 6.58579V6H13V7H9.41421ZM9 4H13V5H9V4ZM7 10H3V11H7V10Z"})}),Mn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})}),is=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 5.83 15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15z"})}),ls=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10z"})}),cs=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})}),ds=()=>e("svg",{viewBox:"0 0 24 24",children:e("path",{fill:"currentColor",d:"M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z",children:e("animateTransform",{attributeName:"transform",dur:"0.75s",repeatCount:"indefinite",type:"rotate",values:"0 12 12;360 12 12"})})}),ms=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"})}),mi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"})}),ui=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19.79 5.61C20.3 4.95 19.83 4 19 4H6.83l7.97 7.97zM2.81 2.81 1.39 4.22 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-2.17l5.78 5.78 1.41-1.41z"})}),hi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})}),pi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2m0 14H5V8h14z"})}),vi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),fi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M8 12l4-4 4 4m-4-4v12",strokeWidth:"2",stroke:"currentColor",fill:"none"})}),gi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[e("path",{d:"M4 3 L4 15 L1.5 15 L5.5 21 L9.5 15 L7 15 L7 3 Z"}),e("path",{d:"M13 21 L13 9 L10.5 9 L14.5 3 L18.5 9 L16 9 L16 21 Z"})]}),yi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M10.5 3 L10.5 15 L8 15 L12 21 L16 15 L13.5 15 L13.5 3 Z"})}),bi=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M10.5 21 L10.5 9 L8 9 L12 3 L16 9 L13.5 9 L13.5 21 Z"})}),_i=Object.freeze(Object.defineProperty({__proto__:null,AlarmIcon:ja,ArrowDownIcon:Ne,ArrowDropDownIcon:Be,CalendarIcon:un,ChartIcon:Sr,ClockIcon:Dt,CloseIcon:Ie,CodeIcon:Bt,CollapseIcon:ls,CommentIcon:ms,CopyIcon:ht,DeleteIcon:En,DoneIcon:Ln,DownloadIcon:Mn,DragIcon:Er,ErrorIcon:Nr,ExpandIcon:is,FilterIcon:mi,FilterOffIcon:ui,FunctionIcon:as,InfoIcon:et,InfoOutlinedIcon:qt,IssueIcon:Za,KeyboardIcon:Ga,LabelIcon:ss,ListIcon:di,LogoAnomalyIcon:Ba,LogoIcon:qa,LogoShortIcon:Qa,MetricIcon:rs,MinusIcon:Wa,ModalIcon:pi,MoreIcon:Lr,OpenNewIcon:hi,PauseIcon:vi,PlayCircleOutlineIcon:Tn,PlayIcon:nt,PlusIcon:Tr,Prettify:Ka,QuestionIcon:Xa,RefreshIcon:Sn,RestartIcon:Nt,ScrollToTopIcon:fi,SearchIcon:cs,SettingsIcon:it,SortArrowDownIcon:yi,SortArrowUpIcon:bi,SortIcon:gi,SpinnerIcon:ds,StarBorderIcon:ts,StarIcon:ns,StorageIcon:pn,SuccessIcon:Ya,TableIcon:An,TimelineIcon:hn,TipIcon:Qt,TuneIcon:es,ValueIcon:os,VisibilityIcon:Ar,VisibilityOffIcon:Ja,WarningIcon:wr,WikiIcon:lt},Symbol.toStringTag,{value:"Module"})),Ci=({to:t,isNavLink:n,children:r,...a})=>n?e(Ea,{to:t,...a,children:r}):e("div",{...a,children:r}),wi=({activeItem:t,item:n,color:r=We("color-primary"),activeNavRef:a,onChange:s,isNavLink:o})=>{const i=c=>()=>{s&&s(c)};return e(Ci,{className:k({"vm-tabs-item":!0,"vm-tabs-item_active":t===n.value,[n.className||""]:n.className}),isNavLink:o,to:n.value,style:{color:r},onClick:i(n.value),ref:t===n.value?a:void 0,children:[n.icon&&e("div",{className:k({"vm-tabs-item__icon":!0,"vm-tabs-item__icon_single":!n.label}),children:n.icon}),n.label]})};function se(t,n,r,a){const s=W(n);L(()=>{s.current=n},[n]),L(()=>{const o=r?.current??window;if(!(o&&o.addEventListener))return;const i=c=>s.current(c);return o.addEventListener(t,i,a),()=>{o.removeEventListener(t,i,a)}},[t,r,a])}const pt=()=>{const[t,n]=b({width:0,height:0}),r=()=>{n({width:window.innerWidth,height:window.innerHeight})};return se("resize",r),L(r,[]),t},Yt=({activeItem:t,items:n,color:r=We("color-primary"),onChange:a,indicatorPlacement:s="bottom",isNavLink:o})=>{const i=pt(),c=W(null),[l,m]=b({left:0,width:0,bottom:0});return L(()=>{if(c.current?.base instanceof HTMLElement){const{offsetLeft:d,offsetWidth:u,offsetHeight:h}=c.current.base;m({left:d,width:u,bottom:s==="top"?h-2:0})}},[i,t,c,n]),e("div",{className:"vm-tabs",children:[n.map(d=>e(wi,{activeItem:t,item:d,onChange:a,color:r,activeNavRef:c,isNavLink:o},d.value)),e("div",{className:"vm-tabs__indicator",style:{...l,borderColor:r}})]})},bt=[{value:pe.chart,icon:e(Sr,{}),label:"Graph",prometheusCode:0},{value:pe.code,icon:e(Bt,{}),label:"JSON",prometheusCode:3},{value:pe.table,icon:e(An,{}),label:"Table",prometheusCode:1}],us=({tabFilter:t})=>{const{displayType:n}=Re(),r=St(),a=o=>{r({type:"SET_DISPLAY_TYPE",payload:o??n})},s=bt.filter(t??(()=>!0));return e(Yt,{activeItem:n,items:s,onChange:a})},hs=()=>{const t=Ee("g0.tab",0);return bt.find(r=>r.prometheusCode===+t||r.value===t)?.value||pe.chart},ra=Oe("SERIES_LIMITS"),Ni={displayType:hs(),nocache:!1,isTracingEnabled:!1,seriesLimits:ra?JSON.parse(ra):Da,tableCompact:Oe("TABLE_COMPACT")||!1,reduceMemUsage:!1};function Si(t,n){switch(n.type){case"SET_DISPLAY_TYPE":return{...t,displayType:n.payload};case"SET_SERIES_LIMITS":return ke("SERIES_LIMITS",JSON.stringify(n.payload)),{...t,seriesLimits:n.payload};case"TOGGLE_QUERY_TRACING":return{...t,isTracingEnabled:!t.isTracingEnabled};case"TOGGLE_NO_CACHE":return{...t,nocache:!t.nocache};case"TOGGLE_TABLE_COMPACT":return ke("TABLE_COMPACT",!t.tableCompact),{...t,tableCompact:!t.tableCompact};case"TOGGLE_REDUCE_MEM_USAGE":return ke("TABLE_COMPACT",!t.reduceMemUsage),{...t,reduceMemUsage:!t.reduceMemUsage};default:throw new Error}}const Mr=dt({}),Re=()=>De(Mr).state,St=()=>De(Mr).dispatch,Ti=({children:t})=>{const[n,r]=Ct(Si,Ni),a=I(()=>({state:n,dispatch:r}),[n,r]);return e(Mr.Provider,{value:a,children:t})},Ai={customStep:Ee("g0.step_input",""),yaxis:{limits:{enable:!1,range:{1:[0,0]}}},isHistogram:!1,isEmptyHistogram:!1,spanGaps:!1,openSettings:!1};function Ei(t,n){switch(n.type){case"TOGGLE_ENABLE_YAXIS_LIMITS":return{...t,yaxis:{...t.yaxis,limits:{...t.yaxis.limits,enable:!t.yaxis.limits.enable}}};case"SET_CUSTOM_STEP":return{...t,customStep:n.payload};case"SET_YAXIS_LIMITS":return{...t,yaxis:{...t.yaxis,limits:{...t.yaxis.limits,range:n.payload}}};case"SET_IS_HISTOGRAM":return{...t,isHistogram:n.payload};case"SET_IS_EMPTY_HISTOGRAM":return{...t,isEmptyHistogram:n.payload};case"SET_SPAN_GAPS":return{...t,spanGaps:n.payload};case"SET_OPEN_SETTINGS":return{...t,openSettings:n.payload};default:throw new Error}}const xr=dt({}),Le=()=>De(xr).state,Je=()=>De(xr).dispatch,Li=({children:t})=>{const[n,r]=Ct(Ei,Ai),a=I(()=>({state:n,dispatch:r}),[n,r]);return e(xr.Provider,{value:a,children:t})},Mi={dashboardsSettings:[],dashboardsLoading:!1,dashboardsError:""};function xi(t,n){switch(n.type){case"SET_DASHBOARDS_SETTINGS":return{...t,dashboardsSettings:n.payload};case"SET_DASHBOARDS_LOADING":return{...t,dashboardsLoading:n.payload};case"SET_DASHBOARDS_ERROR":return{...t,dashboardsError:n.payload};default:throw new Error}}const kr=dt({}),ps=()=>De(kr).state,ki=()=>De(kr).dispatch,Ii=({children:t})=>{const[n,r]=Ct(xi,Mi),a=I(()=>({state:n,dispatch:r}),[n,r]);return e(kr.Provider,{value:a,children:t})},vs={windows:"Windows",mac:"Mac OS",linux:"Linux"},Di=()=>Object.values(vs).find(t=>navigator.userAgent.indexOf(t)>=0)||"unknown",xn=()=>Di()===vs.mac,Ri=()=>["Android","webOS","iPhone","iPad","iPod","BlackBerry","Windows Phone"].map(r=>navigator.userAgent.match(new RegExp(r,"i"))).some(r=>r);function j(){const t=pt(),n=()=>{const s=Ri(),o=window.innerWidth<500;return s||o},[r,a]=b(n());return L(()=>{a(n())},[t]),{isMobile:r}}const $i={success:e(Ya,{}),error:e(Nr,{}),warning:e(wr,{}),info:e(et,{})},ae=({variant:t,children:n})=>{const{isDarkTheme:r}=ne(),{isMobile:a}=j();return e("div",{className:k({"vm-alert":!0,[`vm-alert_${t}`]:t,"vm-alert_dark":r,"vm-alert_mobile":a}),children:[e("div",{className:"vm-alert__icon",children:$i[t||"info"]}),e("div",{className:"vm-alert__content",children:n})]})},fs=dt({showInfoMessage:()=>{}}),Pi=()=>De(fs),zi=({children:t})=>{const{isMobile:n}=j(),[r,a]=b({text:"",type:"info"}),[s,o]=b(!1),[i,c]=b(null);L(()=>{if(!i)return;a({...i,key:Date.now()}),o(!0);const m=setTimeout(l,i.timeout||4e3);return()=>clearTimeout(m)},[i]);const l=()=>{c(null),o(!1)};return e(fs.Provider,{value:{showInfoMessage:c},children:[s&&e("div",{className:k({"vm-snackbar":!0,"vm-snackbar_mobile":n}),children:e(ae,{variant:r.type,children:e("div",{className:"vm-snackbar-content",children:[e("span",{children:r.text}),e("div",{className:"vm-snackbar-content__close",onClick:l,children:e(Ie,{})})]})})}),t]})},Oi=(...t)=>t.reduce((n,r)=>({children:a})=>e(n,{children:e(r,{children:a})}),({children:n})=>e(F,{children:n})),Hi=[Ho,ei,ci,Ti,Li,zi,Ii],gs=Oi(...Hi);var Rt=(t=>(t[t.internalLink=0]="internalLink",t[t.externalLink=1]="externalLink",t))(Rt||{});const Fi=(t,n)=>({label:"Alerts",value:!!Ot(t)?`${t}/vmalert`:t.replace(/\/prometheus$/,"/vmalert"),type:1,hide:!n}),Vi=t=>[{value:J.trace},{value:J.queryAnalyzer},{value:J.withTemplate},{value:J.relabel},{value:J.downsamplingDebug,hide:!t},{value:J.retentionDebug,hide:!t}],Ui=()=>[{value:J.metrics},{value:J.cardinality},{value:J.topQueries},{value:J.activeQueries}],qi=({serverUrl:t,isEnterpriseLicense:n,showPredefinedDashboards:r,showAlertLink:a})=>[{value:J.home},{value:J.rawQuery},{label:"Explore",submenu:Ui()},{label:"Tools",submenu:Vi(n)},{value:J.dashboards,hide:!r},Fi(t,a)],Bi=()=>[{label:mt[J.anomaly].title,value:J.home}],Xn=({activeMenu:t,label:n,value:r,type:a,color:s})=>a===Rt.externalLink?e("a",{className:k({"vm-header-nav-item":!0,"vm-header-nav-item_active":t===r}),style:{color:s},href:r,target:"_blank",rel:"noreferrer",children:n}):e(Ea,{className:k({"vm-header-nav-item":!0,"vm-header-nav-item_active":t===r}),style:{color:s},to:r,children:n}),kn=(t,n,r)=>{const a=X(s=>{const o=t?.current,i=s.target,c=r?.current&&r.current.contains(i);!o||o.contains(s?.target||null)||c||n(s)},[t,n]);se("mouseup",a),se("touchstart",a)},P=({variant:t="contained",color:n="primary",size:r="medium",ariaLabel:a,children:s,endIcon:o,startIcon:i,fullWidth:c=!1,className:l,disabled:m,onClick:d,onMouseDown:u,"data-id":h})=>{const p=k({"vm-button":!0,[`vm-button_${t}_${n}`]:!0,[`vm-button_${r}`]:r,"vm-button_icon_only":(i||o)&&!s,"vm-button_full-width":c,"vm-button_with-icons":i||o,[l||""]:l});return e("button",{className:p,disabled:m,"aria-label":a,onClick:d,onMouseDown:u,"data-id":h,children:[i,s,o]})},Qe=({children:t,buttonRef:n,placement:r="bottom-left",placementPosition:a,open:s=!1,onClose:o,offset:i={top:6,left:0},clickOutside:c=!0,fullWidth:l,title:m,disabledFullScreen:d,variant:u})=>{const{isMobile:h}=j(),p=gn(),v=tt(),[_,y]=b({width:0,height:0}),[f,g]=b(!1),C=W(null);L(()=>(g(s),!s&&o&&o(),s&&h&&!d&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow="auto"}),[s]),L(()=>{y({width:C?.current?.clientWidth||0,height:C?.current?.clientHeight||0}),g(!1)},[C]);const w=I(()=>{const M=n.current;if(!M||!f)return{};const x=M.getBoundingClientRect(),A={top:0,left:0,width:"auto"},D=r==="bottom-right"||r==="top-right",z=r?.includes("top"),R=i?.top||0,V=i?.left||0;if(A.left=A.left=x.left+V,A.top=x.height+x.top+R,D&&(A.left=x.right-_.width),z&&(A.top=x.top-_.height-R),r==="fixed"&&a)return A.top=Math.max(a.top+i.top,0),A.left=Math.max(a.left+i.left,0),A;const{innerWidth:O,innerHeight:q}=window,Q=A.top+_.height>q,re=A.top<0,Z=A.left+_.width>O,te=A.left<0;return Q&&(A.top=x.top-_.height-R),re&&(A.top=x.height+x.top+R),Z&&(A.left=x.right-_.width-V),te&&(A.left=x.left+V),l&&(A.width=`${x.width}px`),A.top<0&&(A.top=0),A.left<0&&(A.left=0),A},[n,r,f,t,l]),E=M=>{M.stopPropagation(),o()},N=()=>{g(!1),o()},S=()=>{c&&N()};L(()=>{if(!C.current||!f||h&&!d)return;const{right:M,width:x}=C.current.getBoundingClientRect();if(M>window.innerWidth){const A=window.innerWidth-x;C.current.style.left=`${A}px`}},[f,C,a]);const T=X(()=>{f&&h&&!d&&(p(v,{replace:!0}),o())},[f,h,d,v,o]);return se("scroll",N),se("popstate",T),kn(C,S,n),e(F,{children:(f||!_.width)&&wt(e("div",{className:k({"vm-popper":!0,[`vm-popper_${u}`]:u,"vm-popper_mobile":h&&!d,"vm-popper_open":(h||Object.keys(w).length)&&f}),ref:C,style:h&&!d?{}:w,children:[(m||h&&!d)&&e("div",{className:"vm-popper-header",children:[e("p",{className:"vm-popper-header__title",children:m}),e(P,{variant:"text",color:u==="dark"?"white":"primary",size:"small",onClick:E,ariaLabel:"close",children:e(Ie,{})})]}),t]}),document.body)})},ce=t=>{const[n,r]=b(!!t),a=X(()=>r(!0),[]),s=X(()=>r(!1),[]),o=X(()=>r(i=>!i),[]);return{value:n,setValue:r,setTrue:a,setFalse:s,toggle:o}},Qi=({activeMenu:t,label:n,color:r,background:a,submenu:s,direction:o})=>{const{pathname:i}=tt(),[c,l]=b(null),m=W(null),{value:d,setFalse:u,setTrue:h}=ce(!1),p=()=>{h(),c&&clearTimeout(c)},v=()=>{c&&clearTimeout(c);const y=setTimeout(u,300);l(y)},_=()=>{c&&clearTimeout(c)};return L(()=>{u()},[i]),o==="column"?e(F,{children:s.map(y=>e(Xn,{activeMenu:t,value:y.value||"",label:y.label||"",type:y.type||Rt.internalLink},y.value))}):e("div",{className:k({"vm-header-nav-item":!0,"vm-header-nav-item_sub":!0,"vm-header-nav-item_open":d,"vm-header-nav-item_active":s.find(y=>y.value===t)}),style:{color:r},onMouseEnter:p,onMouseLeave:v,ref:m,children:[n,e(Be,{}),e(Qe,{open:d,placement:"bottom-left",offset:{top:12,left:0},onClose:u,buttonRef:m,children:e("div",{className:"vm-header-nav-item-submenu",style:{background:a},onMouseLeave:v,onMouseEnter:_,children:s.map(y=>e(Xn,{activeMenu:t,value:y.value||"",label:y.label||"",color:r,type:y.type||Rt.internalLink},y.value))})})]})},Yi=t=>{try{return t.replace(/^\/+/,"").replace(/-/g," ").trim().replace(/^\w/,n=>n.toUpperCase())}catch{return t}},ys=t=>t.filter(n=>!n.hide).map(n=>{const r={...n};return r.value&&!r.label&&(r.label=mt[r.value]?.title||Yi(r.value)),r.submenu&&r.submenu.length>0&&(r.submenu=ys(r.submenu)),r}),ji=()=>{const t=Se(),{dashboardsSettings:n}=ps(),{serverUrl:r,flags:a,appConfig:s}=ne(),o=s.license?.type==="enterprise",i=!!a["vmalert.proxyURL"],c=!!(!t&&n.length),l=I(()=>({serverUrl:r,isEnterpriseLicense:o,showAlertLink:i,showPredefinedDashboards:c}),[r,o,i,c]),m=I(()=>{switch(Ft){case Ht.vmanomaly:return Bi();default:return qi(l)}},[l]);return ys(m)},bs=({color:t,background:n,direction:r})=>{const{pathname:a}=tt(),[s,o]=b(a),i=ji();return L(()=>{o(a)},[a]),e("nav",{className:k({"vm-header-nav":!0,[`vm-header-nav_${r}`]:r}),children:i.map(c=>c.submenu?e(Qi,{activeMenu:s,label:c.label||"",submenu:c.submenu,color:t,background:n,direction:r},c.label):e(Xn,{activeMenu:s,value:c.value||"",label:c.label||"",color:t,type:c.type||Rt.internalLink},c.value))})},Me=({title:t,children:n,onClose:r,className:a,isOpen:s=!0})=>{const{isMobile:o}=j(),i=gn(),c=tt(),l=X(h=>{s&&h.key==="Escape"&&r()},[s]),m=h=>{h.stopPropagation()},d=X(()=>{s&&(i(c,{replace:!0}),r())},[s,c,r]);return L(()=>{if(s)return document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}},[s]),se("popstate",d),se("keyup",l),wt(e("div",{className:k({"vm-modal":!0,"vm-modal_mobile":o,[`${a}`]:a}),onMouseDown:r,children:e("div",{className:"vm-modal-content",onMouseDown:m,children:[e("div",{className:"vm-modal-content-header",children:[t&&e("div",{className:"vm-modal-content-header__title",children:t}),e("div",{className:"vm-modal-header__close",children:e(P,{variant:"text",size:"small",onClick:r,ariaLabel:"close",children:e(Ie,{})})})]}),e("div",{className:"vm-modal-content-body",tabIndex:0,children:n})]})}),document.body)},G=({children:t,title:n,open:r,placement:a="bottom-center",offset:s={top:6,left:0}})=>{const{isMobile:o}=j(),[i,c]=b(!1),[l,m]=b({width:0,height:0}),d=W(null),u=W(null),h=()=>c(!1);L(()=>{if(!(!u.current||!i))return m({width:u.current.clientWidth,height:u.current.clientHeight}),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[i,n]);const p=I(()=>{const y=d?.current?.base;if(!y||!i)return{};const f=y.getBoundingClientRect(),g={top:0,left:0},C=a==="bottom-right"||a==="top-right",w=a==="bottom-left"||a==="top-left",E=a?.includes("top"),N=s?.top||0,S=s?.left||0;g.left=f.left-(l.width-f.width)/2+S,g.top=f.height+f.top+N,C&&(g.left=f.right-l.width),w&&(g.left=f.left+S),E&&(g.top=f.top-l.height-N);const{innerWidth:T,innerHeight:M}=window,x=20,A=g.top+l.height+x>M,D=g.top-x<0,z=g.left+l.width+x>T,R=g.left-x<0;return A&&(g.top=f.top-l.height-N),D&&(g.top=f.height+f.top+N),z&&(g.left=f.right-l.width-S),R&&(g.left=f.left+S),g.top<0&&(g.top=20),g.left<0&&(g.left=20),g},[d,a,i,l]),v=()=>{typeof r!="boolean"&&c(!0)},_=()=>{c(!1)};return L(()=>{typeof r=="boolean"&&c(r)},[r]),L(()=>{const y=d?.current?.base;if(y)return y.addEventListener("mouseenter",v),y.addEventListener("mouseleave",_),()=>{y.removeEventListener("mouseenter",v),y.removeEventListener("mouseleave",_)}},[d]),e(F,{children:[e(F,{ref:d,children:t}),!o&&i&&wt(e("div",{className:"vm-tooltip",ref:u,style:p,children:n}),document.body)]})},an=e("code",{children:xn()?"Cmd":"Ctrl"}),Gi=[{title:"Zoom in",description:e(F,{children:["To zoom in, hold down the ",an," + ",e("code",{children:"scroll up"}),", or press the ",e("code",{children:"+"}),". Also, you can zoom in on a range on the graph by holding down your mouse button and selecting the range."]})},{title:"Zoom out",description:e(F,{children:["To zoom out, hold down the ",an," + ",e("code",{children:"scroll down"}),", or press the ",e("code",{children:"-"}),"."]})},{title:"Move horizontal axis",description:e(F,{children:["To move the graph, hold down the ",an," + ",e("code",{children:"drag"})," the graph to the right or left."]})},{title:"Fixing a tooltip",description:e(F,{children:["To fix the tooltip, ",e("code",{children:"click"})," mouse when it's open. Then, you can drag the fixed tooltip by ",e("code",{children:"clicking"})," and ",e("code",{children:"dragging"})," on the ",e(Er,{})," icon."]})},{title:"Set a custom range for the vertical axis",description:e(F,{children:["To set a custom range for the vertical axis, click on the ",e(it,{})," icon located in the upper right corner of the graph, activate the toggle, and set the values."]})}],Wi=[{title:"Show/hide a legend item",description:e(F,{children:[e("code",{children:"click"})," on a legend item to isolate it on the graph.",an," + ",e("code",{children:"click"})," on a legend item to remove it from the graph. To revert to the previous state, click again."]})},{title:"Copy label key-value pairs",description:e(F,{children:[e("code",{children:"click"})," on a label key-value pair to save it to the clipboard."]})},{title:"Collapse/Expand the legend group",description:e(F,{children:[e("code",{children:"click"})," on the group name (e.g. ",e("b",{children:'Query 1: {__name__!=""}'}),") to collapse or expand the legend."]})}],Ji=Gi.concat(Wi),Ir=()=>{const{value:t,setFalse:n,setTrue:r}=ce(!1);return e(F,{children:[e(G,{title:"Show tips on working with the graph",children:e(P,{variant:"text",color:"gray",startIcon:e(Qt,{}),onClick:r,ariaLabel:"open the tips"})}),t&&e(Me,{title:"Tips on working with the graph and the legend",onClose:n,children:e("div",{className:"fc-graph-tips",children:Ji.map(({title:a,description:s})=>e("div",{className:"fc-graph-tips-item",children:[e("h4",{className:"fc-graph-tips-item__action",children:a}),e("p",{className:"fc-graph-tips-item__description",children:s})]},a))})})]})},rt=e("code",{children:xn()?"Cmd":"Ctrl"}),_s=e(F,{children:[e("code",{children:xn()?"Option":"Ctrl"})," + ",e("code",{children:"Space"})]}),Ki=[{title:"Query",list:[{keys:e("code",{children:"Enter"}),description:"Run"},{keys:e(F,{children:[e("code",{children:"Shift"})," + ",e("code",{children:"Enter"})]}),description:"Multi-line queries"},{keys:e(F,{children:[rt," + ",e("code",{children:"Arrow Up"})]}),description:"Previous command from the Query history"},{keys:e(F,{children:[rt," + ",e("code",{children:"Arrow Down"})]}),description:"Next command from the Query history"},{keys:e(F,{children:[rt," + ",e("code",{children:"click"})," by ",e(Ar,{})]}),description:"Toggle multiple queries"},{keys:_s,description:"Show quick autocomplete tips"}]},{title:"Graph",readMore:e(Ir,{}),list:[{keys:e(F,{children:[rt," + ",e("code",{children:"scroll Up"})," or ",e("code",{children:"+"})]}),description:"Zoom in"},{keys:e(F,{children:[rt," + ",e("code",{children:"scroll Down"})," or ",e("code",{children:"-"})]}),description:"Zoom out"},{keys:e(F,{children:[rt," + ",e("code",{children:"drag"})]}),description:"Move the graph left/right"},{keys:e(F,{children:e("code",{children:"click"})}),description:"Select the series in the legend"},{keys:e(F,{children:[rt," + ",e("code",{children:"click"})]}),description:"Toggle multiple series in the legend"}]}],Vn="Shortcut keys",er=xn(),Zi=er?"Cmd + /":"F1",Dr=({showTitle:t})=>{const n=Se(),{value:r,setTrue:a,setFalse:s}=ce(!1),o=X(i=>{const c=er&&i.key==="/"&&i.metaKey,l=!er&&i.key==="F1"&&!i.metaKey;(c||l)&&a()},[a]);return se("keydown",o),e(F,{children:[e(G,{open:t===!0?!1:void 0,title:`${Vn} (${Zi})`,placement:"bottom-center",children:e(P,{className:n?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(Ga,{}),onClick:a,ariaLabel:Vn,children:t&&Vn})}),r&&e(Me,{title:"Shortcut keys",onClose:s,children:e("div",{className:"vm-shortcuts",children:Ki.map(i=>e("div",{className:"vm-shortcuts-section",children:[i.readMore&&e("div",{className:"vm-shortcuts-section__read-more",children:i.readMore}),e("h3",{className:"vm-shortcuts-section__title",children:i.title}),e("div",{className:"vm-shortcuts-section-list",children:i.list.map((c,l)=>e("div",{className:"vm-shortcuts-section-list-item",children:[e("div",{className:"vm-shortcuts-section-list-item__key",children:c.keys}),e("p",{className:"vm-shortcuts-section-list-item__description",children:c.description})]},`${i.title}_${l}`))})]},i.title))})})]})},Xi=({open:t})=>e("button",{className:k({"vm-menu-burger":!0,"vm-menu-burger_opened":t}),"aria-label":"menu",children:e("span",{})}),el=({background:t,color:n})=>{const{pathname:r}=tt(),{isMobile:a}=j(),s=W(null),{value:o,toggle:i,setFalse:c}=ce(!1);return L(c,[r]),kn(s,c),e("div",{className:"vm-header-sidebar",ref:s,children:[e("div",{className:k({"vm-header-sidebar-button":!0,"vm-header-sidebar-button_open":o}),onClick:i,children:e(Xi,{open:o})}),e("div",{className:k({"vm-header-sidebar-menu":!0,"vm-header-sidebar-menu_open":o}),children:[e("div",{children:e(bs,{color:n,background:t,direction:"column"})}),e("div",{className:"vm-header-sidebar-menu-settings",children:!a&&e(Dr,{showTitle:!0})})]})]})},tl=t=>`${t.replace(/^(.+)(\/select.+)/,"$1")}/admin/tenants`,nl=()=>{const{useTenantID:t}=zt(),n=Se(),{serverUrl:r}=ne(),[a,s]=b(!1),[o,i]=b(),[c,l]=b([]),m=I(()=>tl(r),[r]),d=I(()=>!!Ot(r),[r]),u=n?!t:!d;return L(()=>{if(u)return;(async()=>{s(!0);try{const p=await fetch(m),v=await p.json(),_=v.data||[];l(_.sort((y,f)=>y.localeCompare(f))),p.ok?i(void 0):i(`${v.errorType}\r
${v?.error}`)}catch(p){p instanceof Error&&i(`${p.name}: ${p.message}`)}s(!1)})().catch(console.error)},[m]),{accountIds:c,isLoading:a,error:o}},rl=({controlsComponent:t,isMobile:n,...r})=>{const a=Se(),{pathname:s}=tt(),{accountIds:o}=nl(),{value:i,toggle:c,setFalse:l}=ce(!1),m=I(()=>(mt[s]||{}).header||{},[s]),d=e(t,{...r,isMobile:n,accountIds:o,headerSetup:m});return n?e(F,{children:[e("div",{children:e(P,{className:k({"vm-header-button":!a}),startIcon:e(Lr,{}),onClick:c,ariaLabel:"controls"})}),e(Me,{title:"Controls",onClose:l,isOpen:i,className:k({"vm-header-controls-modal":!0,"vm-header-controls-modal_open":i}),children:d})]}):d},aa=()=>{switch(Ft){case Ht.vmanomaly:return e(Ba,{});default:return e(qa,{})}},Cs=({controlsComponent:t})=>{const{isMobile:n}=j(),r=pt(),a=I(()=>window.innerWidth<1e3,[r]),{isDarkTheme:s}=ne(),o=Se(),i=I(()=>We(s?"color-background-block":"color-primary"),[s]),{background:c,color:l}=I(()=>{const{headerStyles:{background:u=o?"#FFF":i,color:h=o?i:"#FFF"}={}}=zt();return{background:u,color:h}},[i]),m=gn(),d=()=>{m({pathname:J.home}),window.location.reload()};return e("header",{className:k({"vm-header":!0,"vm-header_app":o,"vm-header_dark":s,"vm-header_sidebar":a,"vm-header_mobile":n}),style:{background:c,color:l},children:[a?e(el,{background:c,color:l}):e(F,{children:[!o&&e("div",{className:"vm-header-logo",onClick:d,style:{color:l},children:e(aa,{})}),e(bs,{color:l,background:c})]}),a&&e("div",{className:k({"vm-header-logo":!0,"vm-header-logo_mobile":!0}),onClick:d,style:{color:l},children:e(aa,{})}),e(rl,{controlsComponent:t,displaySidebar:a,isMobile:n})]})},al={href:"https://github.com/VictoriaMetrics/VictoriaMetrics/issues/new/choose",Icon:Za,title:"Create an issue"},sl=[{href:"https://docs.victoriametrics.com/victoriametrics/metricsql/",Icon:Bt,title:"MetricsQL"},{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#vmui",Icon:lt,title:"Documentation"},al],ws=Ao(({links:t=sl})=>{const n=`2019-${new Date().getFullYear()}`;return e("footer",{className:"vm-footer",children:[e("a",{className:"vm-link vm-footer__website",target:"_blank",href:"https://victoriametrics.com/",rel:"me noreferrer",children:[e(Qa,{}),"victoriametrics.com"]}),t.map(({href:r,Icon:a,title:s})=>e("a",{className:"vm-link vm-footer__link",target:"_blank",href:r,rel:"help noreferrer",children:[e(a,{}),s]},`${r}-${s}`)),e("div",{className:"vm-footer__copyright",children:["© ",n," VictoriaMetrics"]})]})}),ol=async t=>await(await fetch(`./dashboards/${t}`)).json(),il=()=>{const t=Se(),{serverUrl:n}=ne(),r=ki(),[a,s]=b(!1),[o,i]=b(""),[c,l]=b([]),m=async()=>{try{const u=window.__VMUI_PREDEFINED_DASHBOARDS__;if(!u?.length)return[];const h=await Promise.all(u.map(async p=>ol(p)));l(p=>[...h,...p])}catch(u){u instanceof Error&&i(`${u.name}: ${u.message}`)}},d=async()=>{if(n){i(""),s(!0);try{const u=await fetch(`${n}/vmui/custom-dashboards`),h=await u.json();if(u.ok){const{dashboardsSettings:p}=h;p&&p.length>0?l(v=>[...v,...p]):await m(),s(!1)}else await m(),i(h.error),s(!1)}catch(u){s(!1),u instanceof Error&&i(`${u.name}: ${u.message}`),await m()}}};return L(()=>{t||(l([]),d())},[n]),L(()=>{r({type:"SET_DASHBOARDS_SETTINGS",payload:c})},[c]),L(()=>{r({type:"SET_DASHBOARDS_LOADING",payload:a})},[a]),L(()=>{r({type:"SET_DASHBOARDS_ERROR",payload:o})},[o]),{dashboardsSettings:c,isLoading:a,error:o}},ll=({error:t,warning:n,info:r})=>{const a=W(null),[s,o]=b(!1),[i,c]=b(!1),m=`${I(()=>t?"ERROR: ":n?"WARNING: ":"",[t,n])}${t||n||r}`,d=()=>{const h=a.current;if(h){const{offsetWidth:p,scrollWidth:v,offsetHeight:_,scrollHeight:y}=h,f=p+1<v||_+1<y;o(f)}else o(!1)},u=()=>{s&&(c(!0),o(!1))};return L(()=>{c(!1),d()},[a,m]),se("resize",d),!t&&!n&&!r?null:e("span",{className:k({"vm-text-field__error":!0,"vm-text-field__warning":n&&!t,"vm-text-field__helper-text":!n&&!t,"vm-text-field__error_overflowed":s,"vm-text-field__error_full":i}),"data-show":!!m,ref:a,onClick:u,children:m})},oe=({label:t,value:n,type:r="text",error:a="",warning:s="",helperText:o="",placeholder:i,endIcon:c,startIcon:l,disabled:m=!1,autofocus:d=!1,inputmode:u="text",caretPosition:h,onChange:p,onEnter:v,onKeyDown:_,onFocus:y,onBlur:f,onChangeCaret:g})=>{const{isDarkTheme:C}=ne(),{isMobile:w}=j(),E=W(null),N=W(null),S=I(()=>r==="textarea"?N:E,[r]),T=k({"vm-text-field__input":!0,"vm-text-field__input_error":a,"vm-text-field__input_warning":!a&&s,"vm-text-field__input_icon-start":l,"vm-text-field__input_disabled":m,"vm-text-field__input_textarea":r==="textarea"}),M=q=>{if(!g)return;const{selectionStart:Q,selectionEnd:re}=q;g&&g([Q||0,re||0])},x=q=>{M(q.currentTarget)},A=q=>{_&&_(q);const{key:Q,ctrlKey:re,metaKey:Z}=q,te=Q==="Enter";(r!=="textarea"?te:te&&(Z||re))&&v&&(q.preventDefault(),v())},D=q=>{M(q.currentTarget)},z=q=>{m||(p&&p(q.currentTarget.value),M(q.currentTarget))},R=()=>{y&&y()},V=()=>{f&&f()},O=q=>{try{S.current&&S.current.setSelectionRange(q[0],q[1])}catch(Q){return Q}};return L(()=>{!d||w||S?.current?.focus&&S.current.focus()},[S,d]),L(()=>{h&&O(h)},[h]),e("label",{className:k({"vm-text-field":!0,"vm-text-field_textarea":r==="textarea","vm-text-field_dark":C}),"data-replicated-value":n,children:[l&&e("div",{className:"vm-text-field__icon-start",children:l}),c&&e("div",{className:"vm-text-field__icon-end",children:c}),r==="textarea"?e("textarea",{className:T,disabled:m,ref:N,value:n,rows:1,inputMode:u,placeholder:i,autoCapitalize:"none",onInput:z,onKeyDown:A,onKeyUp:D,onFocus:R,onBlur:V,onMouseUp:x}):e("input",{className:T,disabled:m,ref:E,value:n,type:r,placeholder:i,inputMode:u,autoCapitalize:"none",onInput:z,onKeyDown:A,onKeyUp:D,onFocus:R,onBlur:V,onMouseUp:x}),t&&e("span",{className:"vm-text-field__label",children:t}),e(ll,{error:a,warning:s,info:o})]})},Ns=({accountIds:t})=>{const n=Se(),{isMobile:r}=j(),{tenantId:a,serverUrl:s}=ne(),o=ut(),i=Ue(),[c,l]=b(""),m=W(null),{value:d,toggle:u,setFalse:h}=ce(!1),p=I(()=>{if(!c)return t;try{const y=new RegExp(c,"i");return t.filter(g=>y.test(g)).sort((g,C)=>(g.match(y)?.index||0)-(C.match(y)?.index||0))}catch{return[]}},[c,t]),v=I(()=>t.length>1,[t]),_=y=>()=>{const f=y;if(o({type:"SET_TENANT_ID",payload:f}),s){const g=ka(s,f);if(g===s)return;o({type:"SET_SERVER",payload:g}),i({type:"RUN_QUERY"})}h()};return L(()=>{const y=Ot(s);a&&a!==y?_(a)():_(y)()},[s]),v?e("div",{className:"vm-tenant-input",children:[e(G,{title:"Define Tenant ID if you need request to another storage",children:e("div",{ref:m,children:r?e("div",{className:"vm-mobile-option",onClick:u,children:[e("span",{className:"vm-mobile-option__icon",children:e(pn,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Tenant ID"}),e("span",{className:"vm-mobile-option-text__value",children:a})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ne,{})})]}):e(P,{className:n?"":"vm-header-button",variant:"contained",color:"primary",fullWidth:!0,startIcon:e(pn,{}),endIcon:e("div",{className:k({"vm-execution-controls-buttons__arrow":!0,"vm-execution-controls-buttons__arrow_open":d}),children:e(Ne,{})}),onClick:u,children:a})})}),e(Qe,{open:d,placement:"bottom-right",onClose:h,buttonRef:m,title:r?"Define Tenant ID":void 0,children:e("div",{className:k({"vm-list vm-tenant-input-list":!0,"vm-list vm-tenant-input-list_mobile":r}),children:[e("div",{className:"vm-tenant-input-list__search",children:e(oe,{autofocus:!0,label:"Search",value:c,onChange:l,type:"search"})}),p.map(y=>e("div",{className:k({"vm-list-item":!0,"vm-list-item_mobile":r,"vm-list-item_active":y===a}),onClick:_(y),children:y},y))]})})]}):null};function $t(t){const n=W();return L(()=>{n.current=t},[t]),n.current}const _e=({text:t,href:n,children:r,colored:a=!0,underlined:s=!1,withIcon:o=!1})=>e("a",{href:n,className:k({"vm-link":!0,"vm-link_colored":a,"vm-link_underlined":s,"vm-link_with-icon":o}),target:"_blank",rel:"noreferrer",children:t||r}),Ss=()=>{const t=Se(),{isMobile:n}=j(),{customStep:r,isHistogram:a}=Le(),{period:{step:s,end:o,start:i}}=ve(),c=Je(),{displayType:l}=Re(),m=$t(o-i),d=I(()=>Vt(o-i,a,l),[o,i,a,l]),u=$t(d),[h,p]=b(r||d),[v,_]=b(""),y=r===d,{value:f,toggle:g,setFalse:C}=ce(!1),w=W(null),E=A=>{const D=A||h||d||"1s",R=(D.match(/[a-zA-Z]+/g)||[]).length?D:`${D}s`;c({type:"SET_CUSTOM_STEP",payload:R}),p(R),_("")},N=()=>{E(),C()},S=()=>{document.activeElement instanceof HTMLInputElement&&document.activeElement.select()},T=()=>{E(),N()},M=A=>{const D=A.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/g)||[],z=A.match(/[a-zA-Z]+/g)||[],R=D.length&&D.every(q=>parseFloat(q)>0),V=z.every(q=>vr.find(Q=>Q.short===q)),O=R&&V;p(A),_(O?"":ye.validStep)},x=()=>{const A=d||"1s";M(A),E(A)};return L(()=>{r&&E(r)},[r]),L(()=>{!r&&d&&E(d)},[d]),L(()=>{o-i===m||!m||r!==u||d&&E(d)},[m,d]),L(()=>{(s===r||s===d)&&E(d)},[a,l]),e("div",{className:"vm-step-control",ref:w,children:[n?e("div",{className:"vm-mobile-option",onClick:g,children:[e("span",{className:"vm-mobile-option__icon",children:e(hn,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Step"}),e("span",{className:"vm-mobile-option-text__value",children:h})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ne,{})})]}):e(P,{className:t?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(hn,{}),onClick:g,children:["Step: ",y?`auto (${h})`:h]}),e(Qe,{open:f,placement:"bottom-right",onClose:N,buttonRef:w,title:n?"Query resolution step width":void 0,children:e("div",{className:k({"vm-step-control-popper":!0,"vm-step-control-popper_mobile":n}),children:[e(oe,{autofocus:!0,label:"Step value",value:h,error:v,onChange:M,onEnter:T,onFocus:S,onBlur:E,endIcon:e(G,{title:`Reset to auto step (${d})`,children:e(P,{size:"small",variant:"text",color:"primary",startIcon:e(Nt,{}),onClick:x,ariaLabel:"reset step"})})}),e("div",{className:"vm-step-control-popper-info",children:[e("p",{children:[e("code",{children:"step"})," - the ",e(_e,{href:"https://prometheus.io/docs/prometheus/latest/querying/basics/#time-durations",text:"interval"})," between datapoints, which must be returned from the range query. The ",e("code",{children:"query"})," is executed at ",e("code",{children:"start"}),", ",e("code",{children:"start+step"}),", ",e("code",{children:"start+2*step"}),", …, ",e("code",{children:"end"})," timestamps."]}),e("p",{children:["Read more about ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#range-query",text:"Range"})," and ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#instant-query",text:"Instant"})," queries."]})]})]})})]})},cl=({relativeTime:t,setDuration:n})=>{const{isMobile:r}=j(),a=s=>()=>{n(s)};return e("div",{className:k({"vm-time-duration":!0,"vm-time-duration_mobile":r}),children:dn.map(({id:s,duration:o,until:i,title:c})=>e("div",{className:k({"vm-list-item":!0,"vm-list-item_mobile":r,"vm-list-item_active":s===t}),onClick:a({duration:o,until:i(),id:s}),children:c||o},s))})},dl=({viewDate:t,showArrowNav:n,onChangeViewDate:r,toggleDisplayYears:a})=>{const s=()=>{r(t.subtract(1,"month"))},o=()=>{r(t.add(1,"month"))};return e("div",{className:"vm-calendar-header",children:[e("div",{className:"vm-calendar-header-left",onClick:a,children:[e("span",{className:"vm-calendar-header-left__date",children:t.format("MMMM YYYY")}),e("div",{className:"vm-calendar-header-left__select-year",children:e(Be,{})})]}),n&&e("div",{className:"vm-calendar-header-right",children:[e("div",{className:"vm-calendar-header-right__prev",onClick:s,children:e(Ne,{})}),e("div",{className:"vm-calendar-header-right__next",onClick:o,children:e(Ne,{})})]})]})},ml=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ul=({viewDate:t,selectDate:n,onChangeSelectDate:r})=>{const a="YYYY-MM-DD",s=U.tz(),o=U(t.format(a)),i=I(()=>{const l=new Array(42).fill(null),m=o.startOf("month"),u=o.endOf("month").diff(m,"day")+1,h=new Array(u).fill(m).map((v,_)=>v.add(_,"day")),p=m.day();return l.splice(p,u,...h),l},[o]),c=l=>()=>{l&&r(l)};return e("div",{className:"vm-calendar-body",children:[ml.map(l=>e(G,{title:l,children:e("div",{className:"vm-calendar-body-cell vm-calendar-body-cell_weekday",children:l[0]})},l)),i.map((l,m)=>e("div",{className:k({"vm-calendar-body-cell":!0,"vm-calendar-body-cell_day":!0,"vm-calendar-body-cell_day_empty":!l,"vm-calendar-body-cell_day_active":(l&&l.format(a))===n.format(a),"vm-calendar-body-cell_day_today":(l&&l.format(a))===s.format(a)}),onClick:c(l),children:l&&l.format("D")},l?l.format(a):m))]})},hl=({viewDate:t,onChangeViewDate:n})=>{const r=U().format("YYYY"),a=I(()=>t.format("YYYY"),[t]),s=I(()=>{const l=U().subtract(18/2,"year");return new Array(18).fill(l).map((m,d)=>m.add(d,"year"))},[t]);L(()=>{const i=document.getElementById(`vm-calendar-year-${a}`);i&&i.scrollIntoView({block:"center"})},[]);const o=i=>()=>{n(i)};return e("div",{className:"vm-calendar-years",children:s.map(i=>e("div",{className:k({"vm-calendar-years__year":!0,"vm-calendar-years__year_selected":i.format("YYYY")===a,"vm-calendar-years__year_today":i.format("YYYY")===r}),id:`vm-calendar-year-${i.format("YYYY")}`,onClick:o(i),children:i.format("YYYY")},i.format("YYYY")))})},pl=({viewDate:t,selectDate:n,onChangeViewDate:r})=>{const a=U().format("MM"),s=I(()=>n.format("MM"),[n]),o=I(()=>new Array(12).fill("").map((c,l)=>U(t).month(l)),[t]);L(()=>{const c=document.getElementById(`vm-calendar-year-${s}`);c&&c.scrollIntoView({block:"center"})},[]);const i=c=>()=>{r(c)};return e("div",{className:"vm-calendar-years",children:o.map(c=>e("div",{className:k({"vm-calendar-years__year":!0,"vm-calendar-years__year_selected":c.format("MM")===s,"vm-calendar-years__year_today":c.format("MM")===a}),id:`vm-calendar-year-${c.format("MM")}`,onClick:i(c),children:c.format("MMMM")},c.format("MM")))})},vl=({date:t,format:n=Ve,onChange:r})=>{const[a,s]=b(0),[o,i]=b(U.tz(t)),[c,l]=b(U.tz(t)),m=U.tz(),d=m.format(st)===o.format(st),{isMobile:u}=j(),h=()=>{s(y=>y===2?0:2)},p=y=>{i(y),s(f=>f===2?1:0)},v=y=>{l(y)},_=()=>{i(m)};return L(()=>{c.format()!==U.tz(t).format()&&r(c.format(n))},[c]),L(()=>{const y=U.tz(t);i(y),l(y)},[t]),e("div",{className:k({"vm-calendar":!0,"vm-calendar_mobile":u}),children:[e(dl,{viewDate:o,onChangeViewDate:p,toggleDisplayYears:h,showArrowNav:a===0}),a===0&&e(ul,{viewDate:o,selectDate:c,onChangeSelectDate:v}),a===2&&e(hl,{viewDate:o,onChangeViewDate:p}),a===1&&e(pl,{selectDate:c,viewDate:o,onChangeViewDate:p}),!d&&a===0&&e("div",{className:"vm-calendar-footer",children:e(P,{variant:"text",size:"small",onClick:_,children:"show today"})})]})},Ts=yn(({date:t,targetRef:n,format:r=Ve,onChange:a,label:s},o)=>{const i=I(()=>U(t).isValid()?U.tz(t):U().tz(),[t]),{isMobile:c}=j(),{value:l,toggle:m,setFalse:d}=ce(!1),u=p=>{a(p),d()},h=p=>{(p.key==="Escape"||p.key==="Enter")&&d()};return se("click",m,n),se("keyup",h),e(F,{children:e(Qe,{open:l,buttonRef:n,placement:"bottom-right",onClose:d,title:c?s:void 0,children:e("div",{ref:o,children:e(vl,{date:i,format:r,onChange:u})})})})}),sa=t=>U(t).isValid()?U.tz(t).format(Ve):t,oa=({value:t="",label:n,pickerLabel:r,pickerRef:a,onChange:s,onEnter:o})=>{const i=W(null),[c,l]=b(null),[m,d]=b(sa(t)),[u,h]=b(!1),[p,v]=b(!1),_=U(m).isValid()?"":"Invalid date format",y=w=>{d(w.currentTarget.value)},f=()=>{s(m)},g=w=>{w.key==="Enter"&&(s(m),v(!0))},C=w=>{d(w),h(!0)};return L(()=>{const w=sa(t);w!==m&&d(w),p&&(o(),v(!1))},[t]),L(()=>{u&&c&&(c.focus(),c.setSelectionRange(11,11),h(!1))},[u]),e("div",{className:k({"vm-date-time-input":!0,"vm-date-time-input_error":_}),children:[e("label",{children:n}),e(Eo,{tabIndex:1,inputRef:l,mask:"9999-99-99 99:99:99",placeholder:"YYYY-MM-DD HH:mm:ss",value:m,autoCapitalize:"none",inputMode:"numeric",maskChar:null,onChange:y,onBlur:f,onKeyUp:g}),_&&e("span",{className:"vm-date-time-input__error-text",children:_}),e("div",{className:"vm-date-time-input__icon",ref:i,children:e(P,{variant:"text",color:"gray",size:"small",startIcon:e(un,{}),ariaLabel:"calendar"})}),e(Ts,{label:r,ref:a,date:m,onChange:C,targetRef:i})]})},As=()=>{const{isMobile:t}=j(),{isDarkTheme:n}=ne(),r=W(null),a=pt(),s=I(()=>a.width>1120,[a]),[o,i]=b(),[c,l]=b(),{period:{end:m,start:d},relativeTime:u,timezone:h,duration:p}=ve(),v=Ue(),_=Se(),y=$t(h),{value:f,toggle:g,setFalse:C}=ce(!1),w=I(()=>({region:h,utc:It(h)}),[h]);L(()=>{i(xt(He(m)))},[h,m]),L(()=>{l(xt(He(d)))},[h,d]);const E=({duration:R,until:V,id:O})=>{v({type:"SET_RELATIVE_TIME",payload:{duration:R,until:V,id:O}}),C()},N=I(()=>{const R=U.tz(He(d)).format(Ve),V=U.tz(He(m)).format(Ve);return{start:R,end:V}},[d,m,h]),S=I(()=>u&&u!=="none"?u.replace(/_/g," "):`${N.start} - ${N.end}`,[u,N]),T=W(null),M=W(null),x=W(null),A=()=>{c&&o&&v({type:"SET_PERIOD",payload:{from:U.tz(c).toDate(),to:U.tz(o).toDate()}}),C()},D=()=>v({type:"RUN_QUERY_TO_NOW"}),z=()=>{i(xt(He(m))),l(xt(He(d))),C()};return L(()=>{const R=yr({relativeTimeId:u,defaultDuration:p,defaultEndInput:He(m)});y&&h!==y&&E({id:R.relativeTimeId,duration:R.duration,until:R.endInput})},[h,y]),kn(r,R=>{if(t)return;const V=R.target,O=T?.current&&T?.current?.contains(V),q=M?.current&&M?.current?.contains(V);O||q||C()}),e(F,{children:[e("div",{ref:x,children:t?e("div",{className:"vm-mobile-option",onClick:g,children:[e("span",{className:"vm-mobile-option__icon",children:e(Dt,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Time range"}),e("span",{className:"vm-mobile-option-text__value",children:S})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ne,{})})]}):e(G,{title:s?"Time range controls":S,children:e(P,{className:_?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(Dt,{}),onClick:g,ariaLabel:"time range controls",children:s&&e("span",{children:S})})})}),e(Qe,{open:f,buttonRef:x,placement:"bottom-right",onClose:C,clickOutside:!1,title:t?"Time range controls":"",children:e("div",{className:k({"vm-time-selector":!0,"vm-time-selector_mobile":t}),ref:r,children:[e("div",{className:"vm-time-selector-left",children:[e("div",{className:k({"vm-time-selector-left-inputs":!0,"vm-time-selector-left-inputs_dark":n}),children:[e(oa,{value:c,label:"From:",pickerLabel:"Date From",pickerRef:T,onChange:l,onEnter:A}),e(oa,{value:o,label:"To:",pickerLabel:"Date To",pickerRef:M,onChange:i,onEnter:A})]}),e("div",{className:"vm-time-selector-left-timezone",children:[e("div",{className:"vm-time-selector-left-timezone__title",children:w.region}),e("div",{className:"vm-time-selector-left-timezone__utc",children:w.utc})]}),e(P,{variant:"text",startIcon:e(ja,{}),onClick:D,children:"switch to now"}),e("div",{className:"vm-time-selector-left__controls",children:[e(P,{color:"error",variant:"outlined",onClick:z,children:"Cancel"}),e(P,{color:"primary",onClick:A,children:"Apply"})]})]}),e(cl,{relativeTime:u||"",setDuration:E})]})})]})},Tt=()=>{const t=gn(),[n,r]=me();return{setSearchParamsFromKeys:X(s=>{const o=!!Array.from(n.values()).length;let i=!1;Object.entries(s).forEach(([c,l])=>{n.get(c)!==`${l}`&&(n.set(c,`${l}`),i=!0)}),i&&(o?r(n):t(`?${n.toString()}`,{replace:!0}))},[n,t])}},Es=()=>{const{isMobile:t}=j(),n=Se(),r=W(null),[a]=me(),{setSearchParamsFromKeys:s}=Tt(),o=a.get("date")||U().tz().format(st),i=I(()=>U.tz(o).format(st),[o]),c=l=>{s({date:l})};return L(()=>{c(o)},[]),e("div",{children:[e("div",{ref:r,children:t?e("div",{className:"vm-mobile-option",children:[e("span",{className:"vm-mobile-option__icon",children:e(un,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Date control"}),e("span",{className:"vm-mobile-option-text__value",children:i})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ne,{})})]}):e(G,{title:"Date control",children:e(P,{className:n?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(un,{}),children:i})})}),e(Ts,{label:"Date control",date:o||"",format:st,onChange:c,targetRef:r})]})},Un=[{seconds:0,title:"Off"},{seconds:1,title:"1s"},{seconds:2,title:"2s"},{seconds:5,title:"5s"},{seconds:10,title:"10s"},{seconds:30,title:"30s"},{seconds:60,title:"1m"},{seconds:300,title:"5m"},{seconds:900,title:"15m"},{seconds:1800,title:"30m"},{seconds:3600,title:"1h"},{seconds:7200,title:"2h"}],Ls=()=>{const{isMobile:t}=j(),n=Ue(),r=Se(),[a,s]=b(!1),[o,i]=b(Un[0]),{value:c,toggle:l,setFalse:m}=ce(!1),d=W(null),u=v=>{(a&&!v.seconds||!a&&v.seconds)&&s(_=>!_),i(v),m()},h=()=>{n({type:"RUN_QUERY"})};L(()=>{const v=o.seconds;let _;return a?_=setInterval(()=>{n({type:"RUN_QUERY"})},v*1e3):i(Un[0]),()=>{_&&clearInterval(_)}},[o,a]);const p=v=>()=>{u(v)};return e(F,{children:[e("div",{className:"vm-execution-controls",children:e("div",{className:k({"vm-execution-controls-buttons":!0,"vm-execution-controls-buttons_mobile":t,"vm-header-button":!r}),children:[!t&&e(G,{title:"Refresh dashboard",children:e(P,{variant:"contained",color:"primary",onClick:h,startIcon:e(Sn,{}),ariaLabel:"refresh dashboard"})}),t?e("div",{className:"vm-mobile-option",onClick:l,children:[e("span",{className:"vm-mobile-option__icon",children:e(Nt,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Auto-refresh"}),e("span",{className:"vm-mobile-option-text__value",children:o.title})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ne,{})})]}):e(G,{title:"Auto-refresh control",children:e("div",{ref:d,children:e(P,{variant:"contained",color:"primary",fullWidth:!0,endIcon:e("div",{className:k({"vm-execution-controls-buttons__arrow":!0,"vm-execution-controls-buttons__arrow_open":c}),children:e(Ne,{})}),onClick:l,children:o.title})})})]})}),e(Qe,{open:c,placement:"bottom-right",onClose:m,buttonRef:d,title:t?"Auto-refresh duration":void 0,children:e("div",{className:k({"vm-execution-controls-list":!0,"vm-execution-controls-list_mobile":t}),children:Un.map(v=>e("div",{className:k({"vm-list-item":!0,"vm-list-item_mobile":t,"vm-list-item_active":v.seconds===o.seconds}),onClick:p(v),children:v.title},v.seconds))})})]})},ia={enable:"Enable to save the modified server URL to local storage, preventing reset upon page refresh.",disable:"Disable to stop saving the server URL to local storage, reverting to the default URL on page refresh."},fl=yn(({onClose:t},n)=>{const{serverUrl:r}=ne(),a=ut(),{value:s,toggle:o}=ce(!!Oe("SERVER_URL")),[i,c]=b(r),[l,m]=b(""),d=h=>{c(h||""),m("")},u=X(()=>{const h=Ot(i);h!==""&&a({type:"SET_TENANT_ID",payload:h}),a({type:"SET_SERVER",payload:i}),t()},[i]);return L(()=>{r||m(ye.emptyServer),ur(r)||m(ye.validServer)},[r]),L(()=>{s?ke("SERVER_URL",i):dr(["SERVER_URL"])},[s]),L(()=>{s&&ke("SERVER_URL",i)},[i]),L(()=>{r!==i&&c(r)},[r]),ir(n,()=>({handleApply:u}),[u]),e("div",{children:[e("div",{className:"vm-server-configurator__title",children:"Server URL"}),e("div",{className:"vm-server-configurator-url",children:[e(oe,{autofocus:!0,value:i,error:l,onChange:d,onEnter:u,inputmode:"url"}),e(G,{title:s?ia.disable:ia.enable,children:e(P,{className:"vm-server-configurator-url__button",variant:"text",color:s?"primary":"gray",onClick:o,startIcon:e(pn,{})})})]})]})}),gl=[{label:"Graph",type:pe.chart},{label:"JSON",type:pe.code},{label:"Table",type:pe.table}],yl=yn(({onClose:t},n)=>{const{isMobile:r}=j(),{seriesLimits:a}=Re(),s=St(),[o,i]=b(a),[c,l]=b({table:"",chart:"",code:""}),m=()=>{i(Da)},d=h=>p=>{const v=p||"";l(_=>({..._,[h]:+v<0?ye.positiveNumber:""})),i({...o,[h]:v||1/0})},u=X(()=>{s({type:"SET_SERIES_LIMITS",payload:o}),t()},[o]);return ir(n,()=>({handleApply:u}),[u]),e("div",{className:"vm-limits-configurator",children:[e("div",{className:"vm-server-configurator__title",children:["Series limits by tabs",e(G,{title:"Set to 0 to disable the limit",children:e(P,{variant:"text",color:"primary",size:"small",startIcon:e(et,{})})}),e("div",{className:"vm-limits-configurator-title__reset",children:e(P,{variant:"text",color:"primary",size:"small",startIcon:e(Nt,{}),onClick:m,children:"Reset limits"})})]}),e("div",{className:k({"vm-limits-configurator__inputs":!0,"vm-limits-configurator__inputs_mobile":r}),children:gl.map(h=>e("div",{children:e(oe,{label:h.label,value:o[h.type],error:c[h.type],onChange:d(h.type),onEnter:u,type:"number"})},h.type))})]})}),Rr=({defaultExpanded:t=!1,onChange:n,title:r,children:a})=>{const[s,o]=b(t),i=()=>{const c=window.getSelection();c&&c.toString()||o(l=>{const m=!l;return n&&n(m),m})};return L(()=>{o(t)},[t]),e(F,{children:[e("header",{className:`vm-accordion-header ${s&&"vm-accordion-header_open"}`,onClick:i,children:[r,e("div",{className:`vm-accordion-header__arrow ${s&&"vm-accordion-header__arrow_open"}`,children:e(Ne,{})})]}),s&&e("section",{className:"vm-accordion-section",children:a},"content")]})},bl="Browser timezone is not recognized, supported, or could not be determined.",_l=()=>e(G,{title:bl,children:e(wr,{})}),Jt=br(),Cl=yn((t,n)=>{const{isMobile:r}=j(),a=ea(),{timezone:s,defaultTimezone:o}=ve(),i=Ue(),[c,l]=b(s),[m,d]=b(""),u=W(null),{value:h,toggle:p,setFalse:v}=ce(!1),_=I(()=>[{title:`Default time (${o})`,region:o,utc:o?It(o):"UTC"},{title:Jt.title,region:Jt.region,utc:It(Jt.region),isInvalid:!Jt.isValid},{title:"UTC (Coordinated Universal Time)",region:"UTC",utc:"UTC"}].filter(N=>N.region),[o]),y=I(()=>{if(!m)return a;try{return ea(m)}catch{return{}}},[m,a]),f=I(()=>Object.keys(y),[y]),g=I(()=>({region:c,utc:It(c)}),[c]),C=N=>{d(N)},w=N=>{l(N.region),d(""),v()},E=N=>()=>{w(N)};return L(()=>{l(s)},[s]),ir(n,()=>({handleApply:()=>{i({type:"SET_TIMEZONE",payload:c})}}),[c]),e("div",{className:"vm-timezones",children:[e("div",{className:"vm-server-configurator__title",children:"Time zone"}),e("div",{className:"vm-timezones-item vm-timezones-item_selected",onClick:p,ref:u,children:[e("div",{className:"vm-timezones-item__title",children:g.region}),e("div",{className:"vm-timezones-item__utc",children:g.utc}),e("div",{className:k({"vm-timezones-item__icon":!0,"vm-timezones-item__icon_open":h}),children:e(Be,{})})]}),e(Qe,{open:h,buttonRef:u,placement:"bottom-left",onClose:v,fullWidth:!0,title:r?"Time zone":void 0,children:e("div",{className:k({"vm-timezones-list":!0,"vm-timezones-list_mobile":r}),children:[e("div",{className:"vm-timezones-list-header",children:[e("div",{className:"vm-timezones-list-header__search",children:e(oe,{autofocus:!0,label:"Search",value:m,onChange:C})}),_.map((N,S)=>N&&e("div",{className:"vm-timezones-item vm-timezones-list-group-options__item",onClick:E(N),children:[e("div",{className:"vm-timezones-item__title",children:[N.title,N.isInvalid&&e(_l,{})]}),e("div",{className:"vm-timezones-item__utc",children:N.utc})]},`${S}_${N.region}`))]}),f.map(N=>e("div",{className:"vm-timezones-list-group",children:e(Rr,{defaultExpanded:!0,title:e("div",{className:"vm-timezones-list-group__title",children:N}),children:e("div",{className:"vm-timezones-list-group-options",children:y[N]&&y[N].map(S=>e("div",{className:"vm-timezones-item vm-timezones-list-group-options__item",onClick:E(S),children:[e("div",{className:"vm-timezones-item__title",children:S.region}),e("div",{className:"vm-timezones-item__utc",children:S.utc})]},S.search))})})},N))]})})]})}),wl=({options:t,value:n,label:r,onChange:a})=>{const s=W(null),[o,i]=b({width:"0px",left:"0px",borderRadius:"0px"}),c=l=>()=>{a(l)};return L(()=>{if(!s.current){i({width:"0px",left:"0px",borderRadius:"0px"});return}const l=t.findIndex(p=>p.value===n),{width:m}=s.current.getBoundingClientRect();let d=m,u=l*d,h="0";l===0&&(h="16px 0 0 16px"),l===t.length-1&&(h="10px",u-=1,h="0 16px 16px 0"),l!==0&&l!==t.length-1&&(d+=1,u-=1),i({width:`${d}px`,left:`${u}px`,borderRadius:h})},[s,n,t]),e("div",{className:"vm-toggles",children:[r&&e("label",{className:"vm-toggles__label",children:r}),e("div",{className:"vm-toggles-group",style:{gridTemplateColumns:`repeat(${t.length}, 1fr)`},children:[o.borderRadius&&e("div",{className:"vm-toggles-group__highlight",style:o}),t.map((l,m)=>e("div",{className:k({"vm-toggles-group-item":!0,"vm-toggles-group-item_first":m===0,"vm-toggles-group-item_active":l.value===n,"vm-toggles-group-item_icon":l.icon&&l.title}),onClick:c(l.value),ref:l.value===n?s:null,children:[l.icon,l.title]},l.value))]})]})},Nl=Object.values(ze).map(t=>({title:t,value:t})),Sl=()=>{const{isMobile:t}=j(),n=ut(),{theme:r}=ne(),a=s=>{n({type:"SET_THEME",payload:s})};return e("div",{className:k({"vm-theme-control":!0,"vm-theme-control_mobile":t}),children:[e("div",{className:"vm-server-configurator__title",children:"Theme preferences"}),e("div",{className:"vm-theme-control__toggle",children:e(wl,{options:Nl,value:r,onChange:a})},`${t}`)]})},qn="Settings",Ms=()=>{const{isMobile:t}=j(),n=Se(),r=W(null),a=W(null),s=W(null),{value:o,setTrue:i,setFalse:c}=ce(!1),l=()=>{r.current&&r.current.handleApply(),a.current&&a.current.handleApply(),s.current&&s.current.handleApply(),c()},m=[{show:!n,component:e(fl,{ref:r,onClose:c})},{show:!0,component:e(yl,{ref:a,onClose:c})},{show:!0,component:e(Cl,{ref:s})},{show:!n,component:e(Sl,{})}].filter(d=>d.show);return e(F,{children:[t?e("div",{className:"vm-mobile-option",onClick:i,children:[e("span",{className:"vm-mobile-option__icon",children:e(it,{})}),e("div",{className:"vm-mobile-option-text",children:e("span",{className:"vm-mobile-option-text__label",children:qn})}),e("span",{className:"vm-mobile-option__arrow",children:e(Ne,{})})]}):e(G,{title:qn,children:e(P,{className:k({"vm-header-button":!n}),variant:"contained",color:"primary",startIcon:e(it,{}),onClick:i,ariaLabel:"settings"})}),o&&e(Me,{title:qn,onClose:c,children:e("div",{className:k({"vm-server-configurator":!0,"vm-server-configurator_mobile":t}),children:[m.map((d,u)=>e("div",{className:"vm-server-configurator__input",children:d.component},u)),e("div",{className:"vm-server-configurator-footer",children:[e(P,{color:"error",variant:"outlined",onClick:c,children:"Cancel"}),e(P,{color:"primary",variant:"contained",onClick:l,children:"Apply"})]})]})})]})},Tl=({displaySidebar:t,isMobile:n,headerSetup:r,accountIds:a})=>e("div",{className:k({"vm-header-controls":!0,"vm-header-controls_mobile":n}),children:[r?.tenant&&e(Ns,{accountIds:a||[]}),r?.stepControl&&e(Ss,{}),r?.timeSelector&&e(As,{}),r?.cardinalityDatePicker&&e(Es,{}),r?.executionControls&&e(Ls,{}),e(Ms,{}),!t&&e(Dr,{})]}),Al=!!Oe("DISABLED_DEFAULT_TIMEZONE"),xs=()=>{const{serverUrl:t}=ne(),n=Ue(),[r,a]=b(!1),[s,o]=b(""),i=l=>{const m=l.toLowerCase()==="local"?br().region:l;try{if(U().tz(m).isValid(),n({type:"SET_DEFAULT_TIMEZONE",payload:m}),Al)return;n({type:"SET_TIMEZONE",payload:m})}catch(d){d instanceof Error&&o(`${d.name}: ${d.message}`)}},c=async()=>{if(t){o(""),a(!0);try{const l=await fetch(`${t}/vmui/timezone`),m=await l.json();l.ok?(i(m.timezone),a(!1)):(o(m.error),a(!1))}catch(l){a(!1),l instanceof Error&&o(`${l.name}: ${l.message}`)}}};return L(()=>{c()},[t]),{isLoading:r,error:s}},El=()=>{const{serverUrl:t}=ne(),n=ut(),[r,a]=b(!1),[s,o]=b("");return L(()=>{(async()=>{if(t){o(""),a(!0);try{const c=xo(t).replace(/\/prometheus\/?$/,""),d=(await(await fetch(`${c}/flags`)).text()).split(`
`).filter(u=>u.trim()!=="").reduce((u,h)=>{const[p,v]=h.split("="),_=p.trim().replace(/^-/,"");return u[_.trim()]=v?v.trim().replace(/^"(.*)"$/,"$1"):null,u},{});n({type:"SET_FLAGS",payload:d})}catch(c){a(!1),c instanceof Error&&o(`${c.name}: ${c.message}`)}}})()},[t]),{isLoading:r,error:s}},Ll=()=>{const t=ut(),[n,r]=b(!1),[a,s]=b("");return L(()=>{(async()=>{s(""),r(!0);try{const c=await(await fetch("./config.json")).json();t({type:"SET_APP_CONFIG",payload:c||{}})}catch(i){r(!1),i instanceof Error&&s(`${i.name}: ${i.message}`)}})()},[]),{isLoading:n,error:a}},Ml=()=>{const t=Se(),{isMobile:n}=j(),{pathname:r}=tt(),[a,s]=me();il(),xs(),Ll(),El();const o=()=>{const c="vmui",l=mt[r]?.title;document.title=l?`${l} - ${c}`:c},i=()=>{const{search:c,href:l}=window.location;if(c){const d=or.parse(c,{ignoreQueryPrefix:!0});Object.entries(d).forEach(([u,h])=>a.set(u,h)),s(a),window.location.search=""}const m=l.replace(/\/\?#\//,"/#/");m!==l&&window.location.replace(m)};return L(o,[r]),L(i,[]),e("section",{className:"vm-container",children:[e(Cs,{controlsComponent:Tl}),e("div",{className:k({"vm-container-body":!0,"vm-container-body_mobile":n,"vm-container-body_app":t}),children:e(La,{})}),!t&&e(ws,{})]})},xl=`No match! 
This query hasn't selected any time series from database.
Either the requested metrics are missing in the database,
or there is a typo in series selector.`,kl=`The shown results are marked as PARTIAL.
The result is marked as partial if one or more vmstorage nodes failed to respond to the query.`,Il=({value:t,onChange:n,onEnter:r,onArrowUp:a,onArrowDown:s,autocomplete:o,autocompleteEl:i,error:c,stats:l,label:m,disabled:d=!1,includeFunctions:u=!0})=>{const{autocompleteQuick:h}=Te(),{isMobile:p}=j(),[v,_]=b(!1),[y,f]=b([0,0]),[g,C]=b([0,0]),w=W(null),[E,N]=b(!1),S=W(bn(N,500)).current,T=[{show:l?.seriesFetched==="0"&&!l.resultLength,text:xl},{show:l?.isPartial,text:kl}].filter(z=>z.show).map(z=>z.text).join("");l&&(m=`${m} (${l.executionTimeMsec||0}ms)`);const M=(z,R)=>{n(z),C([R,R])},x=z=>{const{key:R,ctrlKey:V,metaKey:O,shiftKey:q}=z,re=(z.target.value||"").split(`
`).length>1,Z=V||O,te=R==="ArrowUp",ie=R==="ArrowDown",B=R==="Enter";te&&Z&&(z.preventDefault(),a()),ie&&Z&&(z.preventDefault(),s()),B&&v&&z.preventDefault(),B&&!q&&(!re||Z)&&!v&&(z.preventDefault(),r())},A=z=>{_(!!z.length)},D=z=>{f(R=>R[0]===z[0]&&R[1]===z[1]?R:z)};return L(()=>{_(!!i&&h)},[h]),L(()=>{N(!1),S(y.every(Boolean))},[y]),e("div",{className:"vm-query-editor",ref:w,children:[e(oe,{value:t,label:m,type:"textarea",autofocus:!p,error:c,warning:T,onKeyDown:x,onChange:n,onChangeCaret:D,disabled:d,inputmode:"search",caretPosition:g}),E&&o&&i&&e(i,{value:t,anchorEl:w,caretPosition:y,hasHelperText:!!(T||c),includeFunctions:u,onSelect:M,onFoundOptions:A})]})},Fe=({value:t=!1,disabled:n=!1,label:r,color:a="secondary",fullWidth:s,onChange:o})=>{const i=()=>{n||o(!t)},c=k({"vm-switch":!0,"vm-switch_full-width":s,"vm-switch_disabled":n,"vm-switch_active":t,[`vm-switch_${a}_active`]:t,[`vm-switch_${a}`]:a});return e("div",{className:c,onClick:i,children:[e("div",{className:"vm-switch-track",children:e("div",{className:"vm-switch-track__thumb"})}),r&&e("span",{className:"vm-switch__label",children:r})]})},la=({isMobile:t,hideButtons:n})=>{const{autocomplete:r}=Te(),a=Ut(),{nocache:s,isTracingEnabled:o,reduceMemUsage:i}=Re(),c=St(),l=()=>{c({type:"TOGGLE_NO_CACHE"})},m=()=>{c({type:"TOGGLE_REDUCE_MEM_USAGE"})},d=()=>{c({type:"TOGGLE_QUERY_TRACING"})},u=()=>{a({type:"TOGGLE_AUTOCOMPLETE"})},h=()=>{a({type:"SET_AUTOCOMPLETE_QUICK",payload:!0})};return se("keydown",v=>{const{code:_,ctrlKey:y,altKey:f}=v;_==="Space"&&(y||f)&&(v.preventDefault(),h())}),e("div",{className:k({"vm-additional-settings":!0,"vm-additional-settings_mobile":t}),children:[!n?.autocomplete&&e(G,{title:e(F,{children:["Quick tip: ",_s]}),children:e(Fe,{label:"Autocomplete",value:r,onChange:u,fullWidth:t})}),!n?.disableCache&&e(Fe,{label:"Disable cache",value:s,onChange:l,fullWidth:t}),!n?.reduceMemUsage&&e(Fe,{label:"Disable deduplication",value:i,onChange:m,fullWidth:t}),!n?.traceQuery&&e(Fe,{label:"Trace query",value:o,onChange:d,fullWidth:t})]})},Dl=t=>{const{isMobile:n}=j(),r=W(null),{value:a,toggle:s,setFalse:o}=ce(!1);return n?e(F,{children:[e("div",{ref:r,children:e(P,{variant:"outlined",startIcon:e(es,{}),onClick:s,ariaLabel:"additional the query settings"})}),e(Qe,{open:a,buttonRef:r,placement:"bottom-left",onClose:o,title:"Query settings",children:e(la,{isMobile:n,...t})})]}):e(la,{...t})},In=(t,n)=>t.length===n.length&&t.every((r,a)=>r===n[a]);function Rl(t,n){const r=t.reduce((a,s)=>{const o=n.map(i=>`${String(i)}: ${s[i]||"-"}`).join("|");return(a[o]=a[o]||[]).push(s),a},{});return Object.entries(r).map(([a,s])=>({keys:a.split("|"),values:s}))}const $l=()=>{const{serverUrl:t}=ne();return async r=>{try{const a=encodeURIComponent(r),s=`${t}/prettify-query?query=${a}`,o=await fetch(s);if(o.status!=200)return{query:r,error:"Error requesting /prettify-query, status: "+o.status};const i=await o.json();return i.status!="success"?{query:r,error:String(i.msg)}:{query:String(i.query),error:""}}catch(a){return console.error(a),a instanceof Error&&a.name!=="AbortError"?{query:r,error:`${a.name}: ${a.message}`}:{query:r,error:String(a)}}}},Ye=()=>{const{showInfoMessage:t}=Pi();return async(n,r)=>{if(!navigator?.clipboard)return t({text:e(Pl,{}),type:"error",timeout:2e4}),!1;try{return await navigator.clipboard.writeText(n),r&&t({text:r,type:"success"}),!0}catch(a){return a instanceof Error&&t({text:`${a.name}: ${a.message}`,type:"error"}),console.warn("Copy failed",a),!1}}},Pl=()=>e("div",{className:"vm-snackbar-details",children:[e("p",{className:"vm-snackbar-details__title",children:"Clipboard not supported"}),window.isSecureContext?e("p",{className:"vm-snackbar-details__msg",children:[e("p",{children:"Common reasons:"}),e("ul",{children:[e("li",{children:"Browser restrictions"}),e("li",{children:"Insecure connection (HTTP)"}),e("li",{children:"Permissions not granted"})]}),e("p",{children:["For detailed information, visit the ",e("a",{className:"vm-link vm-link_underlined vm-link_colored",href:"https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API#security_considerations",target:"_blank",rel:"noopener noreferrer",children:"Clipboard API documentation"})]})]}):e("p",{className:"vm-snackbar-details__msg",children:[e("p",{children:"This page is not running in a secure context (HTTPS)."}),e("p",{children:"Clipboard operations require a secure context."}),e("a",{className:"vm-link vm-link_underlined vm-link_colored",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",rel:"noopener noreferrer",children:"Learn more about secure contexts"})]})]}),zl=({query:t,favorites:n,onRun:r,onToggleFavorite:a})=>{const s=Ye(),o=I(()=>n.includes(t),[t,n]);return e("div",{className:"vm-query-history-item",children:[e("span",{className:"vm-query-history-item__value",children:t}),e("div",{className:"vm-query-history-item__buttons",children:[e(G,{title:"Execute query",children:e(P,{size:"small",variant:"text",onClick:()=>{r(t)},startIcon:e(Tn,{})})}),e(G,{title:"Copy query",children:e(P,{size:"small",variant:"text",onClick:async()=>{await s(t,"Query has been copied")},startIcon:e(ht,{})})}),e(G,{title:o?"Remove Favorite":"Add to Favorites",children:e(P,{size:"small",variant:"text",color:o?"warning":"primary",onClick:()=>{a(t,o)},startIcon:o?e(ns,{}):e(ts,{})})})]})]})},at={session:"session",storage:"saved",favorite:"favorite"},ca=[{label:"Session history",value:at.session},{label:"Saved history",value:at.storage},{label:"Favorite queries",value:at.favorite}],Ol=({handleSelectQuery:t,historyKey:n})=>{const{queryHistory:r}=Te(),{isMobile:a}=j(),{value:s,setTrue:o,setFalse:i}=ce(!1),[c,l]=b(ca[0].value),[m,d]=b(Mt(n,"QUERY_HISTORY")),[u,h]=b(Mt(n,"QUERY_FAVORITES")),p=I(()=>r.map(E=>E.values.filter(N=>N).reverse()),[r]),v=I(()=>{switch(c){case at.favorite:return u;case at.storage:return m;default:return p}},[c,u,m,p]),_=v?.every(E=>!E.length),y=I(()=>{switch(c){case at.favorite:return`Favorites queries are empty.
To see your favorites, mark a query as a favorite.`;default:return`Query history is empty.
To see the history, please make a query.`}},[c]),f=E=>N=>{t(N,E),i()},g=(E,N)=>{h(S=>{const T=S[0]||[];return N?[T.filter(M=>M!==E)]:!N&&!T.includes(E)?[[...T,E]]:S})},C=()=>{d(Mt(n,"QUERY_HISTORY")),h(Mt(n,"QUERY_FAVORITES"))},w=()=>{ri(n,"QUERY_HISTORY")};return L(()=>{const E=u[0]||[],N=Mt(n,"QUERY_FAVORITES")[0]||[];In(E,N)||ni(n,u)},[u]),se("storage",C),e(F,{children:[e(G,{title:"Show history",children:e(P,{color:"primary",variant:"text",onClick:o,startIcon:e(Dt,{}),ariaLabel:"Show history"})}),s&&e(Me,{title:"Query history",onClose:i,children:e("div",{className:k({"vm-query-history":!0,"vm-query-history_mobile":a}),children:[e("div",{className:k({"vm-query-history__tabs":!0,"vm-section-header__tabs":!0,"vm-query-history__tabs_mobile":a}),children:e(Yt,{activeItem:c,items:ca,onChange:l})}),e("div",{className:"vm-query-history-list",children:[_&&e("div",{className:"vm-query-history-list__no-data",children:y}),v.map((E,N)=>e("div",{children:[v.length>1&&e("div",{className:k({"vm-query-history-list__group-title":!0,"vm-query-history-list__group-title_first":N===0}),children:["Query ",N+1]}),E.map((S,T)=>e(zl,{query:S,favorites:u.flat(),onRun:f(N),onToggleFavorite:g},T))]},N)),c===at.storage&&!_&&e("div",{className:"vm-query-history-footer",children:e(P,{color:"error",variant:"outlined",size:"small",startIcon:e(En,{}),onClick:w,children:"clear history"})})]})]})})]})},$e=({containerStyles:t,message:n})=>{const{isDarkTheme:r}=ne();return e("div",{className:k({"vm-spinner":!0,"vm-spinner_dark":r}),style:t,children:[e("div",{className:"half-circle-spinner",children:[e("div",{className:"circle circle-1"}),e("div",{className:"circle circle-2"})]}),n&&e("div",{className:"vm-spinner__message",children:n})]})},Hl=()=>{const{serverUrl:t}=ne(),{isMobile:n}=j(),{value:r,setTrue:a,setFalse:s}=ce(!1),{query:o}=Te(),{period:i}=ve(),[c,l]=b(!1),[m,d]=b(""),[u,h]=b(""),[p,v]=b(""),_=async()=>{l(!0);try{const f=encodeURIComponent(o[0]||""),g=encodeURIComponent(i.step||Vt(i.end-i.start,!1)),C=`${t}/api/vmanomaly/config.yaml?query=${f}&step=${g}`,w=await fetch(C),E=w.headers.get("Content-Type");if(w.ok)if(E=="application/yaml"){const N=await w.blob(),S=await N.text();d(S),h(URL.createObjectURL(N))}else v("Response Content-Type is not YAML, does `Server URL` point to VMAnomaly server?");else{const N=await w.text();v(` ${w.status} ${w.statusText}: ${N}`)}}catch(f){console.error(f),v(String(f))}l(!1)};return e(F,{children:[e(P,{color:"secondary",variant:"outlined",onClick:()=>(a(),v(""),URL.revokeObjectURL(u),d(""),h(""),_()),children:"Open Config"}),r&&e(Me,{title:"Download config",onClose:s,children:e("div",{className:k({"vm-anomaly-config":!0,"vm-anomaly-config_mobile":n}),children:[c&&e($e,{containerStyles:{position:"relative"},message:"Loading config..."}),!c&&p&&e("div",{className:"vm-anomaly-config-error",children:[e("div",{className:"vm-anomaly-config-error__icon",children:e(Nr,{})}),e("h3",{className:"vm-anomaly-config-error__title",children:"Cannot download config"}),e("p",{className:"vm-anomaly-config-error__text",children:p})]}),!c&&m&&e(oe,{value:m,label:"config.yaml",type:"textarea",disabled:!0}),e("div",{className:"vm-anomaly-config-footer",children:u&&e("a",{href:u,download:"config.yaml",children:e(P,{variant:"contained",startIcon:e(Mn,{}),children:"download"})})})]})})]})},ks=({value:t,options:n,anchor:r,disabled:a,minLength:s=2,fullWidth:o,selected:i,noOptionsText:c,label:l,disabledFullScreen:m,offset:d,maxDisplayResults:u,loading:h,onSelect:p,onOpenAutocomplete:v,onFoundOptions:_,onChangeWrapperRef:y})=>{const{isMobile:f}=j(),g=W(null),[C,w]=b({index:-1}),[E,N]=b(""),[S,T]=b(0),{value:M,setValue:x,setFalse:A}=ce(!1),D=I(()=>{if(!M)return[];try{const Z=new RegExp(String(t.trim()),"i"),ie=n.filter(B=>Z.test(B.value)).sort((B,$)=>B.value.toLowerCase()===t.trim().toLowerCase()?-1:$.value.toLowerCase()===t.trim().toLowerCase()?1:(B.value.match(Z)?.index||0)-($.value.match(Z)?.index||0));return T(ie.length),N(ie.length>Number(u?.limit)&&u?.message||""),u?.limit?ie.slice(0,u.limit):ie}catch{return[]}},[M,n,t]),z=I(()=>D.length===1&&D[0]?.value===t,[D]),R=I(()=>c&&!D.length,[c,D]),V=Z=>()=>{a||(p(Z.value,Z),i||A())},O=Z=>()=>{w({index:Z,type:0})},q=()=>{w({index:-1})},Q=()=>{if(!g.current||C.type===0)return;const Z=g.current.childNodes[C.index];Z?.scrollIntoView&&Z.scrollIntoView({block:"center"})},re=X(Z=>{const{key:te,ctrlKey:ie,metaKey:B,shiftKey:$}=Z,H=ie||B||$,Y=D.length&&!z;if(te==="ArrowUp"&&!H&&Y&&(Z.preventDefault(),w(({index:K})=>({index:K<=0?0:K-1,type:1}))),te==="ArrowDown"&&!H&&Y){Z.preventDefault();const K=D.length-1;w(({index:le})=>({index:le>=K?K:le+1,type:1}))}if(te==="Enter"){const K=D[C.index];K&&p(K.value,K),i||A()}te==="Escape"&&A()},[C,D,z,A,p,i]);return L(()=>{x(t.length>=s)},[t,n]),se("keydown",re),L(Q,[C,D]),L(()=>{w({index:-1})},[D]),L(()=>{v&&v(M)},[M]),L(()=>{_&&_(z?[]:D)},[D,z]),L(()=>{y&&y(g)},[g]),e(Qe,{open:M,buttonRef:r,placement:"bottom-left",onClose:A,fullWidth:o,title:f?l:void 0,disabledFullScreen:m,offset:d,children:[e("div",{className:k({"vm-autocomplete":!0,"vm-autocomplete_mobile":f&&!m}),ref:g,children:[h&&e("div",{className:"vm-autocomplete__loader",children:[e(Sn,{}),e("span",{children:"Loading..."})]}),R&&e("div",{className:"vm-autocomplete__no-options",children:c}),!z&&D.map((Z,te)=>e("div",{className:k({"vm-list-item":!0,"vm-list-item_mobile":f,"vm-list-item_active":te===C.index,"vm-list-item_multiselect":i,"vm-list-item_multiselect_selected":i?.includes(Z.value),"vm-list-item_with-icon":Z.icon}),id:`$autocomplete$${Z.value}`,onClick:V(Z),onMouseEnter:O(te),onMouseLeave:q,children:[i?.includes(Z.value)&&e(Ln,{}),e(F,{children:Z.icon}),e("span",{children:Z.value})]},`${te}${Z.value}`))]}),E&&e("div",{className:"vm-autocomplete-message",children:["Shown ",u?.limit," results out of ",S,". ",E]}),D[C.index]?.description&&e("div",{className:"vm-autocomplete-info",children:[e("div",{className:"vm-autocomplete-info__type",children:D[C.index].type}),e("div",{className:"vm-autocomplete-info__description",dangerouslySetInnerHTML:{__html:D[C.index].description||""}})]})]})},vn=t=>t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),Kt=t=>JSON.stringify(t).slice(1,-1),Is=t=>{const n=t.match(/["`']/g);return n?n.length%2!==0:!1},Fl={metric:e(rs,{}),label:e(ss,{}),labelValue:e(os,{})},Vl=({valueByContext:t,metric:n,label:r,context:a})=>{const{serverUrl:s}=ne(),{period:{start:o,end:i}}=ve(),{autocompleteCache:c}=Te(),l=Ut(),[m,d]=b(!1),[u,h]=b(t),p=bn(h,500);L(()=>(p(t),p.cancel),[t,p]);const[v,_]=b([]),[y,f]=b([]),[g,C]=b([]),w=W(new AbortController),E=X(T=>{const M=U(o*1e3).startOf("day").valueOf()/1e3,x=U(i*1e3).endOf("day").valueOf()/1e3;return new URLSearchParams({...T||{},limit:`${mn.queryLimit}`,start:`${M}`,end:`${x}`})},[o,i]),N=(T,M)=>T.map(x=>({value:x,type:`${M}`,icon:Fl[M]})),S=async({value:T,urlSuffix:M,setter:x,type:A,params:D})=>{if(!T&&A==="metric")return;w.current.abort(),w.current=new AbortController;const{signal:z}=w.current,R={type:A,value:T,start:D?.get("start")||"",end:D?.get("end")||"",match:D?.get("match[]")||""};d(!0);try{const V=c.get(R);if(V){x(N(V,A)),d(!1);return}const O=await fetch(`${s}/api/v1/${M}?${D}`,{signal:z});if(O.ok){const{data:q}=await O.json();x(N(q,A)),l({type:"SET_AUTOCOMPLETE_CACHE",payload:{key:R,value:q}})}d(!1)}catch(V){V instanceof Error&&V.name!=="AbortError"&&(l({type:"SET_AUTOCOMPLETE_CACHE",payload:{key:R,value:[]}}),d(!1),console.error(V))}};return L(()=>{const T=a!==we.metricsql&&a!==we.empty;if(!s||!n||T)return;_([]);const M=Kt(vn(n));return S({value:u,urlSuffix:"label/__name__/values",setter:_,type:"metric",params:E({"match[]":`{__name__=~".*${M}.*"}`})}),()=>w.current?.abort()},[s,u,a,n]),L(()=>{if(!s||a!==we.label)return;f([]);const T=Kt(n);return S({value:u,urlSuffix:"labels",setter:f,type:"label",params:E(n?{"match[]":`{__name__="${T}"}`}:void 0)}),()=>w.current?.abort()},[s,u,a,n]),L(()=>{if(!s||!r||a!==we.labelValue)return;C([]);const T=Kt(n),M=Kt(vn(u)),x=n?`__name__="${T}"`:"",A=`${r}=~".*${M}.*"`,D=[x,A].filter(Boolean).join(",");return S({value:u,urlSuffix:`label/${r}/values`,setter:C,type:"labelValue",params:E({"match[]":`{${D}}`})}),()=>w.current?.abort()},[s,u,a,n,r]),{metrics:v,labels:y,labelValues:g,loading:m}},Ul=""+new URL("MetricsQL-DNHI7ngg.md",import.meta.url).href,Ds="h3",ql="h4",Bl="p",Ql="https://docs.victoriametrics.com/victoriametrics/metricsql/",Yl="vm-link vm-link_colored",jl=t=>{const n=`$1 target="_blank" class="${Yl}" $2${Ql}#`;return t.replace(/(<a) (href=")#/gm,n)},Gl=t=>{const n=[];let r=t.nextElementSibling;for(;r&&r.tagName.toLowerCase()===Bl;)r&&n.push(r),r=r.nextElementSibling;return n},Wl=(t,n)=>{const r=n.textContent??"",s=Gl(n).map(o=>o.outerHTML??"").join(`
`);return{type:t,value:r,description:jl(s),icon:e(as,{})}},Jl=t=>{let n="";return Array.from(t).map(r=>{const a=r.tagName.toLowerCase()===Ds;return n=a?r.textContent??"":n,a?null:Wl(n,r)}).filter(Boolean)},Kl=t=>{const{metricsQLFunctions:n}=Te(),r=Ut(),a=s=>{const o=document.createElement("div");o.innerHTML=_n(s);const i=o.querySelectorAll(`${Ds}, ${ql}`);return Jl(i)};return L(()=>{if(!t||n.length)return;(async()=>{try{const i=await(await fetch(Ul)).text(),c=a(i);r({type:"SET_METRICSQL_FUNCTIONS",payload:c})}catch(o){console.error("Error fetching or processing the MetricsQL.md file:",o)}})()},[]),t?n:[]};function Zl(t){const n=/\s(or|and|unless|default|ifnot|if|group_left|group_right)\s|}|\+|\|-|\*|\/|\^/i,r=t.split(n),a=r[r.length-1].trim(),s=/.*\(([^)]*)$/,o=a.match(s);if(o&&o[1]){const i=o[1];if(i.lastIndexOf("{")>i.lastIndexOf("}")){const l=i.match(/([\w_.:]+)\{[^}]*$/);return l?l[0]:a}const c=i.lastIndexOf(",");return c!==-1?i.substring(c+1).trim():i}return a}function Xl(t){const n=t.match(/([\w_.:]+(?![},]))$/);return n?n[0]:""}function ec(t){const n=/([{(),+\-*/^]|\b(?:or|and|unless|default|ifnot|if|group_left|group_right|by|without|on|ignoring)\b)/i,r=t.split(/\s+/),a=r.length,s=r[a-1],o=r[a-2],i=!s&&Is(t),c=(!s||r.length>1)&&!n.test(o);return i||c}function tc(t,n="",r=""){const a=t.trim(),s=["}",")"].some(m=>a.endsWith(m)),o=!Is(a)&&["`","'",'"'].some(m=>a.endsWith(m));if(!a||s||o||ec(a))return we.empty;const i=/(?:by|without|on|ignoring)\s*\(\s*[^)]*$|\{[^}]*$/i,c=`(${vn(n)})?{?.+${vn(r)}(=|!=|=~|!~)"?([^"]*)$`,l=new RegExp(c,"g");switch(!0){case l.test(a):return we.labelValue;case i.test(a):return we.label;default:return we.metricsql}}const nc=({value:t,anchorEl:n,caretPosition:r,hasHelperText:a,includeFunctions:s,onSelect:o,onFoundOptions:i})=>{const[c,l]=b({top:0,left:0}),m=Kl(s),d=I(()=>{if(r[0]!==r[1])return{beforeCursor:t,afterCursor:""};const N=t.substring(0,r[0]),S=t.substring(r[1]);return{beforeCursor:N,afterCursor:S}},[t,r]),u=I(()=>Zl(d.beforeCursor),[d]),h=I(()=>{const N=/\w+\((?<metricName>[^)]+)\)\s+(by|without|on|ignoring)\s*\(\w*/gi,S=[...u.matchAll(N)];if(S.length>0&&S[0].groups&&S[0].groups.metricName)return S[0].groups.metricName;const T=/^\s*\b(?<metricName>[^{}(),\s]+)(?={|$)/g,M=[...u.matchAll(T)];return M.length>0&&M[0].groups&&M[0].groups.metricName?M[0].groups.metricName:""},[u]),p=I(()=>{const N=/[a-z_:-][\w\-.:/]*\b(?=\s*(=|!=|=~|!~))/g,S=u.match(N);return S?S[S.length-1]:""},[u]),v=I(()=>tc(d.beforeCursor,h,p),[d,h,p]),_=I(()=>Xl(d.beforeCursor),[d.beforeCursor]),{metrics:y,labels:f,labelValues:g,loading:C}=Vl({valueByContext:_,metric:h,label:p,context:v}),w=I(()=>{switch(v){case we.metricsql:return[...y,...m];case we.label:return f;case we.labelValue:return g;default:return[]}},[v,y,f,g]),E=X(N=>{const S=d.beforeCursor;let T=d.afterCursor;const M=S.lastIndexOf(_,r[0]),x=M+_.length,A=S.substring(0,M),D=S.substring(x);if(v===we.labelValue){const R='"';T=T.replace(/^[^\s"|},]*/,"");const V=/(?:=|!=|=~|!~)$/.test(A),O=T.trim()[0]!=='"';N=`${V?R:""}${N}${O?R:""}`}v===we.label&&(T=T.replace(/^[^\s=!,{}()"|+\-/*^]*/,"")),v===we.metricsql&&(T=T.replace(/^[^\s[\]{}()"|+\-/*^]*/,""));const z=`${A}${N}${D}${T}`;o(z,A.length+N.length)},[d]);return L(()=>{if(!n.current){l({top:0,left:0});return}const N=n.current.querySelector("textarea")||n.current,S=window.getComputedStyle(N),T=`${S.getPropertyValue("font-size")}`,M=`${S.getPropertyValue("font-family")}`,x=parseInt(`${S.getPropertyValue("line-height")}`),A=document.createElement("div");A.style.font=`${T} ${M}`,A.style.padding=S.getPropertyValue("padding"),A.style.lineHeight=`${x}px`,A.style.width=`${N.offsetWidth}px`,A.style.maxWidth=`${N.offsetWidth}px`,A.style.whiteSpace=S.getPropertyValue("white-space"),A.style.overflowWrap=S.getPropertyValue("overflow-wrap");const D=document.createElement("span");A.appendChild(document.createTextNode(d.beforeCursor)),A.appendChild(D),A.appendChild(document.createTextNode(d.afterCursor)),document.body.appendChild(A);const z=A.getBoundingClientRect(),R=D.getBoundingClientRect(),V=R.left-z.left,O=R.bottom-z.bottom-(a?x:0);l({top:O,left:V}),A.remove(),D.remove()},[n,r,a]),e(F,{children:e(ks,{loading:C,disabledFullScreen:!0,value:_,options:w,anchor:n,minLength:0,offset:c,onSelect:E,onFoundOptions:i,maxDisplayResults:{limit:mn.displayResults,message:"Please, specify the query more precisely."}})})},$r=({queryErrors:t,setQueryErrors:n,setHideError:r,stats:a,label:s,isLoading:o,includeFunctions:i=!0,onHideQuery:c,onRunQuery:l,abortFetch:m,hideButtons:d})=>{const{isMobile:u}=j(),{query:h,queryHistory:p,autocomplete:v,autocompleteQuick:_}=Te(),y=Ut(),f=Ue(),[g,C]=b(h||[]),[w,E]=b([]),[N,S]=b(!1),T=$t(g),M=$l(),x=()=>{y({type:"SET_QUERY_HISTORY",payload:{key:"METRICS_QUERY_HISTORY",history:g.map((B,$)=>ai(B,p[$]))}})},A=()=>{if(o){m&&m();return}x(),y({type:"SET_QUERY",payload:g}),f({type:"RUN_QUERY"}),l()},D=()=>{C(B=>[...B,""])},z=B=>{C($=>$.filter((H,Y)=>Y!==B))},R=(B,$)=>{const{ctrlKey:H,metaKey:Y}=B;if(H||Y){const le=g.map((de,ue)=>ue).filter(de=>de!==$);E(de=>In(le,de)?[]:le)}else E(le=>le.includes($)?le.filter(de=>de!==$):[...le,$])},V=(B,$)=>{C(H=>H.map((Y,K)=>K===$?B:Y))},O=(B,$)=>{V(B,$),S(!0)},q=(B,$)=>{const{index:H,values:Y}=p[$],K=H+B;K<0||K>=Y.length||(V(Y[K]||"",$),y({type:"SET_QUERY_HISTORY_BY_INDEX",payload:{value:{values:Y,index:K},queryNumber:$}}))},Q=(B,$)=>()=>{q(B,$)},re=B=>$=>{V($,B),y({type:"SET_AUTOCOMPLETE_QUICK",payload:!1})},Z=B=>()=>{z(B),E($=>$.includes(B)?$.filter(H=>H!==B):$.map(H=>H>B?H-1:H))},te=B=>$=>{R($,B)},ie=async B=>{const $=await M(g[B]);r(!1),V($.query,B),n(H=>(H[B]=$.error,[...H]))};return L(()=>{T&&g.length<T.length&&A()},[g]),L(()=>{c&&c(w)},[w]),L(()=>{N&&(A(),S(!1))},[g,N]),L(()=>{C(h||[])},[h]),e("div",{className:k({"vm-query-configurator":!0,"vm-block":!0,"vm-block_mobile":u}),children:[e("div",{className:"vm-query-configurator-list",children:g.map((B,$)=>e("div",{className:k({"vm-query-configurator-list-row":!0,"vm-query-configurator-list-row_disabled":w.includes($),"vm-query-configurator-list-row_mobile":u}),children:[e(Il,{value:g[$],autocomplete:!d?.autocomplete&&(v||_),autocompleteEl:nc,error:t[$],stats:a[$],onArrowUp:Q(-1,$),onArrowDown:Q(1,$),onEnter:A,onChange:re($),label:`${s||"Query"} ${g.length>1?$+1:""}`,disabled:w.includes($),includeFunctions:i}),c&&e(G,{title:w.includes($)?"Enable query":"Disable query",children:e("div",{className:"vm-query-configurator-list-row__button",children:e(P,{variant:"text",color:"gray",startIcon:w.includes($)?e(Ja,{}):e(Ar,{}),onClick:te($),ariaLabel:"visibility query"})})}),!d?.prettify&&e(G,{title:"Prettify query",children:e("div",{className:"vm-query-configurator-list-row__button",children:e(P,{variant:"text",color:"gray",startIcon:e(Ka,{}),onClick:async()=>await ie($),className:"prettify",ariaLabel:"prettify the query"})})}),g.length>1&&e(G,{title:"Remove Query",children:e("div",{className:"vm-query-configurator-list-row__button",children:e(P,{variant:"text",color:"error",startIcon:e(En,{}),onClick:Z($),ariaLabel:"remove query"})})})]},$))}),e("div",{className:"vm-query-configurator-settings",children:[e(Dl,{hideButtons:d}),e("div",{className:"vm-query-configurator-settings__buttons",children:[e(Ol,{handleSelectQuery:O,historyKey:"METRICS_QUERY_HISTORY"}),d?.anomalyConfig&&e(Hl,{}),!d?.addQuery&&g.length<sn&&e(P,{variant:"outlined",onClick:D,startIcon:e(Tr,{}),children:"Add Query"}),e(P,{variant:"contained",onClick:A,startIcon:o?e(ds,{}):e(nt,{}),children:`${o?"Cancel":"Execute"} ${u?"":"Query"}`})]})]})]})},rc=(t,n,r,a,s)=>`${t}/api/v1/query_range?query=${encodeURIComponent(n)}&start=${r.start}&end=${r.end}&step=${r.step}${a?"&nocache=1":""}${s?"&trace=1":""}`,ac=(t,n,r,a,s)=>`${t}/api/v1/query?query=${encodeURIComponent(n)}&time=${r.end}&step=${r.step}${a?"&nocache=1":""}${s?"&trace=1":""}`,sc=(t,n,r,a)=>{const s=new URLSearchParams({"match[]":n,start:r.start.toString(),end:r.end.toString()});return a&&s.set("reduce_mem_usage","1"),`${t}/api/v1/export?${s}`};let oc=0;class ct{tracing;query;tracingChildren;originalTracing;id;constructor(n,r){this.tracing=n,this.originalTracing=JSON.parse(JSON.stringify(n)),this.query=r,this.id=oc++;const a=n.children||[];this.tracingChildren=a.map(s=>new ct(s,r))}get queryValue(){return this.query}get idValue(){return this.id}get children(){return this.tracingChildren}get message(){return this.tracing.message}get duration(){return this.tracing.duration_msec}get JSON(){return JSON.stringify(this.tracing,null,2)}get originalJSON(){return JSON.stringify(this.originalTracing,null,2)}setTracing(n){this.tracing=n;const r=n.children||[];this.tracingChildren=r.map(a=>new ct(a,this.query))}setQuery(n){this.query=n}resetTracing(){this.tracing=this.originalTracing}}const tr=(t,n,r=!0)=>{const{__name__:a,...s}=t.metric,o=r?`[Query ${t.group}] `:"";if(n)return Rs(t.metric,n);const i=`${o}${a||""}`;if(Object.keys(s).length===0)return i||"value";const c=Object.entries(s).map(([l,m])=>`${l}=${JSON.stringify(m)}`).join(", ");return`${i}{${c}}`},Rs=(t,n)=>n.replace(/\{\{(\w+)}}/g,(r,a)=>t[a]||""),Pt=t=>{switch(t){case"NaN":return NaN;case"Inf":case"+Inf":return 1/0;case"-Inf":return-1/0;default:return parseFloat(t)}},Pr=t=>{if(t.length<2)return!1;const n=["le","vmrange"],r=Object.keys(t[0].metric).filter(s=>!n.includes(s));return t.every(s=>{const o=Object.keys(s.metric).filter(i=>!n.includes(i));return r.length===o.length&&o.every(i=>s.metric[i]===t[0].metric[i])})&&t.every(s=>n.some(o=>o in s.metric))},Dn=({predefinedQuery:t,visible:n,display:r,customStep:a,hideQuery:s,showAllSeries:o})=>{const{query:i}=Te(),{period:c}=ve(),{displayType:l,nocache:m,isTracingEnabled:d,seriesLimits:u}=Re(),{serverUrl:h}=ne(),{isHistogram:p}=Le(),[v,_]=b(!1),[y,f]=b(),[g,C]=b(),[w,E]=b(),[N,S]=b(),[T,M]=b([]),[x,A]=b([]),[D,z]=b(),[R,V]=b([]),[O,q]=b(!1),Q=I(()=>{const{end:H,start:Y}=c;return Vt(H-Y,p,l)},[c,p,l]),Z=X(bn(async({fetchUrl:H,fetchQueue:Y,displayType:K,query:le,stateSeriesLimits:de,showAllSeries:ue,hideQuery:fe})=>{const Ce=new AbortController;V([...Y,Ce]);try{const Ae=K===pe.chart,xe=ue?1/0:+de[K]||1/0;let ge=xe;const be=[],Et=[];let je=1,vt=0,Ke=!1;for await(const On of H){if(fe?.includes(je-1)){M(Ze=>[...Ze,""]),A(Ze=>[...Ze,{}]),je++;continue}const Hn=new URL(On),Jr=await fetch(`${Hn.origin}${Hn.pathname}`,{signal:Ce.signal,method:"POST",body:Hn.searchParams}),Pe=await Jr.json();if(Jr.ok){if(A(qe=>[...qe,{...Pe?.stats,isPartial:Pe?.isPartial,resultLength:Pe.data.result.length}]),M(qe=>[...qe,""]),Pe.trace){const qe=new ct(Pe.trace,le[je-1]);Et.push(qe)}const Ze=!!Ee("display_mode",null);Ke=!ko&&Ae&&!Ze&&Pr(Pe.data.result),ge=Ke?1/0:xe;const Fn=ge-be.length;Pe.data.result.slice(0,Fn).forEach(qe=>{qe.group=je,be.push(qe)}),vt+=Pe.data.result.length}else{be.push({metric:{},values:[],group:je});const Ze=Pe.errorType||ye.unknownType,Fn=Pe?.error||Pe?.message||"see console for more details",qe=[Ze,Fn].join(`,\r
`);M(Co=>[...Co,`${qe}`]),console.error(`Fetch query error: ${Ze}`,Pe)}je++}const ft=`Showing ${be.length} series out of ${vt} series due to performance reasons. Please narrow down the query, so it returns less series`;z(vt>ge?ft:""),Ae?f(be):C(be),E(Et),q(On=>vt?Ke:On)}catch(Ae){const xe=Ae;if(xe.name==="AbortError"){_(!1);return}let be=`Error executing query: ${xe.message}. Please check your serverURL settings and confirm server availability.`;xe.message==="Unexpected end of JSON input"&&(be+=`
Additionally, this error can occur if the server response is too large to process. Apply more specific filters to reduce the data volume.`),S(be)}_(!1)},300),[]),te=I(()=>{S(""),M([]),A([]);const H=t??i,Y=(r||l)===pe.chart;if(c)if(!h)S(ye.emptyServer);else if(H.every(K=>!K.trim()))M(H.map(()=>ye.validQuery));else if(ur(h)){const K={...c};return K.step=a,H.map(le=>Y?rc(h,le,K,m,d):ac(h,le,K,m,d))}else S(ye.validServer)},[h,c,l,a,s]),ie=X(()=>{R.map(H=>H.abort()),V([]),f([]),C([])},[R]),[B,$]=b([]);return L(()=>{const H=te===B&&!!t;if(!n||!te?.length||H)return;_(!0),Z({fetchUrl:te,fetchQueue:R,displayType:r||l,query:t??i,stateSeriesLimits:u,showAllSeries:o,hideQuery:s}),$(te)},[te,n,u,o]),L(()=>{const H=R.slice(0,-1);H.length&&(H.map(Y=>Y.abort()),V(R.filter(Y=>!Y.signal.aborted)))},[R]),L(()=>{Q===a&&f([])},[O]),{fetchUrl:te,isLoading:v,graphData:y,liveData:g,error:N,queryErrors:T,setQueryErrors:M,queryStats:x,warning:D,traces:w,isHistogram:O,abortFetch:ie}},$s=()=>e("div",{className:"vm-line-loader",children:[e("div",{className:"vm-line-loader__background"}),e("div",{className:"vm-line-loader__line"})]}),zr=()=>{const{tenantId:t}=ne(),{displayType:n}=Re(),{query:r}=Te(),{duration:a,relativeTime:s,period:{date:o,step:i}}=ve(),{customStep:c}=Le(),[l,m]=me(),d=ut(),u=Ue(),h=Je(),p=Ut(),v=St(),[_,y]=b(!1),f=X(()=>{if(_){y(!1);return}const g=new URLSearchParams(l);r.forEach((w,E)=>{const N=`g${E}`;l.get(`${N}.expr`)!==w&&w&&g.set(`${N}.expr`,w),l.get(`${N}.range_input`)!==a&&g.set(`${N}.range_input`,a),l.get(`${N}.end_input`)!==o&&g.set(`${N}.end_input`,o),l.get(`${N}.relative_time`)!==s&&g.set(`${N}.relative_time`,s||"none");const S=l.get(`${N}.step_input`)||i;S&&S!==c&&g.set(`${N}.step_input`,c);const T=`${bt.find(M=>M.value===n)?.prometheusCode||0}`;l.get(`${N}.tab`)!==T&&g.set(`${N}.tab`,`${T}`),l.get(`${N}.tenantID`)!==t&&t&&g.set(`${N}.tenantID`,t)});const C=r.length-1;Array.from(g.keys()).forEach(w=>{const E=w.match(/^g(\d+)\./);E&&parseInt(E[1],10)>C&&g.delete(w)}),!(Ro(g,l)||!g.size)&&m(g)},[t,n,r,a,s,o,i,c]);L(()=>{const g=setTimeout(f,200);return()=>clearTimeout(g)},[f]),L(()=>{if(!_)return;const g=Va(),C=g.duration!==a,w=g.relativeTime!==s,E=g.relativeTime==="none"&&g.period.date!==o;(C||w||E)&&u({type:"SET_TIME_STATE",payload:g});const S=hs();S!==n&&v({type:"SET_DISPLAY_TYPE",payload:S});const T=l.get("g0.tenantID")||"";T!==t&&d({type:"SET_TENANT_ID",payload:T});const M=Ra();In(M,r)||(p({type:"SET_QUERY",payload:M}),u({type:"RUN_QUERY"}));const x=setTimeout(()=>{const A=l.get("g0.step_input")||i;A&&A!==c&&h({type:"SET_CUSTOM_STEP",payload:A})},50);return()=>clearTimeout(x)},[l,_]),se("popstate",()=>{y(!0)})},ic=e(_e,{text:"last_over_time",href:"https://docs.victoriametrics.com/victoriametrics/metricsql/#last_over_time",underlined:!0}),lc=e(_e,{text:"instant query",href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#instant-query",underlined:!0}),cc=()=>{const{customStep:t}=Le();return e("div",{children:[e("p",{children:["This tab shows ",lc," results for the last ",t||"5m"," (defined by the ",e("code",{children:"step"}),") ending at the selected time range."]}),e("p",{children:["Please wrap the query into ",ic," if you need results over arbitrary lookbehind interval."]})]})},Ps=({value:t,hideValue:n})=>e("div",{className:"vm-line-progress",children:[e("div",{className:"vm-line-progress-track",children:e("div",{className:"vm-line-progress-track__thumb",style:{width:`${t}%`}})}),!n&&e("span",{children:[t.toFixed(2),"%"]})]}),zs=({isRoot:t,trace:n,totalMsec:r,isExpandedAll:a})=>{const{isDarkTheme:s}=ne(),{isMobile:o}=j(),[i,c]=b({}),l=W(null),[m,d]=b(!1),[u,h]=b(!1),p=fr(n.duration/1e3)||`${n.duration}ms`;L(()=>{if(!l.current)return;const C=l.current,w=l.current.children[0],{height:E}=w.getBoundingClientRect();d(E>C.clientHeight)},[n]);const v=C=>{C.stopPropagation(),h(w=>!w)},_=n.children&&!!n.children.length,y=n.duration/r*100,f=C=>()=>{_&&c(w=>({...w,[C]:!w[C]}))},g=C=>{const w=[C.idValue];return C?.children?.forEach(E=>{w.push(...g(E))}),w};return L(()=>{if(!a){c([]);return}const C=g(n),w={};C.forEach(E=>{w[E]=!0}),c(w)},[a]),e("div",{className:k({"vm-nested-nav":!0,"vm-nested-nav_root":t,"vm-nested-nav_dark":s,"vm-nested-nav_mobile":o}),children:[e("div",{className:k({"vm-nested-nav-header":!0,"vm-nested-nav-header_open":i[n.idValue]}),onClick:f(n.idValue),children:[_&&e("div",{className:k({"vm-nested-nav-header__icon":!0,"vm-nested-nav-header__icon_open":i[n.idValue]}),children:e(Ne,{})}),e("div",{className:"vm-nested-nav-header__progress",children:e(Ps,{value:y})}),e("div",{className:k({"vm-nested-nav-header__message":!0,"vm-nested-nav-header__message_show-full":u}),ref:l,children:[e("span",{className:"vm-nested-nav-header__message_duration",children:p}),": ",e("span",{children:n.message})]}),e("div",{className:"vm-nested-nav-header-bottom",children:(m||u)&&e(P,{variant:"text",size:"small",onClick:v,children:u?"Hide":"Show full query"})})]}),i[n.idValue]&&e("div",{className:"vm-nested-nav__childrens",children:_&&n.children.map(C=>e(zs,{trace:C,totalMsec:r,isExpandedAll:a},C.duration))})]})},Os=({editable:t=!1,defaultTile:n="JSON",displayTitle:r=!0,defaultJson:a="",resetValue:s="",onClose:o,onUpload:i})=>{const c=Ye(),{isMobile:l}=j(),[m,d]=b(a),[u,h]=b(n),[p,v]=b(""),[_,y]=b(""),f=I(()=>{try{const S=JSON.parse(m),T=S.trace||S;return T.duration_msec?(new ct(T,""),""):ye.traceNotFound}catch(S){return S instanceof Error?S.message:"Unknown error"}},[m]),g=S=>{h(S)},C=S=>{y(""),d(S)},w=async()=>{await c(m,"Formatted JSON has been copied")},E=()=>{d(s)},N=()=>{y(f),u.trim()||v(ye.emptyTitle),!(f||p)&&(i(m,u),o())};return e("div",{className:k({"vm-json-form":!0,"vm-json-form_one-field":!r,"vm-json-form_one-field_mobile":!r&&l,"vm-json-form_mobile":l}),children:[r&&e(oe,{value:u,label:"Title",error:p,onEnter:N,onChange:g}),e(oe,{value:m,label:"JSON",type:"textarea",error:_,autofocus:!0,onChange:C,onEnter:N,disabled:!t}),e("div",{className:"vm-json-form-footer",children:[e("div",{className:"vm-json-form-footer__controls",children:[e(P,{variant:"outlined",startIcon:e(ht,{}),onClick:w,children:"Copy JSON"}),s&&e(P,{variant:"text",startIcon:e(Nt,{}),onClick:E,children:"Reset JSON"})]}),e("div",{className:"vm-json-form-footer__controls vm-json-form-footer__controls_right",children:[e(P,{variant:"outlined",color:"error",onClick:o,children:"Cancel"}),e(P,{variant:"contained",onClick:N,children:"apply"})]})]})]})},dc=(t,n)=>{const r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},Hs=(t,n)=>{const r=new Blob([t],{type:"application/json"});dc(r,n)},Or=({traces:t,jsonEditor:n=!1,onDeleteClick:r})=>{const{isMobile:a}=j(),[s,o]=b(null),[i,c]=b([]),l=()=>{o(null)},m=(v,_)=>{if(!(!n||!s))try{s.setTracing(JSON.parse(v)),s.setQuery(_),o(null)}catch(y){console.error(y)}};if(!t.length)return e(ae,{variant:"info",children:"Please re-run the query to see results of the tracing"});const d=v=>()=>{r(v)},u=v=>()=>{o(v)},h=v=>()=>{Hs(v.originalJSON,`vmui_trace_${v.queryValue}.json`)},p=v=>()=>{c(_=>_.includes(v.idValue)?_.filter(y=>y!==v.idValue):[..._,v.idValue])};return e(F,{children:[e("div",{className:"vm-tracings-view",children:t.map(v=>e("div",{className:"vm-tracings-view-trace vm-block vm-block_empty-padding",children:[e("div",{className:"vm-tracings-view-trace-header",children:[e("h3",{className:"vm-tracings-view-trace-header-title",children:["Trace for ",e("b",{className:"vm-tracings-view-trace-header-title__query",children:v.queryValue})]}),e(G,{title:i.includes(v.idValue)?"Collapse All":"Expand All",children:e(P,{variant:"text",startIcon:i.includes(v.idValue)?e(ls,{}):e(is,{}),onClick:p(v),ariaLabel:i.includes(v.idValue)?"Collapse All":"Expand All"})}),e(G,{title:"Save Trace to JSON",children:e(P,{variant:"text",startIcon:e(Mn,{}),onClick:h(v),ariaLabel:"Save trace to JSON"})}),e(G,{title:"Open JSON",children:e(P,{variant:"text",startIcon:e(Bt,{}),onClick:u(v),ariaLabel:"open JSON"})}),e(G,{title:"Remove trace",children:e(P,{variant:"text",color:"error",startIcon:e(En,{}),onClick:d(v),ariaLabel:"remove trace"})})]}),e("nav",{className:k({"vm-tracings-view-trace__nav":!0,"vm-tracings-view-trace__nav_mobile":a}),children:e(zs,{isRoot:!0,trace:v,totalMsec:v.duration,isExpandedAll:i.includes(v.idValue)})})]},v.idValue))}),s&&e(Me,{title:s.queryValue,onClose:l,children:e(Os,{editable:n,displayTitle:n,defaultTile:s.queryValue,defaultJson:s.JSON,resetValue:s.originalJSON,onClose:l,onUpload:m})})]})},mc=({traces:t,displayType:n})=>{const{isTracingEnabled:r}=Re(),[a,s]=b([]),o=i=>{const c=a.filter(l=>l.idValue!==i.idValue);s([...c])};return L(()=>{t&&s([...a,...t])},[t]),L(()=>{s([])},[n]),e(F,{children:r&&e("div",{className:"vm-custom-panel__trace",children:e(Or,{traces:a,onDeleteClick:o})})})},Rn=({warning:t,query:n,onChange:r})=>{const{isMobile:a}=j(),{value:s,setTrue:o,setFalse:i}=ce(!1);return L(i,[n]),L(()=>{r(s)},[s]),e(ae,{variant:"warning",children:e("div",{className:k({"vm-custom-panel__warning":!0,"vm-custom-panel__warning_mobile":a}),children:[e("p",{children:t}),e(P,{color:"warning",variant:"outlined",onClick:o,children:"Show all"})]})})},Hr=t=>{let n=t.length,r=-1/0;for(;n--;){const a=t[n];Number.isFinite(a)&&a>r&&(r=a)}return Number.isFinite(r)?r:null},Fr=t=>{let n=t.length,r=1/0;for(;n--;){const a=t[n];Number.isFinite(a)&&a<r&&(r=a)}return Number.isFinite(r)?r:null},uc=t=>{let n=t[0],r=1;for(let a=1;a<t.length;a++){const s=t[a];Number.isFinite(s)&&(n=n*(r-1)/r+s/r,r++)}return n},hc=t=>{let n=t.length;const r=[];for(;n--;){const a=t[n];Number.isFinite(a)&&r.push(a)}return r.sort(),r[r.length>>1]},pc=t=>{let n=t.length;for(;n--;){const r=t[n];if(Number.isFinite(r))return r}},vc=(t,n,r="")=>{const a=n[0],s=n[n.length-1];return r?n.map(o=>`${Xe(o,a,s)} ${r}`):n.map(o=>Xe(o,a,s))},Xe=(t,n,r)=>{if(t==null)return"";r=r||0,n=n||0;const a=Math.abs(r-n);if(isNaN(a)||a==0)return Math.abs(t)>=1e3?t.toLocaleString("en-US"):t.toString();let s=3+Math.floor(1+Math.log10(Math.max(Math.abs(n),Math.abs(r)))-Math.log10(a));return(isNaN(s)||s>20)&&(s=20),t.toLocaleString("en-US",{minimumSignificantDigits:1,maximumSignificantDigits:s})},fc=(t,n)=>{const r=document.createElement("span");r.innerText=t,r.style.cssText=`position: absolute; z-index: -1; pointer-events: none; opacity: 0; font: ${n}`,document.body.appendChild(r);const a=r.offsetWidth;return r.remove(),a},gc=(t,n)=>{if(n?.hasAlias&&n?.label)return n.label;const r=t?.metric||{},s=Object.keys(r).filter(i=>i!="__name__").map(i=>`${i}=${JSON.stringify(r[i])}`);let o=r.__name__||"";return s.length>0&&(o+="{"+s.join(",")+"}"),o},yc=[[3600*24*365,"{YYYY}",null,null,null,null,null,null,1],[3600*24*28,"{MMM}",`
{YYYY}`,null,null,null,null,null,1],[3600*24,"{MM}-{DD}",`
{YYYY}`,null,null,null,null,null,1],[3600,"{HH}:{mm}",`
{YYYY}-{MM}-{DD}`,null,`
{MM}-{DD}`,null,null,null,1],[60,"{HH}:{mm}",`
{YYYY}-{MM}-{DD}`,null,`
{MM}-{DD}`,null,null,null,1],[1,"{HH}:{mm}:{ss}",`
{YYYY}-{MM}-{DD}`,null,`
{MM}-{DD} {HH}:{mm}`,null,null,null,1],[.001,":{ss}.{fff}",`
{YYYY}-{MM}-{DD} {HH}:{mm}`,null,`
{MM}-{DD} {HH}:{mm}`,null,`
{HH}:{mm}`,null,1]],Fs=(t,n)=>Array.from(new Set(t.map(r=>r.scale))).map(r=>{const a="10px Arial",s=We("color-text"),o={scale:r,show:!0,size:Vs,stroke:s,font:a,values:(i,c)=>vc(i,c,n)};return r?!(Number(r)%2)&&r!=="y"?{...o,side:1}:o:{space:80,values:yc,stroke:s,font:a}}),bc=(t,n,r)=>{const a=gr(n)||1,s=Array.from(new Set(t)).sort((m,d)=>m-d);let o=r.start;const i=rn(r.end+a);let c=0;const l=[];for(;o<=i;){for(;c<s.length&&s[c]<=o;)o=s[c],c++,l.push(o);o=rn(o+a),(c>=s.length||s[c]>o)&&l.push(o)}for(;l.length<2;)l.push(o),o=rn(o+a);return l},Vr=(t,n)=>{if(t==null||n==null)return[-1,1];const a=.02*(Math.abs(n-t)||Math.abs(t)||1);return[t-a,n+a]},_c=(t,n)=>{const r={},a=Object.values(t).flat(),s="1",o=Fr(a)||0,i=Hr(a)||1;return r[s]=n?Vr(o,i):[o,i],r},Vs=(t,n,r,a)=>{const s=t.axes[r];if(a>1)return s._size||60;let o=6+(s?.ticks?.size||0)+(s.gap||0);const i=(n??[]).reduce((c,l)=>l?.length>c.length?l:c,"");return i!=""&&(o+=fc(i,"10px Arial")),Math.ceil(o)},da=["#e54040","#32a9dc","#2ee329","#7126a1","#e38f0f","#3d811a","#ffea00","#2d2d2d","#da42a6","#a44e0c"],Us=t=>{if(t.length!=7)return"0, 0, 0";const n=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return`${n}, ${r}, ${a}`},_t={[ee.yhatUpper]:"#7126a1",[ee.yhatLower]:"#7126a1",[ee.yhat]:"#da42a6",[ee.anomaly]:"#da4242",[ee.anomalyScore]:"#7126a1",[ee.actual]:"#203ea9",[ee.training]:`rgba(${Us("#203ea9")}, 0.2)`},ma=t=>{let a=1,s=0,o=1;if(t.length>0)for(let c=0;c<t.length;c++)t[c].charCodeAt(0)>s&&(s=t[c].charCodeAt(0)),o=parseInt(String(16777215/s)),a=(a+t[c].charCodeAt(0)*o*49979693)%16777215;let i=(a*t.length%16777215).toString(16);return i=i.padEnd(6,i),`#${i}`},Cc=t=>{let n=t.replace("#","").trim();if(n.length===3&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),n.length!==6)throw new Error("Invalid HEX color.");const r=parseInt(n.slice(0,2),16),a=parseInt(n.slice(2,4),16),s=parseInt(n.slice(4,6),16);return(r*299+a*587+s*114)/1e3>=128?"#000000":"#FFFFFF"},wc=(t,n,r)=>{const a=[];for(let s=0;s<r;s++){const o=s/(r-1),i=t[0]+(n[0]-t[0])*o,c=t[1]+(n[1]-t[1])*o,l=t[2]+(n[2]-t[2])*o;a.push([i,c,l].map(m=>Math.round(m)).join(", "))}return a.map(s=>`rgb(${s})`)},Ur=wc([246,226,219],[127,39,4],16),Nc=(t,n)=>{const r=t.data[n][2],a=Ur,s=0;let o=1/0,i=-1/0;for(let d=0;d<r.length;d++)r[d]>s&&(o=Math.min(o,r[d]),i=Math.max(i,r[d]));const c=i-o,l=a.length,m=Array(r.length);for(let d=0;d<r.length;d++)m[d]=r[d]===0?-1:Math.min(l-1,Math.floor(l*(r[d]-o)/c));return m},Sc=()=>(t,n)=>{const r=Math.round(devicePixelRatio);lr.orient(t,n,(a,s,o,i,c,l,m,d,u,h,p,v,_,y)=>{const[f,g,C]=t.data[n],w=f.length,E=Nc(t,n),N=Ur??[...Array.from(new Set(E))],S=N.map(()=>new Path2D),T=w-g.lastIndexOf(g[0]),M=w/T,x=g[1]-g[0],A=f[T]-f[0],D=l(A,i,h,d)-l(0,i,h,d)-r,z=m(x,c,p,u)-m(0,c,p,u)+r,R=g.slice(0,T).map(O=>Math.round(m(O,c,p,u)-z/2)),V=Array.from({length:M},(O,q)=>Math.round(l(f[q*T],i,h,d)-D));for(let O=0;O<w;O++)if(C[O]>0&&f[O]>=(i.min||-1/0)&&f[O]<=(i.max||1/0)&&g[O]>=(c.min||-1/0)&&g[O]<=(c.max||1/0)){const q=V[~~(O/T)],Q=R[O%T],re=S[E[O]];y(re,q,Q,D,z)}t.ctx.save(),t.ctx.rect(t.bbox.left,t.bbox.top,t.bbox.width,t.bbox.height),t.ctx.clip(),S.forEach((O,q)=>{t.ctx.fillStyle=N[q],t.ctx.fill(O)}),t.ctx.restore()})},Tc=t=>{if(!t.every(o=>o.metric.le))return t;const n=t.sort((o,i)=>parseFloat(o.metric.le)-parseFloat(i.metric.le)),r=t[0]?.group||1;let a={metric:{le:""},values:[]};const s=[];for(const o of n){const i=[a.metric.le,o.metric.le].filter(l=>l).join("..."),c=[];for(const[l,m]of o.values){const d=a.values.find(h=>h[0]===l)?.[1]||0,u=+m-+d;c.push([l,`${u}`])}s.push({metric:{vmrange:i},values:c,group:r}),a=o}return s},ua=t=>{const n=(t.metric.vmrange||t.metric.le||"").split("...");return Pt(n[n.length-1])},Ac=(t,n)=>ua(t)-ua(n),Ec=(t,n)=>{if(!n)return t;const r=t.sort(Ac),a=Tc(r),s={};return a.forEach(i=>i.values.forEach(([c,l])=>{const m=Number(l),d=isNaN(m)?0:m,u=s[c]||0;s[c]=u+d})),a.map(i=>{const c=i.values.map(([l,m])=>{const d=s[l];return[l,`${Math.round(+m/d*100)}`]});return{...i,values:c}}).filter(i=>!i.values.every(c=>c[1]==="0"))},Lc=t=>{Object.keys(t.hooks).forEach(n=>{t.hooks[n]=[]})},nr=t=>{const n=["__name__","for"];return Object.entries(t).filter(([r])=>!n.includes(r)).map(([r,a])=>`${r}: ${a}`).join(",")},qs=t=>{const n=t?.__name__||"",r=new RegExp(`(${Object.values(ee).join("|")})$`),a=n.match(r),s=a&&a[0];return{value:/(?:^|[^a-zA-Z0-9_])y(?:$|[^a-zA-Z0-9_])/.test(n)?ee.actual:s,group:nr(t)}},Mc=(t,n,r,a)=>{const s={},o=a?0:Math.min(t.length,da.length);for(let i=0;i<o;i++){const c=tr(t[i],r[t[i].group-1]);s[c]=da[i]}return(i,c)=>{const l=a?qs(t[c].metric):null,m=r[i.group-1],d=a?l?.group||"":tr(i,m);return{label:d,hasAlias:!!m,dash:Dc(l),width:Rc(l),stroke:zc({metricInfo:l,label:d,isAnomalyUI:a,colorState:s}),points:$c(l),spanGaps:!1,forecast:l?.value,forecastGroup:l?.group,freeFormFields:i.metric,show:!Qs(d,n),scale:"1",...xc(i)}}},xc=t=>{const n=t.values.map(i=>Pt(i[1])),{min:r,max:a,median:s,last:o}={min:Fr(n),max:Hr(n),median:hc(n),last:pc(n)};return{median:s,statsFormatted:{min:Xe(r,r,a),max:Xe(a,r,a),median:Xe(s,r,a),last:Xe(o,r,a)}}},Bs=t=>typeof t.label=="string"?t.label:"",ha=(t,n)=>({group:n,label:Bs(t),color:t.stroke,checked:t.show||!1,freeFormFields:t.freeFormFields,statsFormatted:t.statsFormatted,median:t.median,hasAlias:t.hasAlias||!1}),kc=({hideSeries:t,legend:n,metaKey:r,series:a,isAnomalyView:s})=>{const{label:o}=n,i=Qs(o,t),c=a.map(Bs);return s?c.filter(l=>l!==o):r?i?t.filter(l=>l!==o):[...t,o]:t.length?i?[...c.filter(l=>l!==o)]:[]:[...c.filter(l=>l!==o)]},Qs=(t,n)=>n.includes(`${t}`),Ys=t=>{for(let n=t.series.length-1;n>=0;n--)n&&t.delSeries(n)},Ic=(t,n,r=!1)=>{n.forEach((a,s)=>{a.label&&(a.spanGaps=r),s&&t.addSeries(a)})},Dc=t=>{const n=t?.value===ee.yhatLower,r=t?.value===ee.yhatUpper,a=t?.value===ee.yhat;return n||r?[10,5]:a?[10,2]:[]},Rc=t=>{const n=t?.value===ee.yhatLower,r=t?.value===ee.yhatUpper,a=t?.value===ee.yhat,s=t?.value===ee.anomaly;return r||n?.7:a?1:s?0:1.4},$c=t=>t?.value===ee.anomaly?{size:8,width:4,space:0}:{size:4,width:0,show:!0,filter:Pc},Pc=(t,n)=>{const r=t.data[n],a=[];for(let s=0;s<r.length;s++){const o=r[s-1],i=r[s+1];o===null&&i===null&&a.push(s)}return a},zc=({metricInfo:t,label:n,isAnomalyUI:r,colorState:a})=>{const s=a[n]||ma(n),o=t?.value===ee.anomaly;return r&&o?_t[ee.anomaly]:r&&!o&&!t?.value?_t[ee.actual]:t?.value?t?.value?_t[t?.value]:s:a[n]||ma(n)},js=({width:t=400,height:n=500})=>({width:t,height:n,series:[],tzDate:r=>U(xt(He(r))).local().toDate(),legend:{show:!1},cursor:{drag:{x:!0,y:!1},focus:{prox:30},points:{size:5.6,width:1.4},bind:{click:()=>null,dblclick:()=>null}}}),Gs=t=>{Ys(t),Lc(t),t.setData([])},Ws=({min:t,max:n})=>[t,n],Js=(t,n=0,r=1,a,s)=>s.limits.enable?s.limits.range[a]:Vr(n,r),Oc=(t,n)=>{const r={x:{range:()=>Ws(n)}},a=Object.keys(t.limits.range);return(a.length?a:["1"]).forEach(s=>{r[s]={range:(o,i=0,c=1)=>Js(o,i,c,s,t)}}),r},Ks=t=>n=>{const r=n.posToVal(n.select.left,"x"),a=n.posToVal(n.select.left+n.select.width,"x");t({min:r,max:a})},Hc=(t,n)=>{if(t.delBand(),n.length<2)return;const r=n.map((i,c)=>({...i,index:c})),a=r.filter(i=>i.forecast===ee.yhatUpper),s=r.filter(i=>i.forecast===ee.yhatLower),o=a.map(i=>{const c=s.find(l=>l.forecastGroup===i.forecastGroup);return c?{series:[i.index,c.index],fill:Fc(ee.yhatUpper)}:null}).filter(i=>i!==null);o.length&&o.forEach(i=>{t.addBand(i)})};function Fc(t){return`rgba(${Us(_t[t])}, 0.05)`}const Vc=t=>t instanceof MouseEvent,pa=t=>Vc(t)?t.clientX:t.touches[0].clientX,Uc=({dragSpeed:t=.85,setPanning:n,setPlotScale:r})=>{const a=W({leftStart:0,xUnitsPerPx:0,scXMin:0,scXMax:0}),s=c=>{c.preventDefault();const l=pa(c),{leftStart:m,xUnitsPerPx:d,scXMin:u,scXMax:h}=a.current,p=d*((l-m)*t);r({min:u-p,max:h-p})},o=()=>{n(!1),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",o)},i=()=>{document.addEventListener("mousemove",s),document.addEventListener("mouseup",o),document.addEventListener("touchmove",s),document.addEventListener("touchend",o)};return({e:c,u:l})=>{c.preventDefault(),n(!0),a.current={leftStart:pa(c),xUnitsPerPx:l.posToVal(1,"x")-l.posToVal(0,"x"),scXMin:l.scales.x.min||0,scXMax:l.scales.x.max||0},i()}},qc=t=>{const{ctrlKey:n,metaKey:r,button:a}=t;return a===0&&(n||r)},Bn=.9,Zs=t=>{const[n,r]=b(!1),a=Uc({dragSpeed:Bn,setPanning:r,setPlotScale:t});return{onReadyChart:o=>{const i=l=>{const m=l instanceof MouseEvent&&qc(l),d=window.TouchEvent&&l instanceof TouchEvent&&l.touches.length>1;(m||d)&&a({u:o,e:l})},c=l=>{if(!l.ctrlKey&&!l.metaKey)return;l.preventDefault();const{width:m}=o.over.getBoundingClientRect(),d=o.cursor.left&&o.cursor.left>0?o.cursor.left:0,u=o.posToVal(d,"x"),h=(o.scales.x.max||0)-(o.scales.x.min||0),p=l.deltaY<0?h*Bn:h/Bn,v=u-d/m*p,_=v+p;o.batch(()=>t({min:v,max:_}))};o.over.addEventListener("mousedown",i),o.over.addEventListener("touchstart",i),o.over.addEventListener("wheel",c)},isPanning:n}},va=t=>{const n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},Xs=({uPlotInst:t,xRange:n,setPlotScale:r})=>{const[a,s]=b(0),o=X(l=>{const{target:m,ctrlKey:d,metaKey:u,key:h}=l,p=m instanceof HTMLInputElement||m instanceof HTMLTextAreaElement;if(!t||p)return;const v=h==="+"||h==="=";if((h==="-"||v)&&!(d||u)){l.preventDefault();const f=(n.max-n.min)/10*(v?1:-1);r({min:n.min+f,max:n.max-f})}},[t,n]),i=l=>{l.touches.length===2&&(l.preventDefault(),s(va(l.touches)))},c=X(l=>{if(!t||l.touches.length!==2)return;l.preventDefault();const m=va(l.touches),d=a-m,u=t.scales.x.max||n.max,h=t.scales.x.min||n.min,p=u-h,v=d>0?-1:1,_=p/50*v;t.batch(()=>r({min:h+_,max:u-_}))},[t,a,n]);return se("keydown",o),se("touchmove",c),se("touchstart",i),null},eo=({period:t,setPeriod:n})=>{const[r,a]=b({min:t.start,max:t.end}),s=({min:o,max:i})=>{const c=(i-o)*1e3;c<Zr.min||c>Zr.max||n({from:U(o*1e3).toDate(),to:U(i*1e3).toDate()})};return L(()=>{a({min:t.start,max:t.end})},[t]),{xRange:r,setPlotScale:s}},Bc=({u:t,metrics:n,series:r,unit:a,isAnomalyView:s})=>{const[o,i]=b(!1),[c,l]=b({seriesIdx:-1,dataIdx:-1}),[m,d]=b([]),u=()=>{d([]),l({seriesIdx:-1,dataIdx:-1})},h=f=>{const g=f.cursor.idx??-1;l(C=>({...C,dataIdx:g}))},p=(f,g)=>{const C=g??-1;l(w=>({...w,seriesIdx:C}))},v=X(()=>{const{seriesIdx:f,dataIdx:g}=c,C=n[f-1],w=r[f],E=new Set(n.map(D=>D.group)),N=C?.group||0,S=t?.data?.[f]?.[g]||0,T=t?.scales?.[1]?.min||0,M=t?.scales?.[1]?.max||1,x=t?.data?.[0]?.[g]||0,A={top:t?t.valToPos(S||0,w?.scale||"1"):0,left:t?t.valToPos(x,"x"):0};return{unit:a,point:A,u:t,id:`${f}_${g}`,title:E.size>1&&!s?`Query ${N}`:"",dates:[x?U(x*1e3).tz().format(cn):"-"],value:Xe(S,T,M),info:gc(C,w),statsFormatted:w?.statsFormatted,marker:`${w?.stroke}`}},[t,c,n,r,a,s]),_=X(()=>{if(!o)return;const f=v();m.find(g=>g.id===f.id)||d(g=>[...g,f])},[v,m,o]),y=f=>{d(g=>g.filter(C=>C.id!==f))};return L(()=>{i(c.dataIdx!==-1&&c.seriesIdx!==-1)},[c]),se("click",_),{showTooltip:o,stickyTooltips:m,handleUnStick:y,getTooltipProps:v,seriesFocus:p,setCursor:h,resetTooltips:u}},fa=({u:t,id:n,title:r,dates:a,value:s,point:o,unit:i="",info:c,statsFormatted:l,isSticky:m,marker:d,onClose:u})=>{const h=W(null),[p,v]=b({top:-999,left:-999}),[_,y]=b(!1),[f,g]=b(!1),C=()=>{u&&u(n)},w=T=>{g(!0),y(!0);const{clientX:M,clientY:x}=T;v({top:x,left:M})},E=X(T=>{if(!_)return;const{clientX:M,clientY:x}=T;v({top:x,left:M})},[_]),N=()=>{y(!1)};return L(()=>{if(!h.current||!t)return;const{top:T,left:M}=o,x={left:parseFloat(t.over.style.left),top:parseFloat(t.over.style.top)},{width:A,height:D}=t.over.getBoundingClientRect(),{width:z,height:R}=h.current.getBoundingClientRect(),V=10,O=M+z>=A?z+2*V:0,q=T+R>=D?R+2*V:0,Q={top:T+x.top+V-q,left:M+x.left+V-O};Q.left<0&&(Q.left=20),Q.top<0&&(Q.top=20),v(Q)},[t,s,o,h]),se("mousemove",E),se("mouseup",N),t?wt(e("div",{className:k({"vm-chart-tooltip":!0,"vm-chart-tooltip_sticky":m,"vm-chart-tooltip_moved":f}),ref:h,style:p,children:[e("div",{className:"vm-chart-tooltip-header",children:[r&&e("div",{className:"vm-chart-tooltip-header__title",children:r}),e("div",{className:"vm-chart-tooltip-header__date",children:a.map((T,M)=>e("span",{children:T},M))}),m&&e(F,{children:[e(P,{className:"vm-chart-tooltip-header__drag",variant:"text",size:"small",startIcon:e(Er,{}),onMouseDown:w,ariaLabel:"drag the tooltip"}),e(P,{className:"vm-chart-tooltip-header__close",variant:"text",size:"small",startIcon:e(Ie,{}),onClick:C,ariaLabel:"close the tooltip"})]})]}),e("div",{className:"vm-chart-tooltip-data",children:[d&&e("span",{className:"vm-chart-tooltip-data__marker",style:{background:d}}),e("p",{className:"vm-chart-tooltip-data__value",children:[e("b",{children:s}),i]})]}),l&&e("table",{className:"vm-chart-tooltip-stats",children:mr.map((T,M)=>e("div",{className:"vm-chart-tooltip-stats-row",children:[e("span",{className:"vm-chart-tooltip-stats-row__key",children:[T,":"]}),e("span",{className:"vm-chart-tooltip-stats-row__value",children:l[T]})]},M))}),c&&e("p",{className:"vm-chart-tooltip__info",children:c})]}),t.root):null},to=({showTooltip:t,tooltipProps:n,stickyTooltips:r,handleUnStick:a})=>e(F,{children:[t&&n&&e(fa,{...n}),r.map(s=>Lo(fa,{...s,isSticky:!0,key:s.id,onClose:a}))]}),Qc=({data:t,series:n,metrics:r=[],period:a,yaxis:s,unit:o,setPeriod:i,layoutSize:c,height:l,isAnomalyView:m,spanGaps:d=!1})=>{const{isDarkTheme:u}=ne(),h=W(null),[p,v]=b(),{xRange:_,setPlotScale:y}=eo({period:a,setPeriod:i}),{onReadyChart:f,isPanning:g}=Zs(y);Xs({uPlotInst:p,xRange:_,setPlotScale:y});const{showTooltip:C,stickyTooltips:w,handleUnStick:E,getTooltipProps:N,seriesFocus:S,setCursor:T,resetTooltips:M}=Bc({u:p,metrics:r,series:n,unit:o,isAnomalyView:m}),x={...js({width:c.width,height:l}),series:n,axes:Fs([{},{scale:"1"}],o),scales:Oc(s,_),hooks:{ready:[f],setSeries:[S],setCursor:[T],setSelect:[Ks(y)],destroy:[Gs]},bands:[]};return L(()=>{if(M(),!h.current)return;p&&p.destroy();const A=new lr(x,t,h.current);return v(A),A.destroy},[h,u]),L(()=>{p&&(p.setData(t),p.redraw())},[t]),L(()=>{p&&(Ys(p),Ic(p,n,d),Hc(p,n),p.redraw())},[n,d]),L(()=>{p&&(Object.keys(s.limits.range).forEach(A=>{p.scales[A]&&(p.scales[A].range=(D,z=0,R=1)=>Js(D,z,R,A,s))}),p.redraw())},[s]),L(()=>{p&&(p.scales.x.range=()=>Ws(_),p.redraw())},[_]),L(()=>{p&&(p.setSize({width:c.width||400,height:l||500}),p.redraw())},[l,c]),e("div",{className:k({"vm-line-chart":!0,"vm-line-chart_panning":g}),style:{minWidth:`${c.width||400}px`,minHeight:`${l||500}px`},children:[e("div",{className:"vm-line-chart__u-plot",ref:h}),e(to,{showTooltip:C,tooltipProps:N(),stickyTooltips:w,handleUnStick:E})]})};var At=(t=>(t.view="legend_view",t.hideDuplicates="legend_hide_duplicates",t.hideStats="legend_hide_stats",t.format="legend_format",t.group="legend_group",t))(At||{}),rr=(t=>(t.table="table",t.lines="lines",t))(rr||{});const Zt=At.view,no=()=>{const[t,n]=me(),r=t.get(Zt),[a,s]=b(r||"lines"),o=i=>{i==="table"?t.set(Zt,i):t.delete(Zt),s(i),n(t)};return L(()=>{const i=t.get(Zt);i!==a&&s(i)},[t]),{view:a,isLinesView:a==="lines",isTableView:a==="table",onChange:o}},Yc=t=>Object.keys(t.freeFormFields).filter(r=>r!=="__name__").map(r=>{const a=`${r}=${JSON.stringify(t.freeFormFields[r])}`;return{id:`${t.label}.${a}`,freeField:a,key:r}}),Xt=At.hideStats,qr=()=>{const[t,n]=me(),r=t.get(Xt)==="true",[a,s]=b(r),o=i=>{i?t.set(Xt,"true"):t.delete(Xt),s(i),n(t)};return L(()=>{const i=t.get(Xt)==="true";i!==a&&s(i)},[t]),{hideStats:a,onChange:o}},en=At.format,ro=()=>{const[t,n]=me(),r=t.get(en)||"",[a,s]=b(r),o=c=>{s(c)},i=()=>{a?t.set(en,a):t.delete(en),n(t)};return L(()=>{const c=t.get(en);c!==a&&s(c||"")},[t]),{format:a,onChange:o,onApply:i}},jc=({legend:t,onChange:n,duplicateFields:r,isAnomalyView:a})=>{const s=Ye(),{hideStats:o}=qr(),{format:i}=ro(),c=Rs(t.freeFormFields,i),l=I(()=>{const p=Yc(t);return r?.length?p.filter(v=>!r.includes(v.key)):p},[t,r]),m=t.statsFormatted,d=Object.values(m).some(p=>p),u=p=>v=>{n&&n(p,v.ctrlKey||v.metaKey)},h=p=>async v=>{v.stopPropagation(),await s(p,`${p} has been copied`)};return e("div",{className:k({"vm-legend-item":!0,"vm-legend-row":!0,"vm-legend-item_hide":!t.checked}),onClick:u(t),children:[!a&&e("div",{className:"vm-legend-item__marker",style:{backgroundColor:t.color}}),e("div",{className:"vm-legend-item-info",children:e("span",{className:"vm-legend-item-info__label",children:[t.hasAlias&&t.label,!t.hasAlias&&i&&c,!t.hasAlias&&!i&&e(F,{children:[t.freeFormFields.__name__,!!l.length&&e(F,{children:" {"}),l.map((p,v)=>e("span",{className:"vm-legend-item-info__free-fields",onClick:h(p.freeField),title:"copy to clipboard",children:[p.freeField,v+1<l.length&&","]},p.key)),!!l.length&&e(F,{children:"}"})]})]})}),!o&&d&&e("div",{className:"vm-legend-item-stats",children:mr.map((p,v)=>e("div",{className:"vm-legend-item-stats-row",children:[e("span",{className:"vm-legend-item-stats-row__key",children:[p,":"]}),e("span",{className:"vm-legend-item-stats-row__value",children:m[p]})]},v))})]})},Gc=({labels:t,isAnomalyView:n,duplicateFields:r,onChange:a})=>e("div",{className:"vm-legend-item-container",children:t.map(s=>e(jc,{legend:s,isAnomalyView:n,duplicateFields:r,onChange:a},s.label))});function Wc(t,n){return Object.fromEntries(Object.entries(t).filter(n))}function ao(t){return Wc(t,n=>!!n[1]||typeof n[1]=="number")}const ga=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),so=(t,n)=>ga(t)&&t[n]?t[n]:n.split(".").reduce((r,a)=>{if(ga(r))return r[a];if(Array.isArray(r)){const s=parseInt(a,10);return r[s]!==void 0?r[s]:void 0}},t),Jc=mr.map(t=>({key:`statsFormatted.${t}`,title:t})),Kc=({labels:t,duplicateFields:n,onChange:r})=>{const{hideStats:a}=qr(),s=a?[]:Jc,i=I(()=>{const m=[...new Set(t.flatMap(d=>Object.keys(d.freeFormFields)))].map(d=>({key:`freeFormFields.${d}`,title:d}));return n?.length?m.filter(d=>!n.includes(d.title)):m},[t,n]).concat(s),c=m=>d=>{r&&r(m,d.ctrlKey||d.metaKey)},l=X((m,d)=>{const u=so(m,d);return typeof u=="string"?u:""},[]);return e("div",{className:"vm-legend-table__wrapper",children:e("table",{className:"vm-legend-table",children:[e("thead",{className:"vm-legend-table-thead",children:e("tr",{className:"vm-legend-table-row vm-legend-table_thead",children:[e("th",{className:"vm-legend-table-col vm-legend-table-col_marker vm-legend-table-col_thead"}),i.map(m=>e("th",{className:"vm-legend-table-col vm-legend-table-col_thead",children:m.title},m.key))]})}),e("tbody",{className:"vm-legend-table-tbody",children:t.map(m=>e("tr",{className:k({"vm-legend-table-row":!0,"vm-legend-table-row_tbody":!0,"vm-legend-table-row_exclude":!m.checked}),onClick:c(m),children:[e("td",{className:"vm-legend-table-col vm-legend-table-col_marker",children:e("div",{className:"vm-legend-item__marker",style:{backgroundColor:m.color}})}),i.map(d=>e("td",{className:"vm-legend-table-col",children:e("span",{className:"vm-legend-table-col__content",children:l(m,d.key)})},`${d.key}_${m.label}`))]},m.label))})]})})},tn=At.hideDuplicates,oo=t=>{const[n,r]=me(),a=n.get(tn)==="true",[s,o]=b(a),i=l=>{l?n.set(tn,"true"):n.delete(tn),o(l),r(n)};L(()=>{const l=n.get(tn)==="true";l!==s&&o(l)},[n]);const c=I(()=>!s||!t?.length||t?.length<2?[]:[...new Set(t.flatMap(m=>Object.keys(m.freeFormFields||{})))].filter(m=>{const d=t.find(u=>u.freeFormFields[m])?.freeFormFields[m];return t.every(u=>u.freeFormFields[m]===d)}),[t,s]);return{hideDuplicates:s,onChange:i,duplicateFields:c}},ar="Ungrouped",nn=At.group,Br=()=>{const[t,n]=me(),r=t.get(nn)||"",[a,s]=b(r),o=i=>{i&&i!==ar?t.set(nn,i):t.delete(nn),s(i),n(t)};return L(()=>{const i=t.get(nn);i!==a&&s(i||"")},[t]),{groupByLabel:a,onChange:o}},Zc=({labels:t,group:n,isAnomalyView:r,onChange:a})=>{const{isTableView:s}=no(),{groupByLabel:o}=Br(),i=Ye(),{duplicateFields:c}=oo(t),l=I(()=>t.sort((u,h)=>(h.median||0)-(u.median||0)),[t]),m=u=>async h=>{h.stopPropagation(),await i(u,`${u} has been copied`)},d=s?Kc:Gc;return e("div",{className:"vm-legend-group",children:e(Rr,{defaultExpanded:!0,title:e("div",{className:"vm-legend-group-header",children:[e("div",{className:"vm-legend-group-header-title",children:["Group by",o?"":" query",": ",e("b",{children:n})]}),!!c.length&&e("div",{className:"vm-legend-group-header-labels",children:["common labels: {",c.map(u=>e("div",{onClick:m(`${u}="${t[0].freeFormFields[u]}"`),className:"vm-legend-group-header-labels__item",children:`${u}="${t[0].freeFormFields[u]}"`},u)),"}"]})]}),children:e(d,{labels:l,isAnomalyView:r,duplicateFields:c,onChange:a})})},n)},Xc=({labels:t,query:n,groupByLabel:r})=>I(()=>ed(t,n,r),[t,n,r]),ed=(t,n,r)=>{const a=new Map;for(const s of t){const o=r?`${r}="${s.freeFormFields[r]??""}"`:`${n[s.group-1]}`;a.has(o)||a.set(o,{group:String(o),items:[]});const i=a.get(o);i.items.some(l=>l.label===s.label)||i.items.push(s)}return Array.from(a.values())},td=({values:t,onRemoveItem:n})=>{const{isMobile:r}=j(),a=s=>o=>{n(s),o.stopPropagation()};return r?e("span",{className:"vm-select-input-content__counter",children:["selected ",t.length]}):e(F,{children:t.map(s=>e("div",{className:"vm-select-input-content__selected",children:[e("span",{children:s}),e("div",{onClick:a(s),children:e(Ie,{})})]},s))})},kt=({value:t,list:n,label:r,placeholder:a,noOptionsText:s,clearable:o=!1,searchable:i=!1,autofocus:c,disabled:l,onChange:m})=>{const{isDarkTheme:d}=ne(),{isMobile:u}=j(),[h,p]=b(""),v=W(null),[_,y]=b(null),[f,g]=b(!1),C=W(null),w=Array.isArray(t),E=Array.isArray(t)?t:void 0,N=u&&w&&!!E?.length,S=I(()=>f?h:Array.isArray(t)?"":t,[t,h,f,w]),T=I(()=>f?h||"(.+)":"",[h,f]),M=()=>{C.current&&C.current.blur()},x=()=>{g(!1),M()},A=()=>{l||g(!0)},D=()=>{n.includes(h)&&m(h)},z=Q=>{Q.target instanceof HTMLInputElement||l||g(re=>!re)},R=Q=>{p(""),m(Q),w||x(),w&&C.current&&C.current.focus()},V=Q=>{p(Q.target.value)},O=Q=>re=>{R(Q),re.stopPropagation()},q=Q=>{C.current!==Q.target&&g(!1)};return L(()=>{p(""),f&&C.current&&C.current.focus(),f||M()},[f,C]),L(()=>{!c||!C.current||u||C.current.focus()},[c,C]),se("keyup",q),kn(v,x,_),e("div",{className:k({"vm-select":!0,"vm-select_dark":d,"vm-select_disabled":l}),children:[e("div",{className:"vm-select-input",onClick:z,ref:v,children:[e("div",{className:"vm-select-input-content",children:[!!E?.length&&e(td,{values:E,onRemoveItem:R}),!N&&e("input",{value:S,type:"text",placeholder:a,onInput:V,onFocus:A,onBlur:D,ref:C,readOnly:u||!i})]}),r&&e("span",{className:"vm-text-field__label",children:r}),o&&t&&e("div",{className:"vm-select-input__icon",onClick:O(""),children:e(Ie,{})}),e("div",{className:k({"vm-select-input__icon":!0,"vm-select-input__icon_open":f}),children:e(Be,{})})]}),e(ks,{label:r,value:T,options:n.map(Q=>({value:Q})),anchor:v,selected:E,minLength:1,fullWidth:!0,noOptionsText:s,onSelect:R,onOpenAutocomplete:g,onChangeWrapperRef:y})]})},io=({data:t,isCompact:n})=>{const{isTableView:r,onChange:a}=no(),{hideDuplicates:s,onChange:o}=oo(),{hideStats:i,onChange:c}=qr(),{format:l,onChange:m,onApply:d}=ro(),{groupByLabel:u,onChange:h}=Br(),p=Je(),v=I(()=>{if(!t||!t.length)return[];const C=t.flatMap(w=>Object.keys(w.metric));return Array.from(new Set(C))},[t]),_=C=>{const w=C?rr.table:rr.lines;a(w)},y=()=>{p({type:"SET_OPEN_SETTINGS",payload:!0})},f=[{label:"Table View",value:r,onChange:_,info:"If enabled, the legend will be displayed in a table format."},{label:"Hide Common Labels",value:s,onChange:o,info:"If enabled, hides labels that are the same for all series."},{label:"Hide Statistics",value:i,onChange:c,info:"If enabled, hides the display of min, median, and max values."}],g=n?G:F;return e("div",{className:k({"vm-legend-configs":!0,"vm-legend-configs_compact":n}),children:[f.map(({label:C,value:w,onChange:E,info:N})=>e(g,{title:N,children:e("div",{className:"vm-legend-configs-item vm-legend-configs-item_switch",children:[e("span",{className:"vm-legend-configs-item__label",children:C}),e(Fe,{label:`${n?C:w?"Enabled":"Disabled"}`,value:w,onChange:E}),e("span",{className:"vm-legend-configs-item__info",children:N})]})},C)),n&&e(P,{size:"small",variant:"text",startIcon:e(it,{}),onClick:y,children:"Settings"}),!n&&e(F,{children:[e("div",{className:"vm-legend-configs-item",children:[e(oe,{label:"Custom Legend Format",placeholder:"{{label_name}}",value:l,onChange:m,onBlur:d,onEnter:d}),e("span",{className:"vm-legend-configs-item__info vm-legend-configs-item__info_input",children:"Customize legend labels with text and {{label_name}} placeholders."})]}),e("div",{className:"vm-legend-configs-item",children:[e(kt,{label:"Group Legend By",value:u,list:[ar,...v],placeholder:ar,onChange:h,searchable:!0}),e("span",{className:"vm-legend-configs-item__info",children:"Choose a label to group the legend. By default, legends are grouped by query."})]})]})]})},nd=({labels:t,query:n,isAnomalyView:r,isPredefinedPanel:a,onChange:s})=>{const{groupByLabel:o}=Br(),i=Xc({labels:t,query:n,groupByLabel:o});return e("div",{className:"vm-legend",children:[!a&&e(io,{isCompact:!0}),e("div",{children:i.map(({group:c,items:l})=>e(Zc,{labels:l,group:c,isAnomalyView:r,onChange:s},c))})]})},rd=({min:t,max:n,legendValue:r})=>{const[a,s]=b(0),[o,i]=b(""),[c,l]=b(""),[m,d]=b(""),u=I(()=>parseFloat(String(r?.value||0).replace("%","")),[r]);return L(()=>{s(u?(u-t)/(n-t)*100:0),i(u?`${u}%`:""),l(`${t}%`),d(`${n}%`)},[u,t,n]),e("div",{className:"vm-legend-heatmap__wrapper",children:e("div",{className:"vm-legend-heatmap",children:[e("div",{className:"vm-legend-heatmap-gradient",style:{background:`linear-gradient(to right, ${Ur.join(", ")})`},children:!!u&&e("div",{className:"vm-legend-heatmap-gradient__value",style:{left:`${a}%`},children:e("span",{children:o})})}),e("div",{className:"vm-legend-heatmap__value",children:c}),e("div",{className:"vm-legend-heatmap__value",children:m})]})})},ad=({u:t,metrics:n,unit:r})=>{const[a,s]=b({left:0,top:0}),[o,i]=b([]),c=()=>{i([]),s({left:0,top:0})},l=h=>{const p=h.cursor.left||0,v=h.cursor.top||0;s({left:p,top:v})},m=X(()=>{const{left:h,top:p}=a,v=t?.data[1][0]||[],_=t?t.posToVal(h,"x"):0,y=t?t.posToVal(p,"y"):0,f=v.findIndex((x,A)=>_>=x&&_<v[A+1])||-1,g=v[f+1],C=n[Math.round(y)]||{values:[]},[w=0,E=""]=C.values.find(x=>x[0]===g)||[],N=v[f],S=U(N*1e3).tz().format(cn),T=U(w*1e3).tz().format(cn),M=C?.metric?.vmrange||"";return{unit:r,point:a,u:t,id:`${M}_${S}`,dates:[S,T],value:`${E}%`,info:M,show:+E>0}},[t,a,n,r]),d=X(()=>{const h=m();h.show&&(o.find(p=>p.id===h.id)||i(p=>[...p,h]))},[m,o]),u=h=>{i(p=>p.filter(v=>v.id!==h))};return se("click",d),{stickyTooltips:o,handleUnStick:u,getTooltipProps:m,setCursor:l,resetTooltips:c}},sd=({data:t,metrics:n=[],period:r,unit:a,setPeriod:s,layoutSize:o,height:i,onChangeLegend:c})=>{const{isDarkTheme:l}=ne(),m=W(null),[d,u]=b(),{xRange:h,setPlotScale:p}=eo({period:r,setPeriod:s}),{onReadyChart:v,isPanning:_}=Zs(p);Xs({uPlotInst:d,xRange:h,setPlotScale:p});const{stickyTooltips:y,handleUnStick:f,getTooltipProps:g,setCursor:C,resetTooltips:w}=ad({u:d,metrics:n,unit:a}),E=I(()=>g(),[g]),N=()=>{const T=Fs([{}],a);return[...T,{scale:"y",stroke:T[0].stroke,font:T[0].font,size:Vs,splits:n.map((M,x)=>x),values:n.map(M=>M.metric.vmrange)}]},S={...js({width:o.width,height:i}),mode:2,series:[{},{paths:Sc(),facets:[{scale:"x",auto:!0,sorted:1},{scale:"y",auto:!0}]}],axes:N(),scales:{x:{time:!0},y:{log:2,time:!1,range:(T,M,x)=>[M-1,x+1]}},hooks:{ready:[v],setCursor:[C],setSelect:[Ks(p)],destroy:[Gs]}};return L(()=>{w();const T=t[0]===null&&Array.isArray(t[1]);if(!m.current||!T)return;const M=new lr(S,t,m.current);return u(M),M.destroy},[m,t,l]),L(()=>{d&&(d.setSize({width:o.width||400,height:i||500}),d.redraw())},[i,o]),L(()=>{c(E)},[E]),e("div",{className:k({"vm-line-chart":!0,"vm-line-chart_panning":_}),style:{minWidth:`${o.width||400}px`,minHeight:`${i||500}px`},children:[e("div",{className:"vm-line-chart__u-plot",ref:m}),e(to,{showTooltip:!!E.show,tooltipProps:E,stickyTooltips:y,handleUnStick:f})]})},od=()=>{const[t,n]=b(null),[r,a]=b({width:0,height:0}),s=X(()=>{a({width:t?.offsetWidth||0,height:t?.offsetHeight||0})},[t?.offsetHeight,t?.offsetWidth]);return se("resize",s),L(s,[t?.offsetHeight,t?.offsetWidth]),[n,r]},id={[ee.yhat]:"yhat",[ee.yhatLower]:"yhat_upper - yhat_lower",[ee.yhatUpper]:"yhat_upper - yhat_lower",[ee.anomaly]:"anomalies",[ee.training]:"training data",[ee.actual]:"y"},ld=({series:t})=>{const n=I(()=>{const r=t.reduce((s,o)=>{const i=Object.prototype.hasOwnProperty.call(o,"forecast"),c=o.forecast!==ee.yhatUpper,l=!s.find(m=>m.forecast===o.forecast);return i&&l&&c&&s.push(o),s},[]),a={...r[0],forecast:ee.training,color:_t[ee.training]};return r.splice(1,0,a),r.map(s=>({...s,color:typeof s.stroke=="string"?s.stroke:_t[s.forecast||ee.actual]}))},[t]);return e(F,{children:e("div",{className:"vm-legend-anomaly",children:n.filter(r=>r.forecast!==ee.training).map((r,a)=>e("div",{className:"vm-legend-anomaly-item",children:[e("svg",{children:r.forecast===ee.anomaly?e("circle",{cx:"15",cy:"7",r:"4",fill:r.color,stroke:r.color,strokeWidth:"1.4"}):e("line",{x1:"0",y1:"7",x2:"30",y2:"7",stroke:r.color,strokeWidth:r.width||1,strokeDasharray:r.dash?.join(",")})}),e("div",{className:"vm-legend-anomaly-item__title",children:id[r.forecast||ee.actual]})]},`${a}_${r.forecast}`))})})},$n=({data:t=[],period:n,customStep:r,query:a,yaxis:s,unit:o,showLegend:i=!0,setYaxisLimits:c,setPeriod:l,alias:m=[],fullWidth:d=!0,height:u,isHistogram:h,isAnomalyView:p,isPredefinedPanel:v,spanGaps:_})=>{const y=Je(),{isMobile:f}=j(),{timezone:g}=ve(),C=I(()=>r||n.step||"1s",[n.step,r]),w=I(()=>Ec(t,h),[h,t]),[E,N]=b([[]]),[S,T]=b([]),[M,x]=b([]),[A,D]=b([]),[z,R]=b(null),V=I(()=>Mc(w,A,m,p),[w,A,m,p]),O=B=>{const $=_c(B,!h);c($)},q=(B,$)=>{D(kc({hideSeries:A,legend:B,metaKey:$,series:S,isAnomalyView:p}))},Q=B=>{const $=B.slice(1,B.length),H=[],Y=[];$.forEach((le,de)=>{le.forEach((ue,fe)=>{const Ce=fe*$.length+de;Y[Ce]=ue})}),B[0].forEach(le=>{const de=new Array($.length).fill(le);H.push(...de)});const K=new Array(H.length).fill(0).map((le,de)=>de%$.length);return[null,[H,K,Y]]},re=B=>p?Rl(B,["group","label"]).map(H=>{const Y=H.values[0];return{...Y,freeFormFields:{...Y.freeFormFields,__name__:""}}}):B;L(()=>{const B=[],$={},H=[],Y=[{}];w?.forEach((fe,Ce)=>{const Ae=V(fe,Ce);Y.push(Ae),H.push(ha(Ae,fe.group));const xe=$[fe.group]||[];for(const ge of fe.values)B.push(ge[0]),xe.push(Pt(ge[1]));$[fe.group]=xe});const K=bc(B,C,n),le=w.map(fe=>{const Ce=[],Ae=fe.values,xe=Ae.length;let ge=0;for(const Ke of K){for(;ge<xe&&Ae[ge][0]<Ke;)ge++;let ft=null;ge<xe&&Ae[ge][0]==Ke&&(ft=Pt(Ae[ge][1]),Number.isFinite(ft)||(ft=null)),Ce.push(ft)}const be=Ce.filter(Ke=>Ke!==null),Et=Math.abs(uc(be)),je=Vr(Fr(be),Hr(be)),vt=Math.abs(je[1]-je[0]);return Et>vt*1e10&&!p?Ce.map(()=>Et):Ce});le.unshift(K),O($);const de=h?Q(le):le;N(de),T(Y);const ue=re(H);x(ue),p&&D(ue.map(fe=>fe.label||"").slice(1))},[w,g,h,C]),L(()=>{const B=[],$=[{}];w?.forEach((H,Y)=>{const K=V(H,Y);$.push(K),B.push(ha(K,H.group))}),T($),x(re(B))},[A]);const[Z,te]=od(),ie=E[0]?.length>0;return L(()=>{const $=(()=>{if(!h||!w[1])return!1;try{return(E?.[1]?.[2]||[]).every(Y=>Y===null)}catch{return!1}})();y({type:"SET_IS_EMPTY_HISTOGRAM",payload:$})},[E,h]),e("div",{className:k({"vm-graph-view":!0,"vm-graph-view_full-width":d,"vm-graph-view_full-width_mobile":d&&f}),ref:Z,children:[!h&&ie&&e(Qc,{data:E,series:S,metrics:w,period:n,yaxis:s,unit:o,setPeriod:l,layoutSize:te,height:u,isAnomalyView:p,spanGaps:_}),h&&e(sd,{data:E,metrics:w,period:n,unit:o,setPeriod:l,layoutSize:te,height:u,onChangeLegend:R}),p&&i&&e(ld,{series:S}),!h&&i&&e(nd,{labels:M,query:a,isAnomalyView:p,onChange:q,isPredefinedPanel:v}),h&&i&&e(rd,{min:s.limits.range[1][0]||0,max:s.limits.range[1][1]||0,legendValue:z})]})},cd=({yaxis:t,setYaxisLimits:n,toggleEnableLimits:r})=>{const{isMobile:a}=j(),s=I(()=>Object.keys(t.limits.range),[t.limits.range]),i=X(bn((l,m,d)=>{const u=t.limits.range;u[m][d]=+l,!(u[m][0]===u[m][1]||u[m][0]>u[m][1])&&n(u)},500),[t.limits.range]),c=(l,m)=>d=>{i(d,l,m)};return e("div",{className:k({"vm-axes-limits":!0,"vm-axes-limits_mobile":a}),children:[e("div",{className:"vm-graph-settings-row",children:[e("span",{className:"vm-graph-settings-row__label",children:"Fixed Y-axis limits"}),e(Fe,{value:t.limits.enable,onChange:r,label:t.limits.enable?"Enabled":"Disabled",fullWidth:a})]}),e("span",{className:"vm-legend-configs-item__info",children:"Enables manual setting of min and max values for the y-axis."}),t.limits.enable&&e("div",{className:"vm-axes-limits-list",children:s.map(l=>e("div",{className:"vm-axes-limits-list__inputs",children:[e(oe,{label:`Min ${l}`,type:"number",disabled:!t.limits.enable,value:t.limits.range[l][0],onChange:c(l,0)}),e(oe,{label:`Max ${l}`,type:"number",disabled:!t.limits.enable,value:t.limits.range[l][1],onChange:c(l,1)})]},l))})]})},dd=({spanGaps:t,onChange:n})=>{const{isMobile:r}=j();return e("div",{className:"vm-graph-settings-row",children:[e("span",{className:"vm-graph-settings-row__label",children:"Connect null values"}),e(Fe,{value:t,onChange:n,label:t?"Enabled":"Disabled",fullWidth:r}),e("span",{className:"vm-legend-configs-item__info",children:"Connects data points by skipping null values instead of creating gaps."})]})},lo=()=>{const[t,n]=me(),r=Ue();return{handleChange:(s,o)=>{s?t.delete("display_mode"):t.set("display_mode","lines"),n(t),r({type:"RUN_QUERY"}),o&&o()}}},md=({onChange:t})=>{const{isMobile:n}=j(),{handleChange:r}=lo(),[a]=me(),s=!a.get("display_mode");return e("div",{className:"vm-graph-settings-row",children:[e("span",{className:"vm-graph-settings-row__label",children:"Histogram mode"}),e(Fe,{value:s,onChange:i=>{r(i,t)},label:s?"Enabled":"Disabled",fullWidth:n})]})},ya="Graph & Legend Settings",Qr=({data:t,yaxis:n,setYaxisLimits:r,toggleEnableLimits:a,spanGaps:s})=>{const{openSettings:o}=Le(),i=Je(),c=W(null),l=W(null),m=Pr(t),{value:d,setTrue:u,setFalse:h}=ce(!1);return L(()=>{o&&(u(),i({type:"SET_OPEN_SETTINGS",payload:!1}))},[o]),e("div",{className:"vm-graph-settings",children:[e(G,{title:ya,children:e("div",{ref:l,children:e(P,{variant:"text",startIcon:e(it,{}),onClick:u,ariaLabel:"settings"})})}),d&&e(Me,{onClose:h,title:ya,className:"vm-graph-settings-modal",children:e("div",{className:"vm-graph-settings-body",ref:c,children:[e("div",{className:"vm-graph-settings-body-section",children:[e("h3",{className:"vm-graph-settings-body-section__title",children:"Graph Options"}),e("div",{className:"vm-graph-settings-body-section-content",children:[e(cd,{yaxis:n,setYaxisLimits:r,toggleEnableLimits:a}),e(dd,{spanGaps:s.value,onChange:s.onChange}),m&&e(md,{onChange:h})]})]}),e("div",{className:"vm-graph-settings-body-section",children:[e("h3",{className:"vm-graph-settings-body-section__title",children:"Legend Options"}),e("div",{className:"vm-graph-settings-body-section-content",children:e(io,{data:t})})]})]})})]})},co=({isHistogram:t,graphData:n,controlsRef:r,isAnomalyView:a})=>{const{isMobile:s}=j(),{customStep:o,yaxis:i,spanGaps:c}=Le(),{period:l}=ve(),{query:m}=Te(),d=Ue(),u=Je(),h=f=>{u({type:"SET_YAXIS_LIMITS",payload:f})},p=()=>{u({type:"TOGGLE_ENABLE_YAXIS_LIMITS"})},v=f=>{u({type:"SET_SPAN_GAPS",payload:f})},_=({from:f,to:g})=>{d({type:"SET_PERIOD",payload:{from:f,to:g}})},y=e("div",{className:"vm-custom-panel-body-header__graph-controls",children:[e(Ir,{}),e(Qr,{data:n,yaxis:i,isHistogram:t,setYaxisLimits:h,toggleEnableLimits:p,spanGaps:{value:c,onChange:v}})]});return e(F,{children:[r.current&&wt(y,r.current),e($n,{data:n,period:l,customStep:o,query:m,yaxis:i,setYaxisLimits:h,setPeriod:_,height:s?window.innerHeight*.5:500,isHistogram:t,isAnomalyView:a,spanGaps:c})]})},Yr=({data:t})=>{const n=Ye(),r=I(()=>JSON.stringify(t,null,2),[t]);return e("div",{className:"vm-json-view",children:[e("div",{className:"vm-json-view__copy",children:e(P,{variant:"outlined",onClick:async()=>{await n(r,"Formatted JSON has been copied")},children:"Copy JSON"})}),e("pre",{className:"vm-json-view__code",children:e("code",{children:r})})]})},jr=t=>{const n={};return t.forEach(r=>Object.entries(r.metric).forEach(a=>n[a[0]]?n[a[0]].options.add(a[1]):n[a[0]]={options:new Set([a[1]])})),Object.entries(n).map(r=>({key:r[0],variations:r[1].options.size})).sort((r,a)=>r.variations-a.variations)},ba=(t,n)=>I(()=>n?jr(t).filter(a=>n.includes(a.key)):[],[t,n]),mo=({data:t,displayColumns:n})=>{const r=Ye(),{isMobile:a}=j(),{tableCompact:s}=Re(),o=W(null),[i,c]=b(""),[l,m]=b("asc"),d=s?ba([{group:0,metric:{Data:"Data"}}],["Data"]):ba(t,n),u=C=>{const{__name__:w,...E}=C;return!w&&!Object.keys(E).length?"":w?`${w} ${JSON.stringify(E)}`:`${JSON.stringify(E)}`},p=new Set(t?.map(C=>C.group)).size>1,v=I(()=>{const C=t?.map(N=>({metadata:d.map(S=>s?tr(N,"",p):N.metric[S.key]||"-"),value:N.value?N.value[1]:"-",values:N.values?N.values.map(([S,T])=>`${T} @${S}`):[],copyValue:u(N.metric)})),w=i==="Value",E=d.findIndex(N=>N.key===i);return!w&&E===-1?C:C.sort((N,S)=>{const T=w?Number(N.value):N.metadata[E],M=w?Number(S.value):S.metadata[E];return(l==="asc"?T<M:T>M)?-1:1})},[d,t,i,l,s]),_=I(()=>v.some(C=>C.copyValue),[v]),y=C=>{m(w=>w==="asc"&&i===C?"desc":"asc"),c(C)},f=C=>()=>{y(C)},g=C=>async()=>{await r(C,"Row has been copied")};return v.length?e("div",{className:k({"vm-table-view":!0,"vm-table-view_mobile":a}),children:e("table",{className:"vm-table",ref:o,children:[e("thead",{className:"vm-table-header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:[d.map((C,w)=>e("td",{className:"vm-table-cell vm-table-cell_header vm-table-cell_sort",onClick:f(C.key),children:e("div",{className:"vm-table-cell__content",children:[C.key,e("div",{className:k({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":i===C.key,"vm-table__sort-icon_desc":l==="desc"&&i===C.key}),children:e(Be,{})})]})},w)),e("td",{className:"vm-table-cell vm-table-cell_header vm-table-cell_right vm-table-cell_sort",onClick:f("Value"),children:e("div",{className:"vm-table-cell__content",children:[e("div",{className:k({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":i==="Value","vm-table__sort-icon_desc":l==="desc"}),children:e(Be,{})}),"Value"]})}),_&&e("td",{className:"vm-table-cell vm-table-cell_header"})]})}),e("tbody",{className:"vm-table-body",children:v.map((C,w)=>e("tr",{className:"vm-table__row",children:[C.metadata.map((E,N)=>e("td",{className:k({"vm-table-cell vm-table-cell_no-wrap":!0,"vm-table-cell_gray":v[w-1]&&v[w-1].metadata[N]===E}),children:E},N)),e("td",{className:"vm-table-cell vm-table-cell_right vm-table-cell_no-wrap",children:C.values.length?C.values.map(E=>e("p",{children:E},E)):C.value}),_&&e("td",{className:"vm-table-cell vm-table-cell_right",children:C.copyValue&&e("div",{className:"vm-table-cell__content",children:e(G,{title:"Copy row",children:e(P,{variant:"text",color:"gray",size:"small",startIcon:e(ht,{}),onClick:g(C.copyValue),ariaLabel:"copy row"})})})})]},w))})]})}):e(ae,{variant:"warning",children:"No data to show"})},sr=({checked:t=!1,disabled:n=!1,label:r,color:a="secondary",onChange:s})=>{const o=()=>{n||s(!t)},i=k({"vm-checkbox":!0,"vm-checkbox_disabled":n,"vm-checkbox_active":t,[`vm-checkbox_${a}_active`]:t,[`vm-checkbox_${a}`]:a});return e("div",{className:i,onClick:o,children:[e("div",{className:"vm-checkbox-track",children:e("div",{className:"vm-checkbox-track__thumb",children:e(Ln,{})})}),r&&e("span",{className:"vm-checkbox__label",children:r})]})},Qn="Table settings",uo=({columns:t,selectedColumns:n=[],tableCompact:r,onChangeColumns:a,toggleTableCompact:s})=>{const[o,i]=me(),c=W(null),{value:l,toggle:m,setFalse:d}=ce(!1),[u,h]=b(""),[p,v]=b(-1),_=I(()=>n.filter(T=>!t.includes(T)),[t,n]),y=I(()=>{const T=_.concat(t);return(u?T.filter(x=>x.includes(u)):T).sort((x,A)=>x.localeCompare(A))},[t,_,u]),f=I(()=>y.every(T=>n.includes(T)),[n,y]),g=T=>{a(T);const M=new URLSearchParams(o.toString());T.length===t.length?M.delete("columns"):M.set("columns",T.map(encodeURIComponent).join(",")),i(M)},C=T=>{const M=n.includes(T)?n.filter(x=>x!==T):[...n,T];g(M)},w=()=>{g(f?n.filter(T=>!y.includes(T)):y)},E=T=>()=>{C(T)},N=()=>{v(-1)},S=T=>{const M=T.key==="ArrowUp",x=T.key==="ArrowDown",A=T.key==="Enter";(x||M||A)&&T.preventDefault(),x?v(D=>D+1>y.length-1?D:D+1):M?v(D=>D-1<0?D:D-1):A&&C(y[p])};return L(()=>{In(t,n)||o.has("columns")||a(t)},[t]),L(()=>{if(!o.has("columns"))return;const x=(o.get("columns")||"").split(",").map(decodeURIComponent).filter(Boolean);a(x)},[]),e("div",{className:"vm-table-settings",children:[e(G,{title:Qn,children:e("div",{ref:c,children:e(P,{variant:"text",startIcon:e(it,{}),onClick:m,ariaLabel:Qn})})}),l&&e(Me,{title:Qn,className:"vm-table-settings-modal",onClose:d,children:[e("div",{className:"vm-table-settings-modal-section",children:[e("div",{className:"vm-table-settings-modal-section__title",children:"Customize columns"}),e("div",{className:"vm-table-settings-modal-columns",children:[e("div",{className:"vm-table-settings-modal-columns__search",children:e(oe,{placeholder:"Search columns",startIcon:e(cs,{}),value:u,onChange:h,onBlur:N,onKeyDown:S,type:"search"})}),e("div",{className:"vm-table-settings-modal-columns-list",children:[!!y.length&&e("div",{className:"vm-table-settings-modal-columns-list__item vm-table-settings-modal-columns-list__item_all",children:e(sr,{checked:f,onChange:w,label:f?"Uncheck all":"Check all",disabled:r})}),!y.length&&e("div",{className:"vm-table-settings-modal-columns-no-found",children:e("p",{className:"vm-table-settings-modal-columns-no-found__info",children:"No columns found."})}),y.map((T,M)=>e("div",{className:k({"vm-table-settings-modal-columns-list__item":!0,"vm-table-settings-modal-columns-list__item_focus":M===p,"vm-table-settings-modal-columns-list__item_custom":_.includes(T)}),children:e(sr,{checked:n.includes(T),onChange:E(T),label:T,disabled:r})},T))]})]})]}),s&&r!==void 0&&e("div",{className:"vm-table-settings-modal-section",children:[e("div",{className:"vm-table-settings-modal-section__title",children:"Table view"}),e("div",{className:"vm-table-settings-modal-columns-list__item",children:e(Fe,{label:"Compact view",value:r,onChange:s})})]})]})]})},ud=({liveData:t,controlsRef:n})=>{const{tableCompact:r}=Re(),a=St(),[s,o]=b(),i=I(()=>jr(t||[]).map(m=>m.key),[t]),l=e(uo,{columns:i,selectedColumns:s,onChangeColumns:o,tableCompact:r,toggleTableCompact:()=>{a({type:"TOGGLE_TABLE_COMPACT"})}});return e(F,{children:[n.current&&wt(l,n.current),e(mo,{data:t,displayColumns:s})]})},ho=({graphData:t,liveData:n,isHistogram:r,displayType:a,controlsRef:s})=>a===pe.code&&n?e(Yr,{data:n}):a===pe.table&&n?e(ud,{liveData:n,controlsRef:s}):a===pe.chart&&t?e(co,{graphData:t,isHistogram:r,controlsRef:s}):null,hd=e(F,{children:[e("p",{children:"Filename - specify the name for your report file."}),e("p",{children:["Default format: ",e("code",{children:["vmui_report_$",Pa,".json"]}),"."]}),e("p",{children:"This name will be used when saving your report on your device."})]}),pd=e(F,{children:[e("p",{children:["Title - specify the title that will be displayed on the ",e(Cn,{to:J.queryAnalyzer,target:"_blank",rel:"noreferrer",className:"vm-link vm-link_underlined",children:mt[J.queryAnalyzer].title})," page."]}),e("p",{children:"This helps identify your report in the interface."})]}),vd=e(F,{children:[e("p",{children:"Comment (optional) - add a comment to your report."}),e("p",{children:"This can be any additional information that will be useful when reviewing the report later."})]}),fd=e(F,{children:[e("p",{children:"Query trace - enable this option to include a query trace in your report."}),e("p",{children:"This will assist in analyzing and diagnosing the query processing."})]}),gd=e(F,{children:[e("p",{children:"Generate Report - click this button to generate and save your report. "}),e("p",{children:["After creation, the report can be downloaded and examined on the ",e(Cn,{to:J.queryAnalyzer,target:"_blank",rel:"noreferrer",className:"vm-link vm-link_underlined",children:mt[J.queryAnalyzer].title})," page."]})]}),yd=[hd,pd,vd,fd,gd],po=t=>{try{return JSON.parse(t)}catch{return null}},bd=[{title:"Write",value:!1},{title:"Preview",value:!0}],_d=({value:t,onChange:n})=>{const{value:r,setTrue:a,setFalse:s}=ce(!1);return e("div",{className:"vm-markdown-editor",children:[e("div",{className:"vm-markdown-editor-header",children:[e("div",{className:"vm-markdown-editor-header-tabs",children:bd.map(({title:o,value:i})=>e("div",{className:k({"vm-markdown-editor-header-tabs__tab":!0,"vm-markdown-editor-header-tabs__tab_active":r===i}),onClick:i?a:s,children:o},o))}),e("span",{className:"vm-markdown-editor-header__info",children:"Markdown is supported"})]}),r?e("div",{className:"vm-markdown-editor-preview vm-markdown",dangerouslySetInnerHTML:{__html:_n(t)}}):e(oe,{type:"textarea",value:t,onChange:n})]})};var vo=(t=>(t[t.QUERY_DATA=0]="QUERY_DATA",t[t.RAW_DATA=1]="RAW_DATA",t))(vo||{});const Cd=t=>{switch(t){case 1:return"Raw report";default:return"Report"}},wd=t=>{const n=U().utc().format(Pa);return`vmui_${t.toLowerCase().replace(/ /g,"_")}_${n}`},fo=({fetchUrl:t,reportType:n=0})=>{const{query:r}=Te(),a=Cd(n),s=wd(a),[o,i]=b(a),[c,l]=b(s),[m,d]=b(""),[u,h]=b(n===0),[p,v]=b(),[_,y]=b(!1),f=W(null),g=W(null),C=W(null),w=W(null),E=W(null),N=[g,f,C,w,E],[S,T]=b(0),{value:M,toggle:x,setFalse:A}=ce(!1),{value:D,toggle:z,setFalse:R}=ce(!1),V=X(()=>{if(t)try{return t.map(($,H)=>{const Y=new URL($);return u?Y.searchParams.set("trace","1"):Y.searchParams.delete("trace"),{id:H,url:Y}})}catch($){v(String($))}},[t,u]),O=X($=>{const H=JSON.stringify($,null,2);Hs(H,`${c||s}.json`),A()},[c]),q=({id:$,url:H,comment:Y,title:K})=>({id:$,title:K||a,comment:Y,endpoint:$o(H.pathname)||"",params:Object.fromEntries(H.searchParams)}),Q=async($,H)=>{const Y=[],K=await $.text();return $.ok?K.split(`
`).filter(de=>de).forEach(de=>{const ue=po(de);ue&&Y.push({metric:ue.metric,values:ue.values.map((fe,Ce)=>[ue.timestamps[Ce]/1e3,fe])})}):v(String(K)),{data:{result:Y,resultType:"matrix"},vmui:q(H)}},re=async($,H)=>{const Y=await $.json();if($.ok)return Y.vmui=q(H),Y;{const K=Y.errorType?`${Y.errorType}\r
`:"";v(`${K}${Y?.error||Y?.message||"unknown error"}`)}},Z=async($,H)=>{switch(n){case 1:return await Q($,H);default:return await re($,H)}},te=X(async()=>{const $=V();if(!$){v(H=>H||ye.validQuery);return}v(""),y(!0);try{const H=[];for await(const Y of $){if(!Y)continue;const{url:K,id:le}=Y,de=await fetch(K),ue=await Z(de,{id:le,url:K,comment:m,title:o});H.push(ue)}H.length&&O(H)}catch(H){H instanceof Error&&H.name!=="AbortError"&&v(`${H.name}: ${H.message}`)}finally{y(!1)}},[V,m,O,r,o]),ie=$=>()=>{const H=Y=>{const K=Y+$;return N[K]?.current?K:H(K)};T(H)};return L(()=>{v(""),l(s),d("")},[M]),L(()=>{T(0)},[D]),e(F,{children:[e(G,{title:"Export query",children:e(P,{variant:"text",startIcon:e(Mn,{}),onClick:x,ariaLabel:"export query"})}),M&&e(Me,{title:"Export query",onClose:A,isOpen:M,children:e("div",{className:"vm-download-report",children:[e("div",{className:"vm-download-report-settings",children:[e("div",{ref:g,children:[e("div",{className:"vm-download-report-settings__title",children:"Filename"}),e(oe,{value:c,onChange:l})]}),e("div",{ref:f,children:[e("div",{className:"vm-download-report-settings__title",children:"Report title"}),e(oe,{value:o,onChange:i})]}),e("div",{ref:C,children:[e("div",{className:"vm-download-report-settings__title",children:"Comment"}),e(_d,{value:m,onChange:d})]}),n===0&&e(F,{children:[e("div",{ref:w,children:e(sr,{checked:u,onChange:h,label:"Include query trace"})}),e(ae,{variant:"info",children:["If confused with the query results, try viewing the raw samples for selected series in ",e(()=>e(Cn,{className:"vm-link vm-link_underlined vm-link_colored",to:J.rawQuery,children:"Raw Query"}),{})," tab."]})]})]}),p&&e(ae,{variant:"error",children:p}),e("div",{className:"vm-download-report__buttons",children:[e(P,{variant:"text",onClick:z,children:"Help"}),e("div",{ref:E,children:e(P,{onClick:te,disabled:_,children:_?"Loading data...":"Generate Report"})})]}),e(Qe,{open:D,buttonRef:N[S],placement:"top-left",variant:"dark",onClose:R,children:e("div",{className:"vm-download-report-helper",children:[e("div",{className:"vm-download-report-helper__description",children:yd[S]}),e("div",{className:"vm-download-report-helper__buttons",children:[S!==0&&e(P,{onClick:ie(-1),size:"small",color:"white",children:"Prev"}),e(P,{onClick:S===N.length-1?R:ie(1),size:"small",color:"white",variant:"text",children:S===N.length-1?"Close":"Next"})]})]})})]})})]})},go=()=>{const{isEmptyHistogram:t}=Le(),{handleChange:n}=lo();return t?e(ae,{variant:"warning",children:e("div",{className:"vm-warning-heatmap-to-line",children:[e("p",{className:"vm-warning-heatmap-to-line__text",children:'The expression cannot be displayed as a heatmap. To make the graph work, disable the heatmap in the "Graph settings" or modify the expression.'}),e(P,{size:"small",color:"primary",variant:"text",onClick:()=>n(!1),children:"Switch to line chart"})]})}):null},yo=()=>{zr();const{isMobile:t}=j(),{displayType:n}=Re(),{query:r}=Te(),{customStep:a}=Le(),s=Je(),[o,i]=b([]),[c,l]=b(!r[0]),[m,d]=b(!1),u=W(null),{fetchUrl:h,isLoading:p,liveData:v,graphData:_,error:y,queryErrors:f,setQueryErrors:g,queryStats:C,warning:w,traces:E,isHistogram:N,abortFetch:S}=Dn({visible:!0,customStep:a,hideQuery:o,showAllSeries:m}),T=!v?.length&&n!==pe.chart,M=!c&&y,x=D=>{i(D)},A=()=>{l(!1)};return L(()=>{s({type:"SET_IS_HISTOGRAM",payload:N})},[_]),e("div",{className:k({"vm-custom-panel":!0,"vm-custom-panel_mobile":t}),children:[e($r,{queryErrors:c?[]:f,setQueryErrors:g,setHideError:l,stats:C,isLoading:p,onHideQuery:x,onRunQuery:A,abortFetch:S,hideButtons:{reduceMemUsage:!0}}),e(mc,{traces:E,displayType:n}),M&&e(ae,{variant:"error",children:y}),T&&e(ae,{variant:"info",children:e(cc,{})}),e(go,{}),w&&e(Rn,{warning:w,query:r,onChange:d}),e("div",{className:k({"vm-custom-panel-body":!0,"vm-custom-panel-body_mobile":t,"vm-block":!0,"vm-block_mobile":t}),children:[p&&e($s,{}),e("div",{className:"vm-custom-panel-body-header",ref:u,children:[e("div",{className:"vm-custom-panel-body-header__tabs",children:e(us,{})}),(_||v)&&e(fo,{fetchUrl:h})]}),e(ho,{graphData:_,liveData:v,isHistogram:N,displayType:n,controlsRef:u})]})]})},Nd=({title:t,description:n,unit:r,expr:a,showLegend:s,filename:o,alias:i})=>{const{isMobile:c}=j(),{period:l}=ve(),{customStep:m}=Le(),d=Ue(),u=W(null),[h,p]=b(!1),[v,_]=b(!1),[y,f]=b({limits:{enable:!1,range:{1:[0,0]}}}),g=I(()=>Array.isArray(a)&&a.every(A=>A),[a]),{isLoading:C,graphData:w,error:E,warning:N}=Dn({predefinedQuery:g?a:[],display:pe.chart,visible:h,customStep:m}),S=A=>{const D={...y};D.limits.range=A,f(D)},T=()=>{const A={...y};A.limits.enable=!A.limits.enable,f(A)},M=({from:A,to:D})=>{d({type:"SET_PERIOD",payload:{from:A,to:D}})};return L(()=>{const A=new IntersectionObserver(D=>{D.forEach(z=>p(z.isIntersecting))},{threshold:.1});return u.current&&A.observe(u.current),()=>{u.current&&A.unobserve(u.current)}},[u]),g?e("div",{className:"vm-predefined-panel",ref:u,children:[e("div",{className:"vm-predefined-panel-header",children:[e(G,{title:e(()=>e("div",{className:"vm-predefined-panel-header__description vm-default-styles",children:[n&&e(F,{children:[e("div",{children:[e("span",{children:"Description:"}),e("div",{dangerouslySetInnerHTML:{__html:_n(n)}})]}),e("hr",{})]}),e("div",{children:[e("span",{children:"Queries:"}),e("div",{children:a.map((A,D)=>e("div",{children:A},`${D}_${A}`))})]})]}),{}),children:e("div",{className:"vm-predefined-panel-header__info",children:e(et,{})})}),e("h3",{className:"vm-predefined-panel-header__title",children:t||""}),e(Qr,{data:w||[],yaxis:y,setYaxisLimits:S,toggleEnableLimits:T,spanGaps:{value:v,onChange:_}})]}),e("div",{className:"vm-predefined-panel-body",children:[C&&e($e,{}),E&&e(ae,{variant:"error",children:E}),N&&e(ae,{variant:"warning",children:N}),w&&e($n,{isPredefinedPanel:!0,data:w,period:l,customStep:m,query:a,yaxis:y,unit:r,alias:i,showLegend:s,setYaxisLimits:S,setPeriod:M,fullWidth:!1,height:c?window.innerHeight*.5:500,spanGaps:v})]})]}):e(ae,{variant:"error",children:[e("code",{children:'"expr"'})," not found. Check the configuration file ",e("b",{children:o}),"."]})},Sd=({index:t,title:n,panels:r,filename:a})=>{const s=pt(),o=I(()=>s.width/12,[s]),[i,c]=b(!t),[l,m]=b([]);L(()=>{m(r&&r.map(g=>g.width||12))},[r]);const[d,u]=b({start:0,target:0,enable:!1}),h=X(g=>{if(!d.enable)return;const{start:C}=d,w=Math.ceil((C-g.clientX)/o);if(Math.abs(w)>=12)return;const E=l.map((N,S)=>N-(S===d.target?w:0));m(E)},[d,o]),p=(g,C)=>{u({start:g.clientX,target:C,enable:!0})},v=X(()=>{u({...d,enable:!1})},[d]),_=g=>c(g),y=g=>C=>{p(C,g)};return se("mousemove",h),se("mouseup",v),e("div",{className:"vm-predefined-dashboard",children:e(Rr,{defaultExpanded:i,onChange:_,title:e(()=>e("div",{className:k({"vm-predefined-dashboard-header":!0,"vm-predefined-dashboard-header_open":i}),children:[(n||a)&&e("span",{className:"vm-predefined-dashboard-header__title",children:n||`${t+1}. ${a}`}),r&&e("span",{className:"vm-predefined-dashboard-header__count",children:["(",r.length," panels)"]})]}),{}),children:e("div",{className:"vm-predefined-dashboard-panels",children:Array.isArray(r)&&r.length?r.map((g,C)=>e("div",{className:"vm-predefined-dashboard-panels-panel vm-block vm-block_empty-padding",style:{gridColumn:`span ${l[C]}`},children:[e(Nd,{title:g.title,description:g.description,unit:g.unit,expr:g.expr,alias:g.alias,filename:a,showLegend:g.showLegend}),e("button",{className:"vm-predefined-dashboard-panels-panel__resizer",onMouseDown:y(C),"aria-label":"resize the panel"})]},C)):e("div",{className:"vm-predefined-dashboard-panels-panel__alert",children:e(ae,{variant:"error",children:[e("code",{children:'"panels"'})," not found. Check the configuration file ",e("b",{children:a}),"."]})})})})})},Td=()=>{const{duration:t,relativeTime:n,period:{date:r}}=ve(),{customStep:a}=Le(),{setSearchParamsFromKeys:s}=Tt(),o=()=>{const i=ao({"g0.range_input":t,"g0.end_input":r,"g0.step_input":a,"g0.relative_time":n});s(i)};L(o,[t,n,r,a]),L(o,[])},Ad=()=>{Td();const{isMobile:t}=j(),{dashboardsSettings:n,dashboardsLoading:r,dashboardsError:a}=ps(),[s,o]=b(0),i=I(()=>n.map((p,v)=>({label:p.title||"",value:v})),[n]),c=I(()=>n[s]||{},[n,s]),l=I(()=>c?.rows,[c]),m=I(()=>c.title||c.filename||"",[c]),d=I(()=>Array.isArray(l)&&!!l.length,[l]),u=p=>{o(p)},h=p=>()=>{u(p)};return e("div",{className:"vm-predefined-panels",children:[r&&e($e,{}),!n.length&&a&&e(ae,{variant:"error",children:a}),!n.length&&e(ae,{variant:"info",children:"Dashboards not found"}),i.length>1&&e("div",{className:k({"vm-predefined-panels-tabs":!0,"vm-predefined-panels-tabs_mobile":t}),children:i.map(p=>e("div",{className:k({"vm-predefined-panels-tabs__tab":!0,"vm-predefined-panels-tabs__tab_active":p.value==s}),onClick:h(p.value),children:p.label},p.value))}),e("div",{className:"vm-predefined-panels__dashboards",children:[d&&l.map((p,v)=>e(Sd,{index:v,filename:m,title:p.title,panels:p.panels},`${s}_${v}`)),!!n.length&&!d&&e(ae,{variant:"error",children:[e("code",{children:'"rows"'})," not found. Check the configuration file ",e("b",{children:m}),"."]})]})]})},Yn=(t,n)=>{const r=n.match?"&match[]="+encodeURIComponent(n.match):"",a=n.focusLabel?"&focusLabel="+encodeURIComponent(n.focusLabel):"";return`${t}/api/v1/status/tsdb?topN=${n.topN}&date=${n.date}${r}${a}`},Ed=(t,n)=>{const r=new URLSearchParams(Object.entries(n).filter(([a,s])=>s!=null)).toString();return`${t}/api/v1/status/metric_names_stats?${r}`},jt={id:"action",label:"",modifiers:["action"]},Gt={id:"diff",label:"1d",info:"Shows the absolute difference compared to the previous day.",sortable:!0,modifiers:["compact"]},Wt={id:"diffPercent",label:"1d %",info:"Shows the percentage difference compared to the previous day.",sortable:!0,modifiers:["compact"]},Pn={id:"value",label:"Number of series",sortable:!0,modifiers:["compact"]},Ld=[{id:"name",label:"Metric name",sortable:!0},Pn,{id:"requestsCount",label:"Requests count",sortable:!0,modifiers:["compact"],info:"The number of times this metric was queried since stats collection began."},{id:"lastRequestTimestamp",label:"Last request",sortable:!0,modifiers:["compact"],info:"The last time this metric was used in a query since stats collection began."},Gt,Wt,{id:"percentage",label:"Share in total",info:"Shows the share of a metric to the total number of series"},jt],Md=[{id:"name",label:"Label name",sortable:!0},Pn,Gt,Wt,{id:"percentage",label:"Share in total",info:"Shows the share of the label to the total number of series"},jt],xd=[{id:"name",label:"Label value",sortable:!0},Pn,Gt,Wt,{id:"percentage",label:"Share in total"},jt],kd=[{id:"name",label:"Label=value pair",sortable:!0},Pn,Gt,Wt,{id:"percentage",label:"Share in total",info:"Shows the share of the label value pair to the total number of series"},jt],Id=[{id:"name",label:"Label name",sortable:!0},{id:"value",label:"Number of unique values",sortable:!0,modifiers:["compact"]},Gt,Wt,jt];class Dd{tsdbStatus;metricNameStats;tabsNames;isPrometheus;constructor(){this.tsdbStatus=this.defaultTSDBStatus,this.metricNameStats=this.defaultMetricNameStats,this.tabsNames=["table","graph"],this.isPrometheus=!1,this.getDefaultState=this.getDefaultState.bind(this)}set tsdbStatusData(n){this.isPrometheus=!!n?.headStats,this.tsdbStatus=n}set metricNameStatsData(n){this.metricNameStats=n}get tsdbStatusData(){return this.tsdbStatus}get metricNameStatsData(){return this.metricNameStats}get defaultTSDBStatus(){return{totalSeries:0,totalSeriesPrev:0,totalSeriesByAll:0,totalLabelValuePairs:0,seriesCountByMetricName:[],seriesCountByLabelName:[],seriesCountByFocusLabelValue:[],seriesCountByLabelValuePair:[],labelValueCountByLabelName:[]}}get defaultMetricNameStats(){return{statsCollectedSince:0,statsCollectedRecordsTotal:0,trackerMemoryMaxSizeBytes:0,trackerCurrentMemoryUsageBytes:0}}get isPrometheusData(){return this.isPrometheus}keys(n,r){const a=n&&/__name__=".+"/.test(n),s=n&&/{.+=".+"}/g.test(n),o=n&&/__name__=".+", .+!=""/g.test(n);let i=[];return r||o?i=i.concat("seriesCountByFocusLabelValue"):a?i=i.concat("labelValueCountByLabelName"):s?i=i.concat("seriesCountByMetricName","seriesCountByLabelName"):i=i.concat("seriesCountByMetricName","seriesCountByLabelName","seriesCountByLabelValuePair","labelValueCountByLabelName"),i}getDefaultState(n,r){return this.keys(n,r).reduce((a,s)=>({...a,tabs:{...a.tabs,[s]:this.tabsNames},containerRefs:{...a.containerRefs,[s]:W(null)}}),{tabs:{},containerRefs:{}})}sectionsTitles(n){return{seriesCountByMetricName:"Metric names with the highest number of series",seriesCountByLabelName:"Labels with the highest number of series",seriesCountByFocusLabelValue:`Values for "${n}" label with the highest number of series`,seriesCountByLabelValuePair:"Label=value pairs with the highest number of series",labelValueCountByLabelName:"Labels with the highest number of unique values"}}get sectionsTips(){return{seriesCountByMetricName:`
        <p>
          This table returns a list of metrics with the highest cardinality.
          The cardinality of a metric is the number of time series associated with that metric,
          where each time series is defined as a unique combination of key-value label pairs.
        </p>
        <p>
          When looking to reduce the number of active series in your data source,
          you can start by inspecting individual metrics with high cardinality
          (i.e. that have lots of active time series associated with them),
          since that single metric contributes a large fraction of the series that make up your total series count.
        </p>`,seriesCountByLabelName:`
        <p>
          This table returns a list of the labels with the highest number of series.
        </p>
        <p>
          Use this table to identify labels that are storing dimensions with high cardinality
          (many different label values).
        </p>
        <p>
          It is recommended to choose labels such that they have a finite set of values,
          since every unique combination of key-value label pairs creates a new time series
          and therefore can dramatically increase the number of time series in your system.
        </p>`,seriesCountByFocusLabelValue:`
       <p>
          This table returns a list of unique label values per selected label.
       </p>
       <p>
          Use this table to identify label values that are storing per each selected series.
       </p>`,labelValueCountByLabelName:`
       <p>
          This table returns a list of labels with the highest number of the unique values.
       </p>
      `,seriesCountByLabelValuePair:`
        <p>
          This table returns a list of the label values pairs with the highest number of series.
        </p>
        <p>
          Use this table to identify unique label values pairs. This helps to identify same labels 
          is applied to count timeseries in your system, since every unique combination of key-value label pairs 
          creates a new time series and therefore can dramatically increase the number of time series in your system
        </p>`}}get tablesHeaders(){return{seriesCountByMetricName:Ld,seriesCountByLabelName:Md,seriesCountByFocusLabelValue:xd,seriesCountByLabelValuePair:kd,labelValueCountByLabelName:Id}}totalSeries(n,r=!1){return n==="labelValueCountByLabelName"?-1:r?this.tsdbStatus.totalSeriesPrev:this.tsdbStatus.totalSeries}}const Rd=()=>{const t=new Dd,[n]=me(),r=n.get("match"),a=n.get("focusLabel"),s=+(n.get("topN")||10),o=n.get("date")||U().tz().format(st),i=$t(o),c=W(),{serverUrl:l}=ne(),[m,d]=b(!1),[u,h]=b(),[p,v]=b(t.defaultTSDBStatus),[_,y]=b(t.defaultMetricNameStats),[f,g]=b(!1),C=async S=>{const T=await fetch(S),M=await T.json();if(T.ok)return M;console.error(`Error fetching ${S}:`,M);const x=M.errorType||ye.unknownType,A=M?.error||M?.message||"see console for more details",D=[x,A].join(`\r
`);throw new Error(D)},w=(S,T)=>{Object.keys(S).forEach(M=>{const x=M,A=S[x],D=T[x];Array.isArray(A)&&Array.isArray(D)&&A.forEach(z=>{const R=D.find(q=>q.name===z.name)?.value,V=R?z.value-R:0,O=R?V/R*100:0;z.diff=V,z.diffPercent=O,z.valuePrev=R||0})})},E=async S=>{if(!l)return;h(""),d(!0),v(t.defaultTSDBStatus);const T={...S,date:S.date,topN:0,match:"",focusLabel:""},M={...S,date:U(S.date).subtract(1,"day").format(st)},x=[Yn(l,S),Yn(l,M)];i!==o&&(S.match||S.focusLabel)&&x.push(Yn(l,T));try{const[A,D,z]=await Promise.all(x.map(C)),R={...D.data},{data:V}=z||c.current||A;c.current={data:V};const O={...A.data,totalSeries:A.data?.totalSeries||A.data?.headStats?.numSeries||0,totalLabelValuePairs:A.data?.totalLabelValuePairs||A.data?.headStats?.numLabelValuePairs||0,seriesCountByLabelName:A.data?.seriesCountByLabelName||[],seriesCountByFocusLabelValue:A.data?.seriesCountByFocusLabelValue||[],totalSeriesByAll:V?.totalSeries||V?.headStats?.numSeries||p.totalSeriesByAll||0,totalSeriesPrev:R?.totalSeries||R?.headStats?.numSeries||0},q=r?.replace(/[{}"]/g,"");O.seriesCountByLabelValuePair=O.seriesCountByLabelValuePair.filter(Q=>Q.name!==q),w(O,R),v(O),d(!1)}catch(A){d(!1),A instanceof Error&&h(`${A.name}: ${A.message}`)}},N=async()=>{if(!l)return;h(""),d(!0);const S=Ed(l,{limit:1});try{const T=await C(S);y(T),d(!1)}catch(T){d(!1),y(t.defaultMetricNameStats),console.error(T)}};return L(()=>{E({topN:s,match:r,date:o,focusLabel:a})},[l,r,a,s,o]),L(()=>{N()},[l]),L(()=>{u&&(v(t.defaultTSDBStatus),d(!1))},[u]),L(()=>{const S=Ot(l);g(!!S)},[l]),t.tsdbStatusData=p,t.metricNameStatsData=_,{isLoading:m,appConfigurator:t,error:u,isCluster:f}},$d={seriesCountByMetricName:({query:t})=>jn("__name__",t),seriesCountByLabelName:({query:t})=>`{${t}!=""}`,seriesCountByFocusLabelValue:({query:t,focusLabel:n})=>jn(n,t),seriesCountByLabelValuePair:({query:t})=>{const n=t.split("="),r=n[0],a=n.slice(1).join("=");return jn(r,a)},labelValueCountByLabelName:({query:t,match:n})=>n===""?`{${t}!=""}`:`${n.replace("}","")}, ${t}!=""}`},jn=(t,n)=>t?"{"+t+"="+JSON.stringify(n)+"}":"",Pd=({metricNameStats:t})=>{const{statsCollectedSince:n,statsCollectedRecordsTotal:r=0,trackerMemoryMaxSizeBytes:a=0,trackerCurrentMemoryUsageBytes:s=0}=t,o=n?U.unix(n).format(Ve):" - ",i=a?`${(s/a*100).toFixed(2)}%`:" - ",c=r.toLocaleString("en-US");return e("div",{className:"vm-cardinality-totals-card",children:[e("h4",{className:"vm-cardinality-totals-card__title",children:[e(G,{placement:"bottom-left",title:e("div",{className:"vm-cardinality-totals-card__tooltip",children:n?e(F,{children:[e("p",{children:["Total entries in cache since ",o]}),e("p",{children:["Cache utilization: ",i]})]}):e(F,{children:[e("p",{children:"Metric names tracker is likely disabled."}),e("p",{children:"No data available. See documentation for enabling the metric names tracker."})]})}),children:e("div",{className:"vm-cardinality-totals-card__info-icon",children:e(qt,{})})}),"Total metric names"]}),e("span",{className:"vm-cardinality-totals-card__value",children:c}),e("span",{className:"vm-cardinality-totals-card__link",children:e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#track-ingested-metrics-usage",children:"Docs ↗"})})]})},zd=({totalSeries:t=0,totalSeriesPrev:n=0,totalSeriesAll:r=0,seriesCountByMetricName:a=[],metricNameStats:s,isPrometheus:o})=>{const{isMobile:i}=j(),[c]=me(),l=c.get("match"),m=c.get("focusLabel"),d=/__name__/.test(l||""),u=a[0]?.value/r*100,h=t-n,p=Math.abs(h)/n*100,v=[{title:"Total series",value:t.toLocaleString("en-US"),dynamic:!t||!n||o?"":`${p.toFixed(2)}%`,display:!m,info:`The total number of unique time series for a selected day.
             A time series is uniquely identified by its name plus a set of its labels. 
             For example, temperature{city="NY",country="US"} and temperature{city="SF",country="US"} 
             are two distinct series, since they differ by the "city" label.`},{title:"Percentage from total",value:isNaN(u)?"-":`${u.toFixed(2)}%`,display:d,info:"The share of these series in the total number of time series."}].filter(_=>_.display);return v.length?e("div",{className:k({"vm-cardinality-totals":!0,"vm-cardinality-totals_mobile":i}),children:[v.map(({title:_,value:y,info:f,dynamic:g})=>e("div",{className:"vm-cardinality-totals-card",children:[e("h4",{className:"vm-cardinality-totals-card__title",children:[f&&e(G,{title:e("p",{className:"vm-cardinality-totals-card__tooltip",children:f}),children:e("div",{className:"vm-cardinality-totals-card__info-icon",children:e(qt,{})})}),_]}),e("span",{className:"vm-cardinality-totals-card__value",children:y}),!!g&&e(G,{title:`in relation to the previous day: ${n.toLocaleString("en-US")}`,placement:"bottom-left",children:e("span",{className:k({"vm-dynamic-number":!0,"vm-dynamic-number_positive vm-dynamic-number_down":h<0,"vm-dynamic-number_negative vm-dynamic-number_up":h>0}),children:g})})]},_)),e(Pd,{metricNameStats:s})]}):null},ot=(t,n)=>{const[r]=me(),a=r.get(n)?r.get(n):t,[s,o]=b(a);return L(()=>{a!==s&&o(a)},[a]),[s,o]},Od=({isPrometheus:t,isCluster:n,...r})=>{const{isMobile:a}=j(),[s]=me(),{setSearchParamsFromKeys:o}=Tt(),i=s.get("tips")||"",[c,l]=ot("","match"),[m,d]=ot("","focusLabel"),[u,h]=ot(10,"topN"),p=I(()=>u<0?"Number must be bigger than zero":"",[u]),v=g=>{const C=+g;h(isNaN(C)?0:C)},_=()=>{o({match:c,topN:u,focusLabel:m})},y=()=>{o({match:"",focusLabel:""})},f=()=>{const g=s.get("tips")||"";o({tips:g?"":"true"})};return L(()=>{const g=s.get("match"),C=+(s.get("topN")||10),w=s.get("focusLabel");g!==c&&l(g||""),C!==u&&h(C),w!==m&&d(w||"")},[s]),e("div",{className:k({"vm-cardinality-configurator":!0,"vm-cardinality-configurator_mobile":a,"vm-block":!0,"vm-block_mobile":a}),children:[e("div",{className:"vm-cardinality-configurator-controls",children:[e("div",{className:"vm-cardinality-configurator-controls__query",children:e(oe,{label:"Time series selector",type:"string",value:c,onChange:l,onEnter:_})}),e("div",{className:"vm-cardinality-configurator-controls__item",children:e(oe,{label:"Focus label",type:"text",value:m||"",onChange:d,onEnter:_,endIcon:e(G,{title:e("div",{children:e("p",{children:"To identify values with the highest number of series for the selected label."})}),children:e(Xa,{})})})}),e("div",{className:"vm-cardinality-configurator-controls__item vm-cardinality-configurator-controls__item_limit",children:e(oe,{label:"Limit entries",type:"number",value:t?10:u,error:p,disabled:t,helperText:t?"not available for Prometheus":"",onChange:v,onEnter:_})})]}),e("div",{className:"vm-cardinality-configurator-bottom",children:[e(zd,{isPrometheus:t,isCluster:n,...r}),n&&e("div",{className:"vm-cardinality-configurator-bottom-helpful",children:e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#cardinality-explorer-statistic-inaccuracy",withIcon:!0,children:[e(lt,{}),"Statistic inaccuracy explanation"]})}),e("div",{className:"vm-cardinality-configurator-bottom-helpful",children:e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#cardinality-explorer",withIcon:!0,children:[e(lt,{}),"Documentation"]})}),e("div",{className:"vm-cardinality-configurator-bottom__execute",children:[e(G,{title:i?"Hide tips":"Show tips",children:e(P,{variant:"text",color:i?"warning":"gray",startIcon:e(Qt,{}),onClick:f,ariaLabel:"visibility tips"})}),e(P,{variant:"text",startIcon:e(Nt,{}),onClick:y,children:"Reset"}),e(P,{startIcon:e(nt,{}),onClick:_,children:"Execute Query"})]})]})]})};function Hd(t){const{order:n,orderBy:r,onRequestSort:a,headerCells:s}=t,o=i=>c=>{a(c,i)};return e("thead",{className:"vm-table-header vm-cardinality-panel-table__header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:s.map(i=>e("th",{className:k({"vm-table-cell vm-table-cell_header":!0,"vm-table-cell_sort":i.sortable,"vm-table-cell_right":i.id==="action"}),onClick:i.sortable?o(i.id):void 0,children:e("div",{className:"vm-table-cell__content",children:[i.info&&e(G,{title:i.info,children:e("div",{className:"vm-metrics-content-header__tip-icon",children:e(qt,{})})}),i.label,i.sortable&&e("div",{className:k({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":r===i.id,"vm-table__sort-icon_desc":n==="desc"&&r===i.id}),children:e(Be,{})})]})},i.id))})})}const Fd=["date","timestamp","time"];function _a(t,n,r){const a=t[r],s=n[r];if(a==null&&s==null)return 0;if(a==null)return 1;if(s==null)return-1;const o=String(a),i=String(s);if(Fd.includes(String(r))){const u=ta(o),h=ta(i);return h<u?-1:h>u?1:0}const l=Number(o),m=Number(i);return!isNaN(l)&&!isNaN(m)?m-l:i<o?-1:i>o?1:0}function Gr(t,n){return t==="desc"?(r,a)=>_a(r,a,n):(r,a)=>-_a(r,a,n)}function Wr(t,n){const r=t.map((a,s)=>[a,s]);return r.sort((a,s)=>{const o=n(a[0],s[0]);return o!==0?o:a[1]-s[1]}),r.map(a=>a[0])}const Vd=({rows:t,headerCells:n,defaultSortColumn:r,tableCells:a})=>{const[s,o]=b("desc"),[i,c]=b(r),l=(d,u)=>{o(i===u&&s==="asc"?"desc":"asc"),c(u)},m=Wr(t,Gr(s,i));return e("table",{className:"vm-table vm-cardinality-panel-table",children:[e(Hd,{order:s,orderBy:i,onRequestSort:l,rowCount:t.length,headerCells:n}),e("tbody",{className:"vm-table-header",children:m.map(d=>e("tr",{className:"vm-table__row",children:a(d)},d.name))})]})},Ud=({row:t,tableHeaderCells:n,totalSeries:r,totalSeriesPrev:a,onActionClick:s})=>{const o=r>0?t.value/r*100:-1,i=a>0?t.valuePrev/a*100:-1,c=[o,i].some(x=>x===-1),l=t.value.toLocaleString("en-US"),m=t.valuePrev.toLocaleString("en-US"),d=Math.abs(t.diff).toLocaleString("en-US"),u=o-i,h=c?"":`${Math.abs(u).toFixed(2)}%`,p=`${Math.abs(t.diffPercent).toFixed(2)}%`,v=t.requestsCount===0,y=t.requestsCount==null?"n/a":t.requestsCount.toLocaleString("en-US"),f=t.lastRequestTimestamp===0,g=t.lastRequestTimestamp==null,C=!f&&!g,w=f?"never":"n/a",E=C?U().diff(t.lastRequestTimestamp*1e3,"seconds"):0,N=C?U.unix(t.lastRequestTimestamp).format(Ve):"-",S=C?U.duration(-E,"seconds").humanize(!0):w,T=()=>{s(t.name)},M=x=>{switch(x.id){case"name":return e("span",{className:"vm-link vm-link_colored",onClick:T,children:t.name});case"value":return l;case"requestsCount":return e("div",{className:k({"vm-dynamic-number":!0,"vm-dynamic-number_negative":v}),children:y});case"lastRequestTimestamp":return e(G,{title:`${N}`,children:e("span",{className:k({"vm-dynamic-number":!0,"vm-dynamic-number_negative":f||E>=30*86400,"vm-dynamic-number_warning":E>=7*86400&&E<30*86400}),children:S})});case"diff":return e(G,{title:`in relation to the previous day: ${m}`,children:e("span",{className:k({"vm-dynamic-number":!0,"vm-dynamic-number_positive vm-dynamic-number_down":t.diff<0,"vm-dynamic-number_negative vm-dynamic-number_up":t.diff>0}),children:d})});case"diffPercent":return e(G,{title:`in relation to the previous day: ${m}`,children:e("div",{className:k({"vm-dynamic-number":!0,"vm-dynamic-number_positive vm-dynamic-number_down":t.diff<0,"vm-dynamic-number_negative vm-dynamic-number_up":t.diff>0}),children:p})});case"percentage":return e("div",{className:"vm-cardinality-panel-table__progress",children:[e(Ps,{value:o,hideValue:!0}),e("span",{className:"vm-dynamic-number vm-dynamic-number_static",children:[o.toFixed(2),"%"]}),e(G,{title:"in relation to the previous day",children:e("span",{className:k({"vm-dynamic-number":!0,"vm-dynamic-number_no-change":u===0,"vm-dynamic-number_positive vm-dynamic-number_down":u<0,"vm-dynamic-number_negative vm-dynamic-number_up":u>0}),children:h})})]});case"action":return e("div",{className:"vm-table-cell__content",children:e(G,{title:e("span",{children:["Filter by ",e("code",{children:["`",t.name,"`"]})]}),children:e(P,{variant:"text",size:"small",onClick:T,startIcon:e(Tn,{})})})});default:return x.id in t?t[x.id]:""}};return e(F,{children:n.map(x=>e("td",{className:k("vm-table-cell",...x.modifiers?.map(A=>`vm-table-cell_${A}`)??[]),children:M(x)},x.id))})},qd=({data:t})=>{const[n,r]=b([]),[a,s]=b([0,0]),o=i=>{const c=i.map(u=>u.value),l=Math.ceil(c[0]||1),m=10,d=l/(m-1);return new Array(m+1).fill(l+d).map((u,h)=>Math.round(u-d*h))};return L(()=>{const i=t.sort((l,m)=>m.value-l.value),c=o(i);s(c),r(i.map(l=>({...l,percentage:l.value/c[0]*100})))},[t]),e("div",{className:"vm-simple-bar-chart",children:[e("div",{className:"vm-simple-bar-chart-y-axis",children:a.map(i=>e("div",{className:"vm-simple-bar-chart-y-axis__tick",children:i},i))}),e("div",{className:"vm-simple-bar-chart-data",children:n.map(({name:i,value:c,percentage:l})=>e(G,{title:`${i}: ${c}`,placement:"top-center",children:e("div",{className:"vm-simple-bar-chart-data-item",style:{maxHeight:`${l||0}%`}})},`${i}_${c}`))})]})},Bd=({rows:t,tabs:n=[],chartContainer:r,totalSeries:a,totalSeriesPrev:s,onActionClick:o,sectionTitle:i,tip:c,tableHeaderCells:l,isPrometheus:m})=>{const{isMobile:d}=j(),[u,h]=b("table"),p=m&&!t.length,v=y=>e(Ud,{row:y,tableHeaderCells:l,totalSeries:a,totalSeriesPrev:s,onActionClick:o}),_=I(()=>n.map((y,f)=>({value:y,label:y,icon:f===0?e(An,{}):e(Sr,{})})),[n]);return e("div",{className:k({"vm-metrics-content":!0,"vm-metrics-content_mobile":d,"vm-block":!0,"vm-block_mobile":d}),children:[e("div",{className:"vm-metrics-content-header vm-section-header",children:[e("h5",{className:k({"vm-metrics-content-header__title":!0,"vm-section-header__title":!0,"vm-section-header__title_mobile":d}),children:[!d&&c&&e(G,{title:e("p",{dangerouslySetInnerHTML:{__html:c},className:"vm-metrics-content-header__tip"}),children:e("div",{className:"vm-metrics-content-header__tip-icon",children:e(qt,{})})}),i]}),e("div",{className:"vm-section-header__tabs",children:e(Yt,{activeItem:u,items:_,onChange:h})})]}),p&&e("div",{className:"vm-metrics-content-prom-data",children:[e("div",{className:"vm-metrics-content-prom-data__icon",children:e(et,{})}),e("h3",{className:"vm-metrics-content-prom-data__title",children:"Prometheus Data Limitation"}),e("p",{className:"vm-metrics-content-prom-data__text",children:["Due to missing data from your Prometheus source, some tables may appear empty.",e("br",{}),"This does not indicate an issue with your system or our tool."]})]}),!p&&u==="table"&&e("div",{ref:r,className:k({"vm-metrics-content__table":!0,"vm-metrics-content__table_mobile":d}),children:e(Vd,{rows:t,headerCells:l,defaultSortColumn:"value",tableCells:v})}),!p&&u==="graph"&&e("div",{className:"vm-metrics-content__chart",children:e(qd,{data:t.map(({name:y,value:f})=>({name:y,value:f}))})})]})},zn=({title:t,children:n})=>e("div",{className:"vm-cardinality-tip",children:[e("div",{className:"vm-cardinality-tip-header",children:[e("div",{className:"vm-cardinality-tip-header__tip-icon",children:e(Qt,{})}),e("h4",{className:"vm-cardinality-tip-header__title",children:t||"Tips"})]}),e("p",{className:"vm-cardinality-tip__description",children:n})]}),Qd=()=>e(zn,{title:"Metrics with a high number of series",children:e("ul",{children:[e("li",{children:["Identify and eliminate labels with frequently changed values to reduce their ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/faq/#what-is-high-cardinality",children:"cardinality"})," and ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/faq/#what-is-high-churn-rate",children:"high churn rate"})]}),e("li",{children:["Find unused time series and ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",children:"drop entire metrics"})]}),e("li",{children:["Aggregate time series before they got ingested into the database via ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/stream-aggregation/",children:"streaming aggregation"})]})]})}),Yd=()=>e(zn,{title:"Labels with a high number of unique values",children:e("ul",{children:[e("li",{children:"Decrease the number of unique label values to reduce cardinality"}),e("li",{children:["Drop the label entirely via ",e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",children:"relabeling"})]}),e("li",{children:"For volatile label values (such as URL path, user session, etc.) consider printing them to the log file instead of adding to time series"})]})}),jd=()=>e(zn,{title:"Dashboard of a single metric",children:[e("p",{children:"This dashboard helps to understand the cardinality of a single metric."}),e("p",{children:"Each time series is a unique combination of key-value label pairs. Therefore a label key with many values can create a lot of time series for a particular metric. If you’re trying to decrease the cardinality of a metric, start by looking at the labels with the highest number of values."}),e("p",{children:"Use the series selector at the top of the page to apply additional filters."})]}),Gd=()=>e(zn,{title:"Dashboard of a label",children:[e("p",{children:"This dashboard helps you understand the count of time series per label."}),e("p",{children:"Use the selector at the top of the page to pick a label name you’d like to inspect. For the selected label name, you’ll see the label values that have the highest number of series associated with them. So if you’ve chosen `instance` as your label name, you may see that `657` time series have value “host-1” attached to them and `580` time series have value `host-2` attached to them."}),e("p",{children:"This can be helpful in allowing you to determine where the bulk of your time series are coming from. If the label “instance=host-1” was applied to 657 series and the label “instance=host-2” was only applied to 580 series, you’d know, for example, that host-01 was responsible for sending the majority of the time series."})]}),Wd=`Please wait while cardinality stats is calculated. 
                        This may take some time if the db contains big number of time series.`,Jd=()=>{const{isMobile:t}=j(),[n]=me(),{setSearchParamsFromKeys:r}=Tt(),a=n.get("tips")||"",s=n.get("match")||"",o=n.get("focusLabel")||"",{isLoading:i,appConfigurator:c,error:l,isCluster:m}=Rd(),{tsdbStatusData:d,metricNameStatsData:u,getDefaultState:h,tablesHeaders:p,sectionsTips:v}=c,_=h(s,o),y=f=>g=>{const w={match:$d[f]({query:g,focusLabel:o,match:s})};(f==="labelValueCountByLabelName"||f=="seriesCountByLabelName")&&(w.focusLabel=g),f=="seriesCountByFocusLabelValue"&&(w.focusLabel=""),r(w)};return e("div",{className:k({"vm-cardinality-panel":!0,"vm-cardinality-panel_mobile":t}),children:[i&&e($e,{message:Wd}),e(Od,{isPrometheus:c.isPrometheusData,totalSeries:d.totalSeries,totalSeriesPrev:d.totalSeriesPrev,totalSeriesAll:d.totalSeriesByAll,totalLabelValuePairs:d.totalLabelValuePairs,seriesCountByMetricName:d.seriesCountByMetricName,metricNameStats:u,isCluster:m}),a&&e("div",{className:"vm-cardinality-panel-tips",children:[!s&&!o&&e(Qd,{}),s&&!o&&e(jd,{}),!s&&!o&&e(Yd,{}),o&&e(Gd,{})]}),l&&e(ae,{variant:"error",children:l}),c.keys(s,o).map(f=>e(Bd,{sectionTitle:c.sectionsTitles(o)[f],tip:v[f],rows:d[f],onActionClick:y(f),tabs:_.tabs[f],chartContainer:_.containerRefs[f],totalSeriesPrev:c.totalSeries(f,!0),totalSeries:c.totalSeries(f),tableHeaderCells:p[f],isPrometheus:c.isPrometheusData},f))]})},Kd=(t,n,r)=>`${t}/api/v1/status/top_queries?topN=${n||""}&maxLifetime=${r||""}`,Zd=(t,n)=>{const{query:r,timeRangeSeconds:a}=t,s=[`g0.expr=${encodeURIComponent(r)}`],o=dn.find(i=>i.duration===n)?.id;return o&&s.push(`g0.relative_time=${o}`),a&&s.push(`g0.range_input=${n}`),`${J.home}?${s.join("&")}`},Xd=t=>(["topByAvgDuration","topByCount","topBySumDuration"].forEach(r=>{const a=t[r];Array.isArray(a)&&a.forEach(s=>{const o=wn(s.timeRangeSeconds*1e3);s.url=Zd(s,o),s.timeRange=o})}),t),em=({topN:t,maxLifetime:n})=>{const{serverUrl:r}=ne(),{setSearchParamsFromKeys:a}=Tt(),[s,o]=b(null),[i,c]=b(!1),[l,m]=b(),d=I(()=>Kd(r,t,n),[r,t,n]);return{data:s,error:l,loading:i,fetch:async()=>{c(!0),a({topN:t,maxLifetime:n});try{const h=await fetch(d),p=await h.json();o(h.ok?Xd(p):null),m(String(p.error||""))}catch(h){h instanceof Error&&h.name!=="AbortError"&&m(`${h.name}: ${h.message}`)}c(!1)}}},tm=({rows:t,columns:n,defaultOrderBy:r})=>{const a=Ye(),[s,o]=b(r||"count"),[i,c]=b("desc"),l=I(()=>Wr(t,Gr(i,s)),[t,s,i]),m=h=>{c(p=>p==="asc"&&s===h?"desc":"asc"),o(h)},d=h=>()=>{m(h)},u=({query:h})=>async()=>{await a(h,"Query has been copied")};return e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:[n.map(h=>e("th",{className:"vm-table-cell vm-table-cell_header vm-table-cell_sort",onClick:d(h.sortBy||h.key),children:e("div",{className:"vm-table-cell__content",children:[h.title||h.key,e("div",{className:k({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":s===h.key,"vm-table__sort-icon_desc":i==="desc"&&s===h.key}),children:e(Be,{})})]})},h.key)),e("th",{className:"vm-table-cell vm-table-cell_header"})," "]})}),e("tbody",{className:"vm-table-body",children:l.map((h,p)=>e("tr",{className:"vm-table__row",children:[n.map(v=>e("td",{className:"vm-table-cell",children:h[v.key]||"-"},v.key)),e("td",{className:"vm-table-cell vm-table-cell_no-padding",children:e("div",{className:"vm-top-queries-panels__table-actions",children:[h.url&&e(G,{title:"Execute query",children:e(Cn,{to:h.url,target:"_blank",rel:"noreferrer","aria-disabled":!0,children:e(P,{variant:"text",size:"small",startIcon:e(Tn,{}),ariaLabel:"execute query"})})}),e(G,{title:"Copy query",children:e(P,{variant:"text",size:"small",startIcon:e(ht,{}),onClick:u(h),ariaLabel:"copy query"})})]})})]},p))})]})},nm=["table","JSON"].map((t,n)=>({value:String(n),label:t,icon:n===0?e(An,{}):e(Bt,{})})),Gn=({rows:t,title:n,columns:r,defaultOrderBy:a})=>{const{isMobile:s}=j(),[o,i]=b(0),c=l=>{i(+l)};return e("div",{className:k({"vm-top-queries-panel":!0,"vm-block":!0,"vm-block_mobile":s}),children:[e("div",{className:k({"vm-top-queries-panel-header":!0,"vm-section-header":!0,"vm-top-queries-panel-header_mobile":s}),children:[e("h5",{className:k({"vm-section-header__title":!0,"vm-section-header__title_mobile":s}),children:n}),e("div",{className:"vm-section-header__tabs",children:e(Yt,{activeItem:String(o),items:nm,onChange:c})})]}),e("div",{className:k({"vm-top-queries-panel__table":!0,"vm-top-queries-panel__table_mobile":s}),children:[o===0&&e(tm,{rows:t,columns:r,defaultOrderBy:a}),o===1&&e(Yr,{data:t})]})]})},rm="30ms, 15s, 3d4h, 1y2w",am=()=>{const{isMobile:t}=j(),[n,r]=ot(10,"topN"),[a,s]=ot("10m","maxLifetime"),{data:o,error:i,loading:c,fetch:l}=em({topN:n,maxLifetime:a}),m=I(()=>{const g=a.trim().split(" ").reduce((w,E)=>{const N=za(E);return N?{...w,...N}:{...w}},{});return!!U.duration(g).asMilliseconds()},[a]),d=I(()=>!!n&&n<1,[n]),u=I(()=>d?"Number must be bigger than zero":"",[d]),h=I(()=>m?"":"Invalid duration value",[m]),p=f=>{if(!o)return f;const g=o[f];return typeof g=="number"?Xe(g,g,g):g||f},v=f=>{r(+f)},_=f=>{s(f)},y=f=>{f.key==="Enter"&&l()};return L(()=>{o&&(n||r(+o.topN),a||s(o.maxLifetime))},[o]),L(()=>(l(),window.addEventListener("popstate",l),()=>{window.removeEventListener("popstate",l)}),[]),e("div",{className:k({"vm-top-queries":!0,"vm-top-queries_mobile":t}),children:[c&&e($e,{containerStyles:{height:"500px"}}),e("div",{className:k({"vm-top-queries-controls":!0,"vm-block":!0,"vm-block_mobile":t}),children:[e("div",{className:"vm-top-queries-controls-fields",children:[e("div",{className:"vm-top-queries-controls-fields__item",children:e(oe,{label:"Max lifetime",value:a,error:h,helperText:`For example ${rm}`,onChange:_,onKeyDown:y})}),e("div",{className:"vm-top-queries-controls-fields__item",children:e(oe,{label:"Number of returned queries",type:"number",value:n||"",error:u,onChange:v,onKeyDown:y})})]}),e("div",{className:k({"vm-top-queries-controls-bottom":!0,"vm-top-queries-controls-bottom_mobile":t}),children:[e("div",{className:"vm-top-queries-controls-bottom__info",children:["VictoriaMetrics tracks the last ",e(G,{title:"search.queryStats.lastQueriesCount",children:e("b",{children:p("search.queryStats.lastQueriesCount")})})," queries with durations at least ",e(G,{title:"search.queryStats.minQueryDuration",children:e("b",{children:p("search.queryStats.minQueryDuration")})})]}),e("div",{className:"vm-top-queries-controls-bottom__button",children:e(P,{startIcon:e(nt,{}),onClick:l,children:"Execute"})})]})]}),i&&e(ae,{variant:"error",children:i}),o&&e(F,{children:e("div",{className:"vm-top-queries-panels",children:[e(Gn,{rows:o.topBySumDuration,title:"Queries with most summary time to execute",columns:[{key:"query"},{key:"sumDurationSeconds",title:"sum duration, sec"},{key:"timeRange",sortBy:"timeRangeSeconds",title:"query time interval"},{key:"count"}],defaultOrderBy:"sumDurationSeconds"}),e(Gn,{rows:o.topByAvgDuration,title:"Most heavy queries",columns:[{key:"query"},{key:"avgDurationSeconds",title:"avg duration, sec"},{key:"timeRange",sortBy:"timeRangeSeconds",title:"query time interval"},{key:"count"}],defaultOrderBy:"avgDurationSeconds"}),e(Gn,{rows:o.topByCount,title:"Most frequently executed queries",columns:[{key:"query"},{key:"timeRange",sortBy:"timeRangeSeconds",title:"query time interval"},{key:"count"}]})]})})]})},Wn={"color-primary":"#589DF6","color-secondary":"#316eca","color-error":"#e5534b","color-warning":"#c69026","color-info":"#539bf5","color-success":"#57ab5a","color-background-body":"#22272e","color-background-block":"#2d333b","color-background-tooltip":"rgba(22, 22, 22, 0.8)","color-text":"#cdd9e5","color-text-secondary":"#768390","color-text-disabled":"#636e7b","box-shadow":"rgba(0, 0, 0, 0.16) 1px 2px 6px","box-shadow-popper":"rgba(0, 0, 0, 0.2) 0px 2px 8px 0px","border-divider":"1px solid rgba(99, 110, 123, 0.5)","color-hover-black":"rgba(0, 0, 0, 0.2)","color-log-hits-bar-0":"rgba(255, 255, 255, 0.18)","color-log-hits-bar-1":"#FFB74D","color-log-hits-bar-2":"#81C784","color-log-hits-bar-3":"#64B5F6","color-log-hits-bar-4":"#E57373","color-log-hits-bar-5":"#8a62f0"},Jn={"color-primary":"#3F51B5","color-secondary":"#E91E63","color-error":"#FD080E","color-warning":"#FF8308","color-info":"#03A9F4","color-success":"#4CAF50","color-background-body":"#FEFEFF","color-background-block":"#FFFFFF","color-background-tooltip":"rgba(80,80,80,0.9)","color-text":"#110f0f","color-text-secondary":"#706F6F","color-text-disabled":"#A09F9F","box-shadow":"rgba(0, 0, 0, 0.08) 1px 2px 6px","box-shadow-popper":"rgba(0, 0, 0, 0.1) 0px 2px 8px 0px","border-divider":"1px solid rgba(0, 0, 0, 0.15)","color-hover-black":"rgba(0, 0, 0, 0.06)","color-log-hits-bar-0":"rgba(0, 0, 0, 0.18)","color-log-hits-bar-1":"#FFB74D","color-log-hits-bar-2":"#81C784","color-log-hits-bar-3":"#64B5F6","color-log-hits-bar-4":"#E57373","color-log-hits-bar-5":"#8a62f0"},sm=()=>{const[t,n]=b(ln()),r=a=>{n(a.matches)};return L(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)");return a.addEventListener("change",r),()=>a.removeEventListener("change",r)},[]),t},Kn=["primary","secondary","error","warning","info","success"],bo=({onLoaded:t})=>{const n=Se(),{palette:r={}}=zt(),{theme:a}=ne(),s=sm(),o=ut(),i=pt(),[c,l]=b({[ze.dark]:Wn,[ze.light]:Jn,[ze.system]:ln()?Wn:Jn}),m=()=>{const{innerWidth:v,innerHeight:_}=window,{clientWidth:y,clientHeight:f}=document.documentElement;gt("scrollbar-width",`${v-y}px`),gt("scrollbar-height",`${_-f}px`),gt("vh",`${_*.01}px`)},d=()=>{Kn.forEach((v,_)=>{const y=We(`color-${v}`),f=Cc(y);gt(`${v}-text`,f),_===Kn.length-1&&(o({type:"SET_DARK_THEME"}),t(!0))})},u=()=>{Kn.forEach(v=>{const _=r[v];_&&gt(`color-${v}`,_)}),d()},h=()=>{const v=Oe("THEME")||ze.system,_=c[v];Object.entries(_).forEach(([y,f])=>{gt(y,f)}),d(),n&&u()},p=()=>{const v=ln()?Wn:Jn;if(c[ze.system]===v){h();return}l(_=>({..._,[ze.system]:v}))};return L(()=>{m(),h()},[c]),L(m,[i]),L(p,[a,s]),L(()=>{n&&o({type:"SET_THEME",payload:ze.light})},[]),null},_o=()=>{const[t,n]=b([]),[r,a]=b(!1),s=W(document.body),o=m=>{const d=Array.from(m||[]);n(d)},i=m=>{m.preventDefault(),m.stopPropagation(),m.type==="dragenter"||m.type==="dragover"?a(!0):m.type==="dragleave"&&a(!1)},c=m=>{m.preventDefault(),m.stopPropagation(),a(!1),m?.dataTransfer?.files&&m.dataTransfer.files[0]&&o(m.dataTransfer.files)},l=m=>{const d=m.clipboardData?.items;if(!d)return;const u=Array.from(d).filter(h=>h.type==="application/json").map(h=>h.getAsFile()).filter(h=>h!==null);n(u)};return se("dragenter",i,s),se("dragleave",i,s),se("dragover",i,s),se("drop",c,s),se("paste",l,s),{files:t,dragging:r}},fn=({onOpenModal:t,onChange:n})=>e("div",{className:"vm-upload-json-buttons",children:[e(P,{variant:"outlined",onClick:t,children:"Paste JSON"}),e("div",{className:"vm-upload-json-buttons__upload",children:[e(P,{children:"Upload Files"}),e("input",{id:"json",name:"json",type:"file",accept:"application/json",multiple:!0,title:" ",onChange:n})]})]}),om=()=>{const[t,n]=b([]),[r,a]=b([]),s=I(()=>!!t.length,[t]),{value:o,setTrue:i,setFalse:c}=ce(!1),l=(f,g="")=>{a(C=>[{filename:g,text:`: ${f.message}`},...C])},m=(f,g)=>{try{const C=JSON.parse(f),w=C.trace||C;if(!w.duration_msec){l(new Error(ye.traceNotFound),g);return}const E=new ct(w,g);n(N=>[E,...N])}catch(C){C instanceof Error&&l(C,g)}},d=f=>{f.map(g=>{const C=new FileReader,w=g?.name||"";C.onload=E=>{const N=String(E.target?.result);m(N,w)},C.readAsText(g)})},u=f=>{if(!f.target)return;const g=f.target;a([]);const C=Array.from(g.files||[]);d(C),g.value=""},h=f=>{const g=t.filter(C=>C.idValue!==f.idValue);n([...g])},p=f=>{a(g=>g.filter((C,w)=>w!==f))},v=f=>()=>{p(f)},{files:_,dragging:y}=_o();return L(()=>{d(_)},[_]),e("div",{className:"vm-trace-page",children:[e("div",{className:"vm-trace-page-header",children:[e("div",{className:"vm-trace-page-header-errors",children:r.map((f,g)=>e("div",{className:"vm-trace-page-header-errors-item",children:[e(ae,{variant:"error",children:[e("b",{className:"vm-trace-page-header-errors-item__filename",children:f.filename}),e("span",{children:f.text})]}),e(P,{className:"vm-trace-page-header-errors-item__close",startIcon:e(Ie,{}),variant:"text",color:"error",onClick:v(g)})]},`${f}_${g}`))}),e("div",{children:s&&e(fn,{onOpenModal:i,onChange:u})})]}),s&&e("div",{children:e(Or,{jsonEditor:!0,traces:t,onDeleteClick:h})}),!s&&e("div",{className:"vm-trace-page-preview",children:[e("p",{className:"vm-trace-page-preview__text",children:["Please, upload file with JSON response content.",`
`,"The file must contain tracing information in JSON format.",`
`,"In order to use tracing please refer to the doc: ",e("a",{className:"vm-link vm-link_colored",href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#query-tracing",target:"_blank",rel:"help noreferrer",children:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#query-tracing"}),`
`,"Tracing graph will be displayed after file upload.",`
`,"Attach files by dragging & dropping, selecting or pasting them."]}),e(fn,{onOpenModal:i,onChange:u})]}),o&&e(Me,{title:"Paste JSON",onClose:c,children:e(Os,{editable:!0,displayTitle:!0,defaultTile:`JSON ${t.length+1}`,onClose:c,onUpload:m})}),y&&e("div",{className:"vm-trace-page__dropzone"})]})},im=({job:t,instance:n,metrics:r,size:a})=>{const{duration:s,relativeTime:o,period:{date:i}}=ve(),{customStep:c}=Le(),{setSearchParamsFromKeys:l}=Tt(),m=()=>{const d=ao({"g0.range_input":s,"g0.end_input":i,"g0.step_input":c,"g0.relative_time":o,size:a,job:t,instance:n,metrics:r});l(d)};L(m,[s,o,i,c,t,n,r,a]),L(m,[])},lm=(t,n)=>`${t}/api/v1/label/job/values?start=${n.start}&end=${n.end}`,cm=(t,n,r)=>{const a=`{job=${JSON.stringify(r)}}`;return`${t}/api/v1/label/instance/values?match[]=${encodeURIComponent(a)}&start=${n.start}&end=${n.end}`},dm=(t,n,r,a)=>{const o=`{${Object.entries({job:r,instance:a}).filter(i=>i[1]).map(([i,c])=>`${i}=${JSON.stringify(c)}`).join(",")}}`;return`${t}/api/v1/label/__name__/values?match[]=${encodeURIComponent(o)}&start=${n.start}&end=${n.end}`},mm=()=>{const{serverUrl:t}=ne(),{period:n}=ve(),[r,a]=b([]),[s,o]=b(!1),[i,c]=b(),l=I(()=>lm(t,n),[t,n]);return L(()=>{(async()=>{o(!0);try{const d=await fetch(l),u=await d.json(),h=u.data||[];a(h.sort((p,v)=>p.localeCompare(v))),d.ok?c(void 0):c(`${u.errorType}\r
${u?.error}`)}catch(d){d instanceof Error&&c(`${d.name}: ${d.message}`)}o(!1)})().catch(console.error)},[l]),{jobs:r,isLoading:s,error:i}},um=t=>{const{serverUrl:n}=ne(),{period:r}=ve(),[a,s]=b([]),[o,i]=b(!1),[c,l]=b(),m=I(()=>cm(n,r,t),[n,r,t]);return L(()=>{if(!t)return;(async()=>{i(!0);try{const u=await fetch(m),h=await u.json(),p=h.data||[];s(p.sort((v,_)=>v.localeCompare(_))),u.ok?l(void 0):l(`${h.errorType}\r
${h?.error}`)}catch(u){u instanceof Error&&l(`${u.name}: ${u.message}`)}i(!1)})().catch(console.error)},[m]),{instances:a,isLoading:o,error:c}},hm=(t,n)=>{const{serverUrl:r}=ne(),{period:a}=ve(),[s,o]=b([]),[i,c]=b(!1),[l,m]=b(),d=I(()=>dm(r,a,t,n),[r,a,t,n]);return L(()=>{if(!t)return;(async()=>{c(!0);try{const h=await fetch(d),p=await h.json(),v=p.data||[];o(v.sort((_,y)=>_.localeCompare(y))),h.ok?m(void 0):m(`${p.errorType}\r
${p?.error}`)}catch(h){h instanceof Error&&m(`${h.name}: ${h.message}`)}c(!1)})().catch(console.error)},[d]),{names:s,isLoading:i,error:l}},pm=({name:t,job:n,instance:r,rateEnabled:a,isBucket:s,height:o})=>{const{isMobile:i}=j(),{customStep:c,yaxis:l}=Le(),{period:m}=ve(),d=Je(),u=Ue(),h=Vt(m.end-m.start),p=gr(c),v=wn(p*10*1e3),[_,y]=b(!1),[f,g]=b(!1),C=_&&c===h?v:c,w=I(()=>{const z=Object.entries({job:n,instance:r}).filter(O=>O[1]).map(([O,q])=>`${O}=${JSON.stringify(q)}`);z.push(`__name__=${JSON.stringify(t)}`),t=="node_cpu_seconds_total"&&z.push('mode!="idle"');const R=`{${z.join(",")}}`;return s?`sum(rate(${R})) by (vmrange, le)`:`
with (q = ${a?`rollup_rate(${R})`:`rollup(${R})`}) (
  alias(min(label_match(q, "rollup", "min")), "min"),
  alias(max(label_match(q, "rollup", "max")), "max"),
  alias(avg(label_match(q, "rollup", "avg")), "avg"),
)`},[t,n,r,a,s]),{isLoading:E,graphData:N,error:S,queryErrors:T,warning:M,isHistogram:x}=Dn({predefinedQuery:[w],visible:!0,customStep:C,showAllSeries:f}),A=z=>{d({type:"SET_YAXIS_LIMITS",payload:z})},D=({from:z,to:R})=>{u({type:"SET_PERIOD",payload:{from:z,to:R}})};return L(()=>{y(x)},[x]),e("div",{className:k({"vm-explore-metrics-graph":!0,"vm-explore-metrics-graph_mobile":i}),children:[E&&e($e,{}),S&&e(ae,{variant:"error",children:S}),T[0]&&e(ae,{variant:"error",children:T[0]}),M&&e(Rn,{warning:M,query:[w],onChange:g}),N&&m&&e($n,{data:N,period:m,customStep:C,query:[w],yaxis:l,setYaxisLimits:A,setPeriod:D,showLegend:!1,height:o,isHistogram:x})]})},vm=({name:t,index:n,length:r,isBucket:a,rateEnabled:s,onChangeRate:o,onRemoveItem:i,onChangeOrder:c})=>{const{isMobile:l}=j(),{value:m,setTrue:d,setFalse:u}=ce(!1),h=()=>{i(t)},p=()=>{c(t,n,n+1)},v=()=>{c(t,n,n-1)};return l?e("div",{className:"vm-explore-metrics-item-header vm-explore-metrics-item-header_mobile",children:[e("div",{className:"vm-explore-metrics-item-header__name",children:t}),e(P,{variant:"text",size:"small",startIcon:e(Lr,{}),onClick:d,ariaLabel:"open panel settings"}),m&&e(Me,{title:t,onClose:u,children:e("div",{className:"vm-explore-metrics-item-header-modal",children:[e("div",{className:"vm-explore-metrics-item-header-modal-order",children:[e(P,{startIcon:e(Wa,{}),variant:"outlined",onClick:v,disabled:n===0,ariaLabel:"move graph up"}),e("p",{children:["position:",e("span",{className:"vm-explore-metrics-item-header-modal-order__index",children:["#",n+1]})]}),e(P,{endIcon:e(Tr,{}),variant:"outlined",onClick:p,disabled:n===r-1,ariaLabel:"move graph down"})]}),!a&&e("div",{className:"vm-explore-metrics-item-header-modal__rate",children:[e(Fe,{label:e("span",{children:["enable ",e("code",{children:"rate()"})]}),value:s,onChange:o,fullWidth:!0}),e("p",{children:"calculates the average per-second speed of metrics change"})]}),e(P,{startIcon:e(Ie,{}),color:"error",variant:"outlined",onClick:h,fullWidth:!0,children:"Remove graph"})]})})]}):e("div",{className:"vm-explore-metrics-item-header",children:[e("div",{className:"vm-explore-metrics-item-header-order",children:[e(G,{title:"move graph up",children:e(P,{className:"vm-explore-metrics-item-header-order__up",startIcon:e(Ne,{}),variant:"text",color:"gray",size:"small",onClick:v,ariaLabel:"move graph up"})}),e("div",{className:"vm-explore-metrics-item-header__index",children:["#",n+1]}),e(G,{title:"move graph down",children:e(P,{className:"vm-explore-metrics-item-header-order__down",startIcon:e(Ne,{}),variant:"text",color:"gray",size:"small",onClick:p,ariaLabel:"move graph down"})})]}),e("div",{className:"vm-explore-metrics-item-header__name",children:t}),!a&&e("div",{className:"vm-explore-metrics-item-header__rate",children:e(G,{title:"calculates the average per-second speed of metric's change",children:e(Fe,{label:e("span",{children:["enable ",e("code",{children:"rate()"})]}),value:s,onChange:o})})}),e("div",{className:"vm-explore-metrics-item-header__close",children:e(G,{title:"close graph",children:e(P,{startIcon:e(Ie,{}),variant:"text",color:"gray",size:"small",onClick:h,ariaLabel:"close graph"})})})]})},fm=({name:t,job:n,instance:r,index:a,length:s,size:o,onRemoveItem:i,onChangeOrder:c})=>{const l=I(()=>/_sum?|_total?|_count?/.test(t),[t]),m=I(()=>/_bucket?/.test(t),[t]),[d,u]=b(l),h=pt(),p=I(o.height,[o,h]);return L(()=>{u(l)},[n]),e("div",{className:"vm-explore-metrics-item vm-block vm-block_empty-padding",children:[e(vm,{name:t,index:a,length:s,isBucket:m,rateEnabled:d,size:o.id,onChangeRate:u,onRemoveItem:i,onChangeOrder:c}),e(pm,{name:t,job:n,instance:r,rateEnabled:d,isBucket:m,height:p},`${t}_${n}_${r}_${d}`)]})},gm=on.map(t=>t.id),ym=({jobs:t,instances:n,names:r,job:a,instance:s,size:o,selectedMetrics:i,onChangeJob:c,onChangeInstance:l,onToggleMetric:m,onChangeSize:d})=>{const u=I(()=>a?"":"No instances. Please select job",[a]),h=I(()=>a?"":"No metric names. Please select job",[a]),{isMobile:p}=j(),{value:v,toggle:_,setFalse:y}=ce(Oe("EXPLORE_METRICS_TIPS")!=="false");return L(()=>{ke("EXPLORE_METRICS_TIPS",`${v}`)},[v]),e(F,{children:[e("div",{className:k({"vm-explore-metrics-header":!0,"vm-explore-metrics-header_mobile":p,"vm-block":!0,"vm-block_mobile":p}),children:[e("div",{className:"vm-explore-metrics-header__job",children:e(kt,{value:a,list:t,label:"Job",placeholder:"Please select job",onChange:c,autofocus:!a&&!!t.length&&!p,searchable:!0})}),e("div",{className:"vm-explore-metrics-header__instance",children:e(kt,{value:s,list:n,label:"Instance",placeholder:"Please select instance",onChange:l,noOptionsText:u,clearable:!0,searchable:!0})}),e("div",{className:"vm-explore-metrics-header__size",children:[e(kt,{label:"Size graphs",value:o,list:gm,onChange:d}),e(G,{title:`${v?"Hide":"Show"} tip`,children:e(P,{variant:"text",color:v?"warning":"gray",startIcon:e(Qt,{}),onClick:_,ariaLabel:"visibility tips"})})]}),e("div",{className:"vm-explore-metrics-header-metrics",children:e(kt,{label:"Metrics",value:i,list:r,placeholder:"Search metric name",onChange:m,noOptionsText:h,clearable:!0,searchable:!0})})]}),v&&e(ae,{variant:"warning",children:e("div",{className:"vm-explore-metrics-header-description",children:[e("p",{children:["Please note: this page is solely designed for exploring Prometheus metrics. Prometheus metrics always contain ",e("code",{children:"job"})," and ",e("code",{children:"instance"})," labels (see ",e("a",{className:"vm-link vm-link_colored",href:"https://prometheus.io/docs/concepts/jobs_instances/",children:"these docs"}),"), and this page relies on them as filters. ",e("br",{}),"Please use this page for Prometheus metrics only, in accordance with their naming conventions."]}),e(P,{variant:"text",size:"small",startIcon:e(Ie,{}),onClick:y,ariaLabel:"close tips"})]})})]})},bm=Ee("job",""),_m=Ee("instance",""),Ca=Ee("metrics",""),wa=Ee("size",""),Cm=on.find(t=>wa?t.id===wa:t.isDefault)||on[0],wm=()=>{const[t,n]=b(bm),[r,a]=b(_m),[s,o]=b(Ca?Ca.split("&"):[]),[i,c]=b(Cm);im({job:t,instance:r,metrics:s.join("&"),size:i.id});const{jobs:l,isLoading:m,error:d}=mm(),{instances:u,isLoading:h,error:p}=um(t),{names:v,isLoading:_,error:y}=hm(t,r),f=I(()=>m||h||_,[m,h,_]),g=I(()=>d||p||y,[d,p,y]),C=N=>{o(N?S=>S.includes(N)?S.filter(T=>T!==N):[...S,N]:[])},w=N=>{const S=on.find(T=>T.id===N);S&&c(S)},E=(N,S,T)=>{const M=T>s.length-1;T<0||M||o(A=>{const D=[...A],[z]=D.splice(S,1);return D.splice(T,0,z),D})};return L(()=>{r&&u.length&&!u.includes(r)&&a("")},[u,r]),e("div",{className:"vm-explore-metrics",children:[e(ym,{jobs:l,instances:u,names:v,job:t,size:i.id,instance:r,selectedMetrics:s,onChangeJob:n,onChangeSize:w,onChangeInstance:a,onToggleMetric:C}),f&&e($e,{}),g&&e(ae,{variant:"error",children:g}),!t&&e(ae,{variant:"info",children:"Please select job to see list of metric names."}),t&&!s.length&&e(ae,{variant:"info",children:"Please select metric names to see the graphs."}),e("div",{className:"vm-explore-metrics-body",children:s.map((N,S)=>e(fm,{name:N,job:t,instance:r,index:S,length:s.length,size:i,onRemoveItem:C,onChangeOrder:E},N))})]})},Nm=()=>{const t=Ye(),n=r=>async()=>{await t(`<${r}/>`,`<${r}/> has been copied`)};return e("div",{className:"vm-preview-icons",children:Object.entries(_i).map(([r,a])=>e("div",{className:"vm-preview-icons-item",onClick:n(r),children:[e("div",{className:"vm-preview-icons-item__svg",children:a()}),e("div",{className:"vm-preview-icons-item__name",children:`<${r}/>`})]},r))})},Ge=({code:t})=>{const n=Ye(),[r,a]=b("Copy"),s=async()=>{await n(t),a("Copied")};return L(()=>{let o=null;return r==="Copied"&&(o=setTimeout(()=>a("Copy"),1e3)),()=>{o&&clearTimeout(o)}},[r]),e("code",{className:"vm-code-example",children:[t,e("div",{className:"vm-code-example__copy",children:e(G,{title:r,children:e(P,{size:"small",variant:"text",onClick:s,startIcon:e(ht,{}),ariaLabel:"close"})})})]})},Sm=()=>e("a",{className:"vm-link vm-link_colored",href:"https://docs.victoriametrics.com/victoriametrics/metricsql/",target:"_blank",rel:"help noreferrer",children:"MetricsQL"}),Na=()=>e("a",{className:"vm-link vm-link_colored",href:"https://grafana.com/grafana/dashboards/1860",target:"_blank",rel:"help noreferrer",children:"Node Exporter Full"}),Tm=()=>e("section",{className:"vm-with-template-tutorial",children:[e("h2",{className:"vm-with-template-tutorial__title",children:["Tutorial for WITH expressions in ",e(Sm,{})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["Let's look at the following real query from ",e(Na,{})," dashboard:"]}),e(Ge,{code:`(
  (
    node_memory_MemTotal_bytes{instance=~"$node:$port", job=~"$job"}
      -
    node_memory_MemFree_bytes{instance=~"$node:$port", job=~"$job"}
  )
    /
  node_memory_MemTotal_bytes{instance=~"$node:$port", job=~"$job"}
) * 100`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"It is clear the query calculates the percentage of used memory for the given $node, $port and $job. Isn't it? :)"})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"What's wrong with this query? Copy-pasted label filters for distinct timeseries which makes it easy to mistype these filters during modification. Let's simplify the query with WITH expressions:"}),e(Ge,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"}
)
(
  node_memory_MemTotal_bytes{commonFilters}
    -
  node_memory_MemFree_bytes{commonFilters}
)
  /
node_memory_MemTotal_bytes{commonFilters} * 100`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["Now label filters are located in a single place instead of three distinct places. The query mentions node_memory_MemTotal_bytes metric twice and ","{commonFilters}"," three times. WITH expressions may improve this:"]}),e(Ge,{code:`WITH (
    my_resource_utilization(free, limit, filters) = (limit{filters} - free{filters}) / limit{filters} * 100
)
my_resource_utilization(
  node_memory_MemFree_bytes,
  node_memory_MemTotal_bytes,
  {instance=~"$node:$port",job=~"$job"},
)`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"Now the template function my_resource_utilization() may be used for monitoring arbitrary resources - memory, CPU, network, storage, you name it."})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["Let's take another nice query from ",e(Na,{})," dashboard:"]}),e(Ge,{code:`(
  (
    (
      count(
        count(node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"}) by (cpu)
      )
    )
      -
    avg(
      sum by (mode) (rate(node_cpu_seconds_total{mode='idle',instance=~"$node:$port",job=~"$job"}[5m]))
    )
  )
    *
  100
)
  /
count(
  count(node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"}) by (cpu)
)`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"Do you understand what does this mess do? Is it manageable? :) WITH expressions are happy to help in a few iterations."})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"1. Extract common filters used in multiple places into a commonFilters variable:"}),e(Ge,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"}
)
(
  (
    (
      count(
        count(node_cpu_seconds_total{commonFilters}) by (cpu)
      )
    )
      -
    avg(
      sum by (mode) (rate(node_cpu_seconds_total{mode='idle',commonFilters}[5m]))
    )
  )
    *
  100
)
  /
count(
  count(node_cpu_seconds_total{commonFilters}) by (cpu)
)`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:'2. Extract "count(count(...) by (cpu))" into cpuCount variable:'}),e(Ge,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"},
    cpuCount = count(count(node_cpu_seconds_total{commonFilters}) by (cpu))
)
(
  (
    cpuCount
      -
    avg(
      sum by (mode) (rate(node_cpu_seconds_total{mode='idle',commonFilters}[5m]))
    )
  )
    *
  100
) / cpuCount`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"3. Extract rate(...) part into cpuIdle variable, since it is clear now that this part calculates the number of idle CPUs:"}),e(Ge,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"},
    cpuCount = count(count(node_cpu_seconds_total{commonFilters}) by (cpu)),
    cpuIdle = sum(rate(node_cpu_seconds_total{mode='idle',commonFilters}[5m]))
)
((cpuCount - cpuIdle) * 100) / cpuCount`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["4. Put node_cpu_seconds_total","{commonFilters}"," into its own variable with the name cpuSeconds:"]}),e(Ge,{code:`WITH (
    cpuSeconds = node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"},
    cpuCount = count(count(cpuSeconds) by (cpu)),
    cpuIdle = sum(rate(cpuSeconds{mode='idle'}[5m]))
)
((cpuCount - cpuIdle) * 100) / cpuCount`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"Now the query became more clear comparing to the initial query."})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"WITH expressions may be nested and may be put anywhere. Try expanding the following query:"}),e(Ge,{code:`WITH (
    f(a, b) = WITH (
        f1(x) = b-x,
        f2(x) = x+x
    ) f1(a)*f2(b)
) f(foo, with(x=bar) x)`})]})]}),Am=(t,n)=>`${t}/expand-with-exprs?query=${encodeURIComponent(n)}&format=json`,Em=()=>{const{serverUrl:t}=ne(),[n,r]=me(),[a,s]=b(""),[o,i]=b(!1),[c,l]=b();return{data:a,error:c,loading:o,expand:async d=>{n.set("expr",d),r(n);const u=Am(t,d);i(!0);try{const p=await(await fetch(u)).json();s(p?.expr||""),l(String(p.error||""))}catch(h){h instanceof Error&&h.name!=="AbortError"&&l(`${h.name}: ${h.message}`)}i(!1)}}},Lm=()=>{const[t]=me(),{data:n,loading:r,error:a,expand:s}=Em(),[o,i]=b(t.get("expr")||""),c=m=>{i(m)},l=()=>{s(o)};return L(()=>{o&&s(o)},[]),e("section",{className:"vm-with-template",children:[r&&e($e,{}),e("div",{className:"vm-with-template-body vm-block",children:[e("div",{className:"vm-with-template-body__expr",children:e(oe,{type:"textarea",label:"MetricsQL query with optional WITH expressions",value:o,error:a,autofocus:!0,onEnter:l,onChange:c})}),e("div",{className:"vm-with-template-body__result",children:e(oe,{type:"textarea",label:"MetricsQL query after expanding WITH expressions and applying other optimizations",value:n,disabled:!0})}),e("div",{className:"vm-with-template-body-top",children:e(P,{variant:"contained",onClick:l,startIcon:e(nt,{}),children:"Expand"})})]}),e("div",{className:"vm-block",children:e(Tm,{})})]})},Mm=(t,n,r)=>{const a=["format=json",`relabel_configs=${encodeURIComponent(n)}`,`metric=${encodeURIComponent(r)}`];return`${t}/metric-relabel-debug?${a.join("&")}`},xm=()=>{const{serverUrl:t}=ne(),[n,r]=b(null),[a,s]=b(!1),[o,i]=b();return{data:n,error:o,loading:a,fetchData:async(l,m)=>{const d=Mm(t,l,m);s(!0);try{const h=await(await fetch(d)).json();r(h.error?null:h),i(String(h.error||""))}catch(u){u instanceof Error&&u.name!=="AbortError"&&i(`${u.name}: ${u.message}`)}s(!1)}}},km={config:`- if: '{bar_label=~"b.*"}'
  source_labels: [foo_label, bar_label]
  separator: "_"
  target_label: foobar
- action: labeldrop
  regex: "foo_.*"
- target_label: job
  replacement: "my-application-2"`,labels:'{__name__="my_metric", bar_label="bar", foo_label="foo", job="my-application", instance="192.168.0.1"}'},Im=()=>{const[t,n]=me(),{data:r,loading:a,error:s,fetchData:o}=xm(),[i,c]=ot("","config"),[l,m]=ot("","labels"),d=v=>{c(v||"")},u=v=>{m(v||"")},h=X(()=>{o(i,l),t.set("config",i),t.set("labels",l),n(t)},[i,l]),p=()=>{const{config:v,labels:_}=km;c(v),m(_),o(v,_),t.set("config",v),t.set("labels",_),n(t)};return L(()=>{const v=t.get("config")||"",_=t.get("labels")||"";(_||v)&&(o(v,_),c(v),m(_))},[]),e("section",{className:"vm-relabeling",children:[a&&e($e,{}),e("div",{className:"vm-relabeling-header vm-block",children:[e("div",{className:"vm-relabeling-header-configs",children:e(oe,{type:"textarea",label:"Relabel configs",value:i,autofocus:!0,onChange:d,onEnter:h})}),e("div",{className:"vm-relabeling-header__labels",children:e(oe,{type:"textarea",label:"Labels",value:l,onChange:u,onEnter:h})}),e("div",{className:"vm-relabeling-header-bottom",children:[e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",rel:"help noreferrer",children:[e(et,{}),"Relabeling cookbook"]}),e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",rel:"help noreferrer",children:[e(lt,{}),"Documentation"]}),e(P,{variant:"text",onClick:p,children:"Try example"}),e(P,{variant:"contained",onClick:h,startIcon:e(nt,{}),children:"Submit"})]})]}),s&&e(ae,{variant:"error",children:s}),r&&e("div",{className:"vm-relabeling-steps vm-block",children:[r.originalLabels&&e("div",{className:"vm-relabeling-steps-item",children:e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Original labels:"}),e("code",{dangerouslySetInnerHTML:{__html:r.originalLabels}})]})}),r.steps.map((v,_)=>e("div",{className:"vm-relabeling-steps-item",children:[e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Step:"}),_+1]}),e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Relabeling Rule:"}),e("code",{children:e("pre",{children:v.rule})})]}),e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Input Labels:"}),e("code",{children:e("pre",{dangerouslySetInnerHTML:{__html:v.errors?.inLabels||v.inLabels}})})]}),e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Output labels:"}),e("code",{children:e("pre",{dangerouslySetInnerHTML:{__html:v.errors?.outLabels||v.outLabels}})})]})]},_)),r.resultingLabels&&e("div",{className:"vm-relabeling-steps-item",children:e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Resulting labels:"}),e("code",{dangerouslySetInnerHTML:{__html:r.resultingLabels}})]})})]})]})},Dm=t=>`${t}/api/v1/status/active_queries`,Rm=()=>{const{serverUrl:t}=ne(),[n,r]=b([]),[a,s]=b(U().format(cn)),[o,i]=b(!1),[c,l]=b(),m=I(()=>Dm(t),[t]),d=async()=>{i(!0);try{const u=await fetch(m),h=await u.json();r(h.data),s(U().format("HH:mm:ss:SSS")),u.ok?l(void 0):l(`${h.errorType}\r
${h?.error}`)}catch(u){u instanceof Error&&l(`${u.name}: ${u.message}`)}i(!1)};return L(()=>{d().catch(console.error)},[m]),{data:n,lastUpdated:a,isLoading:o,error:c,fetchData:d}},$m=({rows:t,columns:n,defaultOrderBy:r,defaultOrderDir:a,copyToClipboard:s,paginationOffset:o})=>{const i=Ye(),[c,l]=b(r),[m,d]=b(a||"desc"),[u,h]=b(null),p=I(()=>{const{startIndex:y,endIndex:f}=o;return Wr(t,Gr(m,c)).slice(y,f)},[t,c,m,o]),v=y=>()=>{d(f=>f==="asc"&&c===y?"desc":"asc"),l(y)},_=(y,f)=>async()=>{if(u!==f)try{await i(String(y)),h(f)}catch(g){console.error(g)}};return L(()=>{if(u===null)return;const y=setTimeout(()=>h(null),2e3);return()=>clearTimeout(y)},[u]),e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:[n.map(y=>e("th",{className:"vm-table-cell vm-table-cell_header vm-table-cell_sort",onClick:v(y.key),children:e("div",{className:"vm-table-cell__content",children:[e("div",{children:String(y.title||y.key)}),e("div",{className:k({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":c===y.key,"vm-table__sort-icon_desc":m==="desc"&&c===y.key}),children:e(Be,{})})]})},String(y.key))),s&&e("th",{className:"vm-table-cell vm-table-cell_header"})]})}),e("tbody",{className:"vm-table-body",children:p.map((y,f)=>e("tr",{className:"vm-table__row",children:[n.map(g=>e("td",{className:k({"vm-table-cell":!0,[`${g.className}`]:g.className}),children:y[g.key]||"-"},String(g.key))),s&&e("td",{className:"vm-table-cell vm-table-cell_right",children:y[s]&&e("div",{className:"vm-table-cell__content",children:e(G,{title:u===f?"Copied":"Copy row",children:e(P,{variant:"text",color:u===f?"success":"gray",size:"small",startIcon:u===f?e(Ln,{}):e(ht,{}),onClick:_(y[s],f),ariaLabel:"copy row"})})})})]},f))})]})},Pm=()=>{const{isMobile:t}=j(),{timezone:n}=ve(),{data:r,lastUpdated:a,isLoading:s,error:o,fetchData:i}=Rm(),c=I(()=>r.map(d=>{const u=U(d.start).tz().format(Ve),h=U(d.end).tz().format(Ve);return{duration:d.duration,remote_addr:d.remote_addr,query:d.query,args:`${u} to ${h}, step=${Zn(d.step)}`,data:JSON.stringify(d,null,2)}}),[r,n]),l=I(()=>{if(!c?.length)return[];const d=Object.keys(c[0]),u={remote_addr:"client address"},h=["data"];return d.filter(p=>!h.includes(p)).map(p=>({key:p,title:u[p]||p}))},[c]),m=async()=>{i().catch(console.error)};return e("div",{className:"vm-active-queries",children:[s&&e($e,{}),e("div",{className:"vm-active-queries-header",children:[!c.length&&!o&&e(ae,{variant:"info",children:"There are currently no active queries running"}),o&&e(ae,{variant:"error",children:o}),e("div",{className:"vm-active-queries-header-controls",children:[e(P,{variant:"contained",onClick:m,startIcon:e(Sn,{}),children:"Update"}),e("div",{className:"vm-active-queries-header__update-msg",children:["Last updated: ",a]})]})]}),!!c.length&&e("div",{className:k({"vm-block":!0,"vm-block_mobile":t}),children:e($m,{rows:c,columns:l,defaultOrderBy:"duration",copyToClipboard:"data",paginationOffset:{startIndex:0,endIndex:1/0}})})]})},zm=({onClose:t,onUpload:n})=>{const{isMobile:r}=j(),[a,s]=b(""),[o,i]=b(""),c=I(()=>{try{return JSON.parse(a),""}catch(d){return d instanceof Error?d.message:"Unknown error"}},[a]),l=d=>{i(""),s(d)},m=()=>{i(c),!c&&(n(a),t())};return e("div",{className:k({"vm-json-form vm-json-form_one-field":!0,"vm-json-form_mobile vm-json-form_one-field_mobile":r}),children:[e(oe,{value:a,label:"JSON",type:"textarea",error:o,autofocus:!0,onChange:l,onEnter:m}),e("div",{className:"vm-json-form-footer",children:e("div",{className:"vm-json-form-footer__controls vm-json-form-footer__controls_right",children:[e(P,{variant:"outlined",color:"error",onClick:t,children:"Cancel"}),e(P,{variant:"contained",onClick:m,children:"apply"})]})})]})},Om=({data:t,period:n})=>{const{isMobile:r}=j(),[a,s]=me(),{tableCompact:o}=Re(),i=St(),[c,l]=b([]),[m,d]=b(),[u,h]=b(),[p,v]=b(!1),[_,y]=b([]),[f,g]=b(),C=I(()=>jr(u||[]).map(O=>O.key),[u]),w=I(()=>{const O=t.some(Q=>Q.data.resultType==="matrix");return t.some(Q=>Q.data.resultType==="vector")&&O?bt:O?bt.filter(Q=>Q.value==="chart"):bt.filter(Q=>Q.value!=="chart")},[t]),[E,N]=b(w[0].value),{yaxis:S,spanGaps:T}=Le(),M=Je(),x=O=>{M({type:"SET_YAXIS_LIMITS",payload:O})},A=()=>{M({type:"TOGGLE_ENABLE_YAXIS_LIMITS"})},D=O=>{M({type:"SET_SPAN_GAPS",payload:O})},z=O=>{N(O)},R=O=>{l(q=>q.filter(Q=>Q.idValue!==O.idValue))},V=()=>{i({type:"TOGGLE_TABLE_COMPACT"})};return L(()=>{const O=E==="chart"?"matrix":"vector",q=t.filter(Q=>Q.data.resultType===O&&Q.trace).map(Q=>Q.trace?new ct(Q.trace,Q?.vmui?.params?.query||"Query"):null);l(q.filter(Boolean))},[t,E]),L(()=>{const O=[],q=[],Q=[];t.forEach((re,Z)=>{const te=re.data.result.map(ie=>({...ie,group:Number(re.vmui?.params?.id??Z)+1}));re.data.resultType==="matrix"?(q.push(...te),O.push(re.vmui?.params?.query||"Query")):Q.push(...te)}),y(O),d(q),h(Q),a.delete("display_mode"),s(a)},[t]),L(()=>{const O=!a.get("display_mode");v(!!m&&O&&Pr(m))},[m,a]),e("div",{className:k({"vm-query-analyzer-view":!0,"vm-query-analyzer-view_mobile":r}),children:[!!c.length&&e(Or,{traces:c,onDeleteClick:R}),e(go,{}),e("div",{className:k({"vm-block":!0,"vm-block_mobile":r}),children:[e("div",{className:"vm-custom-panel-body-header",children:[e("div",{className:"vm-custom-panel-body-header__tabs",children:e(Yt,{activeItem:E,items:w,onChange:z})}),e("div",{className:"vm-custom-panel-body-header__graph-controls",children:[E==="chart"&&e(Ir,{}),E==="chart"&&e(Qr,{data:m||[],yaxis:S,isHistogram:p,setYaxisLimits:x,toggleEnableLimits:A,spanGaps:{value:T,onChange:D}}),E==="table"&&e(uo,{columns:C,selectedColumns:f,onChangeColumns:g,tableCompact:o,toggleTableCompact:V})]})]}),m&&n&&E==="chart"&&e($n,{data:m,period:n,customStep:n.step||"1s",query:_,yaxis:S,setYaxisLimits:x,setPeriod:()=>null,height:r?window.innerHeight*.5:500,isHistogram:p,spanGaps:T}),u&&E==="code"&&e(Yr,{data:u}),u&&E==="table"&&e(mo,{data:u,displayColumns:f})]})]})},Hm=({data:t,period:n})=>{const r=I(()=>t.filter(d=>d.vmui||d.stats),[t]),a=r.find(d=>d?.vmui?.title)?.vmui?.title||"Report",s=r.find(d=>d?.vmui?.comment)?.vmui?.comment,o=I(()=>["vmui.endpoint",...new Set(r.flatMap(d=>[...Object.keys(d.vmui?.params||[]).map(u=>`vmui.params.${u}`),...Object.keys(d.stats||[]).map(u=>`stats.${u}`),"isPartial"]))].map(d=>({column:d.split(".").pop(),values:r.map(u=>{const h=so(u,d);return typeof h=="string"?h:"-"})})).filter(({values:d})=>d.length&&d.every(u=>u!=="-")),[r]),i=I(()=>{if(!n)return"";const d=U(n.start*1e3).tz().format(Ve),u=U(n.end*1e3).tz().format(Ve);return`${d} - ${u}`},[n]),{value:c,setTrue:l,setFalse:m}=ce(!1);return e(F,{children:[e("div",{className:"vm-query-analyzer-info-header",children:[e("h1",{className:"vm-query-analyzer-info-header__title",children:a}),i&&e("div",{className:"vm-query-analyzer-info-header__timerange",children:[e(Dt,{})," ",i]}),n?.step&&e("div",{className:"vm-query-analyzer-info-header__timerange",children:[e(hn,{})," step ",n.step]}),(s||!!o.length)&&e("div",{className:"vm-query-analyzer-info-header__info",children:e(P,{startIcon:e(et,{}),variant:"outlined",color:"warning",onClick:l,children:["Show stats",s&&" & comments"]})})]}),c&&e(Me,{title:a,onClose:m,children:e("div",{className:"vm-query-analyzer-info__modal",children:[!!o.length&&e("div",{className:"vm-query-analyzer-info-stats",children:[e("div",{className:"vm-query-analyzer-info-comment-header",children:[e(et,{}),"Stats"]}),e("table",{children:[e("thead",{children:e("tr",{children:o.map(({column:d})=>e("th",{children:d},d))})}),e("tbody",{children:o[0]?.values.map((d,u)=>e("tr",{children:o.map(({values:h},p)=>e("td",{children:h[u]},p))},u))})]})]}),s&&e("div",{className:"vm-query-analyzer-info-comment",children:[e("div",{className:"vm-query-analyzer-info-comment-header",children:[e(ms,{}),"Comments"]}),e("div",{className:"vm-query-analyzer-info-comment-body vm-markdown",dangerouslySetInnerHTML:{__html:_n(s)||s}})]})]})})]})},Fm=t=>{const n=t.slice(1).map((o,i)=>o-t[i]),r={};n.forEach(o=>{const i=o.toString();r[i]=(r[i]||0)+1});let a=0,s=0;for(const o in r)r[o]>s&&(s=r[o],a=Number(o));return a},Vm=()=>{const[t,n]=b([]),[r,a]=b(""),s=I(()=>!!t.length,[t]),{value:o,setTrue:i,setFalse:c}=ce(!1),l=I(()=>{if(!t)return;const y=t[0]?.vmui?.params,f={start:+(y?.start||0),end:+(y?.end||0),step:y?.step,date:""};if(!y){const C=t.filter(E=>E.data.resultType==="matrix").map(E=>E.data.result).flat().map(E=>E.values?E.values?.map(N=>N[0]):[0]).flat(),w=Array.from(new Set(C.filter(Boolean))).sort((E,N)=>E-N);f.start=w[0],f.end=w[w.length-1],f.step=fr(Fm(w))}return f.date=Oa(He(f.end)),f},[t]),m=y=>y.every(f=>{if(typeof f=="object"&&f!==null){const g=f.data;if(typeof g=="object"&&g!==null){const C=g.result,w=g.resultType;return Array.isArray(C)&&typeof w=="string"}}return!1}),d=y=>{try{const f=JSON.parse(y),g=Array.isArray(f)?f:[f];m(g)?n(g):(a("Invalid structure - JSON does not match the expected format"),n([]))}catch(f){f instanceof Error&&(a(`${f.name}: ${f.message}`),n([]))}},u=y=>{y.map(f=>{const g=new FileReader;g.onload=C=>{const w=String(C.target?.result);d(w)},g.readAsText(f)})},h=y=>{if(!y.target)return;const f=y.target;a("");const g=Array.from(f.files||[]);u(g),f.value=""},p=()=>{a("")},{files:v,dragging:_}=_o();return L(()=>{u(v)},[v]),e("div",{className:"vm-query-analyzer",children:[s&&e("div",{className:"vm-query-analyzer-header",children:[e(Hm,{data:t,period:l}),e(fn,{onOpenModal:i,onChange:h})]}),s&&e(Om,{data:t,period:l}),!s&&e("div",{className:"vm-trace-page-preview",children:[e("p",{className:"vm-trace-page-preview__text",children:["Please, upload file with JSON response content.",`
`,"The file must contain query information in JSON format.",`
`,"Graph will be displayed after file upload.",`
`,"Attach files by dragging & dropping, selecting or pasting them."]}),e(fn,{onOpenModal:i,onChange:h})]}),r&&e("div",{className:"vm-query-analyzer-error",children:[e(ae,{variant:"error",children:r}),e(P,{className:"vm-query-analyzer-error__close",startIcon:e(Ie,{}),variant:"text",color:"error",onClick:p})]}),o&&e(Me,{title:"Paste JSON",onClose:c,children:e(zm,{onClose:c,onUpload:d})}),_&&e("div",{className:"vm-trace-page__dropzone"})]})},Um=(t,n,r)=>{const a=[`flags=${encodeURIComponent(n)}`,`metrics=${encodeURIComponent(r)}`];return`${t}/downsampling-filters-debug?${a.join("&")}`},qm=()=>{const{serverUrl:t}=ne(),[n,r]=me(),[a,s]=b(new Map),[o,i]=b(!1),[c,l]=b(),[m,d]=b(),[u,h]=b(),p=X(async(v,_)=>{if(l(_?"":"metrics are required"),d(v?"":"flags are required"),!_||!v)return;n.set("flags",v),n.set("metrics",_),r(n);const y=Um(t,v,_);i(!0);try{const g=await(await fetch(y)).json();s(new Map(Object.entries(g.result||{}))),l(g.error?.metrics||""),d(g.error?.flags||""),h("")}catch(f){f instanceof Error&&f.name!=="AbortError"&&h(`${f.name}: ${f.message}`)}i(!1)},[t]);return{data:a,error:u,metricsError:c,flagsError:m,loading:o,applyFilters:p}},Sa={flags:`-downsampling.period={env="dev"}:7d:5m,{env="dev"}:30d:30m
-downsampling.period=30d:1m
-downsampling.period=60d:5m
`,metrics:`up
up{env="dev"}
up{env="prod"}`},Bm=()=>{const[t]=me(),{data:n,loading:r,error:a,metricsError:s,flagsError:o,applyFilters:i}=qm(),[c,l]=b(t.get("metrics")||""),[m,d]=b(t.get("flags")||""),u=X(y=>{l(y)},[l]),h=X(y=>{d(y)},[d]),p=X(()=>{i(m,c)},[i,m,c]),v=X(()=>{const{flags:y,metrics:f}=Sa;d(y),l(f),i(y,f),t.set("flags",y),t.set("metrics",f)},[Sa,d,l,t]);L(()=>{m&&c&&p()},[]);const _=[];for(const[y,f]of n)_.push(e("tr",{className:"vm-table__row",children:[e("td",{className:"vm-table-cell",children:y}),e("td",{className:k({"vm-table-cell":!0,"vm-table-cell_empty":!f}),children:f?f.join(" "):"No matching rules found!"})]}));return e("section",{className:"vm-downsampling-filters",children:[r&&e($e,{}),e("div",{className:"vm-downsampling-filters-body vm-block",children:[e("div",{className:"vm-downsampling-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:["Provide a list of flags for downsampling configuration. Note that only ",e("code",{children:"-downsampling.period"})," and ",e("code",{children:"-dedup.minScrapeInterval"})," flags are supported"]})}),e(oe,{type:"textarea",label:"Flags",value:m,error:a||o,autofocus:!0,onEnter:p,onChange:h,placeholder:"-downsampling.period=30d:1m -downsampling.period=7d:5m -dedup.minScrapeInterval=30s"})]}),e("div",{className:"vm-downsampling-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:"Provide a list of metrics to check downsampling configuration."})}),e(oe,{type:"textarea",label:"Metrics",value:c,error:a||s,onEnter:p,onChange:u,placeholder:`up{env="dev"}
up{env="prod"}
`})]}),e("div",{className:"vm-downsampling-filters-body__result",children:e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{children:[e("th",{className:"vm-table-cell vm-table-cell_header",children:"Metric"}),e("th",{className:"vm-table-cell vm-table-cell_header",children:"Applied downsampling rules"})]})}),e("tbody",{className:"vm-table-body",children:_})]})}),e("div",{className:"vm-downsampling-filters-body-top",children:[e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#downsampling",rel:"help noreferrer",children:[e(lt,{}),"Documentation"]}),e(P,{variant:"text",onClick:v,children:"Try example"}),e(P,{variant:"contained",onClick:p,startIcon:e(nt,{}),children:"Apply"})]})]})]})},Qm=(t,n,r)=>{const a=[`flags=${encodeURIComponent(n)}`,`metrics=${encodeURIComponent(r)}`];return`${t}/retention-filters-debug?${a.join("&")}`},Ym=()=>{const{serverUrl:t}=ne(),[n,r]=me(),[a,s]=b(new Map),[o,i]=b(!1),[c,l]=b(),[m,d]=b(),[u,h]=b(),p=X(async(v,_)=>{if(l(_?"":"metrics are required"),d(v?"":"flags are required"),!_||!v)return;n.set("flags",v),n.set("metrics",_),r(n);const y=Qm(t,v,_);i(!0);try{const g=await(await fetch(y)).json();s(new Map(Object.entries(g.result||{}))),l(g.error?.metrics||""),d(g.error?.flags||""),h("")}catch(f){f instanceof Error&&f.name!=="AbortError"&&h(`${f.name}: ${f.message}`)}i(!1)},[t]);return{data:a,error:u,metricsError:c,flagsError:m,loading:o,applyFilters:p}},Ta={flags:`-retentionPeriod=1y
-retentionFilter={env!="prod"}:2w
`,metrics:`up
up{env="dev"}
up{env="prod"}`},jm=()=>{const[t]=me(),{data:n,loading:r,error:a,metricsError:s,flagsError:o,applyFilters:i}=Ym(),[c,l]=b(t.get("metrics")||""),[m,d]=b(t.get("flags")||""),u=X(y=>{l(y)},[l]),h=X(y=>{d(y)},[d]),p=X(()=>{i(m,c)},[i,m,c]),v=X(()=>{const{flags:y,metrics:f}=Ta;d(y),l(f),i(y,f),t.set("flags",y),t.set("metrics",f)},[Ta,d,l,t]);L(()=>{m&&c&&p()},[]);const _=[];for(const[y,f]of n)_.push(e("tr",{className:"vm-table__row",children:[e("td",{className:"vm-table-cell",children:y}),e("td",{className:"vm-table-cell",children:f})]}));return e("section",{className:"vm-retention-filters",children:[r&&e($e,{}),e("div",{className:"vm-retention-filters-body vm-block",children:[e("div",{className:"vm-retention-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:["Provide a list of flags for retention configuration. Note that only ",e("code",{children:"-retentionPeriod"})," and ",e("code",{children:"-retentionFilter"})," flags are supported."]})}),e(oe,{type:"textarea",label:"Flags",value:m,error:a||o,autofocus:!0,onEnter:p,onChange:h,placeholder:'-retentionPeriod=4w -retentionFilter=up{env="dev"}:2w'})]}),e("div",{className:"vm-retention-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:"Provide a list of metrics to check retention configuration."})}),e(oe,{type:"textarea",label:"Metrics",value:c,error:a||s,onEnter:p,onChange:u,placeholder:`up{env="dev"}
up{env="prod"}
`})]}),e("div",{className:"vm-retention-filters-body__result",children:e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{children:[e("th",{className:"vm-table-cell vm-table-cell_header",children:"Metric"}),e("th",{className:"vm-table-cell vm-table-cell_header",children:"Applied retention"})]})}),e("tbody",{className:"vm-table-body",children:_})]})}),e("div",{className:"vm-retention-filters-body-top",children:[e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#retention-filters",rel:"help noreferrer",children:[e(lt,{}),"Documentation"]}),e(P,{variant:"text",onClick:v,children:"Try example"}),e(P,{variant:"contained",onClick:p,startIcon:e(nt,{}),children:"Apply"})]})]})]})},Gm=({hideQuery:t,showAllSeries:n})=>{const{query:r}=Te(),{period:a}=ve(),{displayType:s,reduceMemUsage:o,seriesLimits:i}=Re(),{serverUrl:c}=ne(),[l,m]=b(!1),[d,u]=b(),[h,p]=b(),[v,_]=b([]),[y,f]=b(),g=W(new AbortController),C=I(()=>{if(p(""),_([]),!!a)if(!c)p(ye.emptyServer);else if(r.every(N=>!N.trim()))_(r.map(()=>ye.validQuery));else if(ur(c)){const N={...a};return r.map(S=>sc(c,S,N,o))}else p(ye.validServer)},[c,a,t,o]),w=X(async({fetchUrl:N,stateSeriesLimits:S,showAllSeries:T})=>{g.current.abort(),g.current=new AbortController;const{signal:M}=g.current;m(!0);try{const x=Math.floor(window.innerWidth/4),A=30*1024*1024,D=[],z=T?1/0:+S[s]||1/0;let R=1,V=0;for await(const q of N){if(t?.includes(R-1)){_(ie=>[...ie,""]),R++;continue}const re=await fetch(q,{signal:M}),Z=await re.text();if(new TextEncoder().encode(Z).length>A){const ie="Response too large to display (over 30 MiB). Please narrow your query.";p(ie),_(B=>[...B,ie]);continue}if(!re.ok||!re.body)D.push({metric:{},values:[],group:R}),p(Z),_(ie=>[...ie,`${Z}`]);else{_(H=>[...H,""]);const ie=z-D.length,B=Z.split(`
`).filter(H=>H),$=B.slice(0,ie).sort();for(const H of $){const Y=po(H);if(!Y)continue;const{values:K,timestamps:le}=Y,de=K.length,ue=de>x,fe=ue?x:de,Ce=ue?de/x:1,Ae=Array.from({length:fe},(xe,ge)=>{const be=ue?Math.floor(ge*Ce):ge;return[le[be]/1e3,K[be]]});D.push({group:R,metric:Y.metric,values:Ae})}V+=B.length}R++}const O=`Showing ${D.length} series out of ${V} series due to performance reasons. Please narrow down the query, so it returns less series`;f(V>z?O:""),u(D),m(!1)}catch(x){m(!1),x instanceof Error&&x.name!=="AbortError"&&(p(String(x)),console.error(x))}},[s,t]),E=X(()=>{g.current.abort(),u([])},[g]);return L(()=>{if(!C?.length)return;const N=setTimeout(w,400,{fetchUrl:C,stateSeriesLimits:i,showAllSeries:n});return()=>{g.current?.abort(),clearTimeout(N)}},[C,i,n]),{fetchUrl:C,isLoading:l,data:d,error:h,queryErrors:v,setQueryErrors:_,warning:y,abortFetch:E}},Wm=()=>e(_e,{href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#raw-samples",underlined:!0,children:"raw samples"}),Jm=()=>e(_e,{underlined:!0,href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#query-data",children:"Query API"}),Km=()=>e(_e,{underlined:!0,href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#filtering",children:"time series selector"}),Zm=()=>{zr();const{isMobile:t}=j(),{displayType:n}=Re(),{query:r}=Te(),[a,s]=b([]),[o,i]=b(!r[0]),[c,l]=b(!1),[m,d]=b(!0),{data:u,error:h,isLoading:p,warning:v,queryErrors:_,setQueryErrors:y,abortFetch:f,fetchUrl:g}=Gm({hideQuery:a,showAllSeries:c}),C=W(null),w=!o&&h,E=T=>{s(T)},N=()=>{i(!1)},S=()=>{d(!1)};return e("div",{className:k({"vm-custom-panel":!0,"vm-custom-panel_mobile":t}),children:[e($r,{label:"Time series selector",queryErrors:o?[]:_,setQueryErrors:y,setHideError:i,stats:[],isLoading:p,onHideQuery:E,onRunQuery:N,abortFetch:f,hideButtons:{traceQuery:!0,disableCache:!0},includeFunctions:!1}),m&&e(ae,{variant:"info",children:e("div",{className:"vm-explore-metrics-header-description",children:[e("ul",{children:[e("li",{children:["This page provides a dedicated view for querying and displaying ",e(Wm,{})," from VictoriaMetrics."]}),e("li",{children:["It expects only ",e(Km,{})," as a query argument."]}),e("li",{children:["Deduplication can only be disabled if it was previously enabled on the server (",e("code",{children:"-dedup.minScrapeInterval"}),")."]}),e("li",{children:["Users often assume that the ",e(Jm,{})," returns data exactly as stored, but data samples and timestamps may be modified by the API."]})]}),e(P,{variant:"text",size:"small",startIcon:e(Ie,{}),onClick:S,ariaLabel:"close tips"})]})}),w&&e(ae,{variant:"error",children:h}),v&&e(Rn,{warning:v,query:r,onChange:l}),e("div",{className:k({"vm-custom-panel-body":!0,"vm-custom-panel-body_mobile":t,"vm-block":!0,"vm-block_mobile":t}),children:[p&&e($s,{}),e("div",{className:"vm-custom-panel-body-header",ref:C,children:[e("div",{className:"vm-custom-panel-body-header__tabs",children:e(us,{tabFilter:T=>T.value!==pe.table})}),u&&e(fo,{fetchUrl:g,reportType:vo.RAW_DATA})]}),e(ho,{graphData:u,liveData:u,isHistogram:!1,displayType:n,controlsRef:C})]})]})},Xm=()=>{const[t,n]=b(!1);return e(F,{children:e(Ma,{children:e(gs,{children:e(F,{children:[e(bo,{onLoaded:n}),t&&e(xa,{children:e(he,{path:"/",element:e(Ml,{}),children:[e(he,{path:J.home,element:e(yo,{})}),e(he,{path:J.rawQuery,element:e(Zm,{})}),e(he,{path:J.metrics,element:e(wm,{})}),e(he,{path:J.cardinality,element:e(Jd,{})}),e(he,{path:J.topQueries,element:e(am,{})}),e(he,{path:J.trace,element:e(om,{})}),e(he,{path:J.queryAnalyzer,element:e(Vm,{})}),e(he,{path:J.dashboards,element:e(Ad,{})}),e(he,{path:J.withTemplate,element:e(Lm,{})}),e(he,{path:J.relabel,element:e(Im,{})}),e(he,{path:J.activeQueries,element:e(Pm,{})}),e(he,{path:J.icons,element:e(Nm,{})}),e(he,{path:J.downsamplingDebug,element:e(Bm,{})}),e(he,{path:J.retentionDebug,element:e(jm,{})})]})})]})})})})},eu=({displaySidebar:t,isMobile:n,headerSetup:r,accountIds:a})=>e("div",{className:k({"vm-header-controls":!0,"vm-header-controls_mobile":n}),children:[r?.tenant&&e(Ns,{accountIds:a||[]}),r?.stepControl&&e(Ss,{}),r?.timeSelector&&e(As,{}),r?.cardinalityDatePicker&&e(Es,{}),r?.executionControls&&e(Ls,{}),e(Ms,{}),!t&&e(Dr,{})]}),tu=()=>{const t=Se(),{isMobile:n}=j(),{pathname:r}=tt(),[a,s]=me();xs();const o=()=>{const c="vmui for vmanomaly",l=mt[r]?.title;document.title=l?`${l} - ${c}`:c},i=()=>{const{search:c,href:l}=window.location;if(c){const d=or.parse(c,{ignoreQueryPrefix:!0});Object.entries(d).forEach(([u,h])=>a.set(u,h)),s(a),window.location.search=""}const m=l.replace(/\/\?#\//,"/#/");m!==l&&window.location.replace(m)};return L(o,[r]),L(i,[]),e("section",{className:"vm-container",children:[e(Cs,{controlsComponent:eu}),e("div",{className:k({"vm-container-body":!0,"vm-container-body_mobile":n,"vm-container-body_app":t}),children:e(La,{})}),!t&&e(ws,{})]})},nu=1,ru=()=>{zr();const{isMobile:t}=j(),{query:n}=Te(),{customStep:r}=Le(),a=W(null),[s]=b([]),[o,i]=b(!n[0]),[c,l]=b(!1),{isLoading:m,graphData:d,error:u,queryErrors:h,setQueryErrors:p,queryStats:v,warning:_}=Dn({visible:!0,customStep:r,hideQuery:s,showAllSeries:c}),y=I(()=>{if(!d)return[];const g=d.map(S=>({...qs(S.metric),...S})),C=g.filter(S=>S.value===ee.actual),w=g.filter(S=>S.value===ee.anomaly),E=C.map(S=>{const T=nr(S.metric),M=w.find(x=>nr(x.metric)===T);return{group:1,metric:{...S.metric,__name__:ee.anomaly},values:S.values.filter(([x])=>{if(!M)return!1;const A=M.values.find(([D])=>D===x);return A&&Pt(A[1])>nu})}});return g.filter(S=>S.value!==ee.anomaly&&S.value).concat(E)},[d]),f=()=>{i(!1)};return e("div",{className:k({"vm-custom-panel":!0,"vm-custom-panel_mobile":t}),children:[e($r,{queryErrors:o?[]:h,setQueryErrors:p,setHideError:i,stats:v,onRunQuery:f,hideButtons:{addQuery:!0,prettify:!1,autocomplete:!1,traceQuery:!0,anomalyConfig:!0,reduceMemUsage:!0}}),m&&e($e,{}),!o&&u&&e(ae,{variant:"error",children:u}),_&&e(Rn,{warning:_,query:n,onChange:l}),e("div",{className:k({"vm-custom-panel-body":!0,"vm-custom-panel-body_mobile":t,"vm-block":!0,"vm-block_mobile":t}),children:[e("div",{className:"vm-custom-panel-body-header",ref:a,children:e("div",{})}),y&&e(co,{graphData:y,isHistogram:!1,controlsRef:a,isAnomalyView:!0})]})]})},au=()=>{const[t,n]=b(!1);return e(F,{children:e(Ma,{children:e(gs,{children:e(F,{children:[e(bo,{onLoaded:n}),t&&e(xa,{children:e(he,{path:"/",element:e(tu,{}),children:[e(he,{path:"/",element:e(ru,{})}),e(he,{path:J.query,element:e(yo,{})})]})})]})})})})},su=()=>{switch(Ft){case Ht.vmanomaly:return e(au,{});default:return e(Xm,{})}},Aa=document.getElementById("root");Aa&&Mo(su(),Aa);
