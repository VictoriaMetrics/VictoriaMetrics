import{d as q,t as Uo,a as qo,u as Bo,r as Qo,q as bn,K as vt,h as xt,T as D,b as e,x as $e,N as Oa,c as M,A as J,y as x,e as y,k as V,f as K,g as ft,i as Ke,$ as Lt,M as jo,D as Tr,I as Yo,j as de,F as _n,O as za,l as kt,m as Er,n as Cn,_ as Go,L as Ar,o as Wo,p as Ha,H as Fa,R as Va,s as ve,v as Jo}from"./vendor-DY9kCvzk.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();q.extend(Uo);q.extend(qo);q.extend(Bo);q.extend(Qo);var gt=(t=>(t.victoriametrics="victoriametrics",t.vmanomaly="vmanomaly",t))(gt||{});const Mt="victoriametrics",Ko=Mt==="vmanomaly",G={home:"/",metrics:"/metrics",dashboards:"/dashboards",cardinality:"/cardinality",topQueries:"/top-queries",trace:"/trace",withTemplate:"/expand-with-exprs",relabel:"/relabeling",activeQueries:"/active-queries",queryAnalyzer:"/query-analyzer",icons:"/icons",anomaly:"/anomaly",query:"/query",rawQuery:"/raw-query",downsamplingDebug:"/downsampling-filters-debug",retentionDebug:"/retention-filters-debug",rules:"/rules",notifiers:"/notifiers"},Ft={header:{tenant:!0,stepControl:!0,timeSelector:!0,executionControls:{tooltip:"Refresh dashboard",useAutorefresh:!0}}},ia=t=>{switch(t){case gt.vmanomaly:return{title:"Anomaly exploration",...Ft};default:return{title:"Query",...Ft}}},It={[G.home]:ia(Mt),[G.rawQuery]:{title:"Raw query",...Ft},[G.metrics]:{title:"Explore Prometheus metrics",header:{tenant:!0,stepControl:!0,timeSelector:!0}},[G.cardinality]:{title:"Explore cardinality",header:{tenant:!0,cardinalityDatePicker:!0}},[G.topQueries]:{title:"Top queries",header:{tenant:!0}},[G.trace]:{title:"Trace analyzer",header:{}},[G.queryAnalyzer]:{title:"Query analyzer",header:{}},[G.dashboards]:{title:"Dashboards",...Ft},[G.rules]:{title:"Rules",header:{executionControls:{tooltip:"Refresh alerts",useAutorefresh:!1}}},[G.notifiers]:{title:"Notifiers",header:{executionControls:{tooltip:"Refresh notifiers",useAutorefresh:!1}}},[G.withTemplate]:{title:"WITH templates",header:{}},[G.relabel]:{title:"Metric relabel debug",header:{}},[G.activeQueries]:{title:"Active Queries",header:{}},[G.icons]:{title:"Icons",header:{}},[G.anomaly]:ia(gt.vmanomaly),[G.query]:{title:"Query",...Ft},[G.downsamplingDebug]:{title:"Downsampling filters debug",header:{}},[G.retentionDebug]:{title:"Retention filters debug",header:{}}},Gt=()=>{const t=document.getElementById("root")?.dataset.params||"{}";try{return JSON.parse(t)}catch(r){return console.error(r),{}}},xe=()=>!!Object.keys(Gt()).length,Nn=/(\/select\/)([^/])(\/)(.+)/,Ua=(t,r)=>t.replace(Nn,`$1${r}/$4`),xr=t=>t.match(Nn)?.[2]||"",Zo=t=>t.replace(Nn,""),Ie=(t,r)=>{r?window.localStorage.setItem(t,JSON.stringify({value:r})):wn([t]),window.dispatchEvent(new Event("storage"))},Ve=t=>{const r=window.localStorage.getItem(t);if(r!==null)try{return JSON.parse(r)?.value}catch{return r}},wn=t=>t.forEach(r=>window.localStorage.removeItem(r)),Xo=t=>t.replace(/(\/(?:prometheus\/)?(?:graph|vmui)\/.*|\/#\/.*)/,"").replace(/(\/select\/[^/]+)$/,"$1/prometheus"),ei=t=>{const{serverURL:r}=Gt(),n=Ve("SERVER_URL"),a=`${window.location.origin}${window.location.pathname.replace(/^\/vmui/,"")}`,s=Xo(window.location.href),o=r||n||s;switch(Mt){case gt.vmanomaly:return n||a;default:return t?Ua(o,t):o}},pr=10,qa=25,Ba={table:100,chart:20,code:1e3},vr=[{id:"small",isDefault:!0,height:()=>window.innerHeight*.2},{id:"medium",height:()=>window.innerHeight*.4},{id:"large",height:()=>window.innerHeight*.8}],Sn=["min","median","max"],he=(t,r)=>{const n=window.location.hash.split("?")[1];return bn.parse(n,{ignoreQueryPrefix:!0})?.[t]||r||""},Qa=()=>{const r=(window.location.hash.split("?")[1]||"").match(/g\d+\.expr/g)?.length||1;return new Array(r>pr?pr:r).fill(1).map((n,a)=>he(`g${a}.expr`,""))};var ee=(t=>(t.yhat="yhat",t.yhatUpper="yhat_upper",t.yhatLower="yhat_lower",t.anomaly="vmui_anomalies_points",t.training="vmui_training_data",t.actual="actual",t.anomalyScore="anomaly_score",t))(ee||{}),ge=(t=>(t.table="table",t.chart="chart",t.code="code",t))(ge||{}),_e=(t=>(t.emptyServer="Please enter Server URL",t.validServer="Please provide a valid Server URL",t.validQuery="Please enter a valid Query and execute it",t.traceNotFound="Not found the tracing information",t.emptyTitle="Please enter title",t.positiveNumber="Please enter positive number",t.validStep="Please enter a valid step",t.unknownType="Unknown server response format: must have 'errorType'",t))(_e||{}),ze=(t=>(t.system="system",t.light="light",t.dark="dark",t))(ze||{}),Ee=(t=>(t.empty="empty",t.metricsql="metricsql",t.label="label",t.labelValue="labelValue",t))(Ee||{});const Ze=t=>getComputedStyle(document.documentElement).getPropertyValue(`--${t}`),wt=(t,r)=>{document.documentElement.style.setProperty(`--${t}`,r)},fr=()=>window.matchMedia("(prefers-color-scheme: dark)").matches,ti=t=>t===ze.system&&fr()||t===ze.dark,Tn=t=>{let r;try{r=new URL(t)}catch{return!1}return r.protocol==="http:"||r.protocol==="https:"},ja=t=>t.replace(/\/$/,""),ri=(t,r)=>{if(Array.from(t.entries()).length!==Array.from(r.entries()).length)return!1;for(const[n,a]of t)if(r.get(n)!==a)return!1;return!0},ni=t=>{try{const r=t.match(/\/api\/v1\/[^?]+/);return r?r[0]:null}catch(r){return console.error("Invalid URL:",r),null}},la=he("g0.tenantID",""),ai={serverUrl:ja(ei(la)),tenantId:la,theme:Ve("THEME")||ze.system,isDarkTheme:null,appConfig:{}};function si(t,r){switch(r.type){case"SET_SERVER":return{...t,serverUrl:ja(r.payload)};case"SET_TENANT_ID":return{...t,tenantId:r.payload};case"SET_THEME":return Ie("THEME",r.payload),{...t,theme:r.payload};case"SET_DARK_THEME":return{...t,isDarkTheme:ti(t.theme)};case"SET_APP_CONFIG":return{...t,appConfig:r.payload};default:throw new Error}}const En=vt({}),re=()=>$e(En).state,Dt=()=>$e(En).dispatch,oi=Object.entries(ai).reduce((t,[r,n])=>({...t,[r]:he(r)||n}),{}),ii=({children:t})=>{const[r,n]=xt(si,oi),a=D(()=>({state:r,dispatch:n}),[r,n]);return e(En.Provider,{value:a,children:t})},st="YYYY-MM-DD",Fe="YYYY-MM-DD HH:mm:ss",gr="YYYY-MM-DD HH:mm:ss:SSS (Z)",Lr="YYYY-MM-DD[T]HH:mm:ss",Ya="YYYY-MM-DD_HHmmss",li=["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmera","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/La_Rioja","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Buenos_Aires","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Catamarca","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Coral_Harbour","America/Cordoba","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fort_Nelson","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Indianapolis","America/Inuvik","America/Iqaluit","America/Jamaica","America/Jujuy","America/Juneau","America/Kentucky/Monticello","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Louisville","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Mendoza","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Punta_Arenas","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Atyrau","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Barnaul","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Calcutta","Asia/Chita","Asia/Choibalsan","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Famagusta","Asia/Gaza","Asia/Hebron","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Katmandu","Asia/Khandyga","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qostanay","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Saigon","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Srednekolymsk","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Tomsk","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faeroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Andorra","Europe/Astrakhan","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Kirov","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Saratov","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Ulyanovsk","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Bougainville","Pacific/Chatham","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Ponape","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Truk","Pacific/Wake","Pacific/Wallis"],ci=window.innerWidth/4,di=window.innerWidth/40,ca={min:1,max:1578e8},da=Intl.supportedValuesOf,mi=da?da("timeZone"):li,An=[{long:"years",short:"y",possible:"year"},{long:"weeks",short:"w",possible:"week"},{long:"days",short:"d",possible:"day"},{long:"hours",short:"h",possible:"hour"},{long:"minutes",short:"m",possible:"min"},{long:"seconds",short:"s",possible:"sec"},{long:"milliseconds",short:"ms",possible:"millisecond"}],ui=An.map(t=>t.short),ur=t=>Math.round(t*1e3)/1e3,xn=t=>kr(q.duration(t,"seconds").asMilliseconds()),dn=t=>{let r=ur(t);const n=Math.round(t);return t>=100&&(r=n-n%10),t<100&&t>=10&&(r=n-n%5),t<10&&t>=1&&(r=n),t<1&&t>.01&&(r=Math.round(t*40)/40),xn(r||.001).replace(/\s/g,"")},Ga=t=>{const r=t.match(/\d+/g),n=t.match(/[a-zA-Z]+/g);if(n&&r&&ui.includes(n[0]))return{[n[0]]:r[0]}},Ln=t=>{const r=An.map(o=>o.short).join("|"),n=new RegExp(`\\d+(\\.\\d+)?[${r}]+`,"g"),s=(t.match(n)||[]).reduce((o,i)=>{const l=Ga(i);return l?{...o,...l}:{...o}},{});return q.duration(s).asSeconds()},hi=[ge.table,ge.code],Wt=(t,r,n)=>n&&hi.includes(n)?dn(t):dn(t/(r?di:ci)),St=(t,r)=>{const n=(r||q().toDate()).valueOf()/1e3,a=Ln(t);return{start:n-a,end:n,step:Wt(a),date:Wa(r||q().toDate())}},pi=t=>q(t).utcOffset(0,!0).toDate(),Wa=t=>q.tz(t).utc().format(Lr),Ht=t=>q.tz(t).format(Lr),vi=()=>q().utc().format(Lr),kr=t=>{const r=Math.floor(t%1e3),n=Math.floor(t/1e3%60),a=Math.floor(t/1e3/60%60),s=Math.floor(t/1e3/3600%24),o=Math.floor(t/(1e3*60*60*24)),i=["d","h","m","s","ms"];return[o,s,a,n,r].map((c,m)=>c?`${c}${i[m]}`:"").filter(c=>c).join("")},fi=t=>{const r=t.to.valueOf()-t.from.valueOf();return kr(r)},qe=t=>{const r=q(t*1e3);return r.isValid()?r.toDate():new Date},gi=()=>q().tz().subtract(1,"day").endOf("day").toDate(),yi=()=>q().tz().endOf("day").toDate(),yr=[{title:"Last 5 minutes",duration:"5m"},{title:"Last 15 minutes",duration:"15m"},{title:"Last 30 minutes",duration:"30m",isDefault:!0},{title:"Last 1 hour",duration:"1h"},{title:"Last 3 hours",duration:"3h"},{title:"Last 6 hours",duration:"6h"},{title:"Last 12 hours",duration:"12h"},{title:"Last 24 hours",duration:"24h"},{title:"Last 2 days",duration:"2d"},{title:"Last 7 days",duration:"7d"},{title:"Last 30 days",duration:"30d"},{title:"Last 90 days",duration:"90d"},{title:"Last 180 days",duration:"180d"},{title:"Last 1 year",duration:"1y"},{title:"Yesterday",duration:"1d",until:gi},{title:"Today",duration:"1d",until:yi}].map(t=>({id:t.title.replace(/\s/g,"_").toLocaleLowerCase(),until:t.until?t.until:()=>q().tz().toDate(),...t})),kn=({relativeTimeId:t,defaultDuration:r,defaultEndInput:n})=>{const a=yr.find(i=>i.isDefault)?.id,s=t||he("g0.relative_time",a),o=yr.find(i=>i.id===s);return{relativeTimeId:o?s:"none",duration:o?o.duration:r,endInput:o?o.until():n}},Vt=t=>`UTC${q().tz(t).format("Z")}`,ma=(t="")=>{const r=new RegExp(t,"i");return mi.reduce((n,a)=>{const s=(a.match(/^(.*?)\//)||[])[1]||"unknown",o=Vt(a),i=o.replace(/UTC|0/,""),l=a.replace(/[/_]/g," "),c={region:a,utc:o,search:`${a} ${o} ${l} ${i}`},m=!t||t&&r.test(c.search);return m&&n[s]?n[s].push(c):m&&(n[s]=[c]),n},{})},Ja=t=>{q.tz.setDefault(t)},bi=t=>{try{return q().tz(t),!0}catch{return!1}},Mn=()=>{const t=q.tz.guess(),r=bi(t);return{isValid:r,title:r?`Browser Time (${t})`:"Browser timezone (UTC)",region:r?t:"UTC"}},ua=t=>{if(!t)return 0n;const r=q(t).valueOf();if(!t.includes("."))return BigInt(r)*1000000n;const n=t.match(/\.(\d+)Z/);if(!n)return BigInt(r)*1000000n;let a=n[1];a=a.padEnd(9,"0");const s=parseInt(a.slice(3),10);return BigInt(r)*1000000n+BigInt(s)},Ka=Ve("TIMEZONE")||Mn().region;Ja(Ka);const Za=()=>{const t=he("g0.range_input"),{duration:r,endInput:n,relativeTimeId:a}=kn({defaultDuration:t||"1h",defaultEndInput:pi(he("g0.end_input",vi())),relativeTimeId:t?he("g0.relative_time","none"):void 0});return{duration:r,period:St(r,n),relativeTime:a}},_i={...Za(),timezone:Ka};function Ci(t,r){switch(r.type){case"SET_TIME_STATE":return{...t,...r.payload};case"SET_DURATION":return{...t,duration:r.payload,period:St(r.payload,qe(t.period.end)),relativeTime:"none"};case"SET_RELATIVE_TIME":return{...t,duration:r.payload.duration,period:St(r.payload.duration,r.payload.until),relativeTime:r.payload.id};case"SET_PERIOD":const n=fi(r.payload);return{...t,duration:n,period:St(n,r.payload.to),relativeTime:"none"};case"RUN_QUERY":const{duration:a,endInput:s}=kn({relativeTimeId:t.relativeTime,defaultDuration:t.duration,defaultEndInput:qe(t.period.end)});return{...t,period:St(a,s)};case"RUN_QUERY_TO_NOW":return{...t,period:St(t.duration)};case"SET_TIMEZONE":return Ja(r.payload),Ie("TIMEZONE",r.payload),t.defaultTimezone&&Ie("DISABLED_DEFAULT_TIMEZONE",r.payload!==t.defaultTimezone),{...t,timezone:r.payload};case"SET_DEFAULT_TIMEZONE":return{...t,defaultTimezone:r.payload};default:throw new Error}}const In=vt({}),pe=()=>$e(In).state,Qe=()=>$e(In).dispatch,Ni=({children:t})=>{const[r,n]=xt(Ci,_i),a=D(()=>({state:r,dispatch:n}),[r,n]);return e(In.Provider,{value:a,children:t})},Mr=t=>{const r=Ve(t);return r?JSON.parse(r):{}},Xa=(t,r,n)=>{const a=Mr(t);Ie(t,JSON.stringify({...a,[r]:n}))},Ot=(t,r)=>Mr(t)[r]||[],wi=(t,r)=>{const n=r.map(c=>c.values[c.index]),a=Mr(t),s=a.QUERY_HISTORY||[];s[0]||(s[0]=[]);const o=s[0],i=qa*pr;n.forEach(c=>{!o.includes(c)&&c&&o.unshift(c),o.length>i&&o.pop()});const l={...a,QUERY_HISTORY:[o]};Ie(t,JSON.stringify(l))},Si=(t,r)=>{Xa(t,"QUERY_FAVORITES",r)},Ti=(t,r)=>{const n=Mr(t);Ie(t,JSON.stringify({...n,[r]:[]}))},Ei=(t,r)=>{const n=r||{values:[]},a=t===n.values[n.values.length-1],s=!a&&t?[...n.values,t]:n.values;return s.length>qa&&s.shift(),{index:n.values.length-Number(a),values:s}},Ai=()=>{const t=r=>{const n=Ve(r);if(n){const a=JSON.parse(n);Xa("METRICS_QUERY_HISTORY",r,a),wn([r])}};t("QUERY_HISTORY"),t("QUERY_FAVORITES")};Ai();const br={displayResults:50,queryLimit:1e3,cacheLimit:1e3};class xi{maxSize;map;constructor(){this.maxSize=br.cacheLimit,this.map=new Map}get(r){for(const[n,a]of this.map){const s=JSON.parse(n),o=s.start===r.start&&s.end===r.end,i=s.type===r.type,l=r.value&&s.value&&r.value.includes(s.value),c=s.match===r.match||l,m=a.length<br.queryLimit;if(c&&o&&i&&m)return a}return this.map.get(JSON.stringify(r))}put(r,n){if(this.map.size>=this.maxSize){const a=this.map.keys().next().value;a&&this.map.delete(a)}this.map.set(JSON.stringify(r),n)}}const ha=Qa(),Li={query:ha,queryHistory:ha.map(t=>({index:0,values:[t]})),autocomplete:Ve("AUTOCOMPLETE")||!1,autocompleteQuick:!1,autocompleteCache:new xi,metricsQLFunctions:[]};function ki(t,r){switch(r.type){case"SET_QUERY":return{...t,query:r.payload.map(n=>n)};case"SET_QUERY_HISTORY":return wi(r.payload.key,r.payload.history),{...t,queryHistory:r.payload.history};case"SET_QUERY_HISTORY_BY_INDEX":return t.queryHistory.splice(r.payload.queryNumber,1,r.payload.value),{...t,queryHistory:t.queryHistory};case"TOGGLE_AUTOCOMPLETE":return Ie("AUTOCOMPLETE",!t.autocomplete),{...t,autocomplete:!t.autocomplete};case"SET_AUTOCOMPLETE_QUICK":return{...t,autocompleteQuick:r.payload};case"SET_AUTOCOMPLETE_CACHE":return t.autocompleteCache.put(r.payload.key,r.payload.value),{...t};case"SET_METRICSQL_FUNCTIONS":return{...t,metricsQLFunctions:r.payload};default:throw new Error}}const Dn=vt({}),Le=()=>$e(Dn).state,Jt=()=>$e(Dn).dispatch,Mi=({children:t})=>{const[r,n]=xt(ki,Li),a=D(()=>({state:r,dispatch:n}),[r,n]);return e(Dn.Provider,{value:a,children:t})},es=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M10.975 14.51a1.05 1.05 0 0 0 0-1.485 2.95 2.95 0 0 1 0-4.172l3.536-3.535a2.95 2.95 0 1 1 4.172 4.172l-1.093 1.092a1.05 1.05 0 0 0 1.485 1.485l1.093-1.092a5.05 5.05 0 0 0-7.142-7.142L9.49 7.368a5.05 5.05 0 0 0 0 7.142c.41.41 1.075.41 1.485 0m2.05-5.02a1.05 1.05 0 0 0 0 1.485 2.95 2.95 0 0 1 0 4.172l-3.5 3.5a2.95 2.95 0 1 1-4.171-4.172l1.025-1.025a1.05 1.05 0 0 0-1.485-1.485L3.87 12.99a5.05 5.05 0 0 0 7.142 7.142l3.5-3.5a5.05 5.05 0 0 0 0-7.142 1.05 1.05 0 0 0-1.485 0z"})}),ts=()=>e("svg",{fill:"currentColor",viewBox:"0 0 512 512",children:e("path",{d:"M170.667 64v42.667h-64v298.666h64V448H64V64zM448 64v384H341.333v-42.667h64V106.667h-64V64zm-85.333 256v42.667H149.333V320zm0-85.333v42.666H149.333v-42.666zm0-85.334V192H149.333v-42.667z"})}),Ir=()=>e("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{d:"M12 3a2 2 0 1 0-4 0 2 2 0 0 0 4 0m-2 5a2 2 0 1 1 0 4 2 2 0 0 1 0-4m0 7a2 2 0 1 1 0 4 2 2 0 0 1 0-4"})}),rs=()=>e("svg",{viewBox:"-1 0 30 30",fill:"currentColor",children:e("path",{d:"m3 24 3-6v-8a8 8 0 0 1 16 0v8l3 6zm11 4a2.99 2.99 0 0 1-2.816-2h5.632A2.99 2.99 0 0 1 14 28m10-10v-8c0-5.522-4.478-10-10-10S4 4.478 4 10v8l-4 8h9.101a5 5 0 0 0 9.798 0H28z"})}),ns=()=>e("svg",{viewBox:"411.014 448.582 21.637 17.836",fill:"currentColor",children:e("path",{d:"M411.47 453.837a.72.72 0 0 0-.422.679c0 .319.137.535.422.667.139.065.322.068 3.814.069l3.668.001.164-.083c.484-.245.535-.904.096-1.254l-.141-.112-3.746-.008c-3.05-.006-3.766.001-3.855.041m-.016 5.54c-.284.124-.44.372-.439.701.001.354.204.614.553.708.092.025 1.214.034 3.267.028 3.481-.011 3.23.008 3.468-.264a.714.714 0 0 0-.003-.963c-.249-.283-.03-.267-3.564-.266-2.735 0-3.171.008-3.282.056m-.018 5.016a.72.72 0 0 0-.422.679c0 .319.137.535.422.667.139.065.322.068 3.814.069l3.668.001.164-.083c.484-.245.535-.904.096-1.254l-.141-.112-3.746-.008c-3.05-.006-3.766.001-3.855.041m.161-15.761a.85.85 0 0 0-.389.417c-.023.07-.034.224-.026.343.018.239.078.345.301.525l.139.112 8.729.01 8.73.009.163-.079c.193-.093.36-.332.395-.565a.75.75 0 0 0-.388-.75c-.142-.072-.227-.073-8.844-.072-7.105.002-8.721.011-8.81.05m14.005 2.595c-.286.18-.371.401-.371.961v.334l-.499.024c-.598.028-.961.126-1.456.392a3.5 3.5 0 0 0-1.721 2.199c-.081.307-.091.479-.115 1.923-.027 1.566-.028 1.59-.138 1.966-.145.496-.557 1.361-.929 1.945a5 5 0 0 0-.368.677c-.1.292-.095.679.013.982.112.32.461.686.75.789.276.099 1.255.259 2.268.373l.84.095.028.287q.089.935.767 1.579a2.383 2.383 0 0 0 3.659-.434c.227-.351.36-.745.396-1.161l.023-.283.291-.027c.956-.093 2.47-.32 2.715-.408.393-.14.694-.464.817-.875.16-.539.093-.833-.354-1.554-.373-.601-.832-1.565-.956-2.007-.083-.29-.093-.448-.119-1.903-.027-1.427-.039-1.619-.118-1.924a3.5 3.5 0 0 0-1.895-2.327c-.422-.202-.758-.282-1.309-.312l-.489-.025-.022-.473c-.022-.521-.062-.621-.325-.806-.124-.088-.182-.096-.69-.096-.489.001-.57.012-.693.089m2.696 2.786c.546.176.994.583 1.249 1.135l.149.326.025 1.543c.027 1.672.046 1.837.286 2.598.166.52.621 1.468.974 2.028.189.303.274.472.244.492-.104.066-1.778.288-2.915.387-.788.068-3.246.068-4.037 0-1.154-.099-2.811-.32-2.919-.39-.035-.023.03-.16.223-.469.375-.603.805-1.493.976-2.024.246-.763.272-1 .272-2.426 0-.701.019-1.398.043-1.549.083-.554.47-1.148.931-1.429.103-.063.308-.157.453-.209.258-.092.315-.094 2.025-.096 1.642-.001 1.776.005 2.021.083m-1.384 10.771a1.06 1.06 0 0 1-.748.2c-.394-.066-.776-.451-.835-.841l-.026-.168h2.005v.108z"})}),as=()=>e("svg",{viewBox:"411.014 448.582 23.358 18.492",fill:"currentColor",children:[e("path",{d:"M411.47 453.837a.72.72 0 0 0-.422.679c0 .319.137.535.422.667.139.065.322.068 3.814.069l3.668.001.164-.083c.484-.245.535-.904.096-1.254l-.141-.112-3.746-.008c-3.05-.006-3.766.001-3.855.041m15.967 7.103a1.592 1.612 0 1 1 1.592-1.612 1.592 1.612 0 0 1-1.592 1.612m0-1.612"}),e("path",{d:"M427.405 466.377a6.966 7.052 0 1 1 6.965-7.053 6.974 7.06 0 0 1-6.965 7.053m0-12.09a4.975 5.037 0 1 0 4.975 5.037 4.981 5.043 0 0 0-4.975-5.037"}),e("path",{d:"M421.832 467.074a.996 1.008 0 0 1-.708-1.715l3.582-3.675a.995 1.008 0 0 1 1.417 1.415l-3.582 3.675a.995 1.007 0 0 1-.709.3m-10.378-7.697c-.284.124-.44.372-.439.701.001.354.204.614.553.708.092.025 1.214.034 3.267.028 3.481-.011 3.23.008 3.468-.264a.714.714 0 0 0-.003-.963c-.249-.283-.03-.267-3.564-.266-2.735 0-3.171.008-3.282.056m-.018 5.016a.72.72 0 0 0-.422.679c0 .319.137.535.422.667.139.065.322.068 3.814.069l3.668.001.164-.083c.484-.245.535-.904.096-1.254l-.141-.112-3.746-.008c-3.05-.006-3.766.001-3.855.041m.161-15.761a.85.85 0 0 0-.389.417c-.023.07-.034.224-.026.343.018.239.078.345.301.525l.139.112 8.729.01 8.73.009.163-.079c.193-.093.36-.332.395-.565a.75.75 0 0 0-.388-.75c-.142-.072-.227-.073-8.844-.072-7.105.002-8.721.011-8.81.05"})]}),ss=()=>e("svg",{viewBox:"0 0 74 24",fill:"currentColor",children:e("path",{d:"M6.12 10.48c.36.28.8.43 1.26.43h.05c.48 0 .96-.19 1.25-.44 1.5-1.28 5.88-5.29 5.88-5.29C15.73 4.1 12.46 3.01 7.43 3h-.06C2.33 3-.93 4.1.24 5.18c0 0 4.37 4 5.88 5.3Zm2.56 2.16c-.36.28-.8.44-1.26.45h-.04c-.46 0-.9-.17-1.26-.45-1.04-.88-4.74-4.22-6.12-5.5v1.94c0 .21.08.5.22.63l.07.06c1.05.96 4.55 4.16 5.83 5.25.36.28.8.43 1.26.44h.04c.49-.02.96-.2 1.26-.44 1.3-1.11 4.94-4.45 5.88-5.31.15-.14.23-.42.23-.63V7.15a454.94 454.94 0 0 1-6.11 5.5Zm-1.26 4.99c.46 0 .9-.16 1.26-.44a454.4 454.4 0 0 0 6.1-5.5v1.94c0 .2-.07.48-.22.62-.94.87-4.57 4.2-5.88 5.3-.3.26-.77.44-1.26.45h-.04c-.46 0-.9-.16-1.26-.44-1.2-1.02-4.38-3.92-5.62-5.06l-.28-.25c-.14-.14-.22-.42-.22-.62v-1.94c1.38 1.26 5.08 4.6 6.12 5.5.36.28.8.43 1.26.44h.04ZM35 5l-5.84 14.46h-2.43L20.89 5h2.16a.9.9 0 0 1 .9.61l3.41 8.82a18.8 18.8 0 0 1 .62 2.02 19.44 19.44 0 0 1 .57-2.02l3.39-8.82c.05-.15.16-.3.31-.42a.9.9 0 0 1 .58-.19H35Zm17.18 0v14.46H49.8v-9.34c0-.37.02-.78.06-1.21l-4.37 8.21c-.21.4-.53.59-.95.59h-.38c-.43 0-.75-.2-.95-.59L38.8 8.88a22.96 22.96 0 0 1 .07 1.24v9.34H36.5V5h2.03l.3.01c.1 0 .17.02.24.05.07.03.13.07.19.13a1 1 0 0 1 .17.24l4.33 8.03a16.97 16.97 0 0 1 .6 1.36 14.34 14.34 0 0 1 .6-1.38l4.28-8.01c.05-.1.1-.18.17-.24.06-.06.12-.1.19-.13a.9.9 0 0 1 .24-.05l.3-.01h2.04Zm8.88 13.73a4.5 4.5 0 0 0 1.82-.35 3.96 3.96 0 0 0 2.22-2.47c.2-.57.3-1.19.3-1.85V5.31h1.02v8.75c0 .78-.12 1.51-.37 2.19a4.88 4.88 0 0 1-2.76 2.95c-.66.29-1.4.43-2.23.43-.82 0-1.57-.14-2.24-.43a5.01 5.01 0 0 1-2.75-2.95 6.37 6.37 0 0 1-.37-2.19V5.31h1.03v8.74c0 .66.1 1.28.3 1.85a3.98 3.98 0 0 0 2.21 2.47c.53.24 1.14.36 1.82.36Zm10.38.73h-1.03V5.31h1.03v14.15Z"})}),os=()=>e("svg",{viewBox:"0 0 85 38",fill:"currentColor",children:e("path",{d:"M11.118 10.476c.36.28.801.433 1.257.436h.052c.48-.007.961-.192 1.25-.444 1.509-1.279 5.88-5.287 5.88-5.287 1.168-1.087-2.093-2.174-7.13-2.181h-.06c-5.036.007-8.298 1.094-7.13 2.181 0 0 4.372 4.008 5.88 5.295zm2.559 2.166c-.359.283-.801.439-1.258.444h-.044a2.071 2.071 0 0 1-1.257-.444C10.082 11.755 6.384 8.42 5 7.148v1.93c0 .215.081.496.222.629l.07.064c1.045.955 4.546 4.154 5.825 5.245.358.283.8.438 1.257.444h.044c.489-.015.962-.2 1.258-.444 1.309-1.11 4.948-4.444 5.887-5.31.148-.132.222-.413.222-.628v-1.93a455.127 455.127 0 0 1-6.11 5.494zm-1.258 4.984a2.071 2.071 0 0 0 1.258-.436c2.053-1.815 4.09-3.65 6.11-5.502v1.938c0 .207-.075.488-.223.621-.94.873-4.578 4.2-5.887 5.31-.296.25-.77.436-1.258.443h-.044a2.071 2.071 0 0 1-1.257-.436c-1.204-1.027-4.376-3.928-5.616-5.062l-.28-.255c-.14-.133-.221-.414-.221-.621v-1.938c1.383 1.265 5.081 4.607 6.117 5.495.358.282.8.438 1.257.443h.044zM40 5l-5.84 14.46h-2.43L25.89 5h2.16c.233 0 .423.057.57.17.146.113.256.26.33.44l3.41 8.82c.113.287.22.603.32.95.106.34.206.697.3 1.07.08-.373.166-.73.26-1.07a8.84 8.84 0 0 1 .31-.95l3.39-8.82a.959.959 0 0 1 .31-.42.906.906 0 0 1 .58-.19H40zm17.176 0v14.46h-2.37v-9.34c0-.373.02-.777.06-1.21l-4.37 8.21c-.206.393-.523.59-.95.59h-.38c-.426 0-.743-.197-.95-.59l-4.42-8.24c.02.22.037.437.05.65.014.213.02.41.02.59v9.34h-2.37V5h2.03c.12 0 .224.003.31.01a.778.778 0 0 1 .23.05c.074.027.137.07.19.13.06.06.117.14.17.24l4.33 8.03c.114.213.217.433.31.66.1.227.197.46.29.7.094-.247.19-.483.29-.71.1-.233.207-.457.32-.67l4.27-8.01c.054-.1.11-.18.17-.24a.57.57 0 0 1 .19-.13.903.903 0 0 1 .24-.05c.087-.007.19-.01.31-.01h2.03zm8.887 13.73c.68 0 1.286-.117 1.82-.35.54-.24.996-.57 1.37-.99a4.28 4.28 0 0 0 .85-1.48c.2-.573.3-1.19.3-1.85V5.31h1.02v8.75c0 .78-.124 1.51-.37 2.19a5.248 5.248 0 0 1-1.07 1.77c-.46.5-1.024.893-1.69 1.18-.66.287-1.404.43-2.23.43-.827 0-1.574-.143-2.24-.43a5.012 5.012 0 0 1-1.69-1.18 5.33 5.33 0 0 1-1.06-1.77 6.373 6.373 0 0 1-.37-2.19V5.31h1.03v8.74c0 .66.096 1.277.29 1.85.2.567.483 1.06.85 1.48.373.42.826.75 1.36.99.54.24 1.15.36 1.83.36zm10.38.73h-1.03V5.31h1.03v14.15zM4.242 35v-5.166l-.672-.078a.595.595 0 0 1-.21-.09.23.23 0 0 1-.078-.186v-.438h.96v-.588c0-.348.048-.656.144-.924.1-.272.24-.5.42-.684a1.79 1.79 0 0 1 .66-.426c.256-.096.544-.144.864-.144.272 0 .522.04.75.12l-.024.534c-.008.096-.062.148-.162.156a4.947 4.947 0 0 1-.39.012c-.184 0-.352.024-.504.072a.949.949 0 0 0-.384.234c-.108.108-.192.25-.252.426a2.184 2.184 0 0 0-.084.654v.558h1.752v.774H5.316V35H4.242zM10.416 28.826a3.1 3.1 0 0 1 1.2.222c.356.148.66.358.912.63s.444.602.576.99c.136.384.204.814.204 1.29 0 .48-.068.912-.204 1.296a2.735 2.735 0 0 1-.576.984 2.572 2.572 0 0 1-.912.63 3.175 3.175 0 0 1-1.2.216c-.448 0-.852-.072-1.212-.216a2.572 2.572 0 0 1-.912-.63 2.805 2.805 0 0 1-.582-.984 3.972 3.972 0 0 1-.198-1.296c0-.476.066-.906.198-1.29.136-.388.33-.718.582-.99.252-.272.556-.482.912-.63.36-.148.764-.222 1.212-.222zm0 5.424c.6 0 1.048-.2 1.344-.6.296-.404.444-.966.444-1.686 0-.724-.148-1.288-.444-1.692-.296-.404-.744-.606-1.344-.606-.304 0-.57.052-.798.156a1.507 1.507 0 0 0-.564.45c-.148.196-.26.438-.336.726a3.941 3.941 0 0 0-.108.966c0 .72.148 1.282.444 1.686.3.4.754.6 1.362.6zM15.677 30.14c.192-.416.428-.74.708-.972.28-.236.622-.354 1.026-.354.128 0 .25.014.366.042.12.028.226.072.318.132l-.078.798c-.024.1-.084.15-.18.15-.056 0-.138-.012-.246-.036a1.694 1.694 0 0 0-.366-.036c-.192 0-.364.028-.516.084-.148.056-.282.14-.402.252a1.782 1.782 0 0 0-.318.408c-.092.16-.176.344-.252.552V35h-1.074v-6.078h.612c.116 0 .196.022.24.066.044.044.074.12.09.228l.072.924zM26.761 28.922 24.283 35h-.96l-2.478-6.078h.87a.33.33 0 0 1 .33.222l1.542 3.912c.048.148.09.292.126.432.036.14.07.28.102.42.032-.14.066-.28.102-.42.036-.14.08-.284.132-.432l1.56-3.912a.33.33 0 0 1 .12-.156.311.311 0 0 1 .198-.066h.834zM27.74 35v-6.078h.643c.152 0 .246.074.282.222l.078.624c.224-.276.476-.502.756-.678.28-.176.604-.264.972-.264.408 0 .738.114.99.342.256.228.44.536.552.924.088-.22.2-.41.336-.57a1.987 1.987 0 0 1 1.014-.624c.196-.048.394-.072.594-.072.32 0 .604.052.852.156.252.1.464.248.636.444.176.196.31.438.402.726.092.284.138.61.138.978V35H34.91v-3.87c0-.476-.104-.836-.312-1.08-.208-.248-.508-.372-.9-.372-.176 0-.344.032-.504.096-.156.06-.294.15-.414.27-.12.12-.216.272-.288.456-.068.18-.102.39-.102.63V35h-1.074v-3.87c0-.488-.098-.852-.294-1.092-.196-.24-.482-.36-.858-.36-.264 0-.508.072-.732.216a2.38 2.38 0 0 0-.618.576V35H27.74zM40.746 32.372c-.428.02-.788.058-1.08.114-.292.052-.526.12-.702.204a.923.923 0 0 0-.378.294.639.639 0 0 0-.114.366c0 .26.076.446.228.558.156.112.358.168.606.168.304 0 .566-.054.786-.162.224-.112.442-.28.654-.504v-1.038zm-3.396-2.67c.708-.648 1.56-.972 2.556-.972.36 0 .682.06.966.18.284.116.524.28.72.492.196.208.344.458.444.75.104.292.156.612.156.96V35h-.672a.708.708 0 0 1-.324-.06c-.076-.044-.136-.13-.18-.258l-.132-.444c-.156.14-.308.264-.456.372a2.804 2.804 0 0 1-.462.264c-.16.072-.332.126-.516.162-.18.04-.38.06-.6.06-.26 0-.5-.034-.72-.102a1.618 1.618 0 0 1-.57-.318 1.414 1.414 0 0 1-.372-.522 1.852 1.852 0 0 1-.132-.726 1.419 1.419 0 0 1 .33-.906c.12-.14.274-.272.462-.396s.418-.232.69-.324c.276-.092.596-.166.96-.222.364-.06.78-.096 1.248-.108v-.36c0-.412-.088-.716-.264-.912-.176-.2-.43-.3-.762-.3-.24 0-.44.028-.6.084-.156.056-.294.12-.414.192l-.33.186a.631.631 0 0 1-.324.084.439.439 0 0 1-.264-.078.716.716 0 0 1-.174-.192l-.264-.474zM44.974 29.6c.124-.124.254-.238.39-.342a2.395 2.395 0 0 1 .936-.444c.176-.044.368-.066.576-.066.336 0 .634.058.894.174.26.112.476.272.648.48.176.204.308.45.396.738.092.284.138.598.138.942V35H47.47v-3.918c0-.376-.086-.666-.258-.87-.172-.208-.434-.312-.786-.312-.256 0-.496.058-.72.174a2.58 2.58 0 0 0-.636.474V35h-1.482v-6.156h.906c.192 0 .318.09.378.27l.102.486zM53.085 28.748c.456 0 .87.074 1.242.222a2.692 2.692 0 0 1 1.578 1.626c.144.392.216.83.216 1.314 0 .488-.072.928-.216 1.32-.144.392-.35.726-.618 1.002a2.653 2.653 0 0 1-.96.636 3.333 3.333 0 0 1-1.242.222c-.46 0-.878-.074-1.254-.222a2.712 2.712 0 0 1-.966-.636 2.922 2.922 0 0 1-.618-1.002 3.807 3.807 0 0 1-.216-1.32c0-.484.072-.922.216-1.314.148-.392.354-.724.618-.996.268-.272.59-.482.966-.63a3.397 3.397 0 0 1 1.254-.222zm0 5.202c.512 0 .89-.172 1.134-.516.248-.344.372-.848.372-1.512s-.124-1.17-.372-1.518c-.244-.348-.622-.522-1.134-.522-.52 0-.906.176-1.158.528-.248.348-.372.852-.372 1.512s.124 1.164.372 1.512c.252.344.638.516 1.158.516zM57.252 35v-6.156h.906c.192 0 .318.09.378.27l.096.456c.108-.12.22-.23.336-.33a2.017 2.017 0 0 1 1.32-.492c.388 0 .706.106.954.318.252.208.44.486.564.834a1.93 1.93 0 0 1 .834-.882c.172-.092.354-.16.546-.204.196-.044.392-.066.588-.066.34 0 .642.052.906.156.264.104.486.256.666.456.18.2.316.444.408.732.096.288.144.618.144.99V35h-1.482v-3.918c0-.392-.086-.686-.258-.882-.172-.2-.424-.3-.756-.3-.152 0-.294.026-.426.078a1.026 1.026 0 0 0-.342.228 1.019 1.019 0 0 0-.228.366 1.435 1.435 0 0 0-.084.51V35h-1.488v-3.918c0-.412-.084-.712-.252-.9-.164-.188-.406-.282-.726-.282-.216 0-.418.054-.606.162a1.979 1.979 0 0 0-.516.432V35h-1.482zM70.558 32.372c-.428.02-.788.058-1.08.114-.292.052-.526.12-.702.204a.923.923 0 0 0-.378.294.639.639 0 0 0-.114.366c0 .26.076.446.228.558.156.112.358.168.606.168.304 0 .566-.054.786-.162.224-.112.442-.28.654-.504v-1.038zm-3.396-2.67c.708-.648 1.56-.972 2.556-.972.36 0 .682.06.966.18.284.116.524.28.72.492.196.208.344.458.444.75.104.292.156.612.156.96V35h-.672a.708.708 0 0 1-.324-.06c-.076-.044-.136-.13-.18-.258l-.132-.444c-.156.14-.308.264-.456.372a2.804 2.804 0 0 1-.462.264c-.16.072-.332.126-.516.162-.18.04-.38.06-.6.06-.26 0-.5-.034-.72-.102a1.618 1.618 0 0 1-.57-.318 1.414 1.414 0 0 1-.372-.522 1.852 1.852 0 0 1-.132-.726 1.419 1.419 0 0 1 .33-.906c.12-.14.274-.272.462-.396s.418-.232.69-.324c.276-.092.596-.166.96-.222.364-.06.78-.096 1.248-.108v-.36c0-.412-.088-.716-.264-.912-.176-.2-.43-.3-.762-.3-.24 0-.44.028-.6.084-.156.056-.294.12-.414.192l-.33.186a.631.631 0 0 1-.324.084.439.439 0 0 1-.264-.078.716.716 0 0 1-.174-.192l-.264-.474zM74.9 26.084V35h-1.482v-8.916H74.9zM81.969 28.844l-3.354 7.848a.538.538 0 0 1-.174.234c-.068.056-.174.084-.318.084h-1.104l1.152-2.472-2.49-5.694h1.302c.116 0 .206.028.27.084.068.056.118.12.15.192l1.308 3.192c.044.108.08.216.108.324.032.108.062.218.09.33a32.3 32.3 0 0 1 .108-.33c.036-.112.076-.222.12-.33l1.236-3.186a.437.437 0 0 1 .408-.276h1.188z"})}),is=()=>e("svg",{viewBox:"0 0 15 17",fill:"currentColor",children:e("path",{d:"M6.11767 7.47586C6.47736 7.75563 6.91931 7.90898 7.37503 7.91213H7.42681C7.90756 7.90474 8.38832 7.71987 8.67677 7.46846C10.1856 6.18921 14.5568 2.18138 14.5568 2.18138C15.7254 1.09438 12.4637 0.00739 7.42681 0H7.36764C2.3308 0.00739 -0.930935 1.09438 0.237669 2.18138C0.237669 2.18138 4.60884 6.18921 6.11767 7.47586ZM8.67677 9.64243C8.31803 9.92483 7.87599 10.0808 7.41941 10.0861H7.37503C6.91845 10.0808 6.47641 9.92483 6.11767 9.64243C5.0822 8.75513 1.38409 5.42018 0.000989555 4.14832V6.07829C0.000989555 6.29273 0.0823481 6.57372 0.222877 6.70682L0.293316 6.7712L0.293344 6.77122C1.33784 7.72579 4.83903 10.9255 6.11767 12.0161C6.47641 12.2985 6.91845 12.4545 7.37503 12.4597H7.41941C7.90756 12.4449 8.38092 12.2601 8.67677 12.0161C9.9859 10.9069 13.6249 7.57198 14.5642 6.70682C14.7121 6.57372 14.7861 6.29273 14.7861 6.07829V4.14832C12.7662 5.99804 10.7297 7.82949 8.67677 9.64243ZM7.41941 14.6263C7.87513 14.6232 8.31708 14.4698 8.67677 14.19C10.7298 12.3746 12.7663 10.5407 14.7861 8.68853V10.6259C14.7861 10.8329 14.7121 11.1139 14.5642 11.247C13.6249 12.1196 9.9859 15.4471 8.67677 16.5563C8.38092 16.8077 7.90756 16.9926 7.41941 17H7.37503C6.91931 16.9968 6.47736 16.8435 6.11767 16.5637C4.91427 15.5373 1.74219 12.6364 0.502294 11.5025C0.393358 11.4029 0.299337 11.3169 0.222877 11.247C0.0823481 11.1139 0.000989555 10.8329 0.000989555 10.6259V8.68853C1.38409 9.95303 5.0822 13.2953 6.11767 14.1827C6.47641 14.4651 6.91845 14.6211 7.37503 14.6263H7.41941Z"})}),mt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),De=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),ut=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"})}),ot=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),Kt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})}),$n=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})}),Pn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),ls=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),qt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})}),Ae=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"})}),We=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m7 10 5 5 5-5z"})}),Bt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[e("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),e("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),_r=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"})}),cs=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m22 5.72-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39 6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})}),ds=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"})}),it=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M8 5v14l11-7z"})}),Dr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m10 16.5 6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"})}),Rn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m3.5 18.49 6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"})}),$r=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5v11zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2zM3 19c0 1.1.9 2 2 2h3V10H3v9z"})}),Zt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})}),Pr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),On=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),ms=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 13H5v-2h14v2z"})}),Rr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M8.9999 14.7854L18.8928 4.8925C19.0803 4.70497 19.3347 4.59961 19.5999 4.59961C19.8651 4.59961 20.1195 4.70497 20.307 4.8925L21.707 6.2925C22.0975 6.68303 22.0975 7.31619 21.707 7.70672L9.70701 19.7067C9.31648 20.0972 8.68332 20.0972 8.2928 19.7067L2.6928 14.1067C2.50526 13.9192 2.3999 13.6648 2.3999 13.3996C2.3999 13.1344 2.50526 12.88 2.6928 12.6925L4.0928 11.2925C4.48332 10.902 5.11648 10.902 5.50701 11.2925L8.9999 14.7854Z"})}),zn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})}),us=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})}),hs=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 9l1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25L19 9zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25L19 15z"})}),yt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),Hn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"})}),Cr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"})}),ht=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21 5C19.89 4.65 18.67 4.5 17.5 4.5C15.55 4.5 13.45 4.9 12 6C10.55 4.9 8.45 4.5 6.5 4.5C5.33 4.5 4.11 4.65 3 5C2.25 5.25 1.6 5.55 1 6V20.6C1 20.85 1.25 21.1 1.5 21.1C1.6 21.1 1.65 21.1 1.75 21.05C3.15 20.3 4.85 20 6.5 20C8.2 20 10.65 20.65 12 21.5C13.35 20.65 15.8 20 17.5 20C19.15 20 20.85 20.3 22.25 21.05C22.35 21.1 22.4 21.1 22.5 21.1C22.75 21.1 23 20.85 23 20.6V6C22.4 5.55 21.75 5.25 21 5ZM21 18.5C19.9 18.15 18.7 18 17.5 18C15.8 18 13.35 18.65 12 19.5C10.65 18.65 8.2 18 6.5 18C5.3 18 4.1 18.15 3 18.5V7C4.1 6.65 5.3 6.5 6.5 6.5C8.2 6.5 10.65 7.15 12 8C13.35 7.15 15.8 6.5 17.5 6.5C18.7 6.5 19.9 6.65 21 7V18.5Z"}),e("path",{d:"M17.5 10.5C18.38 10.5 19.23 10.59 20 10.76V9.24C19.21 9.09 18.36 9 17.5 9C15.8 9 14.26 9.29 13 9.83V11.49C14.13 10.85 15.7 10.5 17.5 10.5ZM13 12.49V14.15C14.13 13.51 15.7 13.16 17.5 13.16C18.38 13.16 19.23 13.25 20 13.42V11.9C19.21 11.75 18.36 11.66 17.5 11.66C15.8 11.66 14.26 11.96 13 12.49ZM17.5 14.33C15.8 14.33 14.26 14.62 13 15.16V16.82C14.13 16.18 15.7 15.83 17.5 15.83C18.38 15.83 19.23 15.92 20 16.09V14.57C19.21 14.41 18.36 14.33 17.5 14.33Z"}),e("path",{d:"M6.5 10.5C5.62 10.5 4.77 10.59 4 10.76V9.24C4.79 9.09 5.64 9 6.5 9C8.2 9 9.74 9.29 11 9.83V11.49C9.87 10.85 8.3 10.5 6.5 10.5ZM11 12.49V14.15C9.87 13.51 8.3 13.16 6.5 13.16C5.62 13.16 4.77 13.25 4 13.42V11.9C4.79 11.75 5.64 11.66 6.5 11.66C8.2 11.66 9.74 11.96 11 12.49ZM6.5 14.33C8.2 14.33 9.74 14.62 11 15.16V16.82C9.87 16.18 8.3 15.83 6.5 15.83C5.62 15.83 4.77 15.92 4 16.09V14.57C4.79 14.41 5.64 14.33 6.5 14.33Z"})]}),ps=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"})}),vs=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 6C9.79 6 8 7.79 8 10H10C10 8.9 10.9 8 12 8C13.1 8 14 8.9 14 10C14 10.8792 13.4202 11.3236 12.7704 11.8217C11.9421 12.4566 11 13.1787 11 15H13C13 13.9046 13.711 13.2833 14.4408 12.6455C15.21 11.9733 16 11.2829 16 10C16 7.79 14.21 6 12 6ZM13 16V18H11V16H13Z"})}),Nr=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M4 20h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2s.9 2 2 2zm0-3h2v2H4v-2zM2 6c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2zm4 1H4V5h2v2zm-2 7h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2s.9 2 2 2zm0-3h2v2H4v-2z"})}),Fn=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})}),fs=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),Xt=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M7 20h4c0 1.1-.9 2-2 2s-2-.9-2-2zm-2-1h8v-2H5v2zm11.5-9.5c0 3.82-2.66 5.86-3.77 6.5H5.27c-1.11-.64-3.77-2.68-3.77-6.5C1.5 5.36 4.86 2 9 2s7.5 3.36 7.5 7.5zm4.87-2.13L20 8l1.37.63L22 10l.63-1.37L24 8l-1.37-.63L22 6l-.63 1.37zM19 6l.94-2.06L22 3l-2.06-.94L19 0l-.94 2.06L16 3l2.06.94L19 6z"})}),Ii=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M3 14h4v-4H3v4zm0 5h4v-4H3v4zM3 9h4V5H3v4zm5 5h13v-4H8v4zm0 5h13v-4H8v4zM8 5v4h13V5H8z"})}),gs=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"})}),ys=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})}),bs=()=>e("svg",{viewBox:"0 0 16 16",fill:Ze("color-error"),children:e("path",{d:"M13.5095 4L8.50952 1H7.50952L2.50952 4L2.01953 4.85999V10.86L2.50952 11.71L7.50952 14.71H8.50952L13.5095 11.71L13.9995 10.86V4.85999L13.5095 4ZM7.50952 13.5601L3.00952 10.86V5.69995L7.50952 8.15002V13.5601ZM3.26953 4.69995L8.00952 1.85999L12.7495 4.69995L8.00952 7.29004L3.26953 4.69995ZM13.0095 10.86L8.50952 13.5601V8.15002L13.0095 5.69995V10.86Z"})}),_s=()=>e("svg",{viewBox:"0 0 16 16",fill:Ze("color-primary"),children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 5H4V4H1.5L1 4.5V12.5L1.5 13H4V12H2V5ZM14.5 4H12V5H14V12H12V13H14.5L15 12.5V4.5L14.5 4ZM11.76 6.56995L12 7V9.51001L11.7 9.95996L7.19995 11.96H6.73999L4.23999 10.46L4 10.03V7.53003L4.30005 7.06995L8.80005 5.06995H9.26001L11.76 6.56995ZM5 9.70996L6.5 10.61V9.28003L5 8.38V9.70996ZM5.57996 7.56006L7.03003 8.43005L10.42 6.93005L8.96997 6.06006L5.57996 7.56006ZM7.53003 10.73L11.03 9.17004V7.77002L7.53003 9.31995V10.73Z"})}),Cs=()=>e("svg",{viewBox:"0 0 16 16",fill:Ze("color-warning"),children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14 2H8L7 3V6H8V3H14V8H10V9H14L15 8V3L14 2ZM9 6H13V7H9.41L9 6.59V6ZM7 7H2L1 8V13L2 14H8L9 13V8L8 7H7ZM8 13H2V8H8V9V13ZM3 9H7V10H3V9ZM3 11H7V12H3V11ZM9 4H13V5H9V4Z"})}),Ns=()=>e("svg",{viewBox:"0 0 16 16",fill:Ze("color-primary"),children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 3L8 2H14L15 3V8L14 9H10V8H14V3H8V6H7V3ZM9 9V8L8 7H7H2L1 8V13L2 14H8L9 13V9ZM8 8V9V13H2V8H7H8ZM9.41421 7L9 6.58579V6H13V7H9.41421ZM9 4H13V5H9V4ZM7 10H3V11H7V10Z"})}),Or=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})}),ws=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 5.83 15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15z"})}),Ss=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10z"})}),$t=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})}),Ts=()=>e("svg",{viewBox:"0 0 24 24",children:e("path",{fill:"currentColor",d:"M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z",children:e("animateTransform",{attributeName:"transform",dur:"0.75s",repeatCount:"indefinite",type:"rotate",values:"0 12 12;360 12 12"})})}),Es=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"})}),As=()=>e("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"})}),Di=Object.freeze(Object.defineProperty({__proto__:null,AlarmIcon:cs,AlertIcon:rs,AlertingRuleIcon:ns,ArrowDownIcon:Ae,ArrowDropDownIcon:We,CalendarIcon:_r,ChartIcon:Rn,ClockIcon:Bt,CloseIcon:De,CodeIcon:Zt,CollapseIcon:Ss,CommentIcon:Es,CopyIcon:yt,DebugIcon:As,DeleteIcon:Pr,DetailsIcon:Ir,DoneIcon:Rr,DownloadIcon:Or,DragIcon:Hn,ErrorIcon:Pn,ExpandIcon:ws,FunctionIcon:_s,GroupIcon:ts,InfoIcon:ot,InfoOutlinedIcon:Kt,IssueIcon:ps,KeyboardIcon:ds,LabelIcon:Cs,LinkIcon:es,ListIcon:Ii,LogoAnomalyIcon:os,LogoIcon:ss,LogoShortIcon:is,MetricIcon:bs,MinusIcon:ms,MoreIcon:Fn,PlayCircleOutlineIcon:Dr,PlayIcon:it,PlusIcon:On,Prettify:hs,QuestionIcon:vs,RecordingRuleIcon:as,RefreshIcon:qt,RestartIcon:ut,SearchIcon:$t,SettingsIcon:mt,SpinnerIcon:Ts,StarBorderIcon:gs,StarIcon:ys,StorageIcon:Nr,SuccessIcon:ls,TableIcon:$r,TimelineIcon:Cr,TipIcon:Xt,TuneIcon:fs,ValueIcon:Ns,VisibilityIcon:zn,VisibilityOffIcon:us,WarningIcon:$n,WikiIcon:ht},Symbol.toStringTag,{value:"Module"})),$i=({to:t,isNavLink:r,children:n,...a})=>r?e(Oa,{to:t,...a,children:n}):e("div",{...a,children:n}),Pi=({activeItem:t,item:r,color:n=Ze("color-primary"),activeNavRef:a,onChange:s,isNavLink:o})=>{const i=l=>()=>{s&&s(l)};return e($i,{className:M({"vm-tabs-item":!0,"vm-tabs-item_active":t===r.value,[r.className||""]:r.className}),isNavLink:o,to:r.value,style:{color:n},onClick:i(r.value),ref:t===r.value?a:void 0,children:[r.icon&&e("div",{className:M({"vm-tabs-item__icon":!0,"vm-tabs-item__icon_single":!r.label}),children:r.icon}),r.label]})};function oe(t,r,n,a){const s=J(r);x(()=>{s.current=r},[r]),x(()=>{const o=n?.current??window;if(!(o&&o.addEventListener))return;const i=l=>s.current(l);return o.addEventListener(t,i,a),()=>{o.removeEventListener(t,i,a)}},[t,n,a])}const bt=()=>{const[t,r]=y({width:0,height:0}),n=()=>{r({width:window.innerWidth,height:window.innerHeight})};return oe("resize",n),x(n,[]),t},er=({activeItem:t,items:r,color:n=Ze("color-primary"),onChange:a,indicatorPlacement:s="bottom",isNavLink:o})=>{const i=bt(),l=J(null),[c,m]=y({left:0,width:0,bottom:0});return x(()=>{if(l.current?.base instanceof HTMLElement){const{offsetLeft:d,offsetWidth:u,offsetHeight:h}=l.current.base;m({left:d,width:u,bottom:s==="top"?h-2:0})}},[i,t,l,r]),e("div",{className:"vm-tabs",children:[r.map(d=>e(Pi,{activeItem:t,item:d,onChange:a,color:n,activeNavRef:l,isNavLink:o},d.value)),e("div",{className:"vm-tabs__indicator",style:{...c,borderColor:n}})]})},Et=[{value:ge.chart,icon:e(Rn,{}),label:"Graph",prometheusCode:0},{value:ge.code,icon:e(Zt,{}),label:"JSON",prometheusCode:3},{value:ge.table,icon:e($r,{}),label:"Table",prometheusCode:1}],xs=({tabFilter:t})=>{const{displayType:r}=Pe(),n=Pt(),a=o=>{n({type:"SET_DISPLAY_TYPE",payload:o??r})},s=Et.filter(t??(()=>!0));return e(er,{activeItem:r,items:s,onChange:a})},Ls=()=>{const t=he("g0.tab",0);return Et.find(n=>n.prometheusCode===+t||n.value===t)?.value||ge.chart},pa=Ve("SERIES_LIMITS"),Ri={displayType:Ls(),nocache:!1,isTracingEnabled:!1,seriesLimits:pa?JSON.parse(pa):Ba,tableCompact:Ve("TABLE_COMPACT")||!1,reduceMemUsage:!1};function Oi(t,r){switch(r.type){case"SET_DISPLAY_TYPE":return{...t,displayType:r.payload};case"SET_SERIES_LIMITS":return Ie("SERIES_LIMITS",JSON.stringify(r.payload)),{...t,seriesLimits:r.payload};case"TOGGLE_QUERY_TRACING":return{...t,isTracingEnabled:!t.isTracingEnabled};case"TOGGLE_NO_CACHE":return{...t,nocache:!t.nocache};case"TOGGLE_TABLE_COMPACT":return Ie("TABLE_COMPACT",!t.tableCompact),{...t,tableCompact:!t.tableCompact};case"TOGGLE_REDUCE_MEM_USAGE":return Ie("TABLE_COMPACT",!t.reduceMemUsage),{...t,reduceMemUsage:!t.reduceMemUsage};default:throw new Error}}const Vn=vt({}),Pe=()=>$e(Vn).state,Pt=()=>$e(Vn).dispatch,zi=({children:t})=>{const[r,n]=xt(Oi,Ri),a=D(()=>({state:r,dispatch:n}),[r,n]);return e(Vn.Provider,{value:a,children:t})},Hi={customStep:he("g0.step_input",""),yaxis:{limits:{enable:!1,range:{1:[0,0]}}},isHistogram:!1,isEmptyHistogram:!1,spanGaps:!1,openSettings:!1};function Fi(t,r){switch(r.type){case"TOGGLE_ENABLE_YAXIS_LIMITS":return{...t,yaxis:{...t.yaxis,limits:{...t.yaxis.limits,enable:!t.yaxis.limits.enable}}};case"SET_CUSTOM_STEP":return{...t,customStep:r.payload};case"SET_YAXIS_LIMITS":return{...t,yaxis:{...t.yaxis,limits:{...t.yaxis.limits,range:r.payload}}};case"SET_IS_HISTOGRAM":return{...t,isHistogram:r.payload};case"SET_IS_EMPTY_HISTOGRAM":return{...t,isEmptyHistogram:r.payload};case"SET_SPAN_GAPS":return{...t,spanGaps:r.payload};case"SET_OPEN_SETTINGS":return{...t,openSettings:r.payload};default:throw new Error}}const Un=vt({}),Me=()=>$e(Un).state,Xe=()=>$e(Un).dispatch,Vi=({children:t})=>{const[r,n]=xt(Fi,Hi),a=D(()=>({state:r,dispatch:n}),[r,n]);return e(Un.Provider,{value:a,children:t})},Ui={dashboardsSettings:[],dashboardsLoading:!1,dashboardsError:""};function qi(t,r){switch(r.type){case"SET_DASHBOARDS_SETTINGS":return{...t,dashboardsSettings:r.payload};case"SET_DASHBOARDS_LOADING":return{...t,dashboardsLoading:r.payload};case"SET_DASHBOARDS_ERROR":return{...t,dashboardsError:r.payload};default:throw new Error}}const qn=vt({}),ks=()=>$e(qn).state,Bi=()=>$e(qn).dispatch,Qi=({children:t})=>{const[r,n]=xt(qi,Ui),a=D(()=>({state:r,dispatch:n}),[r,n]);return e(qn.Provider,{value:a,children:t})},Ms={windows:"Windows",mac:"Mac OS",linux:"Linux"},ji=()=>Object.values(Ms).find(t=>navigator.userAgent.indexOf(t)>=0)||"unknown",zr=()=>ji()===Ms.mac,Yi=()=>["Android","webOS","iPhone","iPad","iPod","BlackBerry","Windows Phone"].map(n=>navigator.userAgent.match(new RegExp(n,"i"))).some(n=>n);function j(){const t=bt(),r=()=>{const s=Yi(),o=window.innerWidth<500;return s||o},[n,a]=y(r());return x(()=>{a(r())},[t]),{isMobile:n}}const Gi={success:e(ls,{}),error:e(Pn,{}),warning:e($n,{}),info:e(ot,{})},X=({variant:t,children:r})=>{const{isDarkTheme:n}=re(),{isMobile:a}=j();return e("div",{className:M({"vm-alert":!0,[`vm-alert_${t}`]:t,"vm-alert_dark":n,"vm-alert_mobile":a}),children:[e("div",{className:"vm-alert__icon",children:Gi[t||"info"]}),e("div",{className:"vm-alert__content",children:r})]})},Is=vt({showInfoMessage:()=>{}}),Ds=()=>$e(Is),Wi=({children:t})=>{const{isMobile:r}=j(),[n,a]=y({text:"",type:"info"}),[s,o]=y(!1),[i,l]=y(null);x(()=>{if(!i)return;a({...i,key:Date.now()}),o(!0);const m=setTimeout(c,i.timeout||4e3);return()=>clearTimeout(m)},[i]);const c=()=>{l(null),o(!1)};return e(Is.Provider,{value:{showInfoMessage:l},children:[s&&e("div",{className:M({"vm-snackbar":!0,"vm-snackbar_mobile":r}),children:e(X,{variant:n.type,children:e("div",{className:"vm-snackbar-content",children:[e("span",{children:n.text}),e("div",{className:"vm-snackbar-content__close",onClick:c,children:e(De,{})})]})})}),t]})},Ji=(...t)=>t.reduce((r,n)=>({children:a})=>e(r,{children:e(n,{children:a})}),({children:r})=>e(V,{children:r})),Ki=[ii,Ni,Mi,zi,Vi,Wi,Qi],$s=Ji(...Ki);var Qt=(t=>(t[t.internalLink=0]="internalLink",t[t.externalLink=1]="externalLink",t))(Qt||{});const Zi=t=>[{value:G.trace},{value:G.queryAnalyzer},{value:G.withTemplate},{value:G.relabel},{value:G.downsamplingDebug,hide:!t},{value:G.retentionDebug,hide:!t}],Xi=()=>[{value:G.metrics},{value:G.cardinality},{value:G.topQueries},{value:G.activeQueries}],el=()=>[{value:G.rules},{value:G.notifiers}],tl=({isEnterpriseLicense:t,showPredefinedDashboards:r,showAlerting:n})=>[{value:G.home},{value:G.rawQuery},{label:"Explore",submenu:Xi()},{label:"Tools",submenu:Zi(t)},{value:G.dashboards,hide:!r},{value:"Alerting",submenu:el(),hide:!n}],rl=()=>[{label:It[G.anomaly].title,value:G.home}],mn=({activeMenu:t,label:r,value:n,type:a,color:s})=>a===Qt.externalLink?e("a",{className:M({"vm-header-nav-item":!0,"vm-header-nav-item_active":t===n}),style:{color:s},href:n,target:"_blank",rel:"noreferrer",children:r}):e(Oa,{className:M({"vm-header-nav-item":!0,"vm-header-nav-item_active":t===n}),style:{color:s},to:n,children:r}),Hr=(t,r,n)=>{const a=K(s=>{const o=t?.current,i=s.target,l=n?.current&&n.current.contains(i);!o||o.contains(s?.target||null)||l||r(s)},[t,r]);oe("mouseup",a),oe("touchstart",a)},z=({variant:t="contained",color:r="primary",size:n="medium",ariaLabel:a,children:s,endIcon:o,startIcon:i,fullWidth:l=!1,className:c,disabled:m,onClick:d,onMouseDown:u,"data-id":h})=>{const v=M({"vm-button":!0,[`vm-button_${t}_${r}`]:!0,[`vm-button_${n}`]:n,"vm-button_icon_only":(i||o)&&!s,"vm-button_full-width":l,"vm-button_with-icons":i||o,[c||""]:c});return e("button",{className:v,disabled:m,"aria-label":a,onClick:d,onMouseDown:u,"data-id":h,children:[i,s,o]})},je=({children:t,buttonRef:r,placement:n="bottom-left",placementPosition:a,open:s=!1,onClose:o,offset:i={top:6,left:0},clickOutside:l=!0,fullWidth:c,title:m,disabledFullScreen:d,classes:u,variant:h})=>{const{isMobile:v}=j(),p=ft(),_=Ke(),[g,f]=y({width:0,height:0}),[b,C]=y(!1),N=J(null);x(()=>(C(s),!s&&o&&o(),s&&v&&!d&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow="auto"}),[s]),x(()=>{f({width:N?.current?.clientWidth||0,height:N?.current?.clientHeight||0}),C(!1)},[N]);const S=D(()=>{if(!r)return{};const L=r.current;if(!L||!b)return{};const $=L.getBoundingClientRect(),I={top:0,left:0,width:"auto"},R=n?.includes("right"),H=n?.includes("top"),O=n?.includes("center"),U=i?.top||0,W=i?.left||0;if(I.left=I.left=$.left+W,I.top=$.height+$.top+U,R&&(I.left=$.right-g.width),H&&(I.top=$.top-g.height-U),O&&(I.top=$.top+($.height-g.height)/2-U),n==="fixed"&&a)return I.top=Math.max(a.top+i.top,0),I.left=Math.max(a.left+i.left,0),I;const{innerWidth:ie,innerHeight:me}=window,Q=I.top+g.height>me,ae=I.top<0,ne=I.left+g.width>ie,F=I.left<0;return Q&&(I.top=$.top-g.height-U),ae&&(I.top=$.height+$.top+U),ne&&(I.left=$.right-g.width-W),F&&(I.left=$.left+W),c&&(I.width=`${$.width}px`),I.top<0&&(I.top=0),I.left<0&&(I.left=0),I},[r,n,b,t,c]),w=L=>{L.stopPropagation(),o()},T=()=>{C(!1),o()},E=()=>{l&&T()};x(()=>{if(!N.current||!b||v&&!d)return;const{right:L,width:$}=N.current.getBoundingClientRect();if(L>window.innerWidth){const I=window.innerWidth-$;N.current.style.left=`${I}px`}},[b,N,a]);const A=K(()=>{b&&v&&!d&&(p(_,{replace:!0}),o())},[b,v,d,_,o]);oe("scroll",T),oe("popstate",A),Hr(N,E,r);const k={};return(u||[]).forEach(L=>{k[L]=!0}),e(V,{children:(b||!g.width)&&Lt(e("div",{className:M({"vm-popper":!0,[`vm-popper_${h}`]:h,"vm-popper_mobile":v&&!d,"vm-popper_open":(v||Object.keys(S).length)&&b,...k}),ref:N,style:v&&!d?{}:S,children:[(m||v&&!d)&&e("div",{className:"vm-popper-header",children:[e("p",{className:"vm-popper-header__title",children:m}),e(z,{variant:"text",color:h==="dark"?"white":"primary",size:"small",onClick:w,ariaLabel:"close",children:e(De,{})})]}),t]}),document.body)})},ce=t=>{const[r,n]=y(!!t),a=K(()=>n(!0),[]),s=K(()=>n(!1),[]),o=K(()=>n(i=>!i),[]);return{value:r,setValue:n,setTrue:a,setFalse:s,toggle:o}},nl=({activeMenu:t,label:r,color:n,background:a,submenu:s,direction:o="row"})=>{const{pathname:i}=Ke(),[l,c]=y(null),m=J(null),{value:d,setFalse:u,setTrue:h}=ce(!1),v=()=>{(o==="row"||!d)&&h(),o==="column"&&d&&u(),o==="row"&&l&&clearTimeout(l)},p=()=>{l&&clearTimeout(l);const g=setTimeout(u,300);c(g)},_=()=>{l&&clearTimeout(l)};return x(()=>{u()},[i]),e("div",{className:M({"vm-header-nav-item_open":d}),style:{color:n},onMouseEnter:o==="column"?void 0:v,onMouseLeave:o==="column"?void 0:p,onClick:o==="column"?v:void 0,ref:m,children:[e("div",{className:M({"vm-header-nav-item":!0,"vm-header-nav-item_sub":!0,"vm-header-nav-item_active":s.find(g=>g.value===t)}),children:[r,e(We,{})]}),o==="column"?e("div",{className:"vm-header-nav-item-submenu",style:{background:a},children:s.map(g=>e(mn,{activeMenu:t,value:g.value||"",label:g.label||"",color:n,type:g.type||Qt.internalLink},g.value))}):e(je,{open:d,placement:"bottom-left",offset:{top:12,left:0},onClose:u,buttonRef:m,children:e("div",{className:"vm-header-nav-item-submenu",style:{background:a},onMouseLeave:p,onMouseEnter:_,children:s.map(g=>e(mn,{activeMenu:t,value:g.value||"",label:g.label||"",color:n,type:g.type||Qt.internalLink},g.value))})})]})},al=t=>{try{return t.replace(/^\/+/,"").replace(/-/g," ").trim().replace(/^\w/,r=>r.toUpperCase())}catch{return t}},Ps=t=>t.filter(r=>!r.hide).map(r=>{const n={...r};return n.value&&!n.label&&(n.label=It[n.value]?.title||al(n.value)),n.submenu&&n.submenu.length>0&&(n.submenu=Ps(n.submenu)),n}),sl=()=>{const t=xe(),{dashboardsSettings:r}=ks(),{serverUrl:n,appConfig:a}=re(),s=a.license?.type==="enterprise",o=a?.vmalert?.enabled||!1,i=!!(!t&&r.length),l=D(()=>({serverUrl:n,isEnterpriseLicense:s,showAlerting:o,showPredefinedDashboards:i}),[n,s,o,i]),c=D(()=>{switch(Mt){case gt.vmanomaly:return rl();default:return tl(l)}},[l]);return Ps(c)},Rs=({color:t,background:r,direction:n})=>{const{pathname:a}=Ke(),[s,o]=y(a),i=sl();return x(()=>{o(a)},[a]),e("nav",{className:M({"vm-header-nav":!0,[`vm-header-nav_${n}`]:n}),children:i.map(l=>l.submenu?e(nl,{activeMenu:s,label:l.label||"",submenu:l.submenu,color:t,background:r,direction:n},l.label):e(mn,{activeMenu:s,value:l.value||"",label:l.label||"",color:t,type:l.type||Qt.internalLink},l.value))})},Ce=({title:t,children:r,onClose:n,className:a,isOpen:s=!0})=>{const{isMobile:o}=j(),i=ft(),l=Ke(),c=K(h=>{s&&h.key==="Escape"&&n()},[s]),m=h=>{h.stopPropagation()},d=K(()=>{s&&(i(l,{replace:!0}),n())},[s,l,n]);return x(()=>{if(s)return document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}},[s]),oe("popstate",d),oe("keyup",c),Lt(e("div",{className:M({"vm-modal":!0,"vm-modal_mobile":o,[`${a}`]:a}),onMouseDown:n,children:e("div",{className:"vm-modal-content",onMouseDown:m,children:[e("div",{className:"vm-modal-content-header",children:[t&&e("div",{className:"vm-modal-content-header__title",children:t}),e("div",{className:"vm-modal-header__close",children:e(z,{variant:"text",size:"small",onClick:n,ariaLabel:"close",children:e(De,{})})})]}),e("div",{className:"vm-modal-content-body",tabIndex:0,children:r})]})}),document.body)},Y=({children:t,title:r,open:n,placement:a="bottom-center",offset:s={top:6,left:0}})=>{const{isMobile:o}=j(),[i,l]=y(!1),[c,m]=y({width:0,height:0}),d=J(null),u=J(null),h=()=>l(!1);x(()=>{if(!(!u.current||!i))return m({width:u.current.clientWidth,height:u.current.clientHeight}),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[i,r]);const v=D(()=>{const g=d?.current?.base;if(!g||!i)return{};const f=g.getBoundingClientRect(),b={top:0,left:0},C=a==="bottom-right"||a==="top-right",N=a==="bottom-left"||a==="top-left",S=a?.includes("top"),w=s?.top||0,T=s?.left||0;b.left=f.left-(c.width-f.width)/2+T,b.top=f.height+f.top+w,C&&(b.left=f.right-c.width),N&&(b.left=f.left+T),S&&(b.top=f.top-c.height-w);const{innerWidth:E,innerHeight:A}=window,k=20,L=b.top+c.height+k>A,$=b.top-k<0,I=b.left+c.width+k>E,R=b.left-k<0;return L&&(b.top=f.top-c.height-w),$&&(b.top=f.height+f.top+w),I&&(b.left=f.right-c.width-T),R&&(b.left=f.left+T),b.top<0&&(b.top=20),b.left<0&&(b.left=20),b},[d,a,i,c]),p=()=>{typeof n!="boolean"&&l(!0)},_=()=>{l(!1)};return x(()=>{typeof n=="boolean"&&l(n)},[n]),x(()=>{const g=d?.current?.base;if(g)return g.addEventListener("mouseenter",p),g.addEventListener("mouseleave",_),()=>{g.removeEventListener("mouseenter",p),g.removeEventListener("mouseleave",_)}},[d]),e(V,{children:[e(V,{ref:d,children:t}),!o&&i&&Lt(e("div",{className:"vm-tooltip",ref:u,style:v,children:r}),document.body)]})},hr=e("code",{children:zr()?"Cmd":"Ctrl"}),ol=[{title:"Zoom in",description:e(V,{children:["To zoom in, hold down the ",hr," + ",e("code",{children:"scroll up"}),", or press the ",e("code",{children:"+"}),". Also, you can zoom in on a range on the graph by holding down your mouse button and selecting the range."]})},{title:"Zoom out",description:e(V,{children:["To zoom out, hold down the ",hr," + ",e("code",{children:"scroll down"}),", or press the ",e("code",{children:"-"}),"."]})},{title:"Move horizontal axis",description:e(V,{children:["To move the graph, hold down the ",hr," + ",e("code",{children:"drag"})," the graph to the right or left."]})},{title:"Fixing a tooltip",description:e(V,{children:["To fix the tooltip, ",e("code",{children:"click"})," mouse when it's open. Then, you can drag the fixed tooltip by ",e("code",{children:"clicking"})," and ",e("code",{children:"dragging"})," on the ",e(Hn,{})," icon."]})},{title:"Set a custom range for the vertical axis",description:e(V,{children:["To set a custom range for the vertical axis, click on the ",e(mt,{})," icon located in the upper right corner of the graph, activate the toggle, and set the values."]})}],il=[{title:"Show/hide a legend item",description:e(V,{children:[e("code",{children:"click"})," on a legend item to isolate it on the graph.",hr," + ",e("code",{children:"click"})," on a legend item to remove it from the graph. To revert to the previous state, click again."]})},{title:"Copy label key-value pairs",description:e(V,{children:[e("code",{children:"click"})," on a label key-value pair to save it to the clipboard."]})},{title:"Collapse/Expand the legend group",description:e(V,{children:[e("code",{children:"click"})," on the group name (e.g. ",e("b",{children:'Query 1: {__name__!=""}'}),") to collapse or expand the legend."]})}],ll=ol.concat(il),Bn=()=>{const{value:t,setFalse:r,setTrue:n}=ce(!1);return e(V,{children:[e(Y,{title:"Show tips on working with the graph",children:e(z,{variant:"text",color:"gray",startIcon:e(Xt,{}),onClick:n,ariaLabel:"open the tips"})}),t&&e(Ce,{title:"Tips on working with the graph and the legend",onClose:r,children:e("div",{className:"fc-graph-tips",children:ll.map(({title:a,description:s})=>e("div",{className:"fc-graph-tips-item",children:[e("h4",{className:"fc-graph-tips-item__action",children:a}),e("p",{className:"fc-graph-tips-item__description",children:s})]},a))})})]})},lt=e("code",{children:zr()?"Cmd":"Ctrl"}),Os=e(V,{children:[e("code",{children:zr()?"Option":"Ctrl"})," + ",e("code",{children:"Space"})]}),cl=[{title:"Query",list:[{keys:e("code",{children:"Enter"}),description:"Run"},{keys:e(V,{children:[e("code",{children:"Shift"})," + ",e("code",{children:"Enter"})]}),description:"Multi-line queries"},{keys:e(V,{children:[lt," + ",e("code",{children:"Arrow Up"})]}),description:"Previous command from the Query history"},{keys:e(V,{children:[lt," + ",e("code",{children:"Arrow Down"})]}),description:"Next command from the Query history"},{keys:e(V,{children:[lt," + ",e("code",{children:"click"})," by ",e(zn,{})]}),description:"Toggle multiple queries"},{keys:Os,description:"Show quick autocomplete tips"}]},{title:"Graph",readMore:e(Bn,{}),list:[{keys:e(V,{children:[lt," + ",e("code",{children:"scroll Up"})," or ",e("code",{children:"+"})]}),description:"Zoom in"},{keys:e(V,{children:[lt," + ",e("code",{children:"scroll Down"})," or ",e("code",{children:"-"})]}),description:"Zoom out"},{keys:e(V,{children:[lt," + ",e("code",{children:"drag"})]}),description:"Move the graph left/right"},{keys:e(V,{children:e("code",{children:"click"})}),description:"Select the series in the legend"},{keys:e(V,{children:[lt," + ",e("code",{children:"click"})]}),description:"Toggle multiple series in the legend"}]}],Zr="Shortcut keys",un=zr(),dl=un?"Cmd + /":"F1",Qn=({showTitle:t})=>{const r=xe(),{value:n,setTrue:a,setFalse:s}=ce(!1),o=K(i=>{const l=un&&i.key==="/"&&i.metaKey,c=!un&&i.key==="F1"&&!i.metaKey;(l||c)&&a()},[a]);return oe("keydown",o),e(V,{children:[e(Y,{open:t===!0?!1:void 0,title:`${Zr} (${dl})`,placement:"bottom-center",children:e(z,{className:r?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(ds,{}),onClick:a,ariaLabel:Zr,children:t&&Zr})}),n&&e(Ce,{title:"Shortcut keys",onClose:s,children:e("div",{className:"vm-shortcuts",children:cl.map(i=>e("div",{className:"vm-shortcuts-section",children:[i.readMore&&e("div",{className:"vm-shortcuts-section__read-more",children:i.readMore}),e("h3",{className:"vm-shortcuts-section__title",children:i.title}),e("div",{className:"vm-shortcuts-section-list",children:i.list.map((l,c)=>e("div",{className:"vm-shortcuts-section-list-item",children:[e("div",{className:"vm-shortcuts-section-list-item__key",children:l.keys}),e("p",{className:"vm-shortcuts-section-list-item__description",children:l.description})]},`${i.title}_${c}`))})]},i.title))})})]})},ml=({open:t})=>e("button",{className:M({"vm-menu-burger":!0,"vm-menu-burger_opened":t}),"aria-label":"menu",children:e("span",{})}),ul=({background:t,color:r})=>{const{pathname:n}=Ke(),{isMobile:a}=j(),s=J(null),{value:o,toggle:i,setFalse:l}=ce(!1);return x(l,[n]),Hr(s,l),e("div",{className:"vm-header-sidebar",ref:s,children:[e("div",{className:M({"vm-header-sidebar-button":!0,"vm-header-sidebar-button_open":o}),onClick:i,children:e(ml,{open:o})}),e("div",{className:M({"vm-header-sidebar-menu":!0,"vm-header-sidebar-menu_open":o}),children:[e("div",{className:"vm-header-sidebar-scrollable",children:e(Rs,{color:r,background:t,direction:"column"})}),e("div",{className:"vm-header-sidebar-menu-settings",children:!a&&e(Qn,{showTitle:!0})})]})]})},hl=t=>`${Zo(t)}/admin/tenants`,pl=()=>{const{useTenantID:t}=Gt(),r=xe(),{serverUrl:n}=re(),[a,s]=y(!1),[o,i]=y(),[l,c]=y([]),m=D(()=>hl(n),[n]),d=D(()=>!!xr(n),[n]),u=r?!t:!d;return x(()=>{if(u)return;(async()=>{s(!0);try{const v=await fetch(m),p=await v.json(),_=p.data||[];c(_.sort((g,f)=>g.localeCompare(f))),v.ok?i(void 0):i(`${p.errorType}\r
${p?.error}`)}catch(v){v instanceof Error&&i(`${v.name}: ${v.message}`)}s(!1)})().catch(console.error)},[m]),{accountIds:l,isLoading:a,error:o}},vl=({controlsComponent:t,isMobile:r,...n})=>{const a=xe(),{pathname:s}=Ke(),{accountIds:o}=pl(),{value:i,toggle:l,setFalse:c}=ce(!1),m=D(()=>(It[s]||{}).header||{},[s]),d=e(t,{...n,isMobile:r,accountIds:o,headerSetup:m,closeModal:c});return r?e(V,{children:[e("div",{className:"vm-header-controls vm-header-controls_mobile",children:e(z,{className:M({"vm-header-button":!a}),startIcon:e(Fn,{}),onClick:l,ariaLabel:"controls"})}),e(Ce,{title:"Controls",onClose:c,isOpen:i,className:M({"vm-header-controls-modal":!0,"vm-header-controls-modal_open":i}),children:d})]}):d},fl=()=>{switch(Mt){case gt.vmanomaly:return e(os,{});default:return e(ss,{})}},zs=({controlsComponent:t})=>{const{isMobile:r}=j(),n=bt(),a=D(()=>window.innerWidth<1230,[n]),{isDarkTheme:s}=re(),o=xe(),i=D(()=>Ze(s?"color-background-block":"color-primary"),[s]),{background:l,color:c}=D(()=>{const{headerStyles:{background:u=o?"#FFF":i,color:h=o?i:"#FFF"}={}}=Gt();return{background:u,color:h}},[i]),m=ft(),d=()=>{m({pathname:G.home}),window.location.reload()};return e("header",{className:M({"vm-header":!0,"vm-header_app":o,"vm-header_dark":s,"vm-header_sidebar":a,"vm-header_mobile":r}),style:{background:l,color:c},children:[e("div",{className:M({"vm-header-logo":!0,"vm-header-logo_mobile":a}),onClick:d,style:{color:c},children:e(fl,{})}),a?e(ul,{background:l,color:c}):e(Rs,{color:c,background:l}),e(vl,{controlsComponent:t,displaySidebar:a,isMobile:r,closeModal:()=>{}})]})},gl={href:"https://github.com/VictoriaMetrics/VictoriaMetrics/issues/new/choose",Icon:ps,title:"Create an issue"},yl=[{href:"https://docs.victoriametrics.com/victoriametrics/metricsql/",Icon:Zt,title:"MetricsQL"},{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#vmui",Icon:ht,title:"Documentation"},gl],Hs=jo(({links:t=yl})=>{const r=`2019-${new Date().getFullYear()}`,{appConfig:n}=re(),a=n?.version;return e("footer",{className:"vm-footer",children:[e("a",{className:"vm-link vm-footer__link",target:"_blank",href:"https://victoriametrics.com/",rel:"me noreferrer",children:[e(is,{}),"victoriametrics.com"]}),t.map(({href:s,Icon:o,title:i})=>e("a",{className:"vm-link vm-footer__link",target:"_blank",href:s,rel:"help noreferrer",children:[e(o,{}),i]},`${s}-${i}`)),e("div",{className:"vm-footer__copyright",children:[" ",r," VictoriaMetrics.",a&&e("span",{className:"vm-footer__version",children:["Version: ",a]})]})]})}),bl=async t=>await(await fetch(`./dashboards/${t}`)).json(),_l=()=>{const t=xe(),{serverUrl:r}=re(),n=Bi(),[a,s]=y(!1),[o,i]=y(""),[l,c]=y([]),m=async()=>{try{const u=window.__VMUI_PREDEFINED_DASHBOARDS__;if(!u?.length)return[];const h=await Promise.all(u.map(async v=>bl(v)));c(v=>[...h,...v])}catch(u){u instanceof Error&&i(`${u.name}: ${u.message}`)}},d=async()=>{if(r){i(""),s(!0);try{const u=await fetch(`${r}/vmui/custom-dashboards`),h=await u.json();if(u.ok){const{dashboardsSettings:v}=h;v&&v.length>0?c(p=>[...p,...v]):await m(),s(!1)}else await m(),i(h.error),s(!1)}catch(u){s(!1),u instanceof Error&&i(`${u.name}: ${u.message}`),await m()}}};return x(()=>{t||(c([]),d())},[r]),x(()=>{n({type:"SET_DASHBOARDS_SETTINGS",payload:l})},[l]),x(()=>{n({type:"SET_DASHBOARDS_LOADING",payload:a})},[a]),x(()=>{n({type:"SET_DASHBOARDS_ERROR",payload:o})},[o]),{dashboardsSettings:l,isLoading:a,error:o}},Cl=({error:t,warning:r,info:n})=>{const a=J(null),[s,o]=y(!1),[i,l]=y(!1),m=`${D(()=>t?"ERROR: ":r?"WARNING: ":"",[t,r])}${t||r||n}`,d=()=>{const h=a.current;if(h){const{offsetWidth:v,scrollWidth:p,offsetHeight:_,scrollHeight:g}=h,f=v+1<p||_+1<g;o(f)}else o(!1)},u=()=>{s&&(l(!0),o(!1))};return x(()=>{l(!1),d()},[a,m]),oe("resize",d),!t&&!r&&!n?null:e("span",{className:M({"vm-text-field__error":!0,"vm-text-field__warning":r&&!t,"vm-text-field__helper-text":!r&&!t,"vm-text-field__error_overflowed":s,"vm-text-field__error_full":i}),"data-show":!!m,ref:a,onClick:u,children:m})},se=({label:t,value:r,type:n="text",error:a="",warning:s="",helperText:o="",placeholder:i,endIcon:l,startIcon:c,disabled:m=!1,autofocus:d=!1,inputmode:u="text",caretPosition:h,onChange:v,onEnter:p,onKeyDown:_,onFocus:g,onBlur:f,onChangeCaret:b})=>{const{isDarkTheme:C}=re(),{isMobile:N}=j(),S=J(null),w=J(null),T=D(()=>n==="textarea"?w:S,[n]),E=M({"vm-text-field__input":!0,"vm-text-field__input_error":a,"vm-text-field__input_warning":!a&&s,"vm-text-field__input_icon-start":c,"vm-text-field__input_textarea":n==="textarea"}),A=U=>{if(!b)return;const{selectionStart:W,selectionEnd:ie}=U;b&&b([W||0,ie||0])},k=U=>{A(U.currentTarget)},L=U=>{_&&_(U);const{key:W,ctrlKey:ie,metaKey:me}=U,Q=W==="Enter";(n!=="textarea"?Q:Q&&(me||ie))&&p&&(U.preventDefault(),p())},$=U=>{A(U.currentTarget)},I=U=>{m||(v&&v(U.currentTarget.value),A(U.currentTarget))},R=()=>{g&&g()},H=()=>{f&&f()},O=U=>{try{T.current&&T.current.setSelectionRange(U[0],U[1])}catch(W){return W}};return x(()=>{!d||N||T?.current?.focus&&T.current.focus()},[T,d]),x(()=>{h&&O(h)},[h]),e("label",{className:M({"vm-text-field":!0,"vm-text-field_textarea":n==="textarea","vm-text-field_dark":C,"vm-text-field_disabled":m}),"data-replicated-value":r,children:[c&&e("div",{className:"vm-text-field__icon-start",children:c}),l&&e("div",{className:"vm-text-field__icon-end",children:l}),t&&e("span",{className:"vm-text-field__label",children:t}),n==="textarea"?e("textarea",{className:E,disabled:m,ref:w,value:r,rows:1,inputMode:u,placeholder:i,autoCapitalize:"none",onInput:I,onKeyDown:L,onKeyUp:$,onFocus:R,onBlur:H,onMouseUp:k}):e("input",{className:E,disabled:m,ref:S,value:r,type:n,placeholder:i,inputMode:u,autoCapitalize:"none",onInput:I,onKeyDown:L,onKeyUp:$,onFocus:R,onBlur:H,onMouseUp:k}),e(Cl,{error:a,warning:s,info:o})]})},Fs=({accountIds:t})=>{const r=xe(),{isMobile:n}=j(),{tenantId:a,serverUrl:s}=re(),o=Dt(),i=Qe(),[l,c]=y(""),m=J(null),{value:d,toggle:u,setFalse:h}=ce(!1),v=D(()=>{if(!l)return t;try{const g=new RegExp(l,"i");return t.filter(b=>g.test(b)).sort((b,C)=>(b.match(g)?.index||0)-(C.match(g)?.index||0))}catch{return[]}},[l,t]),p=D(()=>{const g=!t.length,f=t.length===1&&t[0]==="0:0";return!g&&!f},[t]),_=g=>()=>{const f=g;if(o({type:"SET_TENANT_ID",payload:f}),s){const b=Ua(s,f);if(b===s)return;o({type:"SET_SERVER",payload:b}),i({type:"RUN_QUERY"})}h()};return x(()=>{const g=xr(s);a&&a!==g?_(a)():_(g)()},[s]),p?e("div",{className:"vm-tenant-input",children:[e(Y,{title:"Define Tenant ID if you need request to another storage",children:e("div",{ref:m,children:n?e("div",{className:"vm-mobile-option",onClick:u,children:[e("span",{className:"vm-mobile-option__icon",children:e(Nr,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Tenant ID"}),e("span",{className:"vm-mobile-option-text__value",children:a})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ae,{})})]}):e(z,{className:r?"":"vm-header-button",variant:"contained",color:"primary",fullWidth:!0,startIcon:e(Nr,{}),endIcon:e("div",{className:M({"vm-execution-controls-buttons__arrow":!0,"vm-execution-controls-buttons__arrow_open":d}),children:e(Ae,{})}),onClick:u,children:a})})}),e(je,{open:d,placement:"bottom-right",onClose:h,buttonRef:m,title:n?"Define Tenant ID":void 0,children:e("div",{className:M({"vm-list vm-tenant-input-list":!0,"vm-list vm-tenant-input-list_mobile":n}),children:[e("div",{className:"vm-tenant-input-list__search",children:e(se,{autofocus:!0,label:"Search",value:l,onChange:c,type:"search"})}),v.map(g=>e("div",{className:M({"vm-list-item":!0,"vm-list-item_mobile":n,"vm-list-item_active":g===a}),onClick:_(g),children:g},g))]})})]}):null};function jt(t){const r=J();return x(()=>{r.current=t},[t]),r.current}const Se=({text:t,href:r,children:n,colored:a=!0,underlined:s=!1,withIcon:o=!1})=>e("a",{href:r,className:M({"vm-link":!0,"vm-link_colored":a,"vm-link_underlined":s,"vm-link_with-icon":o}),target:"_blank",rel:"noreferrer",children:t||n}),Vs=()=>{const t=xe(),{isMobile:r}=j(),{customStep:n,isHistogram:a}=Me(),{period:{step:s,end:o,start:i}}=pe(),l=Xe(),{displayType:c}=Pe(),m=jt(o-i),d=D(()=>Wt(o-i,a,c),[o,i,a,c]),u=jt(d),[h,v]=y(n||d),[p,_]=y(""),g=n===d,{value:f,toggle:b,setFalse:C}=ce(!1),N=J(null),S=L=>{const $=L||h||d||"1s",R=($.match(/[a-zA-Z]+/g)||[]).length?$:`${$}s`;l({type:"SET_CUSTOM_STEP",payload:R}),v(R),_("")},w=()=>{S(),C()},T=()=>{document.activeElement instanceof HTMLInputElement&&document.activeElement.select()},E=()=>{S(),w()},A=L=>{const $=L.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/g)||[],I=L.match(/[a-zA-Z]+/g)||[],R=$.length&&$.every(U=>parseFloat(U)>0),H=I.every(U=>An.find(W=>W.short===U)),O=R&&H;v(L),_(O?"":_e.validStep)},k=()=>{const L=d||"1s";A(L),S(L)};return x(()=>{n&&S(n)},[n]),x(()=>{!n&&d&&S(d)},[d]),x(()=>{o-i===m||!m||n!==u||d&&S(d)},[m,d]),x(()=>{(s===n||s===d)&&S(d)},[a,c]),e("div",{className:"vm-step-control",ref:N,children:[r?e("div",{className:"vm-mobile-option",onClick:b,children:[e("span",{className:"vm-mobile-option__icon",children:e(Cr,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Step"}),e("span",{className:"vm-mobile-option-text__value",children:h})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ae,{})})]}):e(z,{className:t?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(Cr,{}),onClick:b,children:["Step: ",g?`auto (${h})`:h]}),e(je,{open:f,placement:"bottom-right",onClose:w,buttonRef:N,title:r?"Query resolution step width":void 0,children:e("div",{className:M({"vm-step-control-popper":!0,"vm-step-control-popper_mobile":r}),children:[e(se,{autofocus:!0,label:"Step value",value:h,error:p,onChange:A,onEnter:E,onFocus:T,onBlur:S,endIcon:e(Y,{title:`Reset to auto step (${d})`,children:e(z,{size:"small",variant:"text",color:"primary",startIcon:e(ut,{}),onClick:k,ariaLabel:"reset step"})})}),e("div",{className:"vm-step-control-popper-info",children:[e("p",{children:[e("code",{children:"step"})," - the ",e(Se,{href:"https://prometheus.io/docs/prometheus/latest/querying/basics/#time-durations",text:"interval"})," between datapoints, which must be returned from the range query. The ",e("code",{children:"query"})," is executed at ",e("code",{children:"start"}),", ",e("code",{children:"start+step"}),", ",e("code",{children:"start+2*step"}),", , ",e("code",{children:"end"})," timestamps."]}),e("p",{children:["Read more about ",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#range-query",text:"Range"})," and ",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#instant-query",text:"Instant"})," queries."]})]})]})})]})},Nl=({relativeTime:t,setDuration:r})=>{const{isMobile:n}=j(),a=s=>()=>{r(s)};return e("div",{className:M({"vm-time-duration":!0,"vm-time-duration_mobile":n}),children:yr.map(({id:s,duration:o,until:i,title:l})=>e("div",{className:M({"vm-list-item":!0,"vm-list-item_mobile":n,"vm-list-item_active":s===t}),onClick:a({duration:o,until:i(),id:s}),children:l||o},s))})},wl=({hasPrev:t,hasNext:r,viewDate:n,showArrowNav:a,onChangeViewDate:s,toggleDisplayYears:o})=>{const i=()=>{s(n.subtract(1,"month"))},l=()=>{s(n.add(1,"month"))};return e("div",{className:"vm-calendar-header",children:[e("div",{className:"vm-calendar-header-left",onClick:o,children:[e("span",{className:"vm-calendar-header-left__date",children:n.format("MMMM YYYY")}),e("div",{className:"vm-calendar-header-left__select-year",children:e(We,{})})]}),a&&e("div",{className:"vm-calendar-header-right",children:[e("div",{className:M({"vm-calendar-header-right__prev":!0,"vm-calendar-header-right_disabled":!t}),onClick:t?i:void 0,children:e(Ae,{})}),e("div",{className:M({"vm-calendar-header-right__next":!0,"vm-calendar-header-right_disabled":!r}),onClick:r?l:void 0,children:e(Ae,{})})]})]})},Sl=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Tl=({minDate:t,maxDate:r,viewDate:n,selectDate:a,onChangeSelectDate:s})=>{const o="YYYY-MM-DD",i=q.tz(),l=q(n.format(o)),c=D(()=>{const d=new Array(42).fill(null),u=l.startOf("month"),v=l.endOf("month").diff(u,"day")+1,p=new Array(v).fill(u).map((g,f)=>g.add(f,"day")),_=u.day();return d.splice(_,v,...p),d},[l]),m=d=>()=>{d&&s(d)};return e("div",{className:"vm-calendar-body",children:[Sl.map(d=>e(Y,{title:d,children:e("div",{className:"vm-calendar-body-cell vm-calendar-body-cell_weekday",children:d[0]})},d)),c.map((d,u)=>{const h=d&&(t&&d.isBefore(t)||r&&d.isAfter(r));return e("div",{className:M({"vm-calendar-body-cell":!0,"vm-calendar-body-cell_day":!0,"vm-calendar-body-cell_day_empty":!d,"vm-calendar-body-cell_day_active":(d&&d.format(o))===a.format(o),"vm-calendar-body-cell_day_today":(d&&d.format(o))===i.format(o),"vm-calendar-body-cell_day_disabled":h}),onClick:h?void 0:m(d),children:d&&d.format("D")},d?d.format(o):u)})]})},El=({minDate:t,maxDate:r,viewDate:n,onChangeViewDate:a})=>{const s=q().format("YYYY"),o=D(()=>n.format("YYYY"),[n]),i=D(()=>{const d=q().subtract(18/2,"year");return new Array(18).fill(d).map((u,h)=>u.add(h,"year"))},[n]);x(()=>{const c=document.getElementById(`vm-calendar-year-${o}`);c&&c.scrollIntoView({block:"center"})},[]);const l=c=>()=>{a(c)};return e("div",{className:"vm-calendar-years",children:i.map(c=>{const m=c&&t&&c.isBefore(t)||r&&c.isAfter(r);return e("div",{className:M({"vm-calendar-years__year":!0,"vm-calendar-years__year_selected":c.format("YYYY")===o,"vm-calendar-years__year_today":c.format("YYYY")===s,"vm-calendar-years__year_disabled":m}),id:`vm-calendar-year-${c.format("YYYY")}`,onClick:m?void 0:l(c),children:c.format("YYYY")},c.format("YYYY"))})})},Al=({minDate:t,maxDate:r,viewDate:n,selectDate:a,onChangeViewDate:s})=>{const o=q().format("MM"),i=D(()=>a.format("MM"),[a]),l=D(()=>new Array(12).fill("").map((m,d)=>q(n).month(d)),[n]);x(()=>{const m=document.getElementById(`vm-calendar-year-${i}`);m&&m.scrollIntoView({block:"center"})},[]);const c=m=>()=>{s(m)};return e("div",{className:"vm-calendar-years",children:l.map(m=>{const d=m&&(t&&m.isBefore(t)||r&&m.isAfter(r));return e("div",{className:M({"vm-calendar-years__year":!0,"vm-calendar-years__year_selected":m.format("MM")===i,"vm-calendar-years__year_today":m.format("MM")===o,"vm-calendar-years__year_disabled":d}),id:`vm-calendar-year-${m.format("MM")}`,onClick:d?void 0:c(m),children:m.format("MMMM")},m.format("MM"))})})},xl=({date:t,minDate:r,maxDate:n,format:a=Fe,onChange:s})=>{const[o,i]=y(0),[l,c]=y(q.tz(t)),[m,d]=y(q.tz(t)),u=q.tz(),h=u.format(st)===l.format(st),{isMobile:v}=j(),p=r?q(r):void 0,_=n?q(n):void 0,g=()=>{i(N=>N===2?0:2)},f=N=>{c(N),i(S=>S===2?1:0)},b=N=>{d(N)},C=()=>{c(u)};return x(()=>{m.format()!==q.tz(t).format()&&s(m.format(a))},[m]),x(()=>{const N=q.tz(t);c(N),d(N)},[t]),e("div",{className:M({"vm-calendar":!0,"vm-calendar_mobile":v}),children:[e(wl,{viewDate:l,onChangeViewDate:f,toggleDisplayYears:g,showArrowNav:o===0,hasPrev:o===0&&(!p||l.startOf("month").isAfter(p)),hasNext:o===0&&(!_||l.endOf("month").isBefore(_))}),o===0&&e(Tl,{minDate:p,maxDate:_,viewDate:l,selectDate:m,onChangeSelectDate:b}),o===2&&e(El,{minDate:p,maxDate:_,viewDate:l,onChangeViewDate:f}),o===1&&e(Al,{minDate:p,maxDate:_,selectDate:m,viewDate:l,onChangeViewDate:f}),!h&&o===0&&e("div",{className:"vm-calendar-footer",children:e(z,{variant:"text",size:"small",onClick:C,children:"show today"})})]})},Us=Tr(({date:t,targetRef:r,format:n=Fe,onChange:a,label:s,minDate:o,maxDate:i},l)=>{const c=D(()=>q(t).isValid()?q.tz(t):q().tz(),[t]),{isMobile:m}=j(),{value:d,toggle:u,setFalse:h}=ce(!1),v=_=>{a(_),h()},p=_=>{(_.key==="Escape"||_.key==="Enter")&&h()};return oe("click",u,r),oe("keyup",p),e(V,{children:e(je,{open:d,buttonRef:r,placement:"bottom-right",onClose:h,title:m?s:void 0,children:e("div",{ref:l,children:e(xl,{date:c,format:n,onChange:v,minDate:o,maxDate:i})})})})}),va=(t,r)=>q(t).isValid()?q.tz(t).format(r):t,Ll={[Lr]:"9999-99-99T99:99:99",[st]:"9999-99-99",[Fe]:"9999-99-99 99:99:99"},fa=({value:t="",format:r=Fe,minDate:n,maxDate:a,label:s,pickerLabel:o,pickerRef:i,onChange:l,onEnter:c,disabled:m})=>{const d=J(null),[u,h]=y(null),v=Ll[r],[p,_]=y(va(t,r)),[g,f]=y(!1),[b,C]=y(!1),N=q(p).isValid()?"":"Invalid date format",S=A=>{_(A.currentTarget.value)},w=()=>{l(p)},T=A=>{A.key==="Enter"&&(l(p),C(!0))},E=A=>{_(A),f(!0)};return x(()=>{const A=va(t,r);A!==p&&_(A),b&&(c(),C(!1))},[t]),x(()=>{g&&u&&(u.focus(),u.setSelectionRange(11,11),f(!1))},[g]),e("div",{className:M({"vm-date-time-input":!0,"vm-date-time-input_error":N,"vm-date-time-input_disabled":m}),children:[e("label",{children:s}),e(Yo,{tabIndex:1,inputRef:h,mask:v,placeholder:r,value:p,autoCapitalize:"none",inputMode:"numeric",maskChar:null,onChange:S,onBlur:w,onKeyUp:T,disabled:m}),N&&e("span",{className:"vm-date-time-input__error-text",children:N}),e("div",{className:"vm-date-time-input__icon",ref:d,children:e(z,{variant:"text",color:"gray",size:"small",startIcon:e(_r,{}),ariaLabel:"calendar",disabled:m})}),e(Us,{label:o,ref:i,date:p,onChange:E,targetRef:d,minDate:n,maxDate:a,format:r})]})},qs=()=>{const{isMobile:t}=j(),{isDarkTheme:r}=re(),n=J(null),a=bt(),s=D(()=>a.width>1120,[a]),[o,i]=y(),[l,c]=y(),{period:{end:m,start:d},relativeTime:u,timezone:h,duration:v}=pe(),p=Qe(),_=xe(),g=jt(h),{value:f,toggle:b,setFalse:C}=ce(!1),N=D(()=>({region:h,utc:Vt(h)}),[h]);x(()=>{i(Ht(qe(m)))},[h,m]),x(()=>{c(Ht(qe(d)))},[h,d]);const S=({duration:R,until:H,id:O})=>{p({type:"SET_RELATIVE_TIME",payload:{duration:R,until:H,id:O}}),C()},w=D(()=>{const R=q.tz(qe(d)).format(Fe),H=q.tz(qe(m)).format(Fe);return{start:R,end:H}},[d,m,h]),T=D(()=>u&&u!=="none"?u.replace(/_/g," "):`${w.start} - ${w.end}`,[u,w]),E=J(null),A=J(null),k=J(null),L=()=>{l&&o&&p({type:"SET_PERIOD",payload:{from:q.tz(l).toDate(),to:q.tz(o).toDate()}}),C()},$=()=>p({type:"RUN_QUERY_TO_NOW"}),I=()=>{i(Ht(qe(m))),c(Ht(qe(d))),C()};return x(()=>{const R=kn({relativeTimeId:u,defaultDuration:v,defaultEndInput:qe(m)});g&&h!==g&&S({id:R.relativeTimeId,duration:R.duration,until:R.endInput})},[h,g]),Hr(n,R=>{if(t)return;const H=R.target,O=E?.current&&E?.current?.contains(H),U=A?.current&&A?.current?.contains(H);O||U||C()}),e(V,{children:[e("div",{ref:k,children:t?e("div",{className:"vm-mobile-option",onClick:b,children:[e("span",{className:"vm-mobile-option__icon",children:e(Bt,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Time range"}),e("span",{className:"vm-mobile-option-text__value",children:T})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ae,{})})]}):e(Y,{title:s?"Time range controls":T,children:e(z,{className:_?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(Bt,{}),onClick:b,ariaLabel:"time range controls",children:s&&e("span",{children:T})})})}),e(je,{open:f,buttonRef:k,placement:"bottom-right",onClose:C,clickOutside:!1,title:t?"Time range controls":"",children:e("div",{className:M({"vm-time-selector":!0,"vm-time-selector_mobile":t}),ref:n,children:[e("div",{className:"vm-time-selector-left",children:[e("div",{className:M({"vm-time-selector-left-inputs":!0,"vm-time-selector-left-inputs_dark":r}),children:[e(fa,{value:l,label:"From:",pickerLabel:"Date From",pickerRef:E,onChange:c,onEnter:L}),e(fa,{value:o,label:"To:",pickerLabel:"Date To",pickerRef:A,onChange:i,onEnter:L})]}),e("div",{className:"vm-time-selector-left-timezone",children:[e("div",{className:"vm-time-selector-left-timezone__title",children:N.region}),e("div",{className:"vm-time-selector-left-timezone__utc",children:N.utc})]}),e(z,{variant:"text",startIcon:e(cs,{}),onClick:$,children:"switch to now"}),e("div",{className:"vm-time-selector-left__controls",children:[e(z,{color:"error",variant:"outlined",onClick:I,children:"Cancel"}),e(z,{color:"primary",onClick:L,children:"Apply"})]})]}),e(Nl,{relativeTime:u||"",setDuration:S})]})})]})},et=()=>{const[t,r]=de();return{setSearchParamsFromKeys:K(a=>{const s=!!t.size,o=new URLSearchParams(t),i=t.toString();for(const[l,c]of Object.entries(a)){if(c==null||c===""){o.delete(l);continue}const d=String(c);o.get(l)!==d&&o.set(l,d)}i!==o.toString()&&r(o,{replace:!s})},[t,r])}},Bs=()=>{const{isMobile:t}=j(),r=xe(),n=J(null),[a]=de(),{setSearchParamsFromKeys:s}=et(),o=a.get("date")||q().tz().format(st),i=D(()=>q.tz(o).format(st),[o]),l=c=>{s({date:c})};return x(()=>{l(o)},[]),e("div",{children:[e("div",{ref:n,children:t?e("div",{className:"vm-mobile-option",children:[e("span",{className:"vm-mobile-option__icon",children:e(_r,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Date control"}),e("span",{className:"vm-mobile-option-text__value",children:i})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ae,{})})]}):e(Y,{title:"Date control",children:e(z,{className:r?"":"vm-header-button",variant:"contained",color:"primary",startIcon:e(_r,{}),children:i})})}),e(Us,{label:"Date control",date:o||"",format:st,onChange:l,targetRef:n})]})},Xr=[{seconds:0,title:"Off"},{seconds:1,title:"1s"},{seconds:2,title:"2s"},{seconds:5,title:"5s"},{seconds:10,title:"10s"},{seconds:30,title:"30s"},{seconds:60,title:"1m"},{seconds:300,title:"5m"},{seconds:900,title:"15m"},{seconds:1800,title:"30m"},{seconds:3600,title:"1h"},{seconds:7200,title:"2h"}],Qs=({tooltip:t,useAutorefresh:r,closeModal:n})=>{const{isMobile:a}=j(),s=Qe(),o=xe(),[i,l]=y(!1),[c,m]=y(Xr[0]),{value:d,toggle:u,setFalse:h}=ce(!1),v=J(null),p=f=>{(i&&!f.seconds||!i&&f.seconds)&&l(b=>!b),m(f),h()},_=()=>{s({type:"RUN_QUERY"}),!r&&a&&n()};x(()=>{const f=c.seconds;let b;return i?b=setInterval(()=>{s({type:"RUN_QUERY"})},f*1e3):m(Xr[0]),()=>{b&&clearInterval(b)}},[c,i]);const g=f=>()=>{p(f)};return e(V,{children:[e("div",{className:"vm-execution-controls",children:e("div",{className:M({"vm-execution-controls-buttons":!0,"vm-execution-controls-buttons_mobile":a,"vm-header-button":!o,"vm-autorefresh":r}),children:r?a?e("div",{className:"vm-mobile-option",onClick:u,children:[e("span",{className:"vm-mobile-option__icon",children:e(ut,{})}),e("div",{className:"vm-mobile-option-text",children:[e("span",{className:"vm-mobile-option-text__label",children:"Auto-refresh"}),e("span",{className:"vm-mobile-option-text__value",children:c.title})]}),e("span",{className:"vm-mobile-option__arrow",children:e(Ae,{})})]}):e(V,{children:[e(Y,{title:t,children:e(z,{variant:"contained",color:"primary",onClick:_,startIcon:e(qt,{}),ariaLabel:t})}),e(Y,{title:"Auto-refresh control",children:e("div",{ref:v,children:e(z,{variant:"contained",color:"primary",fullWidth:!0,endIcon:e("div",{className:M({"vm-execution-controls-buttons__arrow":!0,"vm-execution-controls-buttons__arrow_open":d}),children:e(Ae,{})}),onClick:u,children:c.title})})})]}):a?e("div",{className:"vm-mobile-option",onClick:_,children:[e("span",{className:"vm-mobile-option__icon",children:e(ut,{})}),e("div",{className:"vm-mobile-option-text",children:e("span",{className:"vm-mobile-option-text__label",children:"Refresh"})})]}):e(z,{variant:"contained",color:"primary",onClick:_,startIcon:e(qt,{}),ariaLabel:t})})}),r&&e(je,{open:d,placement:"bottom-right",onClose:h,buttonRef:v,title:a?"Auto-refresh duration":void 0,children:e("div",{className:M({"vm-execution-controls-list":!0,"vm-execution-controls-list_mobile":a}),children:Xr.map(f=>e("div",{className:M({"vm-list-item":!0,"vm-list-item_mobile":a,"vm-list-item_active":f.seconds===c.seconds}),onClick:g(f),children:f.title},f.seconds))})})]})},ga={enable:"Enable to save the modified server URL to local storage, preventing reset upon page refresh.",disable:"Disable to stop saving the server URL to local storage, reverting to the default URL on page refresh."},kl=Tr(({onClose:t},r)=>{const{serverUrl:n}=re(),a=Dt(),{value:s,toggle:o}=ce(!!Ve("SERVER_URL")),[i,l]=y(n),[c,m]=y(""),d=h=>{l(h||""),m("")},u=K(()=>{const h=xr(i);h!==""&&a({type:"SET_TENANT_ID",payload:h}),a({type:"SET_SERVER",payload:i}),t()},[i]);return x(()=>{n||m(_e.emptyServer),Tn(n)||m(_e.validServer)},[n]),x(()=>{s?Ie("SERVER_URL",i):wn(["SERVER_URL"])},[s]),x(()=>{s&&Ie("SERVER_URL",i)},[i]),x(()=>{n!==i&&l(n)},[n]),_n(r,()=>({handleApply:u}),[u]),e("div",{children:[e("div",{className:"vm-server-configurator__title",children:"Server URL"}),e("div",{className:"vm-server-configurator-url",children:[e(se,{autofocus:!0,value:i,error:c,onChange:d,onEnter:u,inputmode:"url"}),e(Y,{title:s?ga.disable:ga.enable,children:e(z,{className:"vm-server-configurator-url__button",variant:"text",color:s?"primary":"gray",onClick:o,startIcon:e(Nr,{})})})]})]})}),Ml=[{label:"Graph",type:ge.chart},{label:"JSON",type:ge.code},{label:"Table",type:ge.table}],Il=Tr(({onClose:t},r)=>{const{isMobile:n}=j(),{seriesLimits:a}=Pe(),s=Pt(),[o,i]=y(a),[l,c]=y({table:"",chart:"",code:""}),m=()=>{i(Ba)},d=h=>v=>{const p=v||"";c(_=>({..._,[h]:+p<0?_e.positiveNumber:""})),i({...o,[h]:p||1/0})},u=K(()=>{s({type:"SET_SERIES_LIMITS",payload:o}),t()},[o]);return _n(r,()=>({handleApply:u}),[u]),e("div",{className:"vm-limits-configurator",children:[e("div",{className:"vm-server-configurator__title",children:["Series limits by tabs",e(Y,{title:"Set to 0 to disable the limit",children:e(z,{variant:"text",color:"primary",size:"small",startIcon:e(ot,{})})}),e("div",{className:"vm-limits-configurator-title__reset",children:e(z,{variant:"text",color:"primary",size:"small",startIcon:e(ut,{}),onClick:m,children:"Reset limits"})})]}),e("div",{className:M({"vm-limits-configurator__inputs":!0,"vm-limits-configurator__inputs_mobile":n}),children:Ml.map(h=>e("div",{children:e(se,{label:h.label,value:o[h.type],error:l[h.type],onChange:d(h.type),onEnter:u,type:"number"})},h.type))})]})}),_t=({defaultExpanded:t=!1,onChange:r,title:n,children:a,id:s})=>{const[o,i]=y(t),l=c=>{const m=window.getSelection();if(c.target.closest("button")){c.preventDefault();return}if(m&&m.toString()){c.preventDefault();return}const d=c.currentTarget.parentElement;r&&r(d.open),i(d.open)};return x(()=>{i(t)},[t]),e(V,{children:e("details",{className:"vm-accordion-section",open:o,id:s,children:[e("summary",{className:"vm-accordion-header",onClick:l,children:[n,e("div",{className:"vm-accordion-header__arrow",children:e(Ae,{})})]}),a]},"content")})},Dl="Browser timezone is not recognized, supported, or could not be determined.",$l=()=>e(Y,{title:Dl,children:e($n,{})}),sr=Mn(),Pl=Tr((t,r)=>{const{isMobile:n}=j(),a=ma(),{timezone:s,defaultTimezone:o}=pe(),i=Qe(),[l,c]=y(s),[m,d]=y(""),u=J(null),{value:h,toggle:v,setFalse:p}=ce(!1),_=D(()=>[{title:`Default time (${o})`,region:o,utc:o?Vt(o):"UTC"},{title:sr.title,region:sr.region,utc:Vt(sr.region),isInvalid:!sr.isValid},{title:"UTC (Coordinated Universal Time)",region:"UTC",utc:"UTC"}].filter(w=>w.region),[o]),g=D(()=>{if(!m)return a;try{return ma(m)}catch{return{}}},[m,a]),f=D(()=>Object.keys(g),[g]),b=D(()=>({region:l,utc:Vt(l)}),[l]),C=w=>{d(w)},N=w=>{c(w.region),d(""),p()},S=w=>()=>{N(w)};return x(()=>{c(s)},[s]),_n(r,()=>({handleApply:()=>{i({type:"SET_TIMEZONE",payload:l})}}),[l]),e("div",{className:"vm-timezones",children:[e("div",{className:"vm-server-configurator__title",children:"Time zone"}),e("div",{className:"vm-timezones-item vm-timezones-item_selected",onClick:v,ref:u,children:[e("div",{className:"vm-timezones-item__title",children:b.region}),e("div",{className:"vm-timezones-item__utc",children:b.utc}),e("div",{className:M({"vm-timezones-item__icon":!0,"vm-timezones-item__icon_open":h}),children:e(We,{})})]}),e(je,{open:h,buttonRef:u,placement:"bottom-left",onClose:p,fullWidth:!0,title:n?"Time zone":void 0,children:e("div",{className:M({"vm-timezones-list":!0,"vm-timezones-list_mobile":n}),children:[e("div",{className:"vm-timezones-list-header",children:[e("div",{className:"vm-timezones-list-header__search",children:e(se,{autofocus:!0,label:"Search",value:m,onChange:C})}),_.map((w,T)=>w&&e("div",{className:"vm-timezones-item vm-timezones-list-group-options__item",onClick:S(w),children:[e("div",{className:"vm-timezones-item__title",children:[w.title,w.isInvalid&&e($l,{})]}),e("div",{className:"vm-timezones-item__utc",children:w.utc})]},`${T}_${w.region}`))]}),f.map(w=>e("div",{className:"vm-timezones-list-group",children:e(_t,{defaultExpanded:!0,title:e("div",{className:"vm-timezones-list-group__title",children:w}),children:e("div",{className:"vm-timezones-list-group-options",children:g[w]&&g[w].map(T=>e("div",{className:"vm-timezones-item vm-timezones-list-group-options__item",onClick:S(T),children:[e("div",{className:"vm-timezones-item__title",children:T.region}),e("div",{className:"vm-timezones-item__utc",children:T.utc})]},T.search))})})},w))]})})]})}),Rl=({options:t,value:r,label:n,onChange:a})=>{const s=J(null),[o,i]=y({width:"0px",left:"0px",borderRadius:"0px"}),l=c=>()=>{a(c)};return x(()=>{if(!s.current){i({width:"0px",left:"0px",borderRadius:"0px"});return}const c=t.findIndex(v=>v.value===r),{width:m}=s.current.getBoundingClientRect();let d=m,u=c*d,h="0";c===0&&(h="16px 0 0 16px"),c===t.length-1&&(h="10px",u-=1,h="0 16px 16px 0"),c!==0&&c!==t.length-1&&(d+=1,u-=1),i({width:`${d}px`,left:`${u}px`,borderRadius:h})},[s,r,t]),e("div",{className:"vm-toggles",children:[n&&e("label",{className:"vm-toggles__label",children:n}),e("div",{className:"vm-toggles-group",style:{gridTemplateColumns:`repeat(${t.length}, 1fr)`},children:[o.borderRadius&&e("div",{className:"vm-toggles-group__highlight",style:o}),t.map((c,m)=>e("div",{className:M({"vm-toggles-group-item":!0,"vm-toggles-group-item_first":m===0,"vm-toggles-group-item_active":c.value===r,"vm-toggles-group-item_icon":c.icon&&c.title}),onClick:l(c.value),ref:c.value===r?s:null,children:[c.icon,c.title]},c.value))]})]})},Ol=Object.values(ze).map(t=>({title:t,value:t})),zl=()=>{const{isMobile:t}=j(),r=Dt(),{theme:n}=re(),a=s=>{r({type:"SET_THEME",payload:s})};return e("div",{className:M({"vm-theme-control":!0,"vm-theme-control_mobile":t}),children:[e("div",{className:"vm-server-configurator__title",children:"Theme preferences"}),e("div",{className:"vm-theme-control__toggle",children:e(Rl,{options:Ol,value:n,onChange:a})},`${t}`)]})},en="Settings",js=()=>{const{isMobile:t}=j(),r=xe(),n=J(null),a=J(null),s=J(null),{value:o,setTrue:i,setFalse:l}=ce(!1),c=()=>{n.current&&n.current.handleApply(),a.current&&a.current.handleApply(),s.current&&s.current.handleApply(),l()},m=[{show:!r,component:e(kl,{ref:n,onClose:l})},{show:!0,component:e(Il,{ref:a,onClose:l})},{show:!0,component:e(Pl,{ref:s})},{show:!r,component:e(zl,{})}].filter(d=>d.show);return e(V,{children:[t?e("div",{className:"vm-mobile-option",onClick:i,children:[e("span",{className:"vm-mobile-option__icon",children:e(mt,{})}),e("div",{className:"vm-mobile-option-text",children:e("span",{className:"vm-mobile-option-text__label",children:en})}),e("span",{className:"vm-mobile-option__arrow",children:e(Ae,{})})]}):e(Y,{title:en,children:e(z,{className:M({"vm-header-button":!r}),variant:"contained",color:"primary",startIcon:e(mt,{}),onClick:i,ariaLabel:"settings"})}),o&&e(Ce,{title:en,onClose:l,children:e("div",{className:M({"vm-server-configurator":!0,"vm-server-configurator_mobile":t}),children:[m.map((d,u)=>e("div",{className:"vm-server-configurator__input",children:d.component},u)),e("div",{className:"vm-server-configurator-footer",children:[e(z,{color:"error",variant:"outlined",onClick:l,children:"Cancel"}),e(z,{color:"primary",variant:"contained",onClick:c,children:"Apply"})]})]})})]})},Hl=({displaySidebar:t,isMobile:r,headerSetup:n,accountIds:a,closeModal:s})=>e("div",{className:M({"vm-header-controls":!0,"vm-header-controls_mobile":r}),children:[n?.tenant&&e(Fs,{accountIds:a||[]}),n?.stepControl&&e(Vs,{}),n?.timeSelector&&e(qs,{}),n?.cardinalityDatePicker&&e(Bs,{}),n?.executionControls&&e(Qs,{tooltip:n?.executionControls?.tooltip,useAutorefresh:n?.executionControls?.useAutorefresh,closeModal:s}),e(js,{}),!t&&e(Qn,{})]}),Fl=!!Ve("DISABLED_DEFAULT_TIMEZONE"),Ys=()=>{const{serverUrl:t}=re(),r=Qe(),[n,a]=y(!1),[s,o]=y(""),i=c=>{const m=c.toLowerCase()==="local"?Mn().region:c;try{if(q().tz(m).isValid(),r({type:"SET_DEFAULT_TIMEZONE",payload:m}),Fl)return;r({type:"SET_TIMEZONE",payload:m})}catch(d){d instanceof Error&&o(`${d.name}: ${d.message}`)}},l=async()=>{if(t){o(""),a(!0);try{const c=await fetch(`${t}/vmui/timezone`),m=await c.json();c.ok?(i(m.timezone),a(!1)):(o(m.error),a(!1))}catch(c){a(!1),c instanceof Error&&o(`${c.name}: ${c.message}`)}}};return x(()=>{l()},[t]),{isLoading:n,error:s}},Vl=()=>{const{serverUrl:t}=re(),r=Dt(),[n,a]=y(!1),[s,o]=y("");return x(()=>{(async()=>{o(""),a(!0);try{const c=await(await fetch(`${t}/vmui/config.json`)).json();r({type:"SET_APP_CONFIG",payload:c||{}})}catch(l){a(!1),l instanceof Error&&o(`${l.name}: ${l.message}`)}})()},[t]),{isLoading:n,error:s}},Ul=()=>{const t=xe(),{isMobile:r}=j(),{pathname:n}=Ke(),[a,s]=de();_l(),Ys(),Vl();const o=()=>{const l="vmui",c=It[n]?.title;document.title=c?`${c} - ${l}`:l},i=()=>{const{search:l,href:c}=window.location;if(l){const d=bn.parse(l,{ignoreQueryPrefix:!0});Object.entries(d).forEach(([u,h])=>a.set(u,h)),s(a),window.location.search=""}const m=c.replace(/\/\?#\//,"/#/");m!==c&&window.location.replace(m)};return x(o,[n]),x(i,[]),e("section",{className:"vm-container",children:[e(zs,{controlsComponent:Hl}),e("div",{className:M({"vm-container-body":!0,"vm-container-body_mobile":r,"vm-container-body_app":t}),children:e(za,{})}),!t&&e(Hs,{})]})},ql=`No match! 
This query hasn't selected any time series from database.
Either the requested metrics are missing in the database,
or there is a typo in series selector.`,Bl=`The shown results are marked as PARTIAL.
The result is marked as partial if one or more vmstorage nodes failed to respond to the query.`,Ql=({value:t,onChange:r,onEnter:n,onArrowUp:a,onArrowDown:s,autocomplete:o,autocompleteEl:i,error:l,stats:c,label:m,disabled:d=!1,includeFunctions:u=!0})=>{const{autocompleteQuick:h}=Le(),{isMobile:v}=j(),[p,_]=y(!1),[g,f]=y([0,0]),[b,C]=y([0,0]),N=J(null),[S,w]=y(!1),T=J(kt(w,500)).current,E=[{show:c?.seriesFetched==="0"&&!c.resultLength,text:ql},{show:c?.isPartial,text:Bl}].filter(I=>I.show).map(I=>I.text).join("");c&&(m=`${m} (${c.executionTimeMsec||0}ms)`);const A=(I,R)=>{r(I),C([R,R])},k=I=>{const{key:R,ctrlKey:H,metaKey:O,shiftKey:U}=I,ie=(I.target.value||"").split(`
`).length>1,me=H||O,Q=R==="ArrowUp",ae=R==="ArrowDown",ne=R==="Enter";Q&&me&&(I.preventDefault(),a()),ae&&me&&(I.preventDefault(),s()),ne&&p&&I.preventDefault(),ne&&!U&&(!ie||me)&&!p&&(I.preventDefault(),n())},L=I=>{_(!!I.length)},$=I=>{f(R=>R[0]===I[0]&&R[1]===I[1]?R:I)};return x(()=>{_(!!i&&h)},[h]),x(()=>{w(!1),T(g.every(Boolean))},[g]),e("div",{className:"vm-query-editor",ref:N,children:[e(se,{value:t,label:m,type:"textarea",autofocus:!v,error:l,warning:E,onKeyDown:k,onChange:r,onChangeCaret:$,disabled:d,inputmode:"search",caretPosition:b}),S&&o&&i&&e(i,{value:t,anchorEl:N,caretPosition:g,hasHelperText:!!(E||l),includeFunctions:u,onSelect:A,onFoundOptions:L})]})},Be=({value:t=!1,disabled:r=!1,label:n,color:a="secondary",fullWidth:s,onChange:o})=>{const i=()=>{r||o(!t)},l=M({"vm-switch":!0,"vm-switch_full-width":s,"vm-switch_disabled":r,"vm-switch_active":t,[`vm-switch_${a}_active`]:t,[`vm-switch_${a}`]:a});return e("div",{className:l,onClick:i,children:[e("div",{className:"vm-switch-track",children:e("div",{className:"vm-switch-track__thumb"})}),n&&e("span",{className:"vm-switch__label",children:n})]})},ya=({isMobile:t,hideButtons:r})=>{const{autocomplete:n}=Le(),a=Jt(),{nocache:s,isTracingEnabled:o,reduceMemUsage:i}=Pe(),l=Pt(),c=()=>{l({type:"TOGGLE_NO_CACHE"})},m=()=>{l({type:"TOGGLE_REDUCE_MEM_USAGE"})},d=()=>{l({type:"TOGGLE_QUERY_TRACING"})},u=()=>{a({type:"TOGGLE_AUTOCOMPLETE"})},h=()=>{a({type:"SET_AUTOCOMPLETE_QUICK",payload:!0})};return oe("keydown",p=>{const{code:_,ctrlKey:g,altKey:f}=p;_==="Space"&&(g||f)&&(p.preventDefault(),h())}),e("div",{className:M({"vm-additional-settings":!0,"vm-additional-settings_mobile":t}),children:[!r?.autocomplete&&e(Y,{title:e(V,{children:["Quick tip: ",Os]}),children:e(Be,{label:"Autocomplete",value:n,onChange:u,fullWidth:t})}),!r?.disableCache&&e(Be,{label:"Disable cache",value:s,onChange:c,fullWidth:t}),!r?.reduceMemUsage&&e(Be,{label:"Disable deduplication",value:i,onChange:m,fullWidth:t}),!r?.traceQuery&&e(Be,{label:"Trace query",value:o,onChange:d,fullWidth:t})]})},jl=t=>{const{isMobile:r}=j(),n=J(null),{value:a,toggle:s,setFalse:o}=ce(!1);return r?e(V,{children:[e("div",{ref:n,children:e(z,{variant:"outlined",startIcon:e(fs,{}),onClick:s,ariaLabel:"additional the query settings"})}),e(je,{open:a,buttonRef:n,placement:"bottom-left",onClose:o,title:"Query settings",children:e(ya,{isMobile:r,...t})})]}):e(ya,{...t})},Fr=(t,r)=>t.length===r.length&&t.every((n,a)=>n===r[a]);function Yl(t,r){const n=t.reduce((a,s)=>{const o=r.map(i=>`${String(i)}: ${s[i]||"-"}`).join("|");return(a[o]=a[o]||[]).push(s),a},{});return Object.entries(n).map(([a,s])=>({keys:a.split("|"),values:s}))}const Gl=()=>{const{serverUrl:t}=re();return async n=>{try{const a=encodeURIComponent(n),s=`${t}/prettify-query?query=${a}`,o=await fetch(s);if(o.status!=200)return{query:n,error:"Error requesting /prettify-query, status: "+o.status};const i=await o.json();return i.status!="success"?{query:n,error:String(i.msg)}:{query:String(i.query),error:""}}catch(a){return console.error(a),a instanceof Error&&a.name!=="AbortError"?{query:n,error:`${a.name}: ${a.message}`}:{query:n,error:String(a)}}}},Ye=()=>{const{showInfoMessage:t}=Ds();return async(r,n)=>{if(!navigator?.clipboard)return t({text:e(Wl,{}),type:"error",timeout:2e4}),!1;try{return await navigator.clipboard.writeText(r),n&&t({text:n,type:"success"}),!0}catch(a){return a instanceof Error&&t({text:`${a.name}: ${a.message}`,type:"error"}),console.warn("Copy failed",a),!1}}},Wl=()=>e("div",{className:"vm-snackbar-details",children:[e("p",{className:"vm-snackbar-details__title",children:"Clipboard not supported"}),window.isSecureContext?e("p",{className:"vm-snackbar-details__msg",children:[e("p",{children:"Common reasons:"}),e("ul",{children:[e("li",{children:"Browser restrictions"}),e("li",{children:"Insecure connection (HTTP)"}),e("li",{children:"Permissions not granted"})]}),e("p",{children:["For detailed information, visit the ",e("a",{className:"vm-link vm-link_underlined vm-link_colored",href:"https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API#security_considerations",target:"_blank",rel:"noopener noreferrer",children:"Clipboard API documentation"})]})]}):e("p",{className:"vm-snackbar-details__msg",children:[e("p",{children:"This page is not running in a secure context (HTTPS)."}),e("p",{children:"Clipboard operations require a secure context."}),e("a",{className:"vm-link vm-link_underlined vm-link_colored",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",rel:"noopener noreferrer",children:"Learn more about secure contexts"})]})]}),Jl=({query:t,favorites:r,onRun:n,onToggleFavorite:a})=>{const s=Ye(),o=D(()=>r.includes(t),[t,r]);return e("div",{className:"vm-query-history-item",children:[e("span",{className:"vm-query-history-item__value",children:t}),e("div",{className:"vm-query-history-item__buttons",children:[e(Y,{title:"Execute query",children:e(z,{size:"small",variant:"text",onClick:()=>{n(t)},startIcon:e(Dr,{})})}),e(Y,{title:"Copy query",children:e(z,{size:"small",variant:"text",onClick:async()=>{await s(t,"Query has been copied")},startIcon:e(yt,{})})}),e(Y,{title:o?"Remove Favorite":"Add to Favorites",children:e(z,{size:"small",variant:"text",color:o?"warning":"primary",onClick:()=>{a(t,o)},startIcon:o?e(ys,{}):e(gs,{})})})]})]})},ct={session:"session",storage:"saved",favorite:"favorite"},ba=[{label:"Session history",value:ct.session},{label:"Saved history",value:ct.storage},{label:"Favorite queries",value:ct.favorite}],Kl=({handleSelectQuery:t,historyKey:r})=>{const{queryHistory:n}=Le(),{isMobile:a}=j(),{value:s,setTrue:o,setFalse:i}=ce(!1),[l,c]=y(ba[0].value),[m,d]=y(Ot(r,"QUERY_HISTORY")),[u,h]=y(Ot(r,"QUERY_FAVORITES")),v=D(()=>n.map(S=>S.values.filter(w=>w).reverse()),[n]),p=D(()=>{switch(l){case ct.favorite:return u;case ct.storage:return m;default:return v}},[l,u,m,v]),_=p?.every(S=>!S.length),g=D(()=>{switch(l){case ct.favorite:return`Favorites queries are empty.
To see your favorites, mark a query as a favorite.`;default:return`Query history is empty.
To see the history, please make a query.`}},[l]),f=S=>w=>{t(w,S),i()},b=(S,w)=>{h(T=>{const E=T[0]||[];return w?[E.filter(A=>A!==S)]:!w&&!E.includes(S)?[[...E,S]]:T})},C=()=>{d(Ot(r,"QUERY_HISTORY")),h(Ot(r,"QUERY_FAVORITES"))},N=()=>{Ti(r,"QUERY_HISTORY")};return x(()=>{const S=u[0]||[],w=Ot(r,"QUERY_FAVORITES")[0]||[];Fr(S,w)||Si(r,u)},[u]),oe("storage",C),e(V,{children:[e(Y,{title:"Show history",children:e(z,{color:"primary",variant:"text",onClick:o,startIcon:e(Bt,{}),ariaLabel:"Show history"})}),s&&e(Ce,{title:"Query history",onClose:i,children:e("div",{className:M({"vm-query-history":!0,"vm-query-history_mobile":a}),children:[e("div",{className:M({"vm-query-history__tabs":!0,"vm-section-header__tabs":!0,"vm-query-history__tabs_mobile":a}),children:e(er,{activeItem:l,items:ba,onChange:c})}),e("div",{className:"vm-query-history-list",children:[_&&e("div",{className:"vm-query-history-list__no-data",children:g}),p.map((S,w)=>e("div",{children:[p.length>1&&e("div",{className:M({"vm-query-history-list__group-title":!0,"vm-query-history-list__group-title_first":w===0}),children:["Query ",w+1]}),S.map((T,E)=>e(Jl,{query:T,favorites:u.flat(),onRun:f(w),onToggleFavorite:b},E))]},w)),l===ct.storage&&!_&&e("div",{className:"vm-query-history-footer",children:e(z,{color:"error",variant:"outlined",size:"small",startIcon:e(Pr,{}),onClick:N,children:"clear history"})})]})]})})]})},ye=({containerStyles:t,message:r})=>{const{isDarkTheme:n}=re();return e("div",{className:M({"vm-spinner":!0,"vm-spinner_dark":n}),style:t,children:[e("div",{className:"half-circle-spinner",children:[e("div",{className:"circle circle-1"}),e("div",{className:"circle circle-2"})]}),r&&e("div",{className:"vm-spinner__message",children:r})]})},Zl=()=>{const{serverUrl:t}=re(),{isMobile:r}=j(),{value:n,setTrue:a,setFalse:s}=ce(!1),{query:o}=Le(),{period:i}=pe(),[l,c]=y(!1),[m,d]=y(""),[u,h]=y(""),[v,p]=y(""),_=async()=>{c(!0);try{const f=encodeURIComponent(o[0]||""),b=encodeURIComponent(i.step||Wt(i.end-i.start,!1)),C=`${t}/api/vmanomaly/config.yaml?query=${f}&step=${b}`,N=await fetch(C),S=N.headers.get("Content-Type");if(N.ok)if(S=="application/yaml"){const w=await N.blob(),T=await w.text();d(T),h(URL.createObjectURL(w))}else p("Response Content-Type is not YAML, does `Server URL` point to VMAnomaly server?");else{const w=await N.text();p(` ${N.status} ${N.statusText}: ${w}`)}}catch(f){console.error(f),p(String(f))}c(!1)};return e(V,{children:[e(z,{color:"secondary",variant:"outlined",onClick:()=>(a(),p(""),URL.revokeObjectURL(u),d(""),h(""),_()),children:"Open Config"}),n&&e(Ce,{title:"Download config",onClose:s,children:e("div",{className:M({"vm-anomaly-config":!0,"vm-anomaly-config_mobile":r}),children:[l&&e(ye,{containerStyles:{position:"relative"},message:"Loading config..."}),!l&&v&&e("div",{className:"vm-anomaly-config-error",children:[e("div",{className:"vm-anomaly-config-error__icon",children:e(Pn,{})}),e("h3",{className:"vm-anomaly-config-error__title",children:"Cannot download config"}),e("p",{className:"vm-anomaly-config-error__text",children:v})]}),!l&&m&&e(se,{value:m,label:"config.yaml",type:"textarea",disabled:!0}),e("div",{className:"vm-anomaly-config-footer",children:u&&e("a",{href:u,download:"config.yaml",children:e(z,{variant:"contained",startIcon:e(Or,{}),children:"download"})})})]})})]})},Gs=({value:t,itemClassName:r,options:n,anchor:a,disabled:s,minLength:o=2,fullWidth:i,selected:l,noOptionsText:c,label:m,disabledFullScreen:d,offset:u,maxDisplayResults:h,loading:v,onSelect:p,onOpenAutocomplete:_,onFoundOptions:g,onChangeWrapperRef:f})=>{const{isMobile:b}=j(),C=J(null),[N,S]=y({index:-1}),[w,T]=y(""),[E,A]=y(0),{value:k,setValue:L,setFalse:$}=ce(!1),I=D(()=>{if(!k)return[];try{const Q=new RegExp(String(t.trim()),"i"),ne=n.filter(F=>Q.test(F.value)).sort((F,P)=>F.value.toLowerCase()===t.trim().toLowerCase()?-1:P.value.toLowerCase()===t.trim().toLowerCase()?1:(F.value.match(Q)?.index||0)-(P.value.match(Q)?.index||0));return A(ne.length),T(ne.length>Number(h?.limit)&&h?.message||""),h?.limit?ne.slice(0,h.limit):ne}catch{return[]}},[k,n,t]),R=D(()=>I.length===1&&I[0]?.value===t,[I]),H=D(()=>c&&!I.length,[c,I]),O=Q=>()=>{s||(p(Q.value,Q),l||$())},U=Q=>()=>{S({index:Q,type:0})},W=()=>{S({index:-1})},ie=()=>{if(!C.current||N.type===0)return;const Q=C.current.childNodes[N.index];Q?.scrollIntoView&&Q.scrollIntoView({block:"center"})},me=K(Q=>{const{key:ae,ctrlKey:ne,metaKey:F,shiftKey:P}=Q,B=ne||F||P,Z=I.length&&!R;if(ae==="ArrowUp"&&!B&&Z&&(Q.preventDefault(),S(({index:te})=>({index:te<=0?0:te-1,type:1}))),ae==="ArrowDown"&&!B&&Z){Q.preventDefault();const te=I.length-1;S(({index:le})=>({index:le>=te?te:le+1,type:1}))}if(ae==="Enter"){const te=I[N.index];te&&p(te.value,te),l||$()}ae==="Escape"&&$()},[N,I,R,$,p,l]);return x(()=>{L(t.length>=o)},[t,n]),oe("keydown",me),x(ie,[N,I]),x(()=>{S({index:-1})},[I]),x(()=>{_&&_(k)},[k]),x(()=>{g&&g(R?[]:I)},[I,R]),x(()=>{f&&f(C)},[C]),e(je,{open:k,buttonRef:a,placement:"bottom-left",onClose:$,fullWidth:i,title:b?m:void 0,disabledFullScreen:d,offset:u,children:[e("div",{className:M({"vm-autocomplete":!0,"vm-autocomplete_mobile":b&&!d}),ref:C,children:[v&&e("div",{className:"vm-autocomplete__loader",children:[e(qt,{}),e("span",{children:"Loading..."})]}),H&&e("div",{className:"vm-autocomplete__no-options",children:c}),!R&&I.map((Q,ae)=>e("div",{className:M({"vm-list-item":!0,"vm-list-item_mobile":b,"vm-list-item_active":ae===N.index,"vm-list-item_multiselect":l,"vm-list-item_multiselect_selected":l?.includes(Q.value),"vm-list-item_with-icon":Q.icon}),id:`$autocomplete$${Q.value}`,onClick:O(Q),onMouseEnter:U(ae),onMouseLeave:W,children:[l?.includes(Q.value)&&e(Rr,{}),e(V,{children:Q.icon}),e("div",{className:`vm-list-item-inner ${r} ${Q.value.toLowerCase().replace(" ","-")}`,children:e("span",{children:Q.value})})]},`${ae}${Q.value}`))]}),w&&e("div",{className:"vm-autocomplete-message",children:["Shown ",h?.limit," results out of ",E,". ",w]}),I[N.index]?.description&&e("div",{className:"vm-autocomplete-info",children:[e("div",{className:"vm-autocomplete-info__type",children:I[N.index].type}),e("div",{className:"vm-autocomplete-info__description",dangerouslySetInnerHTML:{__html:I[N.index].description||""}})]})]})},wr=t=>t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),or=t=>JSON.stringify(t).slice(1,-1),Ws=t=>{const r=t.match(/["`']/g);return r?r.length%2!==0:!1},Xl={metric:e(bs,{}),label:e(Cs,{}),labelValue:e(Ns,{})},ec=({valueByContext:t,metric:r,label:n,context:a})=>{const{serverUrl:s}=re(),{period:{start:o,end:i}}=pe(),{autocompleteCache:l}=Le(),c=Jt(),[m,d]=y(!1),[u,h]=y(t),v=kt(h,500);x(()=>(v(t),v.cancel),[t,v]);const[p,_]=y([]),[g,f]=y([]),[b,C]=y([]),N=J(new AbortController),S=K(E=>{const A=q(o*1e3).startOf("day").valueOf()/1e3,k=q(i*1e3).endOf("day").valueOf()/1e3;return new URLSearchParams({...E||{},limit:`${br.queryLimit}`,start:`${A}`,end:`${k}`})},[o,i]),w=(E,A)=>E.map(k=>({value:k,type:`${A}`,icon:Xl[A]})),T=async({value:E,urlSuffix:A,setter:k,type:L,params:$})=>{if(!E&&L==="metric")return;N.current.abort(),N.current=new AbortController;const{signal:I}=N.current,R={type:L,value:E,start:$?.get("start")||"",end:$?.get("end")||"",match:$?.get("match[]")||""};d(!0);try{const H=l.get(R);if(H){k(w(H,L)),d(!1);return}const O=await fetch(`${s}/api/v1/${A}?${$}`,{signal:I});if(O.ok){const{data:U}=await O.json();k(w(U,L)),c({type:"SET_AUTOCOMPLETE_CACHE",payload:{key:R,value:U}})}d(!1)}catch(H){H instanceof Error&&H.name!=="AbortError"&&(c({type:"SET_AUTOCOMPLETE_CACHE",payload:{key:R,value:[]}}),d(!1),console.error(H))}};return x(()=>{const E=a!==Ee.metricsql&&a!==Ee.empty;if(!s||!r||E)return;_([]);const A=or(wr(r));return T({value:u,urlSuffix:"label/__name__/values",setter:_,type:"metric",params:S({"match[]":`{__name__=~".*${A}.*"}`})}),()=>N.current?.abort()},[s,u,a,r]),x(()=>{if(!s||a!==Ee.label)return;f([]);const E=or(r);return T({value:u,urlSuffix:"labels",setter:f,type:"label",params:S(r?{"match[]":`{__name__="${E}"}`}:void 0)}),()=>N.current?.abort()},[s,u,a,r]),x(()=>{if(!s||!n||a!==Ee.labelValue)return;C([]);const E=or(r),A=or(wr(u)),k=r?`__name__="${E}"`:"",L=`${n}=~".*${A}.*"`,$=[k,L].filter(Boolean).join(",");return T({value:u,urlSuffix:`label/${n}/values`,setter:C,type:"labelValue",params:S({"match[]":`{${$}}`})}),()=>N.current?.abort()},[s,u,a,r,n]),{metrics:p,labels:g,labelValues:b,loading:m}},tc=""+new URL("MetricsQL-CDnEXB9l.md",import.meta.url).href,Js="h3",rc="h4",nc="p",ac="https://docs.victoriametrics.com/victoriametrics/metricsql/",sc="vm-link vm-link_colored",oc=t=>{const r=`$1 target="_blank" class="${sc}" $2${ac}#`;return t.replace(/(<a) (href=")#/gm,r)},ic=t=>{const r=[];let n=t.nextElementSibling;for(;n&&n.tagName.toLowerCase()===nc;)n&&r.push(n),n=n.nextElementSibling;return r},lc=(t,r)=>{const n=r.textContent??"",s=ic(r).map(o=>o.outerHTML??"").join(`
`);return{type:t,value:n,description:oc(s),icon:e(_s,{})}},cc=t=>{let r="";return Array.from(t).map(n=>{const a=n.tagName.toLowerCase()===Js;return r=a?n.textContent??"":r,a?null:lc(r,n)}).filter(Boolean)},dc=t=>{const{metricsQLFunctions:r}=Le(),n=Jt(),a=s=>{const o=document.createElement("div");o.innerHTML=Er(s);const i=o.querySelectorAll(`${Js}, ${rc}`);return cc(i)};return x(()=>{if(!t||r.length)return;(async()=>{try{const i=await(await fetch(tc)).text(),l=a(i);n({type:"SET_METRICSQL_FUNCTIONS",payload:l})}catch(o){console.error("Error fetching or processing the MetricsQL.md file:",o)}})()},[]),t?r:[]};function mc(t){const r=/\s(or|and|unless|default|ifnot|if|group_left|group_right)\s|}|\+|\|-|\*|\/|\^/i,n=t.split(r),a=n[n.length-1].trim(),s=/.*\(([^)]*)$/,o=a.match(s);if(o&&o[1]){const i=o[1];if(i.lastIndexOf("{")>i.lastIndexOf("}")){const c=i.match(/([\w_.:]+)\{[^}]*$/);return c?c[0]:a}const l=i.lastIndexOf(",");return l!==-1?i.substring(l+1).trim():i}return a}function uc(t){const r=t.match(/([\w_.:]+(?![},]))$/);return r?r[0]:""}function hc(t){const r=/([{(),+\-*/^]|\b(?:or|and|unless|default|ifnot|if|group_left|group_right|by|without|on|ignoring)\b)/i,n=t.split(/\s+/),a=n.length,s=n[a-1],o=n[a-2],i=!s&&Ws(t),l=(!s||n.length>1)&&!r.test(o);return i||l}function pc(t,r="",n=""){const a=t.trim(),s=["}",")"].some(m=>a.endsWith(m)),o=!Ws(a)&&["`","'",'"'].some(m=>a.endsWith(m));if(!a||s||o||hc(a))return Ee.empty;const i=/(?:by|without|on|ignoring)\s*\(\s*[^)]*$|\{[^}]*$/i,l=`(${wr(r)})?{?.+${wr(n)}(=|!=|=~|!~)"?([^"]*)$`,c=new RegExp(l,"g");switch(!0){case c.test(a):return Ee.labelValue;case i.test(a):return Ee.label;default:return Ee.metricsql}}const vc=({value:t,anchorEl:r,caretPosition:n,hasHelperText:a,includeFunctions:s,onSelect:o,onFoundOptions:i})=>{const[l,c]=y({top:0,left:0}),m=dc(s),d=D(()=>{if(n[0]!==n[1])return{beforeCursor:t,afterCursor:""};const w=t.substring(0,n[0]),T=t.substring(n[1]);return{beforeCursor:w,afterCursor:T}},[t,n]),u=D(()=>mc(d.beforeCursor),[d]),h=D(()=>{const w=/\w+\((?<metricName>[^)]+)\)\s+(by|without|on|ignoring)\s*\(\w*/gi,T=[...u.matchAll(w)];if(T.length>0&&T[0].groups&&T[0].groups.metricName)return T[0].groups.metricName;const E=/^\s*\b(?<metricName>[^{}(),\s]+)(?={|$)/g,A=[...u.matchAll(E)];return A.length>0&&A[0].groups&&A[0].groups.metricName?A[0].groups.metricName:""},[u]),v=D(()=>{const w=/[a-z_:-][\w\-.:/]*\b(?=\s*(=|!=|=~|!~))/g,T=u.match(w);return T?T[T.length-1]:""},[u]),p=D(()=>pc(d.beforeCursor,h,v),[d,h,v]),_=D(()=>uc(d.beforeCursor),[d.beforeCursor]),{metrics:g,labels:f,labelValues:b,loading:C}=ec({valueByContext:_,metric:h,label:v,context:p}),N=D(()=>{switch(p){case Ee.metricsql:return[...g,...m];case Ee.label:return f;case Ee.labelValue:return b;default:return[]}},[p,g,f,b]),S=K(w=>{const T=d.beforeCursor;let E=d.afterCursor;const A=T.lastIndexOf(_,n[0]),k=A+_.length,L=T.substring(0,A),$=T.substring(k);if(p===Ee.labelValue){const R='"';E=E.replace(/^[^\s"|},]*/,"");const H=/(?:=|!=|=~|!~)$/.test(L),O=E.trim()[0]!=='"';w=`${H?R:""}${w}${O?R:""}`}p===Ee.label&&(E=E.replace(/^[^\s=!,{}()"|+\-/*^]*/,"")),p===Ee.metricsql&&(E=E.replace(/^[^\s[\]{}()"|+\-/*^]*/,""));const I=`${L}${w}${$}${E}`;o(I,L.length+w.length)},[d]);return x(()=>{if(!r.current){c({top:0,left:0});return}const w=r.current.querySelector("textarea")||r.current,T=window.getComputedStyle(w),E=`${T.getPropertyValue("font-size")}`,A=`${T.getPropertyValue("font-family")}`,k=parseInt(`${T.getPropertyValue("line-height")}`),L=document.createElement("div");L.style.font=`${E} ${A}`,L.style.padding=T.getPropertyValue("padding"),L.style.lineHeight=`${k}px`,L.style.width=`${w.offsetWidth}px`,L.style.maxWidth=`${w.offsetWidth}px`,L.style.whiteSpace=T.getPropertyValue("white-space"),L.style.overflowWrap=T.getPropertyValue("overflow-wrap");const $=document.createElement("span");L.appendChild(document.createTextNode(d.beforeCursor)),L.appendChild($),L.appendChild(document.createTextNode(d.afterCursor)),document.body.appendChild(L);const I=L.getBoundingClientRect(),R=$.getBoundingClientRect(),H=R.left-I.left,O=R.bottom-I.bottom-(a?k:0);c({top:O,left:H}),L.remove(),$.remove()},[r,n,a]),e(V,{children:e(Gs,{loading:C,disabledFullScreen:!0,value:_,options:N,anchor:r,minLength:0,offset:l,onSelect:S,onFoundOptions:i,maxDisplayResults:{limit:br.displayResults,message:"Please, specify the query more precisely."}})})},fc=he("expr.hide",""),gc=fc.split(",").filter(t=>t).map(Number),jn=({queryErrors:t,setQueryErrors:r,setHideError:n,stats:a,label:s,isLoading:o,includeFunctions:i=!0,onHideQuery:l,onRunQuery:c,abortFetch:m,hideButtons:d})=>{const{isMobile:u}=j(),{query:h,queryHistory:v,autocomplete:p,autocompleteQuick:_}=Le(),g=Jt(),f=Qe(),{setSearchParamsFromKeys:b}=et(),[C,N]=y(h||[]),[S,w]=y(gc),[T,E]=y(!1),A=jt(C),k=Gl(),L=()=>{g({type:"SET_QUERY_HISTORY",payload:{key:"METRICS_QUERY_HISTORY",history:C.map((F,P)=>Ei(F,v[P]))}})},$=()=>{if(o){m&&m();return}L(),g({type:"SET_QUERY",payload:C}),f({type:"RUN_QUERY"}),c()},I=()=>{N(F=>[...F,""])},R=F=>{N(P=>P.filter((B,Z)=>Z!==F))},H=(F,P)=>{const{ctrlKey:B,metaKey:Z}=F;if(B||Z){const le=C.map((ue,fe)=>fe).filter(ue=>ue!==P);w(ue=>Fr(le,ue)?[]:le)}else w(le=>le.includes(P)?le.filter(ue=>ue!==P):[...le,P])},O=(F,P)=>{N(B=>B.map((Z,te)=>te===P?F:Z))},U=(F,P)=>{O(F,P),E(!0)},W=(F,P)=>{const{index:B,values:Z}=v[P],te=B+F;te<0||te>=Z.length||(O(Z[te]||"",P),g({type:"SET_QUERY_HISTORY_BY_INDEX",payload:{value:{values:Z,index:te},queryNumber:P}}))},ie=(F,P)=>()=>{W(F,P)},me=F=>P=>{O(P,F),g({type:"SET_AUTOCOMPLETE_QUICK",payload:!1})},Q=F=>()=>{R(F),w(P=>P.includes(F)?P.filter(B=>B!==F):P.map(B=>B>F?B-1:B))},ae=F=>P=>{H(P,F)},ne=async F=>{const P=await k(C[F]);n(!1),O(P.query,F),r(B=>(B[F]=P.error,[...B]))};return x(()=>{A&&C.length<A.length&&$()},[C]),x(()=>{l&&l(S),b({"expr.hide":S.join(",")})},[S]),x(()=>{T&&($(),E(!1))},[C,T]),x(()=>{N(h||[])},[h]),e("div",{className:M({"vm-query-configurator":!0,"vm-block":!0,"vm-block_mobile":u}),children:[e("div",{className:"vm-query-configurator-list",children:C.map((F,P)=>e("div",{className:M({"vm-query-configurator-list-row":!0,"vm-query-configurator-list-row_disabled":S.includes(P),"vm-query-configurator-list-row_mobile":u}),children:[e(Ql,{value:C[P],autocomplete:!d?.autocomplete&&(p||_),autocompleteEl:vc,error:t[P],stats:a[P],onArrowUp:ie(-1,P),onArrowDown:ie(1,P),onEnter:$,onChange:me(P),label:`${s||"Query"} ${C.length>1?P+1:""}`,disabled:S.includes(P),includeFunctions:i}),l&&e(Y,{title:S.includes(P)?"Enable query":"Disable query",children:e("div",{className:"vm-query-configurator-list-row__button",children:e(z,{variant:"text",color:"gray",startIcon:S.includes(P)?e(us,{}):e(zn,{}),onClick:ae(P),ariaLabel:"visibility query"})})}),!d?.prettify&&e(Y,{title:"Prettify query",children:e("div",{className:"vm-query-configurator-list-row__button",children:e(z,{variant:"text",color:"gray",startIcon:e(hs,{}),onClick:async()=>await ne(P),className:"prettify",ariaLabel:"prettify the query"})})}),C.length>1&&e(Y,{title:"Remove Query",children:e("div",{className:"vm-query-configurator-list-row__button",children:e(z,{variant:"text",color:"error",startIcon:e(Pr,{}),onClick:Q(P),ariaLabel:"remove query"})})})]},P))}),e("div",{className:"vm-query-configurator-settings",children:[e(jl,{hideButtons:d}),e("div",{className:"vm-query-configurator-settings__buttons",children:[e(Kl,{handleSelectQuery:U,historyKey:"METRICS_QUERY_HISTORY"}),d?.anomalyConfig&&e(Zl,{}),!d?.addQuery&&C.length<pr&&e(z,{variant:"outlined",onClick:I,startIcon:e(On,{}),children:"Add Query"}),e(z,{variant:"contained",onClick:$,startIcon:o?e(Ts,{}):e(it,{}),children:`${o?"Cancel":"Execute"} ${u?"":"Query"}`})]})]})]})},yc=(t,r,n,a,s)=>`${t}/api/v1/query_range?query=${encodeURIComponent(r)}&start=${n.start}&end=${n.end}&step=${n.step}${a?"&nocache=1":""}${s?"&trace=1":""}`,bc=(t,r,n,a,s)=>`${t}/api/v1/query?query=${encodeURIComponent(r)}&time=${n.end}&step=${n.step}${a?"&nocache=1":""}${s?"&trace=1":""}`,_c=(t,r,n,a)=>{const s=new URLSearchParams({"match[]":r,start:n.start.toString(),end:n.end.toString()});return a&&s.set("reduce_mem_usage","1"),`${t}/api/v1/export?${s}`},Cc=(t,r,n,a)=>{const s=new URLSearchParams({start:n.start.toString(),end:n.end.toString(),format:"__name__,__value__,__timestamp__:unix_ms"});return r.forEach(o=>s.append("match[]",o)),a&&s.set("reduce_mem_usage","1"),`${t}/api/v1/export/csv?${s}`},Nc=(t,r,n,a)=>{const s=new URLSearchParams({start:n.start.toString(),end:n.end.toString()});return r.forEach(o=>s.append("match[]",o)),a&&s.set("reduce_mem_usage","1"),`${t}/api/v1/export?${s}`};let wc=0;class pt{tracing;query;tracingChildren;originalTracing;id;constructor(r,n){this.tracing=r,this.originalTracing=JSON.parse(JSON.stringify(r)),this.query=n,this.id=wc++;const a=r.children||[];this.tracingChildren=a.map(s=>new pt(s,n))}get queryValue(){return this.query}get idValue(){return this.id}get children(){return this.tracingChildren}get message(){return this.tracing.message}get duration(){return this.tracing.duration_msec}get JSON(){return JSON.stringify(this.tracing,null,2)}get originalJSON(){return JSON.stringify(this.originalTracing,null,2)}setTracing(r){this.tracing=r;const n=r.children||[];this.tracingChildren=n.map(a=>new pt(a,this.query))}setQuery(r){this.query=r}resetTracing(){this.tracing=this.originalTracing}}const hn=(t,r,n=!0)=>{const{__name__:a,...s}=t.metric,o=n?`[Query ${t.group}] `:"";if(r)return Ks(t.metric,r);const i=`${o}${a||""}`;if(Object.keys(s).length===0)return i||"value";const l=Object.entries(s).map(([c,m])=>`${c}=${JSON.stringify(m)}`).join(", ");return`${i}{${l}}`},Ks=(t,r)=>r.replace(/\{\{(\w+)}}/g,(n,a)=>t[a]||""),Yt=t=>{switch(t){case"NaN":return NaN;case"Inf":case"+Inf":return 1/0;case"-Inf":return-1/0;default:return parseFloat(t)}},Yn=t=>{if(t.length<2)return!1;const r=["le","vmrange"],n=Object.keys(t[0].metric).filter(s=>!r.includes(s));return t.every(s=>{const o=Object.keys(s.metric).filter(i=>!r.includes(i));return n.length===o.length&&o.every(i=>s.metric[i]===t[0].metric[i])})&&t.every(s=>r.some(o=>o in s.metric))},Vr=({predefinedQuery:t,visible:r,display:n,customStep:a,hideQuery:s,showAllSeries:o})=>{const{query:i}=Le(),{period:l}=pe(),{displayType:c,nocache:m,isTracingEnabled:d,seriesLimits:u}=Pe(),{serverUrl:h}=re(),{isHistogram:v}=Me(),[p,_]=y(!1),[g,f]=y(),[b,C]=y(),[N,S]=y(),[w,T]=y(),[E,A]=y([]),[k,L]=y([]),[$,I]=y(),[R,H]=y([]),[O,U]=y(!1),W=D(()=>{const{end:P,start:B}=l;return Wt(P-B,v,c)},[l,v,c]),me=K(kt(async({fetchUrl:P,fetchQueue:B,displayType:Z,query:te,stateSeriesLimits:le,showAllSeries:ue,hideQuery:fe})=>{const be=new AbortController;H([...B,be]);try{const Ne=Z===ge.chart,ke=ue?1/0:+le[Z]||1/0;let we=ke;const Te=[],Ct=[];let Re=1,Je=0,tt=!1;for await(const Wr of P){if(fe?.includes(Re-1)){A(rt=>[...rt,""]),L(rt=>[...rt,{}]),Re++;continue}const Jr=new URL(Wr),oa=await fetch(`${Jr.origin}${Jr.pathname}`,{signal:be.signal,method:"POST",body:Jr.searchParams}),Oe=await oa.json();if(oa.ok){if(L(Ge=>[...Ge,{...Oe?.stats,isPartial:Oe?.isPartial,resultLength:Oe.data.result.length}]),A(Ge=>[...Ge,""]),Oe.trace){const Ge=new pt(Oe.trace,te[Re-1]);Ct.push(Ge)}const rt=!!he("display_mode",null);tt=!Ko&&Ne&&!rt&&Yn(Oe.data.result),we=tt?1/0:ke;const Kr=we-Te.length;Oe.data.result.slice(0,Kr).forEach(Ge=>{Ge.group=Re,Te.push(Ge)}),Je+=Oe.data.result.length}else{Te.push({metric:{},values:[],group:Re});const rt=Oe.errorType||_e.unknownType,Kr=Oe?.error||Oe?.message||"see console for more details",Ge=[rt,Kr].join(`,\r
`);A(Vo=>[...Vo,`${Ge}`]),console.error(`Fetch query error: ${rt}`,Oe)}Re++}const Nt=`Showing ${Te.length} series out of ${Je} series due to performance reasons. Please narrow down the query, so it returns fewer series`;I(Je>we?Nt:""),Ne?f(Te):C(Te),S(Ct),U(Wr=>Je?tt:Wr)}catch(Ne){const ke=Ne;if(ke.name==="AbortError"){_(!1);return}let Te=`Error executing query: ${ke.message}. Please check your serverURL settings and confirm server availability.`;ke.message==="Unexpected end of JSON input"&&(Te+=`
Additionally, this error can occur if the server response is too large to process. Apply more specific filters to reduce the data volume.`),T(Te)}_(!1)},300),[]),Q=D(()=>{T(""),A([]),L([]);const P=t??i,B=(n||c)===ge.chart;if(l)if(!h)T(_e.emptyServer);else if(P.every(Z=>!Z.trim()))A(P.map(()=>_e.validQuery));else if(Tn(h)){const Z={...l};return Z.step=a,P.map(te=>B?yc(h,te,Z,m,d):bc(h,te,Z,m,d))}else T(_e.validServer)},[h,l,c,a,s]),ae=K(()=>{R.map(P=>P.abort()),H([]),f([]),C([])},[R]),[ne,F]=y([]);return x(()=>{const P=Q===ne&&!!t;if(!r||!Q?.length||P)return;_(!0),me({fetchUrl:Q,fetchQueue:R,displayType:n||c,query:t??i,stateSeriesLimits:u,showAllSeries:o,hideQuery:s}),F(Q)},[Q,r,u,o]),x(()=>{const P=R.slice(0,-1);P.length&&(P.map(B=>B.abort()),H(R.filter(B=>!B.signal.aborted)))},[R]),x(()=>{W===a&&f([])},[O]),{fetchUrl:Q,isLoading:p,graphData:g,liveData:b,error:w,queryErrors:E,setQueryErrors:A,queryStats:k,warning:$,traces:N,isHistogram:O,abortFetch:ae}},Zs=()=>e("div",{className:"vm-line-loader",children:[e("div",{className:"vm-line-loader__background"}),e("div",{className:"vm-line-loader__line"})]}),Gn=()=>{const{tenantId:t}=re(),{displayType:r}=Pe(),{query:n}=Le(),{duration:a,relativeTime:s,period:{date:o,step:i}}=pe(),{customStep:l}=Me(),[c,m]=de(),d=Dt(),u=Qe(),h=Xe(),v=Jt(),p=Pt(),[_,g]=y(!1),f=K(()=>{if(_){g(!1);return}const b=new URLSearchParams(c);n.forEach((N,S)=>{const w=`g${S}`;c.get(`${w}.expr`)!==N&&N&&b.set(`${w}.expr`,N),c.get(`${w}.range_input`)!==a&&b.set(`${w}.range_input`,a),c.get(`${w}.end_input`)!==o&&b.set(`${w}.end_input`,o),c.get(`${w}.relative_time`)!==s&&b.set(`${w}.relative_time`,s||"none");const T=c.get("expr.hide")||"";T!==""&&b.set("expr.hide",T);const E=c.get(`${w}.step_input`)||i;E&&E!==l&&b.set(`${w}.step_input`,l);const A=`${Et.find(k=>k.value===r)?.prometheusCode||0}`;c.get(`${w}.tab`)!==A&&b.set(`${w}.tab`,`${A}`),c.get(`${w}.tenantID`)!==t&&t&&b.set(`${w}.tenantID`,t)});const C=n.length-1;Array.from(b.keys()).forEach(N=>{const S=N.match(/^g(\d+)\./);S&&parseInt(S[1],10)>C&&b.delete(N)}),!(ri(b,c)||!b.size)&&m(b)},[t,r,n,a,s,o,i,l]);x(()=>{const b=setTimeout(f,200);return()=>clearTimeout(b)},[f]),x(()=>{if(!_)return;const b=Za(),C=b.duration!==a,N=b.relativeTime!==s,S=b.relativeTime==="none"&&b.period.date!==o;(C||N||S)&&u({type:"SET_TIME_STATE",payload:b});const T=Ls();T!==r&&p({type:"SET_DISPLAY_TYPE",payload:T});const E=c.get("g0.tenantID")||"";E!==t&&d({type:"SET_TENANT_ID",payload:E});const A=Qa();Fr(A,n)||(v({type:"SET_QUERY",payload:A}),u({type:"RUN_QUERY"}));const k=setTimeout(()=>{const L=c.get("g0.step_input")||i;L&&L!==l&&h({type:"SET_CUSTOM_STEP",payload:L})},50);return()=>clearTimeout(k)},[c,_]),oe("popstate",()=>{g(!0)})},Sc=e(Se,{text:"last_over_time",href:"https://docs.victoriametrics.com/victoriametrics/metricsql/#last_over_time",underlined:!0}),Tc=e(Se,{text:"instant query",href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#instant-query",underlined:!0}),Ec=()=>{const{customStep:t}=Me();return e("div",{children:[e("p",{children:["This tab shows ",Tc," results for the last ",t||"5m"," (defined by the ",e("code",{children:"step"}),") ending at the selected time range."]}),e("p",{children:["Please wrap the query into ",Sc," if you need results over arbitrary lookbehind interval."]})]})},Xs=({value:t,hideValue:r})=>e("div",{className:"vm-line-progress",children:[e("div",{className:"vm-line-progress-track",children:e("div",{className:"vm-line-progress-track__thumb",style:{width:`${t}%`}})}),!r&&e("span",{children:[t.toFixed(2),"%"]})]}),eo=({isRoot:t,trace:r,totalMsec:n,isExpandedAll:a})=>{const{isDarkTheme:s}=re(),{isMobile:o}=j(),[i,l]=y({}),c=J(null),[m,d]=y(!1),[u,h]=y(!1),v=xn(r.duration/1e3)||`${r.duration}ms`;x(()=>{if(!c.current)return;const C=c.current,N=c.current.children[0],{height:S}=N.getBoundingClientRect();d(S>C.clientHeight)},[r]);const p=C=>{C.stopPropagation(),h(N=>!N)},_=r.children&&!!r.children.length,g=r.duration/n*100,f=C=>()=>{_&&l(N=>({...N,[C]:!N[C]}))},b=C=>{const N=[C.idValue];return C?.children?.forEach(S=>{N.push(...b(S))}),N};return x(()=>{if(!a){l([]);return}const C=b(r),N={};C.forEach(S=>{N[S]=!0}),l(N)},[a]),e("div",{className:M({"vm-nested-nav":!0,"vm-nested-nav_root":t,"vm-nested-nav_dark":s,"vm-nested-nav_mobile":o}),children:[e("div",{className:M({"vm-nested-nav-header":!0,"vm-nested-nav-header_open":i[r.idValue]}),onClick:f(r.idValue),children:[_&&e("div",{className:M({"vm-nested-nav-header__icon":!0,"vm-nested-nav-header__icon_open":i[r.idValue]}),children:e(Ae,{})}),e("div",{className:"vm-nested-nav-header__progress",children:e(Xs,{value:g})}),e("div",{className:M({"vm-nested-nav-header__message":!0,"vm-nested-nav-header__message_show-full":u}),ref:c,children:[e("span",{className:"vm-nested-nav-header__message_duration",children:v}),":",e("span",{children:r.message})]}),e("div",{className:"vm-nested-nav-header-bottom",children:(m||u)&&e(z,{variant:"text",size:"small",onClick:p,children:u?"Hide":"Show full query"})})]}),i[r.idValue]&&e("div",{className:"vm-nested-nav__childrens",children:_&&r.children.map(C=>e(eo,{trace:C,totalMsec:n,isExpandedAll:a},C.duration))})]})},to=({editable:t=!1,defaultTile:r="JSON",displayTitle:n=!0,defaultJson:a="",resetValue:s="",onClose:o,onUpload:i})=>{const l=Ye(),{isMobile:c}=j(),[m,d]=y(a),[u,h]=y(r),[v,p]=y(""),[_,g]=y(""),f=D(()=>{try{const T=JSON.parse(m),E=T.trace||T;return E.duration_msec?(new pt(E,""),""):_e.traceNotFound}catch(T){return T instanceof Error?T.message:"Unknown error"}},[m]),b=T=>{h(T)},C=T=>{g(""),d(T)},N=async()=>{await l(m,"Formatted JSON has been copied")},S=()=>{d(s)},w=()=>{g(f),u.trim()||p(_e.emptyTitle),!(f||v)&&(i(m,u),o())};return e("div",{className:M({"vm-json-form":!0,"vm-json-form_one-field":!n,"vm-json-form_one-field_mobile":!n&&c,"vm-json-form_mobile":c}),children:[n&&e(se,{value:u,label:"Title",error:v,onEnter:w,onChange:b}),e(se,{value:m,label:"JSON",type:"textarea",error:_,autofocus:!0,onChange:C,onEnter:w,disabled:!t}),e("div",{className:"vm-json-form-footer",children:[e("div",{className:"vm-json-form-footer__controls",children:[e(z,{variant:"outlined",startIcon:e(yt,{}),onClick:N,children:"Copy JSON"}),s&&e(z,{variant:"text",startIcon:e(ut,{}),onClick:S,children:"Reset JSON"})]}),e("div",{className:"vm-json-form-footer__controls vm-json-form-footer__controls_right",children:[e(z,{variant:"outlined",color:"error",onClick:o,children:"Cancel"}),e(z,{variant:"contained",onClick:w,children:"apply"})]})]})]})},ro=(t,r)=>{const n=document.createElement("a"),a=URL.createObjectURL(t);n.setAttribute("href",a),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)},no=(t,r)=>{const n=new Blob([t],{type:"text/csv;charset=utf-8;"});ro(n,r)},Ur=(t,r)=>{const n=new Blob([t],{type:"application/json"});ro(n,r)},Wn=({traces:t,jsonEditor:r=!1,onDeleteClick:n})=>{const{isMobile:a}=j(),[s,o]=y(null),[i,l]=y([]),c=()=>{o(null)},m=(p,_)=>{if(!(!r||!s))try{s.setTracing(JSON.parse(p)),s.setQuery(_),o(null)}catch(g){console.error(g)}};if(!t.length)return e(X,{variant:"info",children:"Please re-run the query to see results of the tracing"});const d=p=>()=>{n(p)},u=p=>()=>{o(p)},h=p=>()=>{Ur(p.originalJSON,`vmui_trace_${p.queryValue}.json`)},v=p=>()=>{l(_=>_.includes(p.idValue)?_.filter(g=>g!==p.idValue):[..._,p.idValue])};return e(V,{children:[e("div",{className:"vm-tracings-view",children:t.map(p=>e("div",{className:"vm-tracings-view-trace vm-block vm-block_empty-padding",children:[e("div",{className:"vm-tracings-view-trace-header",children:[e("h3",{className:"vm-tracings-view-trace-header-title",children:["Trace for ",e("b",{className:"vm-tracings-view-trace-header-title__query",children:p.queryValue})]}),e(Y,{title:i.includes(p.idValue)?"Collapse All":"Expand All",children:e(z,{variant:"text",startIcon:i.includes(p.idValue)?e(Ss,{}):e(ws,{}),onClick:v(p),ariaLabel:i.includes(p.idValue)?"Collapse All":"Expand All"})}),e(Y,{title:"Save Trace to JSON",children:e(z,{variant:"text",startIcon:e(Or,{}),onClick:h(p),ariaLabel:"Save trace to JSON"})}),e(Y,{title:"Open JSON",children:e(z,{variant:"text",startIcon:e(Zt,{}),onClick:u(p),ariaLabel:"open JSON"})}),e(Y,{title:"Remove trace",children:e(z,{variant:"text",color:"error",startIcon:e(Pr,{}),onClick:d(p),ariaLabel:"remove trace"})})]}),e("nav",{className:M({"vm-tracings-view-trace__nav":!0,"vm-tracings-view-trace__nav_mobile":a}),children:e(eo,{isRoot:!0,trace:p,totalMsec:p.duration,isExpandedAll:i.includes(p.idValue)})})]},p.idValue))}),s&&e(Ce,{title:s.queryValue,onClose:c,children:e(to,{editable:r,displayTitle:r,defaultTile:s.queryValue,defaultJson:s.JSON,resetValue:s.originalJSON,onClose:c,onUpload:m})})]})},Ac=({traces:t,displayType:r})=>{const{isTracingEnabled:n}=Pe(),[a,s]=y([]),o=i=>{const l=a.filter(c=>c.idValue!==i.idValue);s([...l])};return x(()=>{t&&s([...a,...t])},[t]),x(()=>{s([])},[r]),e(V,{children:n&&e("div",{className:"vm-custom-panel__trace",children:e(Wn,{traces:a,onDeleteClick:o})})})},qr=({warning:t,query:r,onChange:n})=>{const{isMobile:a}=j(),{value:s,setTrue:o,setFalse:i}=ce(!1);return x(i,[r]),x(()=>{n(s)},[s]),e(X,{variant:"warning",children:e("div",{className:M({"vm-custom-panel__warning":!0,"vm-custom-panel__warning_mobile":a}),children:[e("p",{children:t}),e(z,{color:"warning",variant:"outlined",onClick:o,children:"Show all"})]})})},Jn=t=>{let r=t.length,n=-1/0;for(;r--;){const a=t[r];Number.isFinite(a)&&a>n&&(n=a)}return Number.isFinite(n)?n:null},Kn=t=>{let r=t.length,n=1/0;for(;r--;){const a=t[r];Number.isFinite(a)&&a<n&&(n=a)}return Number.isFinite(n)?n:null},xc=t=>{let r=t[0],n=1;for(let a=1;a<t.length;a++){const s=t[a];Number.isFinite(s)&&(r=r*(n-1)/n+s/n,n++)}return r},Lc=t=>{let r=t.length;const n=[];for(;r--;){const a=t[r];Number.isFinite(a)&&n.push(a)}return n.sort(),n[n.length>>1]},kc=t=>{let r=t.length;for(;r--;){const n=t[r];if(Number.isFinite(n))return n}},Mc=(t,r,n="")=>{const a=r[0],s=r[r.length-1];return n?r.map(o=>`${nt(o,a,s)} ${n}`):r.map(o=>nt(o,a,s))},nt=(t,r,n)=>{if(t==null)return"";n=n||0,r=r||0;const a=Math.abs(n-r);if(isNaN(a)||a==0)return Math.abs(t)>=1e3?t.toLocaleString("en-US"):t.toString();let s=3+Math.floor(1+Math.log10(Math.max(Math.abs(r),Math.abs(n)))-Math.log10(a));return(isNaN(s)||s>20)&&(s=20),t.toLocaleString("en-US",{minimumSignificantDigits:1,maximumSignificantDigits:s})},Ic=(t,r)=>{const n=document.createElement("span");n.innerText=t,n.style.cssText=`position: absolute; z-index: -1; pointer-events: none; opacity: 0; font: ${r}`,document.body.appendChild(n);const a=n.offsetWidth;return n.remove(),a},Dc=(t,r)=>{if(r?.hasAlias&&r?.label)return r.label;const n=t?.metric||{},s=Object.keys(n).filter(i=>i!="__name__").map(i=>`${i}=${JSON.stringify(n[i])}`);let o=n.__name__||"";return s.length>0&&(o+="{"+s.join(",")+"}"),o},$c=[[3600*24*365,"{YYYY}",null,null,null,null,null,null,1],[3600*24*28,"{MMM}",`
{YYYY}`,null,null,null,null,null,1],[3600*24,"{MM}-{DD}",`
{YYYY}`,null,null,null,null,null,1],[3600,"{HH}:{mm}",`
{YYYY}-{MM}-{DD}`,null,`
{MM}-{DD}`,null,null,null,1],[60,"{HH}:{mm}",`
{YYYY}-{MM}-{DD}`,null,`
{MM}-{DD}`,null,null,null,1],[1,"{HH}:{mm}:{ss}",`
{YYYY}-{MM}-{DD}`,null,`
{MM}-{DD} {HH}:{mm}`,null,null,null,1],[.001,":{ss}.{fff}",`
{YYYY}-{MM}-{DD} {HH}:{mm}`,null,`
{MM}-{DD} {HH}:{mm}`,null,`
{HH}:{mm}`,null,1]],ao=(t,r)=>Array.from(new Set(t.map(n=>n.scale))).map(n=>{const a="10px Arial",s=Ze("color-text"),o={scale:n,show:!0,size:so,stroke:s,font:a,values:(i,l)=>Mc(i,l,r)};return n?!(Number(n)%2)&&n!=="y"?{...o,side:1}:o:{space:80,values:$c,stroke:s,font:a}}),Pc=(t,r,n)=>{const a=Ln(r)||1,s=Array.from(new Set(t)).sort((m,d)=>m-d);let o=n.start;const i=ur(n.end+a);let l=0;const c=[];for(;o<=i;){for(;l<s.length&&s[l]<=o;)o=s[l],l++,c.push(o);o=ur(o+a),(l>=s.length||s[l]>o)&&c.push(o)}for(;c.length<2;)c.push(o),o=ur(o+a);return c},Zn=(t,r)=>{if(t==null||r==null)return[-1,1];const a=.02*(Math.abs(r-t)||Math.abs(t)||1);return[t-a,r+a]},Rc=(t,r)=>{const n={},a=Object.values(t).flat(),s="1",o=Kn(a)||0,i=Jn(a)||1;return n[s]=r?Zn(o,i):[o,i],n},so=(t,r,n,a)=>{const s=t.axes[n];if(a>1)return s._size||60;let o=6+(s?.ticks?.size||0)+(s.gap||0);const i=(r??[]).reduce((l,c)=>c?.length>l.length?c:l,"");return i!=""&&(o+=Ic(i,"10px Arial")),Math.ceil(o)},_a=["#e54040","#32a9dc","#2ee329","#7126a1","#e38f0f","#3d811a","#ffea00","#2d2d2d","#da42a6","#a44e0c"],oo=t=>{if(t.length!=7)return"0, 0, 0";const r=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return`${r}, ${n}, ${a}`},At={[ee.yhatUpper]:"#7126a1",[ee.yhatLower]:"#7126a1",[ee.yhat]:"#da42a6",[ee.anomaly]:"#da4242",[ee.anomalyScore]:"#7126a1",[ee.actual]:"#203ea9",[ee.training]:`rgba(${oo("#203ea9")}, 0.2)`},Ca=t=>{let a=1,s=0,o=1;if(t.length>0)for(let l=0;l<t.length;l++)t[l].charCodeAt(0)>s&&(s=t[l].charCodeAt(0)),o=parseInt(String(16777215/s)),a=(a+t[l].charCodeAt(0)*o*49979693)%16777215;let i=(a*t.length%16777215).toString(16);return i=i.padEnd(6,i),`#${i}`},Oc=t=>{let r=t.replace("#","").trim();if(r.length===3&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),r.length!==6)throw new Error("Invalid HEX color.");const n=parseInt(r.slice(0,2),16),a=parseInt(r.slice(2,4),16),s=parseInt(r.slice(4,6),16);return(n*299+a*587+s*114)/1e3>=128?"#000000":"#FFFFFF"},zc=(t,r,n)=>{const a=[];for(let s=0;s<n;s++){const o=s/(n-1),i=t[0]+(r[0]-t[0])*o,l=t[1]+(r[1]-t[1])*o,c=t[2]+(r[2]-t[2])*o;a.push([i,l,c].map(m=>Math.round(m)).join(", "))}return a.map(s=>`rgb(${s})`)},Xn=zc([246,226,219],[127,39,4],16),Hc=(t,r)=>{const n=t.data[r][2],a=Xn,s=0;let o=1/0,i=-1/0;for(let d=0;d<n.length;d++)n[d]>s&&(o=Math.min(o,n[d]),i=Math.max(i,n[d]));const l=i-o,c=a.length,m=Array(n.length);for(let d=0;d<n.length;d++)m[d]=n[d]===0?-1:Math.min(c-1,Math.floor(c*(n[d]-o)/l));return m},Fc=()=>(t,r)=>{const n=Math.round(devicePixelRatio);Cn.orient(t,r,(a,s,o,i,l,c,m,d,u,h,v,p,_,g)=>{const[f,b,C]=t.data[r],N=f.length,S=Hc(t,r),w=Xn??[...Array.from(new Set(S))],T=w.map(()=>new Path2D),E=N-b.lastIndexOf(b[0]),A=N/E,k=b[1]-b[0],L=f[E]-f[0],$=c(L,i,h,d)-c(0,i,h,d)-n,I=m(k,l,v,u)-m(0,l,v,u)+n,R=b.slice(0,E).map(O=>Math.round(m(O,l,v,u)-I/2)),H=Array.from({length:A},(O,U)=>Math.round(c(f[U*E],i,h,d)-$));for(let O=0;O<N;O++)if(C[O]>0&&f[O]>=(i.min||-1/0)&&f[O]<=(i.max||1/0)&&b[O]>=(l.min||-1/0)&&b[O]<=(l.max||1/0)){const U=H[~~(O/E)],W=R[O%E],ie=T[S[O]];g(ie,U,W,$,I)}t.ctx.save(),t.ctx.rect(t.bbox.left,t.bbox.top,t.bbox.width,t.bbox.height),t.ctx.clip(),T.forEach((O,U)=>{t.ctx.fillStyle=w[U],t.ctx.fill(O)}),t.ctx.restore()})},Vc=t=>{if(!t.every(o=>o.metric.le))return t;const r=t.sort((o,i)=>parseFloat(o.metric.le)-parseFloat(i.metric.le)),n=t[0]?.group||1;let a={metric:{le:""},values:[]};const s=[];for(const o of r){const i=[a.metric.le,o.metric.le].filter(c=>c).join("..."),l=[];for(const[c,m]of o.values){const d=a.values.find(h=>h[0]===c)?.[1]||0,u=+m-+d;l.push([c,`${u}`])}s.push({metric:{vmrange:i},values:l,group:n}),a=o}return s},Na=t=>{const r=(t.metric.vmrange||t.metric.le||"").split("...");return Yt(r[r.length-1])},Uc=(t,r)=>Na(t)-Na(r),qc=(t,r)=>{if(!r)return t;const n=t.sort(Uc),a=Vc(n),s={};return a.forEach(i=>i.values.forEach(([l,c])=>{const m=Number(c),d=isNaN(m)?0:m,u=s[l]||0;s[l]=u+d})),a.map(i=>{const l=i.values.map(([c,m])=>{const d=s[c];return[c,`${Math.round(+m/d*100)}`]});return{...i,values:l}}).filter(i=>!i.values.every(l=>l[1]==="0"))},Bc=t=>{Object.keys(t.hooks).forEach(r=>{t.hooks[r]=[]})},pn=t=>{const r=["__name__","for"];return Object.entries(t).filter(([n])=>!r.includes(n)).map(([n,a])=>`${n}: ${a}`).join(",")},io=t=>{const r=t?.__name__||"",n=new RegExp(`(${Object.values(ee).join("|")})$`),a=r.match(n),s=a&&a[0];return{value:/(?:^|[^a-zA-Z0-9_])y(?:$|[^a-zA-Z0-9_])/.test(r)?ee.actual:s,group:pn(t)}},Qc=(t,r,n,a)=>{const s={},o=a?0:Math.min(t.length,_a.length);for(let i=0;i<o;i++){const l=hn(t[i],n[t[i].group-1]);s[l]=_a[i]}return(i,l)=>{const c=a?io(t[l].metric):null,m=n[i.group-1],d=a?c?.group||"":hn(i,m);return{label:d,hasAlias:!!m,dash:Wc(c),width:Jc(c),stroke:Xc({metricInfo:c,label:d,isAnomalyUI:a,colorState:s}),points:Kc(c),spanGaps:!1,forecast:c?.value,forecastGroup:c?.group,freeFormFields:i.metric,show:!co(d,r),scale:"1",...jc(i)}}},jc=t=>{const r=t.values.map(i=>Yt(i[1])),{min:n,max:a,median:s,last:o}={min:Kn(r),max:Jn(r),median:Lc(r),last:kc(r)};return{median:s,statsFormatted:{min:nt(n,n,a),max:nt(a,n,a),median:nt(s,n,a),last:nt(o,n,a)}}},lo=t=>typeof t.label=="string"?t.label:"",wa=(t,r)=>({group:r,label:lo(t),color:t.stroke,checked:t.show||!1,freeFormFields:t.freeFormFields,statsFormatted:t.statsFormatted,median:t.median,hasAlias:t.hasAlias||!1}),Yc=({hideSeries:t,legend:r,metaKey:n,series:a,isAnomalyView:s})=>{const{label:o}=r,i=co(o,t),l=a.map(lo);return s?l.filter(c=>c!==o):n?i?t.filter(c=>c!==o):[...t,o]:t.length?i?[...l.filter(c=>c!==o)]:[]:[...l.filter(c=>c!==o)]},co=(t,r)=>r.includes(`${t}`),mo=t=>{for(let r=t.series.length-1;r>=0;r--)r&&t.delSeries(r)},Gc=(t,r,n=!1)=>{r.forEach((a,s)=>{a.label&&(a.spanGaps=n),s&&t.addSeries(a)})},Wc=t=>{const r=t?.value===ee.yhatLower,n=t?.value===ee.yhatUpper,a=t?.value===ee.yhat;return r||n?[10,5]:a?[10,2]:[]},Jc=t=>{const r=t?.value===ee.yhatLower,n=t?.value===ee.yhatUpper,a=t?.value===ee.yhat,s=t?.value===ee.anomaly;return n||r?.7:a?1:s?0:1.4},Kc=t=>t?.value===ee.anomaly?{size:8,width:4,space:0}:{size:4,width:0,show:!0,filter:Zc},Zc=(t,r)=>{const n=t.data[r],a=[];for(let s=0;s<n.length;s++){const o=n[s-1],i=n[s+1];o===null&&i===null&&a.push(s)}return a},Xc=({metricInfo:t,label:r,isAnomalyUI:n,colorState:a})=>{const s=a[r]||Ca(r),o=t?.value===ee.anomaly;return n&&o?At[ee.anomaly]:n&&!o&&!t?.value?At[ee.actual]:t?.value?t?.value?At[t?.value]:s:a[r]||Ca(r)},uo=({width:t=400,height:r=500})=>({width:t,height:r,series:[],tzDate:n=>q(Ht(qe(n))).local().toDate(),legend:{show:!1},cursor:{drag:{x:!0,y:!1},focus:{prox:30},points:{size:5.6,width:1.4},bind:{click:()=>null,dblclick:()=>null}}}),ho=t=>{mo(t),Bc(t),t.setData([])},po=({min:t,max:r})=>[t,r],vo=(t,r=0,n=1,a,s)=>s.limits.enable?s.limits.range[a]:Zn(r,n),ed=(t,r)=>{const n={x:{range:()=>po(r)}},a=Object.keys(t.limits.range);return(a.length?a:["1"]).forEach(s=>{n[s]={range:(o,i=0,l=1)=>vo(o,i,l,s,t)}}),n},fo=t=>r=>{const n=r.posToVal(r.select.left,"x"),a=r.posToVal(r.select.left+r.select.width,"x");t({min:n,max:a})},td=(t,r)=>{if(t.delBand(),r.length<2)return;const n=r.map((i,l)=>({...i,index:l})),a=n.filter(i=>i.forecast===ee.yhatUpper),s=n.filter(i=>i.forecast===ee.yhatLower),o=a.map(i=>{const l=s.find(c=>c.forecastGroup===i.forecastGroup);return l?{series:[i.index,l.index],fill:rd(ee.yhatUpper)}:null}).filter(i=>i!==null);o.length&&o.forEach(i=>{t.addBand(i)})};function rd(t){return`rgba(${oo(At[t])}, 0.05)`}const nd=t=>t instanceof MouseEvent,Sa=t=>nd(t)?t.clientX:t.touches[0].clientX,ad=({dragSpeed:t=.85,setPanning:r,setPlotScale:n})=>{const a=J({leftStart:0,xUnitsPerPx:0,scXMin:0,scXMax:0}),s=l=>{l.preventDefault();const c=Sa(l),{leftStart:m,xUnitsPerPx:d,scXMin:u,scXMax:h}=a.current,v=d*((c-m)*t);n({min:u-v,max:h-v})},o=()=>{r(!1),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",o)},i=()=>{document.addEventListener("mousemove",s),document.addEventListener("mouseup",o),document.addEventListener("touchmove",s),document.addEventListener("touchend",o)};return({e:l,u:c})=>{l.preventDefault(),r(!0),a.current={leftStart:Sa(l),xUnitsPerPx:c.posToVal(1,"x")-c.posToVal(0,"x"),scXMin:c.scales.x.min||0,scXMax:c.scales.x.max||0},i()}},sd=t=>{const{ctrlKey:r,metaKey:n,button:a}=t;return a===0&&(r||n)},tn=.9,go=t=>{const[r,n]=y(!1),a=ad({dragSpeed:tn,setPanning:n,setPlotScale:t});return{onReadyChart:o=>{const i=c=>{const m=c instanceof MouseEvent&&sd(c),d=window.TouchEvent&&c instanceof TouchEvent&&c.touches.length>1;(m||d)&&a({u:o,e:c})},l=c=>{if(!c.ctrlKey&&!c.metaKey)return;c.preventDefault();const{width:m}=o.over.getBoundingClientRect(),d=o.cursor.left&&o.cursor.left>0?o.cursor.left:0,u=o.posToVal(d,"x"),h=(o.scales.x.max||0)-(o.scales.x.min||0),v=c.deltaY<0?h*tn:h/tn,p=u-d/m*v,_=p+v;o.batch(()=>t({min:p,max:_}))};o.over.addEventListener("mousedown",i),o.over.addEventListener("touchstart",i),o.over.addEventListener("wheel",l)},isPanning:r}},Ta=t=>{const r=t[0].clientX-t[1].clientX,n=t[0].clientY-t[1].clientY;return Math.sqrt(r*r+n*n)},yo=({uPlotInst:t,xRange:r,setPlotScale:n})=>{const[a,s]=y(0),o=K(c=>{const{target:m,ctrlKey:d,metaKey:u,key:h}=c,v=m instanceof HTMLInputElement||m instanceof HTMLTextAreaElement;if(!t||v)return;const p=h==="+"||h==="=";if((h==="-"||p)&&!(d||u)){c.preventDefault();const f=(r.max-r.min)/10*(p?1:-1);n({min:r.min+f,max:r.max-f})}},[t,r]),i=c=>{c.touches.length===2&&(c.preventDefault(),s(Ta(c.touches)))},l=K(c=>{if(!t||c.touches.length!==2)return;c.preventDefault();const m=Ta(c.touches),d=a-m,u=t.scales.x.max||r.max,h=t.scales.x.min||r.min,v=u-h,p=d>0?-1:1,_=v/50*p;t.batch(()=>n({min:h+_,max:u-_}))},[t,a,r]);return oe("keydown",o),oe("touchmove",l),oe("touchstart",i),null},bo=({period:t,setPeriod:r})=>{const[n,a]=y({min:t.start,max:t.end}),s=({min:o,max:i})=>{const l=(i-o)*1e3;l<ca.min||l>ca.max||r({from:q(o*1e3).toDate(),to:q(i*1e3).toDate()})};return x(()=>{a({min:t.start,max:t.end})},[t]),{xRange:n,setPlotScale:s}},od=({u:t,metrics:r,series:n,unit:a,isAnomalyView:s})=>{const[o,i]=y(!1),[l,c]=y({seriesIdx:-1,dataIdx:-1}),[m,d]=y([]),u=()=>{d([]),c({seriesIdx:-1,dataIdx:-1})},h=f=>{const b=f.cursor.idx??-1;c(C=>({...C,dataIdx:b}))},v=(f,b)=>{const C=b??-1;c(N=>({...N,seriesIdx:C}))},p=K(()=>{const{seriesIdx:f,dataIdx:b}=l,C=r[f-1],N=n[f],S=new Set(r.map($=>$.group)),w=C?.group||0,T=t?.data?.[f]?.[b]||0,E=t?.scales?.[1]?.min||0,A=t?.scales?.[1]?.max||1,k=t?.data?.[0]?.[b]||0,L={top:t?t.valToPos(T||0,N?.scale||"1"):0,left:t?t.valToPos(k,"x"):0};return{unit:a,point:L,u:t,id:`${f}_${b}`,title:S.size>1&&!s?`Query ${w}`:"",dates:[k?q(k*1e3).tz().format(gr):"-"],value:nt(T,E,A),info:Dc(C,N),statsFormatted:N?.statsFormatted,marker:`${N?.stroke}`}},[t,l,r,n,a,s]),_=K(()=>{if(!o)return;const f=p();m.find(b=>b.id===f.id)||d(b=>[...b,f])},[p,m,o]),g=f=>{d(b=>b.filter(C=>C.id!==f))};return x(()=>{i(l.dataIdx!==-1&&l.seriesIdx!==-1)},[l]),oe("click",_),{showTooltip:o,stickyTooltips:m,handleUnStick:g,getTooltipProps:p,seriesFocus:v,setCursor:h,resetTooltips:u}},Ea=({u:t,id:r,title:n,dates:a,value:s,point:o,unit:i="",info:l,statsFormatted:c,isSticky:m,marker:d,onClose:u})=>{const h=J(null),[v,p]=y({top:-999,left:-999}),[_,g]=y(!1),[f,b]=y(!1),C=()=>{u&&u(r)},N=E=>{b(!0),g(!0);const{clientX:A,clientY:k}=E;p({top:k,left:A})},S=K(E=>{if(!_)return;const{clientX:A,clientY:k}=E;p({top:k,left:A})},[_]),w=()=>{g(!1)};return x(()=>{if(!h.current||!t)return;const{top:E,left:A}=o,k={left:parseFloat(t.over.style.left),top:parseFloat(t.over.style.top)},{width:L,height:$}=t.over.getBoundingClientRect(),{width:I,height:R}=h.current.getBoundingClientRect(),H=10,O=A+I>=L?I+2*H:0,U=E+R>=$?R+2*H:0,W={top:E+k.top+H-U,left:A+k.left+H-O};W.left<0&&(W.left=20),W.top<0&&(W.top=20),p(W)},[t,s,o,h]),oe("mousemove",S),oe("mouseup",w),t?Lt(e("div",{className:M({"vm-chart-tooltip":!0,"vm-chart-tooltip_sticky":m,"vm-chart-tooltip_moved":f}),ref:h,style:v,children:[e("div",{className:"vm-chart-tooltip-header",children:[n&&e("div",{className:"vm-chart-tooltip-header__title",children:n}),e("div",{className:"vm-chart-tooltip-header__date",children:a.map((E,A)=>e("span",{children:E},A))}),m&&e(V,{children:[e(z,{className:"vm-chart-tooltip-header__drag",variant:"text",size:"small",startIcon:e(Hn,{}),onMouseDown:N,ariaLabel:"drag the tooltip"}),e(z,{className:"vm-chart-tooltip-header__close",variant:"text",size:"small",startIcon:e(De,{}),onClick:C,ariaLabel:"close the tooltip"})]})]}),e("div",{className:"vm-chart-tooltip-data",children:[d&&e("span",{className:"vm-chart-tooltip-data__marker",style:{background:d}}),e("p",{className:"vm-chart-tooltip-data__value",children:[e("b",{children:s}),i]})]}),c&&e("table",{className:"vm-chart-tooltip-stats",children:Sn.map((E,A)=>e("div",{className:"vm-chart-tooltip-stats-row",children:[e("span",{className:"vm-chart-tooltip-stats-row__key",children:[E,":"]}),e("span",{className:"vm-chart-tooltip-stats-row__value",children:c[E]})]},A))}),l&&e("p",{className:"vm-chart-tooltip__info",children:l})]}),t.root):null},_o=({showTooltip:t,tooltipProps:r,stickyTooltips:n,handleUnStick:a})=>e(V,{children:[t&&r&&e(Ea,{...r}),n.map(s=>Go(Ea,{...s,isSticky:!0,key:s.id,onClose:a}))]}),id=({data:t,series:r,metrics:n=[],period:a,yaxis:s,unit:o,setPeriod:i,layoutSize:l,height:c,isAnomalyView:m,spanGaps:d=!1})=>{const{isDarkTheme:u}=re(),h=J(null),[v,p]=y(),{xRange:_,setPlotScale:g}=bo({period:a,setPeriod:i}),{onReadyChart:f,isPanning:b}=go(g);yo({uPlotInst:v,xRange:_,setPlotScale:g});const{showTooltip:C,stickyTooltips:N,handleUnStick:S,getTooltipProps:w,seriesFocus:T,setCursor:E,resetTooltips:A}=od({u:v,metrics:n,series:r,unit:o,isAnomalyView:m}),k={...uo({width:l.width,height:c}),series:r,axes:ao([{},{scale:"1"}],o),scales:ed(s,_),hooks:{ready:[f],setSeries:[T],setCursor:[E],setSelect:[fo(g)],destroy:[ho]},bands:[]};return x(()=>{if(A(),!h.current)return;v&&v.destroy();const L=new Cn(k,t,h.current);return p(L),L.destroy},[h,u]),x(()=>{v&&(v.setData(t),v.redraw())},[t]),x(()=>{v&&(mo(v),Gc(v,r,d),td(v,r),v.redraw())},[r,d]),x(()=>{v&&(Object.keys(s.limits.range).forEach(L=>{v.scales[L]&&(v.scales[L].range=($,I=0,R=1)=>vo($,I,R,L,s))}),v.redraw())},[s]),x(()=>{v&&(v.scales.x.range=()=>po(_),v.redraw())},[_]),x(()=>{v&&(v.setSize({width:l.width||400,height:c||500}),v.redraw())},[c,l]),e("div",{className:M({"vm-line-chart":!0,"vm-line-chart_panning":b}),style:{minWidth:`${l.width||400}px`,minHeight:`${c||500}px`},children:[e("div",{className:"vm-line-chart__u-plot",ref:h}),e(_o,{showTooltip:C,tooltipProps:w(),stickyTooltips:N,handleUnStick:S})]})};var Rt=(t=>(t.view="legend_view",t.hideDuplicates="legend_hide_duplicates",t.hideStats="legend_hide_stats",t.format="legend_format",t.group="legend_group",t))(Rt||{}),vn=(t=>(t.table="table",t.lines="lines",t))(vn||{});const ir=Rt.view,Co=()=>{const[t,r]=de(),n=t.get(ir),[a,s]=y(n||"lines"),o=i=>{i==="table"?t.set(ir,i):t.delete(ir),s(i),r(t)};return x(()=>{const i=t.get(ir);i!==a&&s(i)},[t]),{view:a,isLinesView:a==="lines",isTableView:a==="table",onChange:o}},ld=t=>Object.keys(t.freeFormFields).filter(n=>n!=="__name__").map(n=>{const a=`${n}=${JSON.stringify(t.freeFormFields[n])}`;return{id:`${t.label}.${a}`,freeField:a,key:n}}),lr=Rt.hideStats,ea=()=>{const[t,r]=de(),n=t.get(lr)==="true",[a,s]=y(n),o=i=>{i?t.set(lr,"true"):t.delete(lr),s(i),r(t)};return x(()=>{const i=t.get(lr)==="true";i!==a&&s(i)},[t]),{hideStats:a,onChange:o}},cr=Rt.format,No=()=>{const[t,r]=de(),n=t.get(cr)||"",[a,s]=y(n),o=l=>{s(l)},i=()=>{a?t.set(cr,a):t.delete(cr),r(t)};return x(()=>{const l=t.get(cr);l!==a&&s(l||"")},[t]),{format:a,onChange:o,onApply:i}},cd=({legend:t,onChange:r,duplicateFields:n,isAnomalyView:a})=>{const s=Ye(),{hideStats:o}=ea(),{format:i}=No(),l=Ks(t.freeFormFields,i),c=D(()=>{const v=ld(t);return n?.length?v.filter(p=>!n.includes(p.key)):v},[t,n]),m=t.statsFormatted,d=Object.values(m).some(v=>v),u=v=>p=>{r&&r(v,p.ctrlKey||p.metaKey)},h=v=>async p=>{p.stopPropagation(),await s(v,`${v} has been copied`)};return e("div",{className:M({"vm-legend-item":!0,"vm-legend-row":!0,"vm-legend-item_hide":!t.checked}),onClick:u(t),children:[!a&&e("div",{className:"vm-legend-item__marker",style:{backgroundColor:t.color}}),e("div",{className:"vm-legend-item-info",children:e("span",{className:"vm-legend-item-info__label",children:[t.hasAlias&&t.label,!t.hasAlias&&i&&l,!t.hasAlias&&!i&&e(V,{children:[t.freeFormFields.__name__,!!c.length&&e(V,{children:" {"}),c.map((v,p)=>e("span",{className:"vm-legend-item-info__free-fields",onClick:h(v.freeField),title:"copy to clipboard",children:[v.freeField,p+1<c.length&&","]},v.key)),!!c.length&&e(V,{children:"}"})]})]})}),!o&&d&&e("div",{className:"vm-legend-item-stats",children:Sn.map((v,p)=>e("div",{className:"vm-legend-item-stats-row",children:[e("span",{className:"vm-legend-item-stats-row__key",children:[v,":"]}),e("span",{className:"vm-legend-item-stats-row__value",children:m[v]})]},p))})]})},dd=({labels:t,isAnomalyView:r,duplicateFields:n,onChange:a})=>e("div",{className:"vm-legend-item-container",children:t.map(s=>e(cd,{legend:s,isAnomalyView:r,duplicateFields:n,onChange:a},s.label))});function md(t,r){return Object.fromEntries(Object.entries(t).filter(r))}function Br(t){return md(t,r=>!!r[1]||typeof r[1]=="number")}const Aa=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),wo=(t,r)=>Aa(t)&&t[r]?t[r]:r.split(".").reduce((n,a)=>{if(Aa(n))return n[a];if(Array.isArray(n)){const s=parseInt(a,10);return n[s]!==void 0?n[s]:void 0}},t),ud=Sn.map(t=>({key:`statsFormatted.${t}`,title:t})),hd=({labels:t,duplicateFields:r,onChange:n})=>{const{hideStats:a}=ea(),s=a?[]:ud,i=D(()=>{const m=[...new Set(t.flatMap(d=>Object.keys(d.freeFormFields)))].map(d=>({key:`freeFormFields.${d}`,title:d}));return r?.length?m.filter(d=>!r.includes(d.title)):m},[t,r]).concat(s),l=m=>d=>{n&&n(m,d.ctrlKey||d.metaKey)},c=K((m,d)=>{const u=wo(m,d);return typeof u=="string"?u:""},[]);return e("div",{className:"vm-legend-table__wrapper",children:e("table",{className:"vm-legend-table",children:[e("thead",{className:"vm-legend-table-thead",children:e("tr",{className:"vm-legend-table-row vm-legend-table_thead",children:[e("th",{className:"vm-legend-table-col vm-legend-table-col_marker vm-legend-table-col_thead"}),i.map(m=>e("th",{className:"vm-legend-table-col vm-legend-table-col_thead",children:m.title},m.key))]})}),e("tbody",{className:"vm-legend-table-tbody",children:t.map(m=>e("tr",{className:M({"vm-legend-table-row":!0,"vm-legend-table-row_tbody":!0,"vm-legend-table-row_exclude":!m.checked}),onClick:l(m),children:[e("td",{className:"vm-legend-table-col vm-legend-table-col_marker",children:e("div",{className:"vm-legend-item__marker",style:{backgroundColor:m.color}})}),i.map(d=>e("td",{className:"vm-legend-table-col",children:e("span",{className:"vm-legend-table-col__content",children:c(m,d.key)})},`${d.key}_${m.label}`))]},m.label))})]})})},dr=Rt.hideDuplicates,So=t=>{const[r,n]=de(),a=r.get(dr)==="true",[s,o]=y(a),i=c=>{c?r.set(dr,"true"):r.delete(dr),o(c),n(r)};x(()=>{const c=r.get(dr)==="true";c!==s&&o(c)},[r]);const l=D(()=>!s||!t?.length||t?.length<2?[]:[...new Set(t.flatMap(m=>Object.keys(m.freeFormFields||{})))].filter(m=>{const d=t.find(u=>u.freeFormFields[m])?.freeFormFields[m];return t.every(u=>u.freeFormFields[m]===d)}),[t,s]);return{hideDuplicates:s,onChange:i,duplicateFields:l}},fn="Ungrouped",mr=Rt.group,ta=()=>{const[t,r]=de(),n=t.get(mr)||"",[a,s]=y(n),o=i=>{i&&i!==fn?t.set(mr,i):t.delete(mr),s(i),r(t)};return x(()=>{const i=t.get(mr);i!==a&&s(i||"")},[t]),{groupByLabel:a,onChange:o}},pd=({labels:t,group:r,isAnomalyView:n,onChange:a})=>{const{isTableView:s}=Co(),{groupByLabel:o}=ta(),i=Ye(),{duplicateFields:l}=So(t),c=D(()=>t.sort((u,h)=>(h.median||0)-(u.median||0)),[t]),m=u=>async h=>{h.stopPropagation(),await i(u,`${u} has been copied`)},d=s?hd:dd;return e("div",{className:"vm-legend-group",children:e(_t,{defaultExpanded:!0,title:e("div",{className:"vm-legend-group-header",children:[e("div",{className:"vm-legend-group-header-title",children:["Group by",o?"":" query",": ",e("b",{children:r})]}),!!l.length&&e("div",{className:"vm-legend-group-header-labels",children:["common labels: {",l.map(u=>e("div",{onClick:m(`${u}="${t[0].freeFormFields[u]}"`),className:"vm-legend-group-header-labels__item",children:`${u}="${t[0].freeFormFields[u]}"`},u)),"}"]})]}),children:e(d,{labels:c,isAnomalyView:n,duplicateFields:l,onChange:a})})},r)},vd=({labels:t,query:r,groupByLabel:n})=>D(()=>fd(t,r,n),[t,r,n]),fd=(t,r,n)=>{const a=new Map;for(const s of t){const o=n?`${n}="${s.freeFormFields[n]??""}"`:`${r[s.group-1]}`;a.has(o)||a.set(o,{group:String(o),items:[]});const i=a.get(o);i.items.some(c=>c.label===s.label)||i.items.push(s)}return Array.from(a.values())},gd=({values:t,itemClassName:r,onRemoveItem:n})=>{const{isMobile:a}=j(),s=o=>i=>{n(o),i.stopPropagation()};return a?e("span",{className:"vm-select-input-content__counter",children:["selected ",t.length]}):e(V,{children:t.map(o=>e("div",{className:`vm-select-input-content__selected ${r} ${o.toLowerCase().replace(" ","-")}`,children:[e("span",{children:o}),e("div",{onClick:s(o),children:e(De,{})})]},o))})},at=({value:t,list:r,label:n,itemClassName:a,placeholder:s,noOptionsText:o,clearable:i=!1,searchable:l=!1,autofocus:c,disabled:m,includeAll:d,onChange:u})=>{const{isDarkTheme:h}=re(),{isMobile:v}=j(),[p,_]=y(""),g=J(null),[f,b]=y(null),[C,N]=y(!1),S=[...r],w=J(null),T=Array.isArray(t);let E=Array.isArray(t)?t.slice():[];const A=v&&T&&!!E?.length,k=D(()=>C?p:Array.isArray(t)?"":t,[t,p,C,T]),L=D(()=>C?p||"(.+)":"",[p,C]),$=()=>{w.current&&w.current.blur()},I=()=>{N(!1),$()},R=()=>{m||N(!0)},H=()=>{S.includes(p)&&u(p)},O=Q=>{Q.target instanceof HTMLInputElement||m||N(ae=>!ae)},U=Q=>{_(""),u(Q),T||I(),T&&w.current&&w.current.focus()},W=Q=>{_(Q.target.value)},ie=Q=>ae=>{U(Q),ae.stopPropagation()},me=Q=>{w.current!==Q.target&&N(!1)};return x(()=>{_(""),C&&w.current&&w.current.focus(),C||$()},[C,w]),x(()=>{!c||!w.current||v||w.current.focus()},[c,w]),oe("keyup",me),Hr(g,I,f),d&&!S.includes("All")&&S.push("All"),d&&(!E?.length||E?.length===S?.length)&&(E=["All"]),e("div",{className:M({"vm-select":!0,"vm-select_dark":h,"vm-select_disabled":m}),children:[e("div",{className:"vm-select-input",onClick:O,ref:g,children:[e("div",{className:"vm-select-input-content",children:[!!E?.length&&e(gd,{itemClassName:a,values:E,onRemoveItem:U}),!A&&!E?.length&&e("input",{value:k,type:"text",placeholder:s,onInput:W,onFocus:R,onBlur:H,disabled:m,ref:w,readOnly:v||!l})]}),n&&e("span",{className:"vm-text-field__label",children:n}),i&&t&&e("div",{className:"vm-select-input__icon",onClick:ie(""),children:e(De,{})}),e("div",{className:M({"vm-select-input__icon":!0,"vm-select-input__icon_open":C}),children:e(We,{})})]}),e(Gs,{itemClassName:a,label:n,value:L,options:S.map(Q=>({value:Q})),anchor:g,selected:E,minLength:1,fullWidth:!0,noOptionsText:o,onSelect:U,onOpenAutocomplete:N,onChangeWrapperRef:b})]})},To=({data:t,isCompact:r})=>{const{isTableView:n,onChange:a}=Co(),{hideDuplicates:s,onChange:o}=So(),{hideStats:i,onChange:l}=ea(),{format:c,onChange:m,onApply:d}=No(),{groupByLabel:u,onChange:h}=ta(),v=Xe(),p=D(()=>{if(!t||!t.length)return[];const C=t.flatMap(N=>Object.keys(N.metric));return Array.from(new Set(C))},[t]),_=C=>{const N=C?vn.table:vn.lines;a(N)},g=()=>{v({type:"SET_OPEN_SETTINGS",payload:!0})},f=[{label:"Table View",value:n,onChange:_,info:"If enabled, the legend will be displayed in a table format."},{label:"Hide Common Labels",value:s,onChange:o,info:"If enabled, hides labels that are the same for all series."},{label:"Hide Statistics",value:i,onChange:l,info:"If enabled, hides the display of min, median, and max values."}],b=r?Y:V;return e("div",{className:M({"vm-legend-configs":!0,"vm-legend-configs_compact":r}),children:[f.map(({label:C,value:N,onChange:S,info:w})=>e(b,{title:w,children:e("div",{className:"vm-legend-configs-item vm-legend-configs-item_switch",children:[e("span",{className:"vm-legend-configs-item__label",children:C}),e(Be,{label:`${r?C:N?"Enabled":"Disabled"}`,value:N,onChange:S}),e("span",{className:"vm-legend-configs-item__info",children:w})]})},C)),r&&e(z,{size:"small",variant:"text",startIcon:e(mt,{}),onClick:g,children:"Settings"}),!r&&e(V,{children:[e("div",{className:"vm-legend-configs-item",children:[e(se,{label:"Custom Legend Format",placeholder:"{{label_name}}",value:c,onChange:m,onBlur:d,onEnter:d}),e("span",{className:"vm-legend-configs-item__info vm-legend-configs-item__info_input",children:"Customize legend labels with text and {{label_name}} placeholders."})]}),e("div",{className:"vm-legend-configs-item",children:[e(at,{label:"Group Legend By",value:u,list:[fn,...p],placeholder:fn,onChange:h,searchable:!0}),e("span",{className:"vm-legend-configs-item__info",children:"Choose a label to group the legend. By default, legends are grouped by query."})]})]})]})},yd=({labels:t,query:r,isAnomalyView:n,isPredefinedPanel:a,onChange:s})=>{const{groupByLabel:o}=ta(),i=vd({labels:t,query:r,groupByLabel:o});return e("div",{className:"vm-legend",children:[!a&&e(To,{isCompact:!0}),e("div",{children:i.map(({group:l,items:c})=>e(pd,{labels:c,group:l,isAnomalyView:n,onChange:s},l))})]})},bd=({min:t,max:r,legendValue:n})=>{const[a,s]=y(0),[o,i]=y(""),[l,c]=y(""),[m,d]=y(""),u=D(()=>parseFloat(String(n?.value||0).replace("%","")),[n]);return x(()=>{s(u?(u-t)/(r-t)*100:0),i(u?`${u}%`:""),c(`${t}%`),d(`${r}%`)},[u,t,r]),e("div",{className:"vm-legend-heatmap__wrapper",children:e("div",{className:"vm-legend-heatmap",children:[e("div",{className:"vm-legend-heatmap-gradient",style:{background:`linear-gradient(to right, ${Xn.join(", ")})`},children:!!u&&e("div",{className:"vm-legend-heatmap-gradient__value",style:{left:`${a}%`},children:e("span",{children:o})})}),e("div",{className:"vm-legend-heatmap__value",children:l}),e("div",{className:"vm-legend-heatmap__value",children:m})]})})},_d=({u:t,metrics:r,unit:n})=>{const[a,s]=y({left:0,top:0}),[o,i]=y([]),l=()=>{i([]),s({left:0,top:0})},c=h=>{const v=h.cursor.left||0,p=h.cursor.top||0;s({left:v,top:p})},m=K(()=>{const{left:h,top:v}=a,p=t?.data[1][0]||[],_=t?t.posToVal(h,"x"):0,g=t?t.posToVal(v,"y"):0,f=p.findIndex((k,L)=>_>=k&&_<p[L+1])||-1,b=p[f+1],C=r[Math.round(g)]||{values:[]},[N=0,S=""]=C.values.find(k=>k[0]===b)||[],w=p[f],T=q(w*1e3).tz().format(gr),E=q(N*1e3).tz().format(gr),A=C?.metric?.vmrange||"";return{unit:n,point:a,u:t,id:`${A}_${T}`,dates:[T,E],value:`${S}%`,info:A,show:+S>0}},[t,a,r,n]),d=K(()=>{const h=m();h.show&&(o.find(v=>v.id===h.id)||i(v=>[...v,h]))},[m,o]),u=h=>{i(v=>v.filter(p=>p.id!==h))};return oe("click",d),{stickyTooltips:o,handleUnStick:u,getTooltipProps:m,setCursor:c,resetTooltips:l}},Cd=({data:t,metrics:r=[],period:n,unit:a,setPeriod:s,layoutSize:o,height:i,onChangeLegend:l})=>{const{isDarkTheme:c}=re(),m=J(null),[d,u]=y(),{xRange:h,setPlotScale:v}=bo({period:n,setPeriod:s}),{onReadyChart:p,isPanning:_}=go(v);yo({uPlotInst:d,xRange:h,setPlotScale:v});const{stickyTooltips:g,handleUnStick:f,getTooltipProps:b,setCursor:C,resetTooltips:N}=_d({u:d,metrics:r,unit:a}),S=D(()=>b(),[b]),w=()=>{const E=ao([{}],a);return[...E,{scale:"y",stroke:E[0].stroke,font:E[0].font,size:so,splits:r.map((A,k)=>k),values:r.map(A=>A.metric.vmrange)}]},T={...uo({width:o.width,height:i}),mode:2,series:[{},{paths:Fc(),facets:[{scale:"x",auto:!0,sorted:1},{scale:"y",auto:!0}]}],axes:w(),scales:{x:{time:!0},y:{log:2,time:!1,range:(E,A,k)=>[A-1,k+1]}},hooks:{ready:[p],setCursor:[C],setSelect:[fo(v)],destroy:[ho]}};return x(()=>{N();const E=t[0]===null&&Array.isArray(t[1]);if(!m.current||!E)return;const A=new Cn(T,t,m.current);return u(A),A.destroy},[m,t,c]),x(()=>{d&&(d.setSize({width:o.width||400,height:i||500}),d.redraw())},[i,o]),x(()=>{l(S)},[S]),e("div",{className:M({"vm-line-chart":!0,"vm-line-chart_panning":_}),style:{minWidth:`${o.width||400}px`,minHeight:`${i||500}px`},children:[e("div",{className:"vm-line-chart__u-plot",ref:m}),e(_o,{showTooltip:!!S.show,tooltipProps:S,stickyTooltips:g,handleUnStick:f})]})},Nd=()=>{const[t,r]=y(null),[n,a]=y({width:0,height:0}),s=K(()=>{a({width:t?.offsetWidth||0,height:t?.offsetHeight||0})},[t?.offsetHeight,t?.offsetWidth]);return oe("resize",s),x(s,[t?.offsetHeight,t?.offsetWidth]),[r,n]},wd={[ee.yhat]:"yhat",[ee.yhatLower]:"yhat_upper - yhat_lower",[ee.yhatUpper]:"yhat_upper - yhat_lower",[ee.anomaly]:"anomalies",[ee.training]:"training data",[ee.actual]:"y"},Sd=({series:t})=>{const r=D(()=>{const n=t.reduce((s,o)=>{const i=Object.prototype.hasOwnProperty.call(o,"forecast"),l=o.forecast!==ee.yhatUpper,c=!s.find(m=>m.forecast===o.forecast);return i&&c&&l&&s.push(o),s},[]),a={...n[0],forecast:ee.training,color:At[ee.training]};return n.splice(1,0,a),n.map(s=>({...s,color:typeof s.stroke=="string"?s.stroke:At[s.forecast||ee.actual]}))},[t]);return e(V,{children:e("div",{className:"vm-legend-anomaly",children:r.filter(n=>n.forecast!==ee.training).map((n,a)=>e("div",{className:"vm-legend-anomaly-item",children:[e("svg",{children:n.forecast===ee.anomaly?e("circle",{cx:"15",cy:"7",r:"4",fill:n.color,stroke:n.color,strokeWidth:"1.4"}):e("line",{x1:"0",y1:"7",x2:"30",y2:"7",stroke:n.color,strokeWidth:n.width||1,strokeDasharray:n.dash?.join(",")})}),e("div",{className:"vm-legend-anomaly-item__title",children:wd[n.forecast||ee.actual]})]},`${a}_${n.forecast}`))})})},Qr=({data:t=[],period:r,customStep:n,query:a,yaxis:s,unit:o,showLegend:i=!0,setYaxisLimits:l,setPeriod:c,alias:m=[],fullWidth:d=!0,height:u,isHistogram:h,isAnomalyView:v,isPredefinedPanel:p,spanGaps:_})=>{const g=Xe(),{isMobile:f}=j(),{timezone:b}=pe(),C=D(()=>n||r.step||"1s",[r.step,n]),N=D(()=>qc(t,h),[h,t]),[S,w]=y([[]]),[T,E]=y([]),[A,k]=y([]),[L,$]=y([]),[I,R]=y(null),H=D(()=>Qc(N,L,m,v),[N,L,m,v]),O=ne=>{const F=Rc(ne,!h);l(F)},U=(ne,F)=>{$(Yc({hideSeries:L,legend:ne,metaKey:F,series:T,isAnomalyView:v}))},W=ne=>{const F=ne.slice(1,ne.length),P=[],B=[];F.forEach((te,le)=>{te.forEach((ue,fe)=>{const be=fe*F.length+le;B[be]=ue})}),ne[0].forEach(te=>{const le=new Array(F.length).fill(te);P.push(...le)});const Z=new Array(P.length).fill(0).map((te,le)=>le%F.length);return[null,[P,Z,B]]},ie=ne=>v?Yl(ne,["group","label"]).map(P=>{const B=P.values[0];return{...B,freeFormFields:{...B.freeFormFields,__name__:""}}}):ne;x(()=>{const ne=[],F={},P=[],B=[{}];N?.forEach((fe,be)=>{const Ne=H(fe,be);B.push(Ne),P.push(wa(Ne,fe.group));const ke=F[fe.group]||[];for(const we of fe.values)ne.push(we[0]),ke.push(Yt(we[1]));F[fe.group]=ke});const Z=Pc(ne,C,r),te=N.map(fe=>{const be=[],Ne=fe.values,ke=Ne.length;let we=0;for(const tt of Z){for(;we<ke&&Ne[we][0]<tt;)we++;let Nt=null;we<ke&&Ne[we][0]==tt&&(Nt=Yt(Ne[we][1]),Number.isFinite(Nt)||(Nt=null)),be.push(Nt)}const Te=be.filter(tt=>tt!==null),Ct=Math.abs(xc(Te)),Re=Zn(Kn(Te),Jn(Te)),Je=Math.abs(Re[1]-Re[0]);return Ct>Je*1e10&&!v?be.map(()=>Ct):be});te.unshift(Z),O(F);const le=h?W(te):te;w(le),E(B);const ue=ie(P);k(ue),v&&$(ue.map(fe=>fe.label||"").slice(1))},[N,b,h,C]),x(()=>{const ne=[],F=[{}];N?.forEach((P,B)=>{const Z=H(P,B);F.push(Z),ne.push(wa(Z,P.group))}),E(F),k(ie(ne))},[L]);const[me,Q]=Nd(),ae=S[0]?.length>0;return x(()=>{const F=(()=>{if(!h||!N[1])return!1;try{return(S?.[1]?.[2]||[]).every(B=>B===null)}catch{return!1}})();g({type:"SET_IS_EMPTY_HISTOGRAM",payload:F})},[S,h]),e("div",{className:M({"vm-graph-view":!0,"vm-graph-view_full-width":d,"vm-graph-view_full-width_mobile":d&&f}),ref:me,children:[!h&&ae&&e(id,{data:S,series:T,metrics:N,period:r,yaxis:s,unit:o,setPeriod:c,layoutSize:Q,height:u,isAnomalyView:v,spanGaps:_}),h&&e(Cd,{data:S,metrics:N,period:r,unit:o,setPeriod:c,layoutSize:Q,height:u,onChangeLegend:R}),v&&i&&e(Sd,{series:T}),!h&&i&&e(yd,{labels:A,query:a,isAnomalyView:v,onChange:U,isPredefinedPanel:p}),h&&i&&e(bd,{min:s.limits.range[1][0]||0,max:s.limits.range[1][1]||0,legendValue:I})]})},Td=({yaxis:t,setYaxisLimits:r,toggleEnableLimits:n})=>{const{isMobile:a}=j(),s=D(()=>Object.keys(t.limits.range),[t.limits.range]),i=K(kt((c,m,d)=>{const u=t.limits.range;u[m][d]=+c,!(u[m][0]===u[m][1]||u[m][0]>u[m][1])&&r(u)},500),[t.limits.range]),l=(c,m)=>d=>{i(d,c,m)};return e("div",{className:M({"vm-axes-limits":!0,"vm-axes-limits_mobile":a}),children:[e("div",{className:"vm-graph-settings-row",children:[e("span",{className:"vm-graph-settings-row__label",children:"Fixed Y-axis limits"}),e(Be,{value:t.limits.enable,onChange:n,label:t.limits.enable?"Enabled":"Disabled",fullWidth:a})]}),e("span",{className:"vm-legend-configs-item__info",children:"Enables manual setting of min and max values for the y-axis."}),t.limits.enable&&e("div",{className:"vm-axes-limits-list",children:s.map(c=>e("div",{className:"vm-axes-limits-list__inputs",children:[e(se,{label:`Min ${c}`,type:"number",disabled:!t.limits.enable,value:t.limits.range[c][0],onChange:l(c,0)}),e(se,{label:`Max ${c}`,type:"number",disabled:!t.limits.enable,value:t.limits.range[c][1],onChange:l(c,1)})]},c))})]})},Ed=({spanGaps:t,onChange:r})=>{const{isMobile:n}=j();return e("div",{className:"vm-graph-settings-row",children:[e("span",{className:"vm-graph-settings-row__label",children:"Connect null values"}),e(Be,{value:t,onChange:r,label:t?"Enabled":"Disabled",fullWidth:n}),e("span",{className:"vm-legend-configs-item__info",children:"Connects data points by skipping null values instead of creating gaps."})]})},Eo=()=>{const[t,r]=de(),n=Qe();return{handleChange:(s,o)=>{s?t.delete("display_mode"):t.set("display_mode","lines"),r(t),n({type:"RUN_QUERY"}),o&&o()}}},Ad=({onChange:t})=>{const{isMobile:r}=j(),{handleChange:n}=Eo(),[a]=de(),s=!a.get("display_mode");return e("div",{className:"vm-graph-settings-row",children:[e("span",{className:"vm-graph-settings-row__label",children:"Histogram mode"}),e(Be,{value:s,onChange:i=>{n(i,t)},label:s?"Enabled":"Disabled",fullWidth:r})]})},xa="Graph & Legend Settings",ra=({data:t,yaxis:r,setYaxisLimits:n,toggleEnableLimits:a,spanGaps:s})=>{const{openSettings:o}=Me(),i=Xe(),l=J(null),c=J(null),m=Yn(t),{value:d,setTrue:u,setFalse:h}=ce(!1);return x(()=>{o&&(u(),i({type:"SET_OPEN_SETTINGS",payload:!1}))},[o]),e("div",{className:"vm-graph-settings",children:[e(Y,{title:xa,children:e("div",{ref:c,children:e(z,{variant:"text",startIcon:e(mt,{}),onClick:u,ariaLabel:"settings"})})}),d&&e(Ce,{onClose:h,title:xa,className:"vm-graph-settings-modal",children:e("div",{className:"vm-graph-settings-body",ref:l,children:[e("div",{className:"vm-graph-settings-body-section",children:[e("h3",{className:"vm-graph-settings-body-section__title",children:"Graph Options"}),e("div",{className:"vm-graph-settings-body-section-content",children:[e(Td,{yaxis:r,setYaxisLimits:n,toggleEnableLimits:a}),e(Ed,{spanGaps:s.value,onChange:s.onChange}),m&&e(Ad,{onChange:h})]})]}),e("div",{className:"vm-graph-settings-body-section",children:[e("h3",{className:"vm-graph-settings-body-section__title",children:"Legend Options"}),e("div",{className:"vm-graph-settings-body-section-content",children:e(To,{data:t})})]})]})})]})},Ao=({isHistogram:t,graphData:r,controlsRef:n,isAnomalyView:a})=>{const{isMobile:s}=j(),{customStep:o,yaxis:i,spanGaps:l}=Me(),{period:c}=pe(),{query:m}=Le(),d=Qe(),u=Xe(),h=f=>{u({type:"SET_YAXIS_LIMITS",payload:f})},v=()=>{u({type:"TOGGLE_ENABLE_YAXIS_LIMITS"})},p=f=>{u({type:"SET_SPAN_GAPS",payload:f})},_=({from:f,to:b})=>{d({type:"SET_PERIOD",payload:{from:f,to:b}})},g=e("div",{className:"vm-custom-panel-body-header__graph-controls",children:[e(Bn,{}),e(ra,{data:r,yaxis:i,isHistogram:t,setYaxisLimits:h,toggleEnableLimits:v,spanGaps:{value:l,onChange:p}})]});return e(V,{children:[n.current&&Lt(g,n.current),e(Qr,{data:r,period:c,customStep:o,query:m,yaxis:i,setYaxisLimits:h,setPeriod:_,height:s?window.innerHeight*.5:500,isHistogram:t,isAnomalyView:a,spanGaps:l})]})},na=({data:t})=>{const r=Ye(),n=D(()=>JSON.stringify(t,null,2),[t]);return e("div",{className:"vm-json-view",children:[e("div",{className:"vm-json-view__copy",children:e(z,{variant:"outlined",onClick:async()=>{await r(n,"Formatted JSON has been copied")},children:"Copy JSON"})}),e("pre",{className:"vm-json-view__code",children:e("code",{children:n})})]})},tr=t=>{const r={};return t.forEach(n=>Object.entries(n.metric).forEach(a=>r[a[0]]?r[a[0]].options.add(a[1]):r[a[0]]={options:new Set([a[1]])})),Object.entries(r).map(n=>({key:n[0],variations:n[1].options.size})).sort((n,a)=>n.variations-a.variations)},La=(t,r)=>D(()=>r?tr(t).filter(a=>r.includes(a.key)):[],[t,r]),xo=({data:t,displayColumns:r})=>{const n=Ye(),{isMobile:a}=j(),{tableCompact:s}=Pe(),o=J(null),[i,l]=y(""),[c,m]=y("asc"),d=s?La([{group:0,metric:{Data:"Data"}}],["Data"]):La(t,r),u=C=>{const{__name__:N,...S}=C;return!N&&!Object.keys(S).length?"":N?`${N} ${JSON.stringify(S)}`:`${JSON.stringify(S)}`},v=new Set(t?.map(C=>C.group)).size>1,p=D(()=>{const C=t?.map(w=>({metadata:d.map(T=>s?hn(w,"",v):w.metric[T.key]||"-"),value:w.value?w.value[1]:"-",values:w.values?w.values.map(([T,E])=>`${E} @${T}`):[],copyValue:u(w.metric)})),N=i==="Value",S=d.findIndex(w=>w.key===i);return!N&&S===-1?C:C.sort((w,T)=>{const E=N?Number(w.value):w.metadata[S],A=N?Number(T.value):T.metadata[S];return(c==="asc"?E<A:E>A)?-1:1})},[d,t,i,c,s]),_=D(()=>p.some(C=>C.copyValue),[p]),g=C=>{m(N=>N==="asc"&&i===C?"desc":"asc"),l(C)},f=C=>()=>{g(C)},b=C=>async()=>{await n(C,"Row has been copied")};return p.length?e("div",{className:M({"vm-table-view":!0,"vm-table-view_mobile":a}),children:e("table",{className:"vm-table",ref:o,children:[e("thead",{className:"vm-table-header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:[d.map((C,N)=>e("td",{className:"vm-table-cell vm-table-cell_header vm-table-cell_sort",onClick:f(C.key),children:e("div",{className:"vm-table-cell__content",children:[C.key,e("div",{className:M({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":i===C.key,"vm-table__sort-icon_desc":c==="desc"&&i===C.key}),children:e(We,{})})]})},N)),e("td",{className:"vm-table-cell vm-table-cell_header vm-table-cell_right vm-table-cell_sort",onClick:f("Value"),children:e("div",{className:"vm-table-cell__content",children:[e("div",{className:M({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":i==="Value","vm-table__sort-icon_desc":c==="desc"}),children:e(We,{})}),"Value"]})}),_&&e("td",{className:"vm-table-cell vm-table-cell_header"})]})}),e("tbody",{className:"vm-table-body",children:p.map((C,N)=>e("tr",{className:"vm-table__row",children:[C.metadata.map((S,w)=>e("td",{className:M({"vm-table-cell vm-table-cell_no-wrap":!0,"vm-table-cell_gray":p[N-1]&&p[N-1].metadata[w]===S}),children:S},w)),e("td",{className:"vm-table-cell vm-table-cell_right vm-table-cell_no-wrap",children:C.values.length?C.values.map(S=>e("p",{children:S},S)):C.value}),_&&e("td",{className:"vm-table-cell vm-table-cell_right",children:C.copyValue&&e("div",{className:"vm-table-cell__content",children:e(Y,{title:"Copy row",children:e(z,{variant:"text",color:"gray",size:"small",startIcon:e(yt,{}),onClick:b(C.copyValue),ariaLabel:"copy row"})})})})]},N))})]})}):e(X,{variant:"warning",children:"No data to show"})},gn=({checked:t=!1,disabled:r=!1,label:n,color:a="secondary",onChange:s})=>{const o=()=>{r||s(!t)},i=M({"vm-checkbox":!0,"vm-checkbox_disabled":r,"vm-checkbox_active":t,[`vm-checkbox_${a}_active`]:t,[`vm-checkbox_${a}`]:a});return e("div",{className:i,onClick:o,children:[e("div",{className:"vm-checkbox-track",children:e("div",{className:"vm-checkbox-track__thumb",children:e(Rr,{})})}),n&&e("span",{className:"vm-checkbox__label",children:n})]})},rn="Table settings",Lo=({columns:t,selectedColumns:r=[],tableCompact:n,onChangeColumns:a,toggleTableCompact:s})=>{const[o,i]=de(),l=J(null),{value:c,toggle:m,setFalse:d}=ce(!1),[u,h]=y(""),[v,p]=y(-1),_=D(()=>r.filter(E=>!t.includes(E)),[t,r]),g=D(()=>{const E=_.concat(t);return(u?E.filter(k=>k.includes(u)):E).sort((k,L)=>k.localeCompare(L))},[t,_,u]),f=D(()=>g.every(E=>r.includes(E)),[r,g]),b=E=>{a(E);const A=new URLSearchParams(o.toString());E.length===t.length?A.delete("columns"):A.set("columns",E.map(encodeURIComponent).join(",")),i(A)},C=E=>{const A=r.includes(E)?r.filter(k=>k!==E):[...r,E];b(A)},N=()=>{b(f?r.filter(E=>!g.includes(E)):g)},S=E=>()=>{C(E)},w=()=>{p(-1)},T=E=>{const A=E.key==="ArrowUp",k=E.key==="ArrowDown",L=E.key==="Enter";(k||A||L)&&E.preventDefault(),k?p($=>$+1>g.length-1?$:$+1):A?p($=>$-1<0?$:$-1):L&&C(g[v])};return x(()=>{Fr(t,r)||o.has("columns")||a(t)},[t]),x(()=>{if(!o.has("columns"))return;const k=(o.get("columns")||"").split(",").map(decodeURIComponent).filter(Boolean);a(k)},[]),e("div",{className:"vm-table-settings",children:[e(Y,{title:rn,children:e("div",{ref:l,children:e(z,{variant:"text",startIcon:e(mt,{}),onClick:m,ariaLabel:rn})})}),c&&e(Ce,{title:rn,className:"vm-table-settings-modal",onClose:d,children:[e("div",{className:"vm-table-settings-modal-section",children:[e("div",{className:"vm-table-settings-modal-section__title",children:"Customize columns"}),e("div",{className:"vm-table-settings-modal-columns",children:[e("div",{className:"vm-table-settings-modal-columns__search",children:e(se,{placeholder:"Search columns",startIcon:e($t,{}),value:u,onChange:h,onBlur:w,onKeyDown:T,type:"search"})}),e("div",{className:"vm-table-settings-modal-columns-list",children:[!!g.length&&e("div",{className:"vm-table-settings-modal-columns-list__item vm-table-settings-modal-columns-list__item_all",children:e(gn,{checked:f,onChange:N,label:f?"Uncheck all":"Check all",disabled:n})}),!g.length&&e("div",{className:"vm-table-settings-modal-columns-no-found",children:e("p",{className:"vm-table-settings-modal-columns-no-found__info",children:"No columns found."})}),g.map((E,A)=>e("div",{className:M({"vm-table-settings-modal-columns-list__item":!0,"vm-table-settings-modal-columns-list__item_focus":A===v,"vm-table-settings-modal-columns-list__item_custom":_.includes(E)}),children:e(gn,{checked:r.includes(E),onChange:S(E),label:E,disabled:n})},E))]})]})]}),s&&n!==void 0&&e("div",{className:"vm-table-settings-modal-section",children:[e("div",{className:"vm-table-settings-modal-section__title",children:"Table view"}),e("div",{className:"vm-table-settings-modal-columns-list__item",children:e(Be,{label:"Compact view",value:n,onChange:s})})]})]})]})},xd=({liveData:t,controlsRef:r})=>{const{tableCompact:n}=Pe(),a=Pt(),[s,o]=y(),i=D(()=>tr(t||[]).map(m=>m.key),[t]),c=e(Lo,{columns:i,selectedColumns:s,onChangeColumns:o,tableCompact:n,toggleTableCompact:()=>{a({type:"TOGGLE_TABLE_COMPACT"})}});return e(V,{children:[r.current&&Lt(c,r.current),e(xo,{data:t,displayColumns:s})]})},ko=({graphData:t,liveData:r,isHistogram:n,displayType:a,controlsRef:s})=>a===ge.code&&r?e(na,{data:r}):a===ge.table&&r?e(xd,{liveData:r,controlsRef:s}):a===ge.chart&&t?e(Ao,{graphData:t,isHistogram:n,controlsRef:s}):null,Ld=e(V,{children:[e("p",{children:"Filename - specify the name for your report file."}),e("p",{children:["Default format: ",e("code",{children:["vmui_report_$",Ya,".json"]}),"."]}),e("p",{children:"This name will be used when saving your report on your device."})]}),kd=e(V,{children:[e("p",{children:["Title - specify the title that will be displayed on the ",e(Ar,{to:G.queryAnalyzer,target:"_blank",rel:"noreferrer",className:"vm-link vm-link_underlined",children:It[G.queryAnalyzer].title})," page."]}),e("p",{children:"This helps identify your report in the interface."})]}),Md=e(V,{children:[e("p",{children:"Comment (optional) - add a comment to your report."}),e("p",{children:"This can be any additional information that will be useful when reviewing the report later."})]}),Id=e(V,{children:[e("p",{children:"Query trace - enable this option to include a query trace in your report."}),e("p",{children:"This will assist in analyzing and diagnosing the query processing."})]}),Dd=e(V,{children:[e("p",{children:"Generate Report - click this button to generate and save your report. "}),e("p",{children:["After creation, the report can be downloaded and examined on the ",e(Ar,{to:G.queryAnalyzer,target:"_blank",rel:"noreferrer",className:"vm-link vm-link_underlined",children:It[G.queryAnalyzer].title})," page."]})]}),$d=[Ld,kd,Md,Id,Dd],Mo=t=>{try{return JSON.parse(t)}catch{return null}},Pd=[{title:"Write",value:!1},{title:"Preview",value:!0}],Rd=({value:t,onChange:r})=>{const{value:n,setTrue:a,setFalse:s}=ce(!1);return e("div",{className:"vm-markdown-editor",children:[e("div",{className:"vm-markdown-editor-header",children:[e("div",{className:"vm-markdown-editor-header-tabs",children:Pd.map(({title:o,value:i})=>e("div",{className:M({"vm-markdown-editor-header-tabs__tab":!0,"vm-markdown-editor-header-tabs__tab_active":n===i}),onClick:i?a:s,children:o},o))}),e("span",{className:"vm-markdown-editor-header__info",children:"Markdown is supported"})]}),n?e("div",{className:"vm-markdown-editor-preview vm-markdown",dangerouslySetInnerHTML:{__html:Er(t)}}):e(se,{type:"textarea",value:t,onChange:r})]})},Od=t=>{switch(t){case 1:return"Raw report";default:return"Report"}},zd=t=>{const r=q().utc().format(Ya);return`vmui_${t.toLowerCase().replace(/ /g,"_")}_${r}`},Hd=({fetchUrl:t,reportType:r=0})=>{const{query:n}=Le(),a=Od(r),s=zd(a),[o,i]=y(a),[l,c]=y(s),[m,d]=y(""),[u,h]=y(r===0),[v,p]=y(),[_,g]=y(!1),f=J(null),b=J(null),C=J(null),N=J(null),S=J(null),w=[b,f,C,N,S],[T,E]=y(0),{value:A,toggle:k,setFalse:L}=ce(!1),{value:$,toggle:I,setFalse:R}=ce(!1),H=K(()=>{if(t)try{return t.map((F,P)=>{const B=new URL(F);return u?B.searchParams.set("trace","1"):B.searchParams.delete("trace"),{id:P,url:B}})}catch(F){p(String(F))}},[t,u]),O=K(F=>{const P=JSON.stringify(F,null,2);Ur(P,`${l||s}.json`),L()},[l]),U=({id:F,url:P,comment:B,title:Z})=>({id:F,title:Z||a,comment:B,endpoint:ni(P.pathname)||"",params:Object.fromEntries(P.searchParams)}),W=async(F,P)=>{const B=[],Z=await F.text();return F.ok?Z.split(`
`).filter(le=>le).forEach(le=>{const ue=Mo(le);ue&&B.push({metric:ue.metric,values:ue.values.map((fe,be)=>[ue.timestamps[be]/1e3,fe])})}):p(String(Z)),{data:{result:B,resultType:"matrix"},vmui:U(P)}},ie=async(F,P)=>{const B=await F.json();if(F.ok)return B.vmui=U(P),B;{const Z=B.errorType?`${B.errorType}\r
`:"";p(`${Z}${B?.error||B?.message||"unknown error"}`)}},me=async(F,P)=>{switch(r){case 1:return await W(F,P);default:return await ie(F,P)}},Q=K(async()=>{const F=H();if(!F){p(P=>P||_e.validQuery);return}p(""),g(!0);try{const P=[];for await(const B of F){if(!B)continue;const{url:Z,id:te}=B,le=await fetch(Z),ue=await me(le,{id:te,url:Z,comment:m,title:o});P.push(ue)}P.length&&O(P)}catch(P){P instanceof Error&&P.name!=="AbortError"&&p(`${P.name}: ${P.message}`)}finally{g(!1)}},[H,m,O,n,o]),ae=F=>()=>{const P=B=>{const Z=B+F;return w[Z]?.current?Z:P(Z)};E(P)};return x(()=>{p(""),c(s),d("")},[A]),x(()=>{E(0)},[$]),e(V,{children:[e(Y,{title:"Debug query",children:e(z,{variant:"text",startIcon:e(As,{}),onClick:k,ariaLabel:"Debug query"})}),A&&e(Ce,{title:"Debug query",onClose:L,isOpen:A,children:e("div",{className:"vm-download-report",children:[e("div",{className:"vm-download-report-settings",children:[e("div",{ref:b,children:[e("div",{className:"vm-download-report-settings__title",children:"Filename"}),e(se,{value:l,onChange:c})]}),e("div",{ref:f,children:[e("div",{className:"vm-download-report-settings__title",children:"Report title"}),e(se,{value:o,onChange:i})]}),e("div",{ref:C,children:[e("div",{className:"vm-download-report-settings__title",children:"Comment"}),e(Rd,{value:m,onChange:d})]}),r===0&&e(V,{children:[e("div",{ref:N,children:e(gn,{checked:u,onChange:h,label:"Include query trace"})}),e(X,{variant:"info",children:["If confused with the query results, try viewing the raw samples for selected series in ",e(()=>e(Ar,{className:"vm-link vm-link_underlined vm-link_colored",to:G.rawQuery,children:"Raw Query"}),{})," tab."]})]})]}),v&&e(X,{variant:"error",children:v}),e("div",{className:"vm-download-report__buttons",children:[e(z,{variant:"text",onClick:I,children:"Help"}),e("div",{ref:S,children:e(z,{onClick:Q,disabled:_,children:_?"Loading data...":"Generate Report"})})]}),e(je,{open:$,buttonRef:w[T],placement:"top-left",variant:"dark",onClose:R,children:e("div",{className:"vm-download-report-helper",children:[e("div",{className:"vm-download-report-helper__description",children:$d[T]}),e("div",{className:"vm-download-report-helper__buttons",children:[T!==0&&e(z,{onClick:ae(-1),size:"small",color:"white",children:"Prev"}),e(z,{onClick:T===w.length-1?R:ae(1),size:"small",color:"white",variant:"text",children:T===w.length-1?"Close":"Next"})]})]})})]})})]})},Io=()=>{const{isEmptyHistogram:t}=Me(),{handleChange:r}=Eo();return t?e(X,{variant:"warning",children:e("div",{className:"vm-warning-heatmap-to-line",children:[e("p",{className:"vm-warning-heatmap-to-line__text",children:'The expression cannot be displayed as a heatmap. To make the graph work, disable the heatmap in the "Graph settings" or modify the expression.'}),e(z,{size:"small",color:"primary",variant:"text",onClick:()=>r(!1),children:"Switch to line chart"})]})}):null},Do=({title:t,downloadFormatOptions:r,onDownload:n})=>{const{value:a,setTrue:s,setFalse:o}=ce(!1),i=J(null),l=K(()=>{if(a){o();return}r&&r.length>0?s():(n(),o())},[n,o,a,s]),c=K(d=>r?.includes(d),[r]),m=K(d=>{const h=d.currentTarget.textContent;h&&c(h)?n(h):n(),o()},[n]);return e(V,{children:[e("div",{ref:i,children:e(Y,{title:t,children:e(z,{variant:"text",startIcon:e(Or,{}),onClick:l,ariaLabel:t})})}),r&&r.length>0&&e(je,{open:a,onClose:o,buttonRef:i,placement:"bottom-right",children:r.map(d=>e("div",{className:"vm-download-button__format-option",children:e(z,{variant:"text",onClick:m,className:"vm-download-button__format-option-button",children:d})},d))})]})},Fd=t=>t.includes(",")||t.includes(`
`)||t.includes('"')?'"'+t.replace(/"/g,'""')+'"':t,Vd=t=>tr(t).map(({key:r})=>r).join(","),Ud=(t,r)=>t?.map(n=>r.map(a=>Fd(n.metric[a.key]||"-")).join(",")),qd=t=>{const r=Vd(t);if(!r.length)return"";const n=Ud(t,tr(t));return[r,...n].join(`
`)},$o=()=>{Gn();const{isMobile:t}=j(),{displayType:r}=Pe(),{query:n}=Le(),{customStep:a}=Me(),s=Xe(),[o,i]=y([]),[l,c]=y(!n[0]),[m,d]=y(!1),u=J(null),{fetchUrl:h,isLoading:v,liveData:p,graphData:_,error:g,queryErrors:f,setQueryErrors:b,queryStats:C,warning:N,traces:S,isHistogram:w,abortFetch:T}=Vr({visible:!0,customStep:a,hideQuery:o,showAllSeries:m}),E=D(()=>{const R=H=>`vmui_export_${n.join("_")}.${H}`;return{csv:async()=>{if(!p)return;const H=qd(p);no(H,R("csv"))},json:async()=>{Ur(JSON.stringify(p),R("json"))}}},[p,n]),A=K(R=>{R&&E[R]()},[E]),k=!p?.length&&r!==ge.chart,L=!l&&g,$=R=>{i(R)},I=()=>{c(!1)};return x(()=>{s({type:"SET_IS_HISTOGRAM",payload:w})},[_]),e("div",{className:M({"vm-custom-panel":!0,"vm-custom-panel_mobile":t}),children:[e(jn,{queryErrors:l?[]:f,setQueryErrors:b,setHideError:c,stats:C,isLoading:v,onHideQuery:$,onRunQuery:I,abortFetch:T,hideButtons:{reduceMemUsage:!0}}),e(Ac,{traces:S,displayType:r}),L&&e(X,{variant:"error",children:g}),k&&e(X,{variant:"info",children:e(Ec,{})}),e(Io,{}),N&&e(qr,{warning:N,query:n,onChange:d}),e("div",{className:M({"vm-custom-panel-body":!0,"vm-custom-panel-body_mobile":t,"vm-block":!0,"vm-block_mobile":t}),children:[v&&e(Zs,{}),e("div",{className:"vm-custom-panel-body-header",ref:u,children:[e("div",{className:"vm-custom-panel-body-header__tabs",children:e(xs,{})}),r==="table"&&e(Do,{title:"Export query",onDownload:A,downloadFormatOptions:["json","csv"]}),(_||p)&&r!=="code"&&e(Hd,{fetchUrl:h})]}),e(ko,{graphData:_,liveData:p,isHistogram:w,displayType:r,controlsRef:u})]})]})},Bd=({title:t,description:r,unit:n,expr:a,showLegend:s,filename:o,alias:i})=>{const{isMobile:l}=j(),{period:c}=pe(),{customStep:m}=Me(),d=Qe(),u=J(null),[h,v]=y(!1),[p,_]=y(!1),[g,f]=y({limits:{enable:!1,range:{1:[0,0]}}}),b=D(()=>Array.isArray(a)&&a.every(L=>L),[a]),{isLoading:C,graphData:N,error:S,warning:w}=Vr({predefinedQuery:b?a:[],display:ge.chart,visible:h,customStep:m}),T=L=>{const $={...g};$.limits.range=L,f($)},E=()=>{const L={...g};L.limits.enable=!L.limits.enable,f(L)},A=({from:L,to:$})=>{d({type:"SET_PERIOD",payload:{from:L,to:$}})};return x(()=>{const L=new IntersectionObserver($=>{$.forEach(I=>v(I.isIntersecting))},{threshold:.1});return u.current&&L.observe(u.current),()=>{u.current&&L.unobserve(u.current)}},[u]),b?e("div",{className:"vm-predefined-panel",ref:u,children:[e("div",{className:"vm-predefined-panel-header",children:[e(Y,{title:e(()=>e("div",{className:"vm-predefined-panel-header__description vm-default-styles",children:[r&&e(V,{children:[e("div",{children:[e("span",{children:"Description:"}),e("div",{dangerouslySetInnerHTML:{__html:Er(r)}})]}),e("hr",{})]}),e("div",{children:[e("span",{children:"Queries:"}),e("div",{children:a.map((L,$)=>e("div",{children:L},`${$}_${L}`))})]})]}),{}),children:e("div",{className:"vm-predefined-panel-header__info",children:e(ot,{})})}),e("h3",{className:"vm-predefined-panel-header__title",children:t||""}),e(ra,{data:N||[],yaxis:g,setYaxisLimits:T,toggleEnableLimits:E,spanGaps:{value:p,onChange:_}})]}),e("div",{className:"vm-predefined-panel-body",children:[C&&e(ye,{}),S&&e(X,{variant:"error",children:S}),w&&e(X,{variant:"warning",children:w}),N&&e(Qr,{isPredefinedPanel:!0,data:N,period:c,customStep:m,query:a,yaxis:g,unit:n,alias:i,showLegend:s,setYaxisLimits:T,setPeriod:A,fullWidth:!1,height:l?window.innerHeight*.5:500,spanGaps:p})]})]}):e(X,{variant:"error",children:[e("code",{children:'"expr"'})," not found. Check the configuration file ",e("b",{children:o}),"."]})},Qd=({index:t,title:r,panels:n,filename:a})=>{const s=bt(),o=D(()=>s.width/12,[s]),[i,l]=y(!t),[c,m]=y([]);x(()=>{m(n&&n.map(b=>b.width||12))},[n]);const[d,u]=y({start:0,target:0,enable:!1}),h=K(b=>{if(!d.enable)return;const{start:C}=d,N=Math.ceil((C-b.clientX)/o);if(Math.abs(N)>=12)return;const S=c.map((w,T)=>w-(T===d.target?N:0));m(S)},[d,o]),v=(b,C)=>{u({start:b.clientX,target:C,enable:!0})},p=K(()=>{u({...d,enable:!1})},[d]),_=b=>l(b),g=b=>C=>{v(C,b)};return oe("mousemove",h),oe("mouseup",p),e("div",{className:"vm-predefined-dashboard",children:e(_t,{defaultExpanded:i,onChange:_,title:e(()=>e("div",{className:M({"vm-predefined-dashboard-header":!0,"vm-predefined-dashboard-header_open":i}),children:[(r||a)&&e("span",{className:"vm-predefined-dashboard-header__title",children:r||`${t+1}. ${a}`}),n&&e("span",{className:"vm-predefined-dashboard-header__count",children:["(",n.length," panels)"]})]}),{}),children:e("div",{className:"vm-predefined-dashboard-panels",children:Array.isArray(n)&&n.length?n.map((b,C)=>e("div",{className:"vm-predefined-dashboard-panels-panel vm-block vm-block_empty-padding",style:{gridColumn:`span ${c[C]}`},children:[e(Bd,{title:b.title,description:b.description,unit:b.unit,expr:b.expr,alias:b.alias,filename:a,showLegend:b.showLegend}),e("button",{className:"vm-predefined-dashboard-panels-panel__resizer",onMouseDown:g(C),"aria-label":"resize the panel"})]},C)):e("div",{className:"vm-predefined-dashboard-panels-panel__alert",children:e(X,{variant:"error",children:[e("code",{children:'"panels"'})," not found. Check the configuration file ",e("b",{children:a}),"."]})})})})})},jd=()=>{const{duration:t,relativeTime:r,period:{date:n}}=pe(),{customStep:a}=Me(),{setSearchParamsFromKeys:s}=et(),o=()=>{const i=Br({"g0.range_input":t,"g0.end_input":n,"g0.step_input":a,"g0.relative_time":r});s(i)};x(o,[t,r,n,a]),x(o,[])},Yd=()=>{jd();const{isMobile:t}=j(),{dashboardsSettings:r,dashboardsLoading:n,dashboardsError:a}=ks(),[s,o]=y(0),i=D(()=>r.map((v,p)=>({label:v.title||"",value:p})),[r]),l=D(()=>r[s]||{},[r,s]),c=D(()=>l?.rows,[l]),m=D(()=>l.title||l.filename||"",[l]),d=D(()=>Array.isArray(c)&&!!c.length,[c]),u=v=>{o(v)},h=v=>()=>{u(v)};return e("div",{className:"vm-predefined-panels",children:[n&&e(ye,{}),!r.length&&a&&e(X,{variant:"error",children:a}),!r.length&&e(X,{variant:"info",children:"Dashboards not found"}),i.length>1&&e("div",{className:M({"vm-predefined-panels-tabs":!0,"vm-predefined-panels-tabs_mobile":t}),children:i.map(v=>e("div",{className:M({"vm-predefined-panels-tabs__tab":!0,"vm-predefined-panels-tabs__tab_active":v.value==s}),onClick:h(v.value),children:v.label},v.value))}),e("div",{className:"vm-predefined-panels__dashboards",children:[d&&c.map((v,p)=>e(Qd,{index:p,filename:m,title:v.title,panels:v.panels},`${s}_${p}`)),!!r.length&&!d&&e(X,{variant:"error",children:[e("code",{children:'"rows"'})," not found. Check the configuration file ",e("b",{children:m}),"."]})]})]})},nn=(t,r)=>{const n=r.match?"&match[]="+encodeURIComponent(r.match):"",a=r.focusLabel?"&focusLabel="+encodeURIComponent(r.focusLabel):"";return`${t}/api/v1/status/tsdb?topN=${r.topN}&date=${r.date}${n}${a}`},Gd=(t,r)=>{const n=new URLSearchParams(Object.entries(r).filter(([a,s])=>s!=null)).toString();return`${t}/api/v1/status/metric_names_stats?${n}`},rr={id:"action",label:"",modifiers:["action"]},nr={id:"diff",label:"1d",info:"Shows the absolute difference compared to the previous day.",sortable:!0,modifiers:["compact"]},ar={id:"diffPercent",label:"1d %",info:"Shows the percentage difference compared to the previous day.",sortable:!0,modifiers:["compact"]},jr={id:"value",label:"Number of series",sortable:!0,modifiers:["compact"]},Wd=[{id:"name",label:"Metric name",sortable:!0},jr,{id:"requestsCount",label:"Requests count",sortable:!0,modifiers:["compact"],info:"The number of times this metric was queried since stats collection began."},{id:"lastRequestTimestamp",label:"Last request",sortable:!0,modifiers:["compact"],info:"The last time this metric was used in a query since stats collection began."},nr,ar,{id:"percentage",label:"Share in total",info:"Shows the share of a metric to the total number of series"},rr],Jd=[{id:"name",label:"Label name",sortable:!0},jr,nr,ar,{id:"percentage",label:"Share in total",info:"Shows the share of the label to the total number of series"},rr],Kd=[{id:"name",label:"Label value",sortable:!0},jr,nr,ar,{id:"percentage",label:"Share in total"},rr],Zd=[{id:"name",label:"Label=value pair",sortable:!0},jr,nr,ar,{id:"percentage",label:"Share in total",info:"Shows the share of the label value pair to the total number of series"},rr],Xd=[{id:"name",label:"Label name",sortable:!0},{id:"value",label:"Number of unique values",sortable:!0,modifiers:["compact"]},nr,ar,rr];class em{tsdbStatus;metricNameStats;tabsNames;isPrometheus;constructor(){this.tsdbStatus=this.defaultTSDBStatus,this.metricNameStats=this.defaultMetricNameStats,this.tabsNames=["table","graph"],this.isPrometheus=!1,this.getDefaultState=this.getDefaultState.bind(this)}set tsdbStatusData(r){this.isPrometheus=!!r?.headStats,this.tsdbStatus=r}set metricNameStatsData(r){this.metricNameStats=r}get tsdbStatusData(){return this.tsdbStatus}get metricNameStatsData(){return this.metricNameStats}get defaultTSDBStatus(){return{totalSeries:0,totalSeriesPrev:0,totalSeriesByAll:0,totalLabelValuePairs:0,seriesCountByMetricName:[],seriesCountByLabelName:[],seriesCountByFocusLabelValue:[],seriesCountByLabelValuePair:[],labelValueCountByLabelName:[]}}get defaultMetricNameStats(){return{statsCollectedSince:0,statsCollectedRecordsTotal:0,trackerMemoryMaxSizeBytes:0,trackerCurrentMemoryUsageBytes:0}}get isPrometheusData(){return this.isPrometheus}keys(r,n){const a=r&&/__name__=".+"/.test(r),s=r&&/{.+=".+"}/g.test(r),o=r&&/__name__=".+", .+!=""/g.test(r);let i=[];return n||o?i=i.concat("seriesCountByFocusLabelValue"):a?i=i.concat("labelValueCountByLabelName"):s?i=i.concat("seriesCountByMetricName","seriesCountByLabelName"):i=i.concat("seriesCountByMetricName","seriesCountByLabelName","seriesCountByLabelValuePair","labelValueCountByLabelName"),i}getDefaultState(r,n){return this.keys(r,n).reduce((a,s)=>({...a,tabs:{...a.tabs,[s]:this.tabsNames},containerRefs:{...a.containerRefs,[s]:J(null)}}),{tabs:{},containerRefs:{}})}sectionsTitles(r){return{seriesCountByMetricName:"Metric names with the highest number of series",seriesCountByLabelName:"Labels with the highest number of series",seriesCountByFocusLabelValue:`Values for "${r}" label with the highest number of series`,seriesCountByLabelValuePair:"Label=value pairs with the highest number of series",labelValueCountByLabelName:"Labels with the highest number of unique values"}}get sectionsTips(){return{seriesCountByMetricName:`
        <p>
          This table returns a list of metrics with the highest cardinality.
          The cardinality of a metric is the number of time series associated with that metric,
          where each time series is defined as a unique combination of key-value label pairs.
        </p>
        <p>
          When looking to reduce the number of active series in your data source,
          you can start by inspecting individual metrics with high cardinality
          (i.e. that have lots of active time series associated with them),
          since that single metric contributes a large fraction of the series that make up your total series count.
        </p>`,seriesCountByLabelName:`
        <p>
          This table returns a list of the labels with the highest number of series.
        </p>
        <p>
          Use this table to identify labels that are storing dimensions with high cardinality
          (many different label values).
        </p>
        <p>
          It is recommended to choose labels such that they have a finite set of values,
          since every unique combination of key-value label pairs creates a new time series
          and therefore can dramatically increase the number of time series in your system.
        </p>`,seriesCountByFocusLabelValue:`
       <p>
          This table returns a list of unique label values per selected label.
       </p>
       <p>
          Use this table to identify label values that are storing per each selected series.
       </p>`,labelValueCountByLabelName:`
       <p>
          This table returns a list of labels with the highest number of the unique values.
       </p>
      `,seriesCountByLabelValuePair:`
        <p>
          This table returns a list of the label values pairs with the highest number of series.
        </p>
        <p>
          Use this table to identify unique label values pairs. This helps to identify same labels 
          is applied to count timeseries in your system, since every unique combination of key-value label pairs 
          creates a new time series and therefore can dramatically increase the number of time series in your system
        </p>`}}get tablesHeaders(){return{seriesCountByMetricName:Wd,seriesCountByLabelName:Jd,seriesCountByFocusLabelValue:Kd,seriesCountByLabelValuePair:Zd,labelValueCountByLabelName:Xd}}totalSeries(r,n=!1){return r==="labelValueCountByLabelName"?-1:n?this.tsdbStatus.totalSeriesPrev:this.tsdbStatus.totalSeries}}const tm=()=>{const t=new em,[r]=de(),n=r.get("match"),a=r.get("focusLabel"),s=+(r.get("topN")||10),o=r.get("date")||q().tz().format(st),i=jt(o),l=J(),{serverUrl:c}=re(),[m,d]=y(!1),[u,h]=y(),[v,p]=y(t.defaultTSDBStatus),[_,g]=y(t.defaultMetricNameStats),[f,b]=y(!1),C=async T=>{const E=await fetch(T),A=await E.json();if(E.ok)return A;console.error(`Error fetching ${T}:`,A);const k=A.errorType||_e.unknownType,L=A?.error||A?.message||"see console for more details",$=[k,L].join(`\r
`);throw new Error($)},N=(T,E)=>{Object.keys(T).forEach(A=>{const k=A,L=T[k],$=E[k];Array.isArray(L)&&Array.isArray($)&&L.forEach(I=>{const R=$.find(U=>U.name===I.name)?.value,H=R?I.value-R:0,O=R?H/R*100:0;I.diff=H,I.diffPercent=O,I.valuePrev=R||0})})},S=async T=>{if(!c)return;h(""),d(!0),p(t.defaultTSDBStatus);const E={...T,date:T.date,topN:0,match:"",focusLabel:""},A={...T,date:q(T.date).subtract(1,"day").format(st)},k=[nn(c,T),nn(c,A)];i!==o&&(T.match||T.focusLabel)&&k.push(nn(c,E));try{const[L,$,I]=await Promise.all(k.map(C)),R={...$.data},{data:H}=I||l.current||L;l.current={data:H};const O={...L.data,totalSeries:L.data?.totalSeries||L.data?.headStats?.numSeries||0,totalLabelValuePairs:L.data?.totalLabelValuePairs||L.data?.headStats?.numLabelValuePairs||0,seriesCountByLabelName:L.data?.seriesCountByLabelName||[],seriesCountByFocusLabelValue:L.data?.seriesCountByFocusLabelValue||[],totalSeriesByAll:H?.totalSeries||H?.headStats?.numSeries||v.totalSeriesByAll||0,totalSeriesPrev:R?.totalSeries||R?.headStats?.numSeries||0},U=n?.replace(/[{}"]/g,"");O.seriesCountByLabelValuePair=O.seriesCountByLabelValuePair.filter(W=>W.name!==U),N(O,R),p(O),d(!1)}catch(L){d(!1),L instanceof Error&&h(`${L.name}: ${L.message}`)}},w=async()=>{if(!c)return;h(""),d(!0);const T=Gd(c,{limit:1});try{const E=await C(T);g(E),d(!1)}catch(E){d(!1),g(t.defaultMetricNameStats),console.error(E)}};return x(()=>{S({topN:s,match:n,date:o,focusLabel:a})},[c,n,a,s,o]),x(()=>{w()},[c]),x(()=>{u&&(p(t.defaultTSDBStatus),d(!1))},[u]),x(()=>{const T=xr(c);b(!!T)},[c]),t.tsdbStatusData=v,t.metricNameStatsData=_,{isLoading:m,appConfigurator:t,error:u,isCluster:f}},rm={seriesCountByMetricName:({query:t})=>an("__name__",t),seriesCountByLabelName:({query:t})=>`{${t}!=""}`,seriesCountByFocusLabelValue:({query:t,focusLabel:r})=>an(r,t),seriesCountByLabelValuePair:({query:t})=>{const r=t.split("="),n=r[0],a=r.slice(1).join("=");return an(n,a)},labelValueCountByLabelName:({query:t,match:r})=>r===""?`{${t}!=""}`:`${r.replace("}","")}, ${t}!=""}`},an=(t,r)=>t?"{"+t+"="+JSON.stringify(r)+"}":"",nm=({metricNameStats:t})=>{const{statsCollectedSince:r,statsCollectedRecordsTotal:n=0,trackerMemoryMaxSizeBytes:a=0,trackerCurrentMemoryUsageBytes:s=0}=t,o=r?q.unix(r).format(Fe):" - ",i=a?`${(s/a*100).toFixed(2)}%`:" - ",l=n.toLocaleString("en-US");return e("div",{className:"vm-cardinality-totals-card",children:[e("h4",{className:"vm-cardinality-totals-card__title",children:[e(Y,{placement:"bottom-left",title:e("div",{className:"vm-cardinality-totals-card__tooltip",children:r?e(V,{children:[e("p",{children:["Total entries in cache since ",o]}),e("p",{children:["Cache utilization: ",i]})]}):e(V,{children:[e("p",{children:"Metric names tracker is likely disabled."}),e("p",{children:"No data available. See documentation for enabling the metric names tracker."})]})}),children:e("div",{className:"vm-cardinality-totals-card__info-icon",children:e(Kt,{})})}),"Total metric names"]}),e("span",{className:"vm-cardinality-totals-card__value",children:l}),e("span",{className:"vm-cardinality-totals-card__link",children:e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#track-ingested-metrics-usage",children:"Docs "})})]})},am=({totalSeries:t=0,totalSeriesPrev:r=0,totalSeriesAll:n=0,seriesCountByMetricName:a=[],metricNameStats:s,isPrometheus:o})=>{const{isMobile:i}=j(),[l]=de(),c=l.get("match"),m=l.get("focusLabel"),d=/__name__/.test(c||""),u=a[0]?.value/n*100,h=t-r,v=Math.abs(h)/r*100,p=[{title:"Total series",value:t.toLocaleString("en-US"),dynamic:!t||!r||o?"":`${v.toFixed(2)}%`,display:!m,info:`The total number of unique time series for a selected day.
             A time series is uniquely identified by its name plus a set of its labels. 
             For example, temperature{city="NY",country="US"} and temperature{city="SF",country="US"} 
             are two distinct series, since they differ by the "city" label.`},{title:"Percentage from total",value:isNaN(u)?"-":`${u.toFixed(2)}%`,display:d,info:"The share of these series in the total number of time series."}].filter(_=>_.display);return p.length?e("div",{className:M({"vm-cardinality-totals":!0,"vm-cardinality-totals_mobile":i}),children:[p.map(({title:_,value:g,info:f,dynamic:b})=>e("div",{className:"vm-cardinality-totals-card",children:[e("h4",{className:"vm-cardinality-totals-card__title",children:[f&&e(Y,{title:e("p",{className:"vm-cardinality-totals-card__tooltip",children:f}),children:e("div",{className:"vm-cardinality-totals-card__info-icon",children:e(Kt,{})})}),_]}),e("span",{className:"vm-cardinality-totals-card__value",children:g}),!!b&&e(Y,{title:`in relation to the previous day: ${r.toLocaleString("en-US")}`,placement:"bottom-left",children:e("span",{className:M({"vm-dynamic-number":!0,"vm-dynamic-number_positive vm-dynamic-number_down":h<0,"vm-dynamic-number_negative vm-dynamic-number_up":h>0}),children:b})})]},_)),e(nm,{metricNameStats:s})]}):null},dt=(t,r)=>{const[n]=de(),a=n.get(r)?n.get(r):t,[s,o]=y(a);return x(()=>{a!==s&&o(a)},[a]),[s,o]},zt=10,sm=({isPrometheus:t,isCluster:r,...n})=>{const{isMobile:a}=j(),[s]=de(),{setSearchParamsFromKeys:o}=et(),i=s.get("tips")||"",[l,c]=dt("","match"),[m,d]=dt("","focusLabel"),[u,h]=dt(zt,"topN"),v=!!(l||m||u!==zt&&!t),p=D(()=>u<0?"Number must be bigger than zero":"",[u]),_=C=>{const N=+C;h(isNaN(N)?0:N)},g=()=>{o({match:l,topN:u,focusLabel:m})},f=()=>{o({match:"",focusLabel:"",topN:""}),c(""),d(""),h(zt)},b=()=>{const C=s.get("tips")||"";o({tips:C?"":"true"})};return x(()=>{const C=s.get("match"),N=+(s.get("topN")||zt),S=s.get("focusLabel");C!==l&&c(C||""),N!==u&&h(N),S!==m&&d(S||"")},[s]),e("div",{className:M({"vm-cardinality-configurator":!0,"vm-cardinality-configurator_mobile":a,"vm-block":!0,"vm-block_mobile":a}),children:[e("div",{className:"vm-cardinality-configurator-controls",children:[e("div",{className:"vm-cardinality-configurator-controls__query",children:e(se,{label:"Time series selector",type:"string",value:l,onChange:c,onEnter:g})}),e("div",{className:"vm-cardinality-configurator-controls__item",children:e(se,{label:"Focus label",type:"text",value:m||"",onChange:d,onEnter:g,endIcon:e(Y,{title:e("div",{children:e("p",{children:"To identify values with the highest number of series for the selected label."})}),children:e(vs,{})})})}),e("div",{className:"vm-cardinality-configurator-controls__item vm-cardinality-configurator-controls__item_limit",children:e(se,{label:"Limit entries",type:"number",value:t?zt:u,error:p,disabled:t,helperText:t?"not available for Prometheus":"",onChange:_,onEnter:g})})]}),e("div",{className:"vm-cardinality-configurator-bottom",children:[e(am,{isPrometheus:t,isCluster:r,...n}),r&&e("div",{className:"vm-cardinality-configurator-bottom-helpful",children:e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#cardinality-explorer-statistic-inaccuracy",withIcon:!0,children:[e(ht,{}),"Statistic inaccuracy explanation"]})}),e("div",{className:"vm-cardinality-configurator-bottom-helpful",children:e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#cardinality-explorer",withIcon:!0,children:[e(ht,{}),"Documentation"]})}),e("div",{className:"vm-cardinality-configurator-bottom__execute",children:[e(Y,{title:i?"Hide tips":"Show tips",children:e(z,{variant:"text",color:i?"warning":"gray",startIcon:e(Xt,{}),onClick:b,ariaLabel:"visibility tips"})}),e(z,{variant:"text",startIcon:e(ut,{}),onClick:f,disabled:!v,children:"Reset filters"}),e(z,{startIcon:e(it,{}),onClick:g,children:"Execute Query"})]})]})]})};function om(t){const{order:r,orderBy:n,onRequestSort:a,headerCells:s}=t,o=i=>l=>{a(l,i)};return e("thead",{className:"vm-table-header vm-cardinality-panel-table__header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:s.map(i=>e("th",{className:M({"vm-table-cell vm-table-cell_header":!0,"vm-table-cell_sort":i.sortable,"vm-table-cell_right":i.id==="action"}),onClick:i.sortable?o(i.id):void 0,children:e("div",{className:"vm-table-cell__content",children:[i.info&&e(Y,{title:i.info,children:e("div",{className:"vm-metrics-content-header__tip-icon",children:e(Kt,{})})}),i.label,i.sortable&&e("div",{className:M({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":n===i.id,"vm-table__sort-icon_desc":r==="desc"&&n===i.id}),children:e(We,{})})]})},i.id))})})}const im=["date","timestamp","time"];function ka(t,r,n){const a=t[n],s=r[n];if(a==null&&s==null)return 0;if(a==null)return 1;if(s==null)return-1;const o=String(a),i=String(s);if(im.includes(String(n))){const u=ua(o),h=ua(i);return h<u?-1:h>u?1:0}const c=Number(o),m=Number(i);return!isNaN(c)&&!isNaN(m)?m-c:i<o?-1:i>o?1:0}function aa(t,r){return t==="desc"?(n,a)=>ka(n,a,r):(n,a)=>-ka(n,a,r)}function sa(t,r){const n=t.map((a,s)=>[a,s]);return n.sort((a,s)=>{const o=r(a[0],s[0]);return o!==0?o:a[1]-s[1]}),n.map(a=>a[0])}const lm=({rows:t,headerCells:r,defaultSortColumn:n,tableCells:a})=>{const[s,o]=y("desc"),[i,l]=y(n),c=(d,u)=>{o(i===u&&s==="asc"?"desc":"asc"),l(u)},m=sa(t,aa(s,i));return e("table",{className:"vm-table vm-cardinality-panel-table",children:[e(om,{order:s,orderBy:i,onRequestSort:c,rowCount:t.length,headerCells:r}),e("tbody",{className:"vm-table-header",children:m.map(d=>e("tr",{className:"vm-table__row",children:a(d)},d.name))})]})},cm=({row:t,tableHeaderCells:r,totalSeries:n,totalSeriesPrev:a,onActionClick:s})=>{const o=n>0?t.value/n*100:-1,i=a>0?t.valuePrev/a*100:-1,l=[o,i].some(k=>k===-1),c=t.value.toLocaleString("en-US"),m=t.valuePrev.toLocaleString("en-US"),d=Math.abs(t.diff).toLocaleString("en-US"),u=o-i,h=l?"":`${Math.abs(u).toFixed(2)}%`,v=`${Math.abs(t.diffPercent).toFixed(2)}%`,p=t.requestsCount===0,g=t.requestsCount==null?"n/a":t.requestsCount.toLocaleString("en-US"),f=t.lastRequestTimestamp===0,b=t.lastRequestTimestamp==null,C=!f&&!b,N=f?"never":"n/a",S=C?q().diff(t.lastRequestTimestamp*1e3,"seconds"):0,w=C?q.unix(t.lastRequestTimestamp).format(Fe):"-",T=C?q.duration(-S,"seconds").humanize(!0):N,E=()=>{s(t.name)},A=k=>{switch(k.id){case"name":return e("span",{className:"vm-link vm-link_colored",onClick:E,children:t.name});case"value":return c;case"requestsCount":return e("div",{className:M({"vm-dynamic-number":!0,"vm-dynamic-number_negative":p}),children:g});case"lastRequestTimestamp":return e(Y,{title:`${w}`,children:e("span",{className:M({"vm-dynamic-number":!0,"vm-dynamic-number_negative":f||S>=30*86400,"vm-dynamic-number_warning":S>=7*86400&&S<30*86400}),children:T})});case"diff":return e(Y,{title:`in relation to the previous day: ${m}`,children:e("span",{className:M({"vm-dynamic-number":!0,"vm-dynamic-number_positive vm-dynamic-number_down":t.diff<0,"vm-dynamic-number_negative vm-dynamic-number_up":t.diff>0}),children:d})});case"diffPercent":return e(Y,{title:`in relation to the previous day: ${m}`,children:e("div",{className:M({"vm-dynamic-number":!0,"vm-dynamic-number_positive vm-dynamic-number_down":t.diff<0,"vm-dynamic-number_negative vm-dynamic-number_up":t.diff>0}),children:v})});case"percentage":return e("div",{className:"vm-cardinality-panel-table__progress",children:[e(Xs,{value:o,hideValue:!0}),e("span",{className:"vm-dynamic-number vm-dynamic-number_static",children:[o.toFixed(2),"%"]}),e(Y,{title:"in relation to the previous day",children:e("span",{className:M({"vm-dynamic-number":!0,"vm-dynamic-number_no-change":u===0,"vm-dynamic-number_positive vm-dynamic-number_down":u<0,"vm-dynamic-number_negative vm-dynamic-number_up":u>0}),children:h})})]});case"action":return e("div",{className:"vm-table-cell__content",children:e(Y,{title:e("span",{children:["Filter by ",e("code",{children:["`",t.name,"`"]})]}),children:e(z,{variant:"text",size:"small",onClick:E,startIcon:e(Dr,{})})})});default:return k.id in t?t[k.id]:""}};return e(V,{children:r.map(k=>e("td",{className:M("vm-table-cell",...k.modifiers?.map(L=>`vm-table-cell_${L}`)??[]),children:A(k)},k.id))})},dm=({data:t})=>{const[r,n]=y([]),[a,s]=y([0,0]),o=i=>{const l=i.map(u=>u.value),c=Math.ceil(l[0]||1),m=10,d=c/(m-1);return new Array(m+1).fill(c+d).map((u,h)=>Math.round(u-d*h))};return x(()=>{const i=t.sort((c,m)=>m.value-c.value),l=o(i);s(l),n(i.map(c=>({...c,percentage:c.value/l[0]*100})))},[t]),e("div",{className:"vm-simple-bar-chart",children:[e("div",{className:"vm-simple-bar-chart-y-axis",children:a.map(i=>e("div",{className:"vm-simple-bar-chart-y-axis__tick",children:i},i))}),e("div",{className:"vm-simple-bar-chart-data",children:r.map(({name:i,value:l,percentage:c})=>e(Y,{title:`${i}: ${l}`,placement:"top-center",children:e("div",{className:"vm-simple-bar-chart-data-item",style:{maxHeight:`${c||0}%`}})},`${i}_${l}`))})]})},mm=({rows:t,tabs:r=[],chartContainer:n,totalSeries:a,totalSeriesPrev:s,onActionClick:o,sectionTitle:i,tip:l,tableHeaderCells:c,isPrometheus:m})=>{const{isMobile:d}=j(),[u,h]=y("table"),v=m&&!t.length,p=g=>e(cm,{row:g,tableHeaderCells:c,totalSeries:a,totalSeriesPrev:s,onActionClick:o}),_=D(()=>r.map((g,f)=>({value:g,label:g,icon:f===0?e($r,{}):e(Rn,{})})),[r]);return e("div",{className:M({"vm-metrics-content":!0,"vm-metrics-content_mobile":d,"vm-block":!0,"vm-block_mobile":d}),children:[e("div",{className:"vm-metrics-content-header vm-section-header",children:[e("h5",{className:M({"vm-metrics-content-header__title":!0,"vm-section-header__title":!0,"vm-section-header__title_mobile":d}),children:[!d&&l&&e(Y,{title:e("p",{dangerouslySetInnerHTML:{__html:l},className:"vm-metrics-content-header__tip"}),children:e("div",{className:"vm-metrics-content-header__tip-icon",children:e(Kt,{})})}),i]}),e("div",{className:"vm-section-header__tabs",children:e(er,{activeItem:u,items:_,onChange:h})})]}),v&&e("div",{className:"vm-metrics-content-prom-data",children:[e("div",{className:"vm-metrics-content-prom-data__icon",children:e(ot,{})}),e("h3",{className:"vm-metrics-content-prom-data__title",children:"Prometheus Data Limitation"}),e("p",{className:"vm-metrics-content-prom-data__text",children:["Due to missing data from your Prometheus source, some tables may appear empty.",e("br",{}),"This does not indicate an issue with your system or our tool."]})]}),!v&&u==="table"&&e("div",{ref:n,className:M({"vm-metrics-content__table":!0,"vm-metrics-content__table_mobile":d}),children:e(lm,{rows:t,headerCells:c,defaultSortColumn:"value",tableCells:p})}),!v&&u==="graph"&&e("div",{className:"vm-metrics-content__chart",children:e(dm,{data:t.map(({name:g,value:f})=>({name:g,value:f}))})})]})},Yr=({title:t,children:r})=>e("div",{className:"vm-cardinality-tip",children:[e("div",{className:"vm-cardinality-tip-header",children:[e("div",{className:"vm-cardinality-tip-header__tip-icon",children:e(Xt,{})}),e("h4",{className:"vm-cardinality-tip-header__title",children:t||"Tips"})]}),e("p",{className:"vm-cardinality-tip__description",children:r})]}),um=()=>e(Yr,{title:"Metrics with a high number of series",children:e("ul",{children:[e("li",{children:["Identify and eliminate labels with frequently changed values to reduce their",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/faq/#what-is-high-cardinality",children:"cardinality"}),"and",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/faq/#what-is-high-churn-rate",children:"high churn rate"})]}),e("li",{children:["Find unused time series and",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",children:"drop entire metrics"})]}),e("li",{children:["Aggregate time series before they got ingested into the database via",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/stream-aggregation/",children:"streaming aggregation"})]})]})}),hm=()=>e(Yr,{title:"Labels with a high number of unique values",children:e("ul",{children:[e("li",{children:"Decrease the number of unique label values to reduce cardinality"}),e("li",{children:["Drop the label entirely via",e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",children:"relabeling"})]}),e("li",{children:"For volatile label values (such as URL path, user session, etc.) consider printing them to the log file instead of adding to time series"})]})}),pm=()=>e(Yr,{title:"Dashboard of a single metric",children:[e("p",{children:"This dashboard helps to understand the cardinality of a single metric."}),e("p",{children:"Each time series is a unique combination of key-value label pairs. Therefore a label key with many values can create a lot of time series for a particular metric. If youre trying to decrease the cardinality of a metric, start by looking at the labels with the highest number of values."}),e("p",{children:"Use the series selector at the top of the page to apply additional filters."})]}),vm=()=>e(Yr,{title:"Dashboard of a label",children:[e("p",{children:"This dashboard helps you understand the count of time series per label."}),e("p",{children:"Use the selector at the top of the page to pick a label name youd like to inspect. For the selected label name, youll see the label values that have the highest number of series associated with them. So if youve chosen `instance` as your label name, you may see that `657` time series have value host-1 attached to them and `580` time series have value `host-2` attached to them."}),e("p",{children:"This can be helpful in allowing you to determine where the bulk of your time series are coming from. If the label instance=host-1 was applied to 657 series and the label instance=host-2 was only applied to 580 series, youd know, for example, that host-01 was responsible for sending the majority of the time series."})]}),fm=`Please wait while cardinality stats is calculated. 
                        This may take some time if the db contains big number of time series.`,gm=()=>{const{isMobile:t}=j(),[r]=de(),{setSearchParamsFromKeys:n}=et(),a=r.get("tips")||"",s=r.get("match")||"",o=r.get("focusLabel")||"",{isLoading:i,appConfigurator:l,error:c,isCluster:m}=tm(),{tsdbStatusData:d,metricNameStatsData:u,getDefaultState:h,tablesHeaders:v,sectionsTips:p}=l,_=h(s,o),g=f=>b=>{const N={match:rm[f]({query:b,focusLabel:o,match:s})};(f==="labelValueCountByLabelName"||f=="seriesCountByLabelName")&&(N.focusLabel=b),f=="seriesCountByFocusLabelValue"&&(N.focusLabel=""),n(N)};return e("div",{className:M({"vm-cardinality-panel":!0,"vm-cardinality-panel_mobile":t}),children:[i&&e(ye,{message:fm}),e(sm,{isPrometheus:l.isPrometheusData,totalSeries:d.totalSeries,totalSeriesPrev:d.totalSeriesPrev,totalSeriesAll:d.totalSeriesByAll,totalLabelValuePairs:d.totalLabelValuePairs,seriesCountByMetricName:d.seriesCountByMetricName,metricNameStats:u,isCluster:m}),a&&e("div",{className:"vm-cardinality-panel-tips",children:[!s&&!o&&e(um,{}),s&&!o&&e(pm,{}),!s&&!o&&e(hm,{}),o&&e(vm,{})]}),c&&e(X,{variant:"error",children:c}),l.keys(s,o).map(f=>e(mm,{sectionTitle:l.sectionsTitles(o)[f],tip:p[f],rows:d[f],onActionClick:g(f),tabs:_.tabs[f],chartContainer:_.containerRefs[f],totalSeriesPrev:l.totalSeries(f,!0),totalSeries:l.totalSeries(f),tableHeaderCells:v[f],isPrometheus:l.isPrometheusData},f))]})},ym=(t,r,n)=>`${t}/api/v1/status/top_queries?topN=${r||""}&maxLifetime=${n||""}`,bm=(t,r)=>{const{query:n,timeRangeSeconds:a}=t,s=[`g0.expr=${encodeURIComponent(n)}`],o=yr.find(i=>i.duration===r)?.id;return o&&s.push(`g0.relative_time=${o}`),a&&s.push(`g0.range_input=${r}`),`${G.home}?${s.join("&")}`},_m=t=>(["topByAvgDuration","topByCount","topBySumDuration"].forEach(n=>{const a=t[n];Array.isArray(a)&&a.forEach(s=>{const o=kr(s.timeRangeSeconds*1e3);s.url=bm(s,o),s.timeRange=o})}),t),Cm=({topN:t,maxLifetime:r})=>{const{serverUrl:n}=re(),{setSearchParamsFromKeys:a}=et(),[s,o]=y(null),[i,l]=y(!1),[c,m]=y(),d=D(()=>ym(n,t,r),[n,t,r]);return{data:s,error:c,loading:i,fetch:async()=>{l(!0),a({topN:t,maxLifetime:r});try{const h=await fetch(d),v=await h.json();o(h.ok?_m(v):null),m(String(v.error||""))}catch(h){h instanceof Error&&h.name!=="AbortError"&&m(`${h.name}: ${h.message}`)}l(!1)}}},Nm=({rows:t,columns:r,defaultOrderBy:n})=>{const a=Ye(),[s,o]=y(n||"count"),[i,l]=y("desc"),c=D(()=>sa(t,aa(i,s)),[t,s,i]),m=h=>{l(v=>v==="asc"&&s===h?"desc":"asc"),o(h)},d=h=>()=>{m(h)},u=({query:h})=>async()=>{await a(h,"Query has been copied")};return e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:[r.map(h=>e("th",{className:"vm-table-cell vm-table-cell_header vm-table-cell_sort",onClick:d(h.sortBy||h.key),children:e("div",{className:"vm-table-cell__content",children:[h.title||h.key,e("div",{className:M({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":s===h.key,"vm-table__sort-icon_desc":i==="desc"&&s===h.key}),children:e(We,{})})]})},h.key)),e("th",{className:"vm-table-cell vm-table-cell_header"})," "]})}),e("tbody",{className:"vm-table-body",children:c.map((h,v)=>e("tr",{className:"vm-table__row",children:[r.map(p=>e("td",{className:"vm-table-cell",children:h[p.key]||"-"},p.key)),e("td",{className:"vm-table-cell vm-table-cell_no-padding",children:e("div",{className:"vm-top-queries-panels__table-actions",children:[h.url&&e(Y,{title:"Execute query",children:e(Ar,{to:h.url,target:"_blank",rel:"noreferrer","aria-disabled":!0,children:e(z,{variant:"text",size:"small",startIcon:e(Dr,{}),ariaLabel:"execute query"})})}),e(Y,{title:"Copy query",children:e(z,{variant:"text",size:"small",startIcon:e(yt,{}),onClick:u(h),ariaLabel:"copy query"})})]})})]},v))})]})},wm=["table","JSON"].map((t,r)=>({value:String(r),label:t,icon:r===0?e($r,{}):e(Zt,{})})),sn=({rows:t,title:r,columns:n,defaultOrderBy:a})=>{const{isMobile:s}=j(),[o,i]=y(0),l=c=>{i(+c)};return e("div",{className:M({"vm-top-queries-panel":!0,"vm-block":!0,"vm-block_mobile":s}),children:[e("div",{className:M({"vm-top-queries-panel-header":!0,"vm-section-header":!0,"vm-top-queries-panel-header_mobile":s}),children:[e("h5",{className:M({"vm-section-header__title":!0,"vm-section-header__title_mobile":s}),children:r}),e("div",{className:"vm-section-header__tabs",children:e(er,{activeItem:String(o),items:wm,onChange:l})})]}),e("div",{className:M({"vm-top-queries-panel__table":!0,"vm-top-queries-panel__table_mobile":s}),children:[o===0&&e(Nm,{rows:t,columns:n,defaultOrderBy:a}),o===1&&e(na,{data:t})]})]})},Sm="30ms, 15s, 3d4h, 1y2w",Tm=()=>{const{isMobile:t}=j(),[r,n]=dt(10,"topN"),[a,s]=dt("10m","maxLifetime"),{data:o,error:i,loading:l,fetch:c}=Cm({topN:r,maxLifetime:a}),m=D(()=>{const b=a.trim().split(" ").reduce((N,S)=>{const w=Ga(S);return w?{...N,...w}:{...N}},{});return!!q.duration(b).asMilliseconds()},[a]),d=D(()=>!!r&&r<1,[r]),u=D(()=>d?"Number must be bigger than zero":"",[d]),h=D(()=>m?"":"Invalid duration value",[m]),v=f=>{if(!o)return f;const b=o[f];return typeof b=="number"?nt(b,b,b):b||f},p=f=>{n(+f)},_=f=>{s(f)},g=f=>{f.key==="Enter"&&c()};return x(()=>{o&&(r||n(+o.topN),a||s(o.maxLifetime))},[o]),x(()=>(c(),window.addEventListener("popstate",c),()=>{window.removeEventListener("popstate",c)}),[]),e("div",{className:M({"vm-top-queries":!0,"vm-top-queries_mobile":t}),children:[l&&e(ye,{containerStyles:{height:"500px"}}),e("div",{className:M({"vm-top-queries-controls":!0,"vm-block":!0,"vm-block_mobile":t}),children:[e("div",{className:"vm-top-queries-controls-fields",children:[e("div",{className:"vm-top-queries-controls-fields__item",children:e(se,{label:"Max lifetime",value:a,error:h,helperText:`For example ${Sm}`,onChange:_,onKeyDown:g})}),e("div",{className:"vm-top-queries-controls-fields__item",children:e(se,{label:"Number of returned queries",type:"number",value:r||"",error:u,onChange:p,onKeyDown:g})})]}),e("div",{className:M({"vm-top-queries-controls-bottom":!0,"vm-top-queries-controls-bottom_mobile":t}),children:[e("div",{className:"vm-top-queries-controls-bottom__info",children:["VictoriaMetrics tracks the last",e(Y,{title:"search.queryStats.lastQueriesCount",children:e("b",{children:v("search.queryStats.lastQueriesCount")})}),"queries with durations at least",e(Y,{title:"search.queryStats.minQueryDuration",children:e("b",{children:v("search.queryStats.minQueryDuration")})})]}),e("div",{className:"vm-top-queries-controls-bottom__button",children:e(z,{startIcon:e(it,{}),onClick:c,children:"Execute"})})]})]}),i&&e(X,{variant:"error",children:i}),o&&e(V,{children:e("div",{className:"vm-top-queries-panels",children:[e(sn,{rows:o.topBySumDuration,title:"Queries with most summary time to execute",columns:[{key:"query"},{key:"sumDurationSeconds",title:"sum duration, sec"},{key:"timeRange",sortBy:"timeRangeSeconds",title:"query time interval"},{key:"count"}],defaultOrderBy:"sumDurationSeconds"}),e(sn,{rows:o.topByAvgDuration,title:"Most heavy queries",columns:[{key:"query"},{key:"avgDurationSeconds",title:"avg duration, sec"},{key:"timeRange",sortBy:"timeRangeSeconds",title:"query time interval"},{key:"count"}],defaultOrderBy:"avgDurationSeconds"}),e(sn,{rows:o.topByCount,title:"Most frequently executed queries",columns:[{key:"query"},{key:"timeRange",sortBy:"timeRangeSeconds",title:"query time interval"},{key:"count"}]})]})})]})},on={"color-primary":"#589df6","color-secondary":"#316eca","color-error":"#e5534b","color-background-error":"#240705","color-warning":"#c69026","color-background-warning":"#221906","color-info":"#539bf5","color-background-info":"#021327","color-success":"#57ab5a","color-background-success":"#0e1b0e","color-passive":"#a7acb3","color-code":"#4e5a6a","color-background-body":"#22272e","color-background-block":"#2d333b","color-background-tooltip":"rgba(22, 22, 22, 0.8)","color-background-item":"#313944","color-background-badge":"#4e5a6a","color-background-hover":"#3D4652","color-text":"#cdd9e5","color-text-secondary":"#768390","color-text-disabled":"#636e7b","box-shadow":"rgba(0, 0, 0, 0.16) 1px 2px 6px","box-shadow-popper":"rgba(0, 0, 0, 0.2) 0px 2px 8px 0px","border-divider":"1px solid rgba(99, 110, 123, 0.5)","color-hover-black":"rgba(0, 0, 0, 0.2)","color-log-hits-bar-0":"rgba(255, 255, 255, 0.18)","color-log-hits-bar-1":"#FFB74D","color-log-hits-bar-2":"#81C784","color-log-hits-bar-3":"#64B5F6","color-log-hits-bar-4":"#E57373","color-log-hits-bar-5":"#8a62f0"},ln={"color-primary":"#3f51b5","color-secondary":"#e91e63","color-error":"#fd080e","color-background-error":"#ffd7d8","color-warning":"#ff8308","color-background-warning":"#ffd6ad","color-info":"#03a9f4","color-background-info":"#d7f2fe","color-success":"#4caf50","color-background-success":"#d4ecd5","color-passive":"#5d6267","color-code":"#ecedee","color-background-body":"#FEFEFF","color-background-block":"#FFFFFF","color-background-tooltip":"rgba(80,80,80,0.9)","color-background-item":"#f8f9fa","color-background-badge":"#e1e4e7","color-background-hover":"#edf0f2","color-text":"#110f0f","color-text-secondary":"#706F6F","color-text-disabled":"#A09F9F","box-shadow":"rgba(0, 0, 0, 0.08) 1px 2px 6px","box-shadow-popper":"rgba(0, 0, 0, 0.1) 0px 2px 8px 0px","border-divider":"1px solid rgba(0, 0, 0, 0.15)","color-hover-black":"rgba(0, 0, 0, 0.06)","color-log-hits-bar-0":"rgba(0, 0, 0, 0.18)","color-log-hits-bar-1":"#FFB74D","color-log-hits-bar-2":"#81C784","color-log-hits-bar-3":"#64B5F6","color-log-hits-bar-4":"#E57373","color-log-hits-bar-5":"#8a62f0"},Em=()=>{const[t,r]=y(fr()),n=a=>{r(a.matches)};return x(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)");return a.addEventListener("change",n),()=>a.removeEventListener("change",n)},[]),t},cn=["primary","secondary","error","warning","info","success"],Po=({onLoaded:t})=>{const r=xe(),{palette:n={}}=Gt(),{theme:a}=re(),s=Em(),o=Dt(),i=bt(),[l,c]=y({[ze.dark]:on,[ze.light]:ln,[ze.system]:fr()?on:ln}),m=()=>{const{innerWidth:p,innerHeight:_}=window,{clientWidth:g,clientHeight:f}=document.documentElement;wt("scrollbar-width",`${p-g}px`),wt("scrollbar-height",`${_-f}px`),wt("vh",`${_*.01}px`)},d=()=>{cn.forEach((p,_)=>{const g=Ze(`color-${p}`),f=Oc(g);wt(`${p}-text`,f),_===cn.length-1&&(o({type:"SET_DARK_THEME"}),t(!0))})},u=()=>{cn.forEach(p=>{const _=n[p];_&&wt(`color-${p}`,_)}),d()},h=()=>{const p=Ve("THEME")||ze.system,_=l[p];Object.entries(_).forEach(([g,f])=>{wt(g,f)}),d(),r&&u()},v=()=>{const p=fr()?on:ln;if(l[ze.system]===p){h();return}c(_=>({..._,[ze.system]:p}))};return x(()=>{m(),h()},[l]),x(m,[i]),x(v,[a,s]),x(()=>{r&&o({type:"SET_THEME",payload:ze.light})},[]),null},Ro=()=>{const[t,r]=y([]),[n,a]=y(!1),s=J(document.body),o=m=>{const d=Array.from(m||[]);r(d)},i=m=>{m.preventDefault(),m.stopPropagation(),m.type==="dragenter"||m.type==="dragover"?a(!0):m.type==="dragleave"&&a(!1)},l=m=>{m.preventDefault(),m.stopPropagation(),a(!1),m?.dataTransfer?.files&&m.dataTransfer.files[0]&&o(m.dataTransfer.files)},c=m=>{const d=m.clipboardData?.items;if(!d)return;const u=Array.from(d).filter(h=>h.type==="application/json").map(h=>h.getAsFile()).filter(h=>h!==null);r(u)};return oe("dragenter",i,s),oe("dragleave",i,s),oe("dragover",i,s),oe("drop",l,s),oe("paste",c,s),{files:t,dragging:n}},Sr=({onOpenModal:t,onChange:r})=>e("div",{className:"vm-upload-json-buttons",children:[e(z,{variant:"outlined",onClick:t,children:"Paste JSON"}),e("div",{className:"vm-upload-json-buttons__upload",children:[e(z,{children:"Upload Files"}),e("input",{id:"json",name:"json",type:"file",accept:"application/json",multiple:!0,title:" ",onChange:r})]})]}),Am=()=>{const[t,r]=y([]),[n,a]=y([]),s=D(()=>!!t.length,[t]),{value:o,setTrue:i,setFalse:l}=ce(!1),c=(f,b="")=>{a(C=>[{filename:b,text:`: ${f.message}`},...C])},m=(f,b)=>{try{const C=JSON.parse(f),N=C.trace||C;if(!N.duration_msec){c(new Error(_e.traceNotFound),b);return}const S=new pt(N,b);r(w=>[S,...w])}catch(C){C instanceof Error&&c(C,b)}},d=f=>{f.map(b=>{const C=new FileReader,N=b?.name||"";C.onload=S=>{const w=String(S.target?.result);m(w,N)},C.readAsText(b)})},u=f=>{if(!f.target)return;const b=f.target;a([]);const C=Array.from(b.files||[]);d(C),b.value=""},h=f=>{const b=t.filter(C=>C.idValue!==f.idValue);r([...b])},v=f=>{a(b=>b.filter((C,N)=>N!==f))},p=f=>()=>{v(f)},{files:_,dragging:g}=Ro();return x(()=>{d(_)},[_]),e("div",{className:"vm-trace-page",children:[e("div",{className:"vm-trace-page-header",children:[e("div",{className:"vm-trace-page-header-errors",children:n.map((f,b)=>e("div",{className:"vm-trace-page-header-errors-item",children:[e(X,{variant:"error",children:[e("b",{className:"vm-trace-page-header-errors-item__filename",children:f.filename}),e("span",{children:f.text})]}),e(z,{className:"vm-trace-page-header-errors-item__close",startIcon:e(De,{}),variant:"text",color:"error",onClick:p(b)})]},`${f}_${b}`))}),e("div",{children:s&&e(Sr,{onOpenModal:i,onChange:u})})]}),s&&e("div",{children:e(Wn,{jsonEditor:!0,traces:t,onDeleteClick:h})}),!s&&e("div",{className:"vm-trace-page-preview",children:[e("p",{className:"vm-trace-page-preview__text",children:["Please, upload file with JSON response content.",`
`,"The file must contain tracing information in JSON format.",`
`,"In order to use tracing please refer to the doc:",e("a",{className:"vm-link vm-link_colored",href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#query-tracing",target:"_blank",rel:"help noreferrer",children:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#query-tracing"}),`
`,"Tracing graph will be displayed after file upload.",`
`,"Attach files by dragging & dropping, selecting or pasting them."]}),e(Sr,{onOpenModal:i,onChange:u})]}),o&&e(Ce,{title:"Paste JSON",onClose:l,children:e(to,{editable:!0,displayTitle:!0,defaultTile:`JSON ${t.length+1}`,onClose:l,onUpload:m})}),g&&e("div",{className:"vm-trace-page__dropzone"})]})},xm=({job:t,instance:r,metrics:n,size:a})=>{const{duration:s,relativeTime:o,period:{date:i}}=pe(),{customStep:l}=Me(),{setSearchParamsFromKeys:c}=et(),m=()=>{const d=Br({"g0.range_input":s,"g0.end_input":i,"g0.step_input":l,"g0.relative_time":o,size:a,job:t,instance:r,metrics:n});c(d)};x(m,[s,o,i,l,t,r,n,a]),x(m,[])},Lm=(t,r)=>`${t}/api/v1/label/job/values?start=${r.start}&end=${r.end}`,km=(t,r,n)=>{const a=`{job=${JSON.stringify(n)}}`;return`${t}/api/v1/label/instance/values?match[]=${encodeURIComponent(a)}&start=${r.start}&end=${r.end}`},Mm=(t,r,n,a)=>{const o=`{${Object.entries({job:n,instance:a}).filter(i=>i[1]).map(([i,l])=>`${i}=${JSON.stringify(l)}`).join(",")}}`;return`${t}/api/v1/label/__name__/values?match[]=${encodeURIComponent(o)}&start=${r.start}&end=${r.end}`},Im=()=>{const{serverUrl:t}=re(),{period:r}=pe(),[n,a]=y([]),[s,o]=y(!1),[i,l]=y(),c=D(()=>Lm(t,r),[t,r]);return x(()=>{(async()=>{o(!0);try{const d=await fetch(c),u=await d.json(),h=u.data||[];a(h.sort((v,p)=>v.localeCompare(p))),d.ok?l(void 0):l(`${u.errorType}\r
${u?.error}`)}catch(d){d instanceof Error&&l(`${d.name}: ${d.message}`)}o(!1)})().catch(console.error)},[c]),{jobs:n,isLoading:s,error:i}},Dm=t=>{const{serverUrl:r}=re(),{period:n}=pe(),[a,s]=y([]),[o,i]=y(!1),[l,c]=y(),m=D(()=>km(r,n,t),[r,n,t]);return x(()=>{if(!t)return;(async()=>{i(!0);try{const u=await fetch(m),h=await u.json(),v=h.data||[];s(v.sort((p,_)=>p.localeCompare(_))),u.ok?c(void 0):c(`${h.errorType}\r
${h?.error}`)}catch(u){u instanceof Error&&c(`${u.name}: ${u.message}`)}i(!1)})().catch(console.error)},[m]),{instances:a,isLoading:o,error:l}},$m=(t,r)=>{const{serverUrl:n}=re(),{period:a}=pe(),[s,o]=y([]),[i,l]=y(!1),[c,m]=y(),d=D(()=>Mm(n,a,t,r),[n,a,t,r]);return x(()=>{if(!t)return;(async()=>{l(!0);try{const h=await fetch(d),v=await h.json(),p=v.data||[];o(p.sort((_,g)=>_.localeCompare(g))),h.ok?m(void 0):m(`${v.errorType}\r
${v?.error}`)}catch(h){h instanceof Error&&m(`${h.name}: ${h.message}`)}l(!1)})().catch(console.error)},[d]),{names:s,isLoading:i,error:c}},Pm=({name:t,job:r,instance:n,rateEnabled:a,isBucket:s,height:o})=>{const{isMobile:i}=j(),{customStep:l,yaxis:c}=Me(),{period:m}=pe(),d=Xe(),u=Qe(),h=Wt(m.end-m.start),v=Ln(l),p=kr(v*10*1e3),[_,g]=y(!1),[f,b]=y(!1),C=_&&l===h?p:l,N=D(()=>{const I=Object.entries({job:r,instance:n}).filter(O=>O[1]).map(([O,U])=>`${O}=${JSON.stringify(U)}`);I.push(`__name__=${JSON.stringify(t)}`),t=="node_cpu_seconds_total"&&I.push('mode!="idle"');const R=`{${I.join(",")}}`;return s?`sum(rate(${R})) by (vmrange, le)`:`
with (q = ${a?`rollup_rate(${R})`:`rollup(${R})`}) (
  alias(min(label_match(q, "rollup", "min")), "min"),
  alias(max(label_match(q, "rollup", "max")), "max"),
  alias(avg(label_match(q, "rollup", "avg")), "avg"),
)`},[t,r,n,a,s]),{isLoading:S,graphData:w,error:T,queryErrors:E,warning:A,isHistogram:k}=Vr({predefinedQuery:[N],visible:!0,customStep:C,showAllSeries:f}),L=I=>{d({type:"SET_YAXIS_LIMITS",payload:I})},$=({from:I,to:R})=>{u({type:"SET_PERIOD",payload:{from:I,to:R}})};return x(()=>{g(k)},[k]),e("div",{className:M({"vm-explore-metrics-graph":!0,"vm-explore-metrics-graph_mobile":i}),children:[S&&e(ye,{}),T&&e(X,{variant:"error",children:T}),E[0]&&e(X,{variant:"error",children:E[0]}),A&&e(qr,{warning:A,query:[N],onChange:b}),w&&m&&e(Qr,{data:w,period:m,customStep:C,query:[N],yaxis:c,setYaxisLimits:L,setPeriod:$,showLegend:!1,height:o,isHistogram:k})]})},Rm=({name:t,index:r,length:n,isBucket:a,rateEnabled:s,onChangeRate:o,onRemoveItem:i,onChangeOrder:l})=>{const{isMobile:c}=j(),{value:m,setTrue:d,setFalse:u}=ce(!1),h=()=>{i(t)},v=()=>{l(t,r,r+1)},p=()=>{l(t,r,r-1)};return c?e("div",{className:"vm-explore-metrics-item-header vm-explore-metrics-item-header_mobile",children:[e("div",{className:"vm-explore-metrics-item-header__name",children:t}),e(z,{variant:"text",size:"small",startIcon:e(Fn,{}),onClick:d,ariaLabel:"open panel settings"}),m&&e(Ce,{title:t,onClose:u,children:e("div",{className:"vm-explore-metrics-item-header-modal",children:[e("div",{className:"vm-explore-metrics-item-header-modal-order",children:[e(z,{startIcon:e(ms,{}),variant:"outlined",onClick:p,disabled:r===0,ariaLabel:"move graph up"}),e("p",{children:["position:",e("span",{className:"vm-explore-metrics-item-header-modal-order__index",children:["#",r+1]})]}),e(z,{endIcon:e(On,{}),variant:"outlined",onClick:v,disabled:r===n-1,ariaLabel:"move graph down"})]}),!a&&e("div",{className:"vm-explore-metrics-item-header-modal__rate",children:[e(Be,{label:e("span",{children:["enable ",e("code",{children:"rate()"})]}),value:s,onChange:o,fullWidth:!0}),e("p",{children:"calculates the average per-second speed of metrics change"})]}),e(z,{startIcon:e(De,{}),color:"error",variant:"outlined",onClick:h,fullWidth:!0,children:"Remove graph"})]})})]}):e("div",{className:"vm-explore-metrics-item-header",children:[e("div",{className:"vm-explore-metrics-item-header-order",children:[e(Y,{title:"move graph up",children:e(z,{className:"vm-explore-metrics-item-header-order__up",startIcon:e(Ae,{}),variant:"text",color:"gray",size:"small",onClick:p,ariaLabel:"move graph up"})}),e("div",{className:"vm-explore-metrics-item-header__index",children:["#",r+1]}),e(Y,{title:"move graph down",children:e(z,{className:"vm-explore-metrics-item-header-order__down",startIcon:e(Ae,{}),variant:"text",color:"gray",size:"small",onClick:v,ariaLabel:"move graph down"})})]}),e("div",{className:"vm-explore-metrics-item-header__name",children:t}),!a&&e("div",{className:"vm-explore-metrics-item-header__rate",children:e(Y,{title:"calculates the average per-second speed of metric's change",children:e(Be,{label:e("span",{children:["enable ",e("code",{children:"rate()"})]}),value:s,onChange:o})})}),e("div",{className:"vm-explore-metrics-item-header__close",children:e(Y,{title:"close graph",children:e(z,{startIcon:e(De,{}),variant:"text",color:"gray",size:"small",onClick:h,ariaLabel:"close graph"})})})]})},Om=({name:t,job:r,instance:n,index:a,length:s,size:o,onRemoveItem:i,onChangeOrder:l})=>{const c=D(()=>/_sum$|_total$|_count$/.test(t),[t]),m=D(()=>/_bucket$/.test(t),[t]),[d,u]=y(c),h=bt(),v=D(o.height,[o,h]);return x(()=>{u(c)},[r]),e("div",{className:"vm-explore-metrics-item vm-block vm-block_empty-padding",children:[e(Rm,{name:t,index:a,length:s,isBucket:m,rateEnabled:d,size:o.id,onChangeRate:u,onRemoveItem:i,onChangeOrder:l}),e(Pm,{name:t,job:r,instance:n,rateEnabled:d,isBucket:m,height:v},`${t}_${r}_${n}_${d}`)]})},zm=vr.map(t=>t.id),Hm=({jobs:t,instances:r,names:n,job:a,instance:s,size:o,selectedMetrics:i,onChangeJob:l,onChangeInstance:c,onToggleMetric:m,onChangeSize:d})=>{const u=D(()=>a?"":"No instances. Please select job",[a]),h=D(()=>a?"":"No metric names. Please select job",[a]),{isMobile:v}=j(),{value:p,toggle:_,setFalse:g}=ce(Ve("EXPLORE_METRICS_TIPS")!=="false");return x(()=>{Ie("EXPLORE_METRICS_TIPS",`${p}`)},[p]),e(V,{children:[e("div",{className:M({"vm-explore-metrics-header":!0,"vm-explore-metrics-header_mobile":v,"vm-block":!0,"vm-block_mobile":v}),children:[e("div",{className:"vm-explore-metrics-header__job",children:e(at,{value:a,list:t,label:"Job",placeholder:"Please select job",onChange:l,autofocus:!a&&!!t.length&&!v,searchable:!0})}),e("div",{className:"vm-explore-metrics-header__instance",children:e(at,{value:s,list:r,label:"Instance",placeholder:"Please select instance",onChange:c,noOptionsText:u,clearable:!0,searchable:!0})}),e("div",{className:"vm-explore-metrics-header__size",children:[e(at,{label:"Size graphs",value:o,list:zm,onChange:d}),e(Y,{title:`${p?"Hide":"Show"} tip`,children:e(z,{variant:"text",color:p?"warning":"gray",startIcon:e(Xt,{}),onClick:_,ariaLabel:"visibility tips"})})]}),e("div",{className:"vm-explore-metrics-header-metrics",children:e(at,{label:"Metrics",value:i,list:n,placeholder:"Search metric name",onChange:m,noOptionsText:h,clearable:!0,searchable:!0})})]}),p&&e(X,{variant:"warning",children:e("div",{className:"vm-explore-metrics-header-description",children:[e("p",{children:["Please note: this page is solely designed for exploring Prometheus metrics. Prometheus metrics always contain ",e("code",{children:"job"})," and ",e("code",{children:"instance"})," labels (see ",e("a",{className:"vm-link vm-link_colored",href:"https://prometheus.io/docs/concepts/jobs_instances/",children:"these docs"}),"), and this page relies on them as filters. ",e("br",{}),"Please use this page for Prometheus metrics only, in accordance with their naming conventions."]}),e(z,{variant:"text",size:"small",startIcon:e(De,{}),onClick:g,ariaLabel:"close tips"})]})})]})},Fm=he("job",""),Vm=he("instance",""),Ma=he("metrics",""),Ia=he("size",""),Um=vr.find(t=>Ia?t.id===Ia:t.isDefault)||vr[0],qm=()=>{const[t,r]=y(Fm),[n,a]=y(Vm),[s,o]=y(Ma?Ma.split("&"):[]),[i,l]=y(Um);xm({job:t,instance:n,metrics:s.join("&"),size:i.id});const{jobs:c,isLoading:m,error:d}=Im(),{instances:u,isLoading:h,error:v}=Dm(t),{names:p,isLoading:_,error:g}=$m(t,n),f=D(()=>m||h||_,[m,h,_]),b=D(()=>d||v||g,[d,v,g]),C=w=>{o(w?T=>T.includes(w)?T.filter(E=>E!==w):[...T,w]:[])},N=w=>{const T=vr.find(E=>E.id===w);T&&l(T)},S=(w,T,E)=>{const A=E>s.length-1;E<0||A||o(L=>{const $=[...L],[I]=$.splice(T,1);return $.splice(E,0,I),$})};return x(()=>{n&&u.length&&!u.includes(n)&&a("")},[u,n]),e("div",{className:"vm-explore-metrics",children:[e(Hm,{jobs:c,instances:u,names:p,job:t,size:i.id,instance:n,selectedMetrics:s,onChangeJob:r,onChangeSize:N,onChangeInstance:a,onToggleMetric:C}),f&&e(ye,{}),b&&e(X,{variant:"error",children:b}),!t&&e(X,{variant:"info",children:"Please select job to see list of metric names."}),t&&!s.length&&e(X,{variant:"info",children:"Please select metric names to see the graphs."}),e("div",{className:"vm-explore-metrics-body",children:s.map((w,T)=>e(Om,{name:w,job:t,instance:n,index:T,length:s.length,size:i,onRemoveItem:C,onChangeOrder:S},w))})]})},Bm=()=>{const t=Ye(),r=n=>async()=>{await t(`<${n}/>`,`<${n}/> has been copied`)};return e("div",{className:"vm-preview-icons",children:Object.entries(Di).map(([n,a])=>e("div",{className:"vm-preview-icons-item",onClick:r(n),children:[e("div",{className:"vm-preview-icons-item__svg",children:a()}),e("div",{className:"vm-preview-icons-item__name",children:`<${n}/>`})]},n))})},Ue=({code:t})=>{const r=Ye(),[n,a]=y("Copy"),s=async()=>{await r(t),a("Copied")};return x(()=>{let o=null;return n==="Copied"&&(o=setTimeout(()=>a("Copy"),1e3)),()=>{o&&clearTimeout(o)}},[n]),e("code",{className:"vm-code-example",children:[t,e("div",{className:"vm-code-example__copy",children:e(Y,{title:n,children:e(z,{size:"small",variant:"text",onClick:s,startIcon:e(yt,{}),ariaLabel:"close"})})})]})},Qm=()=>e("a",{className:"vm-link vm-link_colored",href:"https://docs.victoriametrics.com/victoriametrics/metricsql/",target:"_blank",rel:"help noreferrer",children:"MetricsQL"}),Da=()=>e("a",{className:"vm-link vm-link_colored",href:"https://grafana.com/grafana/dashboards/1860",target:"_blank",rel:"help noreferrer",children:"Node Exporter Full"}),jm=()=>e("section",{className:"vm-with-template-tutorial",children:[e("h2",{className:"vm-with-template-tutorial__title",children:["Tutorial for WITH expressions in ",e(Qm,{})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["Let's look at the following real query from ",e(Da,{})," dashboard:"]}),e(Ue,{code:`(
  (
    node_memory_MemTotal_bytes{instance=~"$node:$port", job=~"$job"}
      -
    node_memory_MemFree_bytes{instance=~"$node:$port", job=~"$job"}
  )
    /
  node_memory_MemTotal_bytes{instance=~"$node:$port", job=~"$job"}
) * 100`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"It is clear the query calculates the percentage of used memory for the given $node, $port and $job. Isn't it? :)"})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"What's wrong with this query? Copy-pasted label filters for distinct timeseries which makes it easy to mistype these filters during modification. Let's simplify the query with WITH expressions:"}),e(Ue,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"}
)
(
  node_memory_MemTotal_bytes{commonFilters}
    -
  node_memory_MemFree_bytes{commonFilters}
)
  /
node_memory_MemTotal_bytes{commonFilters} * 100`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["Now label filters are located in a single place instead of three distinct places. The query mentions node_memory_MemTotal_bytes metric twice and ","{commonFilters}"," three times. WITH expressions may improve this:"]}),e(Ue,{code:`WITH (
    my_resource_utilization(free, limit, filters) = (limit{filters} - free{filters}) / limit{filters} * 100
)
my_resource_utilization(
  node_memory_MemFree_bytes,
  node_memory_MemTotal_bytes,
  {instance=~"$node:$port",job=~"$job"},
)`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"Now the template function my_resource_utilization() may be used for monitoring arbitrary resources - memory, CPU, network, storage, you name it."})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["Let's take another nice query from ",e(Da,{})," dashboard:"]}),e(Ue,{code:`(
  (
    (
      count(
        count(node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"}) by (cpu)
      )
    )
      -
    avg(
      sum by (mode) (rate(node_cpu_seconds_total{mode='idle',instance=~"$node:$port",job=~"$job"}[5m]))
    )
  )
    *
  100
)
  /
count(
  count(node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"}) by (cpu)
)`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"Do you understand what does this mess do? Is it manageable? :) WITH expressions are happy to help in a few iterations."})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"1. Extract common filters used in multiple places into a commonFilters variable:"}),e(Ue,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"}
)
(
  (
    (
      count(
        count(node_cpu_seconds_total{commonFilters}) by (cpu)
      )
    )
      -
    avg(
      sum by (mode) (rate(node_cpu_seconds_total{mode='idle',commonFilters}[5m]))
    )
  )
    *
  100
)
  /
count(
  count(node_cpu_seconds_total{commonFilters}) by (cpu)
)`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:'2. Extract "count(count(...) by (cpu))" into cpuCount variable:'}),e(Ue,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"},
    cpuCount = count(count(node_cpu_seconds_total{commonFilters}) by (cpu))
)
(
  (
    cpuCount
      -
    avg(
      sum by (mode) (rate(node_cpu_seconds_total{mode='idle',commonFilters}[5m]))
    )
  )
    *
  100
) / cpuCount`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"3. Extract rate(...) part into cpuIdle variable, since it is clear now that this part calculates the number of idle CPUs:"}),e(Ue,{code:`WITH (
    commonFilters = {instance=~"$node:$port",job=~"$job"},
    cpuCount = count(count(node_cpu_seconds_total{commonFilters}) by (cpu)),
    cpuIdle = sum(rate(node_cpu_seconds_total{mode='idle',commonFilters}[5m]))
)
((cpuCount - cpuIdle) * 100) / cpuCount`})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:["4. Put node_cpu_seconds_total","{commonFilters}"," into its own variable with the name cpuSeconds:"]}),e(Ue,{code:`WITH (
    cpuSeconds = node_cpu_seconds_total{instance=~"$node:$port",job=~"$job"},
    cpuCount = count(count(cpuSeconds) by (cpu)),
    cpuIdle = sum(rate(cpuSeconds{mode='idle'}[5m]))
)
((cpuCount - cpuIdle) * 100) / cpuCount`}),e("p",{className:"vm-with-template-tutorial-section__text",children:"Now the query became more clear comparing to the initial query."})]}),e("div",{className:"vm-with-template-tutorial-section",children:[e("p",{className:"vm-with-template-tutorial-section__text",children:"WITH expressions may be nested and may be put anywhere. Try expanding the following query:"}),e(Ue,{code:`WITH (
    f(a, b) = WITH (
        f1(x) = b-x,
        f2(x) = x+x
    ) f1(a)*f2(b)
) f(foo, with(x=bar) x)`})]})]}),Ym=(t,r)=>`${t}/expand-with-exprs?query=${encodeURIComponent(r)}&format=json`,Gm=()=>{const{serverUrl:t}=re(),[r,n]=de(),[a,s]=y(""),[o,i]=y(!1),[l,c]=y();return{data:a,error:l,loading:o,expand:async d=>{r.set("expr",d),n(r);const u=Ym(t,d);i(!0);try{const v=await(await fetch(u)).json();s(v?.expr||""),c(String(v.error||""))}catch(h){h instanceof Error&&h.name!=="AbortError"&&c(`${h.name}: ${h.message}`)}i(!1)}}},Wm=()=>{const[t]=de(),{data:r,loading:n,error:a,expand:s}=Gm(),[o,i]=y(t.get("expr")||""),l=m=>{i(m)},c=()=>{s(o)};return x(()=>{o&&s(o)},[]),e("section",{className:"vm-with-template",children:[n&&e(ye,{}),e("div",{className:"vm-with-template-body vm-block",children:[e("div",{className:"vm-with-template-body__expr",children:e(se,{type:"textarea",label:"MetricsQL query with optional WITH expressions",value:o,error:a,autofocus:!0,onEnter:c,onChange:l})}),e("div",{className:"vm-with-template-body__result",children:e(se,{type:"textarea",label:"MetricsQL query after expanding WITH expressions and applying other optimizations",value:r,disabled:!0})}),e("div",{className:"vm-with-template-body-top",children:e(z,{variant:"contained",onClick:c,startIcon:e(it,{}),children:"Expand"})})]}),e("div",{className:"vm-block",children:e(jm,{})})]})},Jm=(t,r,n)=>{const a=["format=json",`relabel_configs=${encodeURIComponent(r)}`,`metric=${encodeURIComponent(n)}`];return`${t}/metric-relabel-debug?${a.join("&")}`},Km=()=>{const{serverUrl:t}=re(),[r,n]=y(null),[a,s]=y(!1),[o,i]=y();return{data:r,error:o,loading:a,fetchData:async(c,m)=>{const d=Jm(t,c,m);s(!0);try{const h=await(await fetch(d)).json();n(h.error?null:h),i(String(h.error||""))}catch(u){u instanceof Error&&u.name!=="AbortError"&&i(`${u.name}: ${u.message}`)}s(!1)}}},Zm={config:`- if: '{bar_label=~"b.*"}'
  source_labels: [foo_label, bar_label]
  separator: "_"
  target_label: foobar
- action: labeldrop
  regex: "foo_.*"
- target_label: job
  replacement: "my-application-2"`,labels:'{__name__="my_metric", bar_label="bar", foo_label="foo", job="my-application", instance="192.168.0.1"}'},Xm=()=>{const[t,r]=de(),{data:n,loading:a,error:s,fetchData:o}=Km(),[i,l]=dt("","config"),[c,m]=dt("","labels"),d=p=>{l(p||"")},u=p=>{m(p||"")},h=K(()=>{o(i,c),t.set("config",i),t.set("labels",c),r(t)},[i,c]),v=()=>{const{config:p,labels:_}=Zm;l(p),m(_),o(p,_),t.set("config",p),t.set("labels",_),r(t)};return x(()=>{const p=t.get("config")||"",_=t.get("labels")||"";(_||p)&&(o(p,_),l(p),m(_))},[]),e("section",{className:"vm-relabeling",children:[a&&e(ye,{}),e("div",{className:"vm-relabeling-header vm-block",children:[e("div",{className:"vm-relabeling-header-configs",children:e(se,{type:"textarea",label:"Relabel configs",value:i,autofocus:!0,onChange:d,onEnter:h})}),e("div",{className:"vm-relabeling-header__labels",children:e(se,{type:"textarea",label:"Labels",value:c,onChange:u,onEnter:h})}),e("div",{className:"vm-relabeling-header-bottom",children:[e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",rel:"help noreferrer",children:[e(ot,{}),"Relabeling cookbook"]}),e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/relabeling/",rel:"help noreferrer",children:[e(ht,{}),"Documentation"]}),e(z,{variant:"text",onClick:v,children:"Try example"}),e(z,{variant:"contained",onClick:h,startIcon:e(it,{}),children:"Submit"})]})]}),s&&e(X,{variant:"error",children:s}),n&&e("div",{className:"vm-relabeling-steps vm-block",children:[n.originalLabels&&e("div",{className:"vm-relabeling-steps-item",children:e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Original labels:"}),e("code",{dangerouslySetInnerHTML:{__html:n.originalLabels}})]})}),n.steps.map((p,_)=>e("div",{className:"vm-relabeling-steps-item",children:[e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Step:"}),_+1]}),e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Relabeling Rule:"}),e("code",{children:e("pre",{children:p.rule})})]}),e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Input Labels:"}),e("code",{children:e("pre",{dangerouslySetInnerHTML:{__html:p.errors?.inLabels||p.inLabels}})})]}),e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Output labels:"}),e("code",{children:e("pre",{dangerouslySetInnerHTML:{__html:p.errors?.outLabels||p.outLabels}})})]})]},_)),n.resultingLabels&&e("div",{className:"vm-relabeling-steps-item",children:e("div",{className:"vm-relabeling-steps-item__row",children:[e("span",{children:"Resulting labels:"}),e("code",{dangerouslySetInnerHTML:{__html:n.resultingLabels}})]})})]})]})},eu=t=>`${t}/api/v1/status/active_queries`,tu=()=>{const{serverUrl:t}=re(),[r,n]=y([]),[a,s]=y(q().format(gr)),[o,i]=y(!1),[l,c]=y(),m=D(()=>eu(t),[t]),d=async()=>{i(!0);try{const u=await fetch(m),h=await u.json();n(h.data),s(q().format("HH:mm:ss:SSS")),u.ok?c(void 0):c(`${h.errorType}\r
${h?.error}`)}catch(u){u instanceof Error&&c(`${u.name}: ${u.message}`)}i(!1)};return x(()=>{d().catch(console.error)},[m]),{data:r,lastUpdated:a,isLoading:o,error:l,fetchData:d}},ru=({rows:t,columns:r,defaultOrderBy:n,defaultOrderDir:a,copyToClipboard:s,paginationOffset:o,rowClasses:i,rowAction:l=c=>()=>{}})=>{const c=Ye(),[m,d]=y(n),[u,h]=y(a||"desc"),[v,p]=y(null),[_,g]=y(new Map);x(()=>{const S=new Map;t.forEach(w=>{S.set(w.id,Wo())}),g(S)},[t]);const f=D(()=>{const{startIndex:S,endIndex:w}=o;return sa(t,aa(u,m)).slice(S,w)},[t,m,u,o]),b=S=>()=>{h(w=>w==="asc"&&m===S?"desc":"asc"),d(S)},C=(S,w)=>async()=>{if(v!==w)try{await c(String(S)),p(w)}catch(T){console.error(T)}};x(()=>{if(v===null)return;const S=setTimeout(()=>p(null),2e3);return()=>clearTimeout(S)},[v]);const N=s&&r.find(S=>S.key==s);return e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{className:"vm-table__row vm-table__row_header",children:[r.map(S=>e("th",{className:"vm-table-cell vm-table-cell_header vm-table-cell_sort",onClick:b(S.key),children:e("div",{className:"vm-table-cell__content",children:[e("div",{children:String(S.title||S.key)}),e("div",{className:M({"vm-table__sort-icon":!0,"vm-table__sort-icon_active":m===S.key,"vm-table__sort-icon_desc":u==="desc"&&m===S.key}),children:e(We,{})})]})},String(S.key))),s&&e("th",{className:"vm-table-cell vm-table-cell_header"})]})}),e("tbody",{className:"vm-table-body",children:f.map((S,w)=>e("tr",{className:M({"vm-table__row":!0,...i?i(S):{}}),id:S.id,ref:_.get(S.id),onClick:l(_.get(S.id)),children:[r.map(T=>e("td",{className:M({"vm-table-cell":!0,[`${T.className}`]:T.className}),children:(T.format?T.format(S):String(S[T.key]))||"-"},String(T.key))),s&&N&&e("td",{className:"vm-table-cell vm-table-cell_right",children:S[s]&&e("div",{className:"vm-table-cell__content",children:e(Y,{title:v===w?"Copied":"Copy row",children:e(z,{variant:"text",color:v===w?"success":"gray",size:"small",startIcon:v===w?e(Rr,{}):e(yt,{}),onClick:C(N.format?N.format(S):String(S[s]),w),ariaLabel:"copy row"})})})})]},w))})]})},nu=()=>{const{isMobile:t}=j(),{timezone:r}=pe(),{data:n,lastUpdated:a,isLoading:s,error:o,fetchData:i}=tu(),l=D(()=>n.map(d=>{const u=q(d.start).tz().format(Fe),h=q(d.end).tz().format(Fe);return{duration:d.duration,remote_addr:d.remote_addr,query:d.query,args:`${u} to ${h}, step=${dn(d.step)}`,data:JSON.stringify(d,null,2)}}),[n,r]),c=D(()=>{if(!l?.length)return[];const d=Object.keys(l[0]),u={remote_addr:"client address"},h=["data"];return d.filter(v=>!h.includes(v)).map(v=>({key:v,title:u[v]||v}))},[l]),m=async()=>{i().catch(console.error)};return e("div",{className:"vm-active-queries",children:[s&&e(ye,{}),e("div",{className:"vm-active-queries-header",children:[!l.length&&!o&&e(X,{variant:"info",children:"There are currently no active queries running"}),o&&e(X,{variant:"error",children:o}),e("div",{className:"vm-active-queries-header-controls",children:[e(z,{variant:"contained",onClick:m,startIcon:e(qt,{}),children:"Update"}),e("div",{className:"vm-active-queries-header__update-msg",children:["Last updated: ",a]})]})]}),!!l.length&&e("div",{className:M({"vm-block":!0,"vm-block_mobile":t}),children:e(ru,{rows:l,columns:c,defaultOrderBy:"duration",copyToClipboard:"data",paginationOffset:{startIndex:0,endIndex:1/0}})})]})},au=({onClose:t,onUpload:r})=>{const{isMobile:n}=j(),[a,s]=y(""),[o,i]=y(""),l=D(()=>{try{return JSON.parse(a),""}catch(d){return d instanceof Error?d.message:"Unknown error"}},[a]),c=d=>{i(""),s(d)},m=()=>{i(l),!l&&(r(a),t())};return e("div",{className:M({"vm-json-form vm-json-form_one-field":!0,"vm-json-form_mobile vm-json-form_one-field_mobile":n}),children:[e(se,{value:a,label:"JSON",type:"textarea",error:o,autofocus:!0,onChange:c,onEnter:m}),e("div",{className:"vm-json-form-footer",children:e("div",{className:"vm-json-form-footer__controls vm-json-form-footer__controls_right",children:[e(z,{variant:"outlined",color:"error",onClick:t,children:"Cancel"}),e(z,{variant:"contained",onClick:m,children:"apply"})]})})]})},su=({data:t,period:r})=>{const{isMobile:n}=j(),[a,s]=de(),{tableCompact:o}=Pe(),i=Pt(),[l,c]=y([]),[m,d]=y(),[u,h]=y(),[v,p]=y(!1),[_,g]=y([]),[f,b]=y(),C=D(()=>tr(u||[]).map(O=>O.key),[u]),N=D(()=>{const O=t.some(W=>W.data.resultType==="matrix");return t.some(W=>W.data.resultType==="vector")&&O?Et:O?Et.filter(W=>W.value==="chart"):Et.filter(W=>W.value!=="chart")},[t]),[S,w]=y(N[0].value),{yaxis:T,spanGaps:E}=Me(),A=Xe(),k=O=>{A({type:"SET_YAXIS_LIMITS",payload:O})},L=()=>{A({type:"TOGGLE_ENABLE_YAXIS_LIMITS"})},$=O=>{A({type:"SET_SPAN_GAPS",payload:O})},I=O=>{w(O)},R=O=>{c(U=>U.filter(W=>W.idValue!==O.idValue))},H=()=>{i({type:"TOGGLE_TABLE_COMPACT"})};return x(()=>{const O=S==="chart"?"matrix":"vector",U=t.filter(W=>W.data.resultType===O&&W.trace).map(W=>W.trace?new pt(W.trace,W?.vmui?.params?.query||"Query"):null);c(U.filter(Boolean))},[t,S]),x(()=>{const O=[],U=[],W=[];t.forEach((ie,me)=>{const Q=ie.data.result.map(ae=>({...ae,group:Number(ie.vmui?.params?.id??me)+1}));ie.data.resultType==="matrix"?(U.push(...Q),O.push(ie.vmui?.params?.query||"Query")):W.push(...Q)}),g(O),d(U),h(W),a.delete("display_mode"),s(a)},[t]),x(()=>{const O=!a.get("display_mode");p(!!m&&O&&Yn(m))},[m,a]),e("div",{className:M({"vm-query-analyzer-view":!0,"vm-query-analyzer-view_mobile":n}),children:[!!l.length&&e(Wn,{traces:l,onDeleteClick:R}),e(Io,{}),e("div",{className:M({"vm-block":!0,"vm-block_mobile":n}),children:[e("div",{className:"vm-custom-panel-body-header",children:[e("div",{className:"vm-custom-panel-body-header__tabs",children:e(er,{activeItem:S,items:N,onChange:I})}),e("div",{className:"vm-custom-panel-body-header__graph-controls",children:[S==="chart"&&e(Bn,{}),S==="chart"&&e(ra,{data:m||[],yaxis:T,isHistogram:v,setYaxisLimits:k,toggleEnableLimits:L,spanGaps:{value:E,onChange:$}}),S==="table"&&e(Lo,{columns:C,selectedColumns:f,onChangeColumns:b,tableCompact:o,toggleTableCompact:H})]})]}),m&&r&&S==="chart"&&e(Qr,{data:m,period:r,customStep:r.step||"1s",query:_,yaxis:T,setYaxisLimits:k,setPeriod:()=>null,height:n?window.innerHeight*.5:500,isHistogram:v,spanGaps:E}),u&&S==="code"&&e(na,{data:u}),u&&S==="table"&&e(xo,{data:u,displayColumns:f})]})]})},ou=({data:t,period:r})=>{const n=D(()=>t.filter(d=>d.vmui||d.stats),[t]),a=n.find(d=>d?.vmui?.title)?.vmui?.title||"Report",s=n.find(d=>d?.vmui?.comment)?.vmui?.comment,o=D(()=>["vmui.endpoint",...new Set(n.flatMap(d=>[...Object.keys(d.vmui?.params||[]).map(u=>`vmui.params.${u}`),...Object.keys(d.stats||[]).map(u=>`stats.${u}`),"isPartial"]))].map(d=>({column:d.split(".").pop(),values:n.map(u=>{const h=wo(u,d);return typeof h=="string"?h:"-"})})).filter(({values:d})=>d.length&&d.every(u=>u!=="-")),[n]),i=D(()=>{if(!r)return"";const d=q(r.start*1e3).tz().format(Fe),u=q(r.end*1e3).tz().format(Fe);return`${d} - ${u}`},[r]),{value:l,setTrue:c,setFalse:m}=ce(!1);return e(V,{children:[e("div",{className:"vm-query-analyzer-info-header",children:[e("h1",{className:"vm-query-analyzer-info-header__title",children:a}),i&&e("div",{className:"vm-query-analyzer-info-header__timerange",children:[e(Bt,{})," ",i]}),r?.step&&e("div",{className:"vm-query-analyzer-info-header__timerange",children:[e(Cr,{})," step ",r.step]}),(s||!!o.length)&&e("div",{className:"vm-query-analyzer-info-header__info",children:e(z,{startIcon:e(ot,{}),variant:"outlined",color:"warning",onClick:c,children:["Show stats",s&&" & comments"]})})]}),l&&e(Ce,{title:a,onClose:m,children:e("div",{className:"vm-query-analyzer-info__modal",children:[!!o.length&&e("div",{className:"vm-query-analyzer-info-stats",children:[e("div",{className:"vm-query-analyzer-info-comment-header",children:[e(ot,{}),"Stats"]}),e("table",{children:[e("thead",{children:e("tr",{children:o.map(({column:d})=>e("th",{children:d},d))})}),e("tbody",{children:o[0]?.values.map((d,u)=>e("tr",{children:o.map(({values:h},v)=>e("td",{children:h[u]},v))},u))})]})]}),s&&e("div",{className:"vm-query-analyzer-info-comment",children:[e("div",{className:"vm-query-analyzer-info-comment-header",children:[e(Es,{}),"Comments"]}),e("div",{className:"vm-query-analyzer-info-comment-body vm-markdown",dangerouslySetInnerHTML:{__html:Er(s)||s}})]})]})})]})},iu=t=>{const r=t.slice(1).map((o,i)=>o-t[i]),n={};r.forEach(o=>{const i=o.toString();n[i]=(n[i]||0)+1});let a=0,s=0;for(const o in n)n[o]>s&&(s=n[o],a=Number(o));return a},lu=()=>{const[t,r]=y([]),[n,a]=y(""),s=D(()=>!!t.length,[t]),{value:o,setTrue:i,setFalse:l}=ce(!1),c=D(()=>{if(!t)return;const g=t[0]?.vmui?.params,f={start:+(g?.start||0),end:+(g?.end||0),step:g?.step,date:""};if(!g){const C=t.filter(S=>S.data.resultType==="matrix").map(S=>S.data.result).flat().map(S=>S.values?S.values?.map(w=>w[0]):[0]).flat(),N=Array.from(new Set(C.filter(Boolean))).sort((S,w)=>S-w);f.start=N[0],f.end=N[N.length-1],f.step=xn(iu(N))}return f.date=Wa(qe(f.end)),f},[t]),m=g=>g.every(f=>{if(typeof f=="object"&&f!==null){const b=f.data;if(typeof b=="object"&&b!==null){const C=b.result,N=b.resultType;return Array.isArray(C)&&typeof N=="string"}}return!1}),d=g=>{try{const f=JSON.parse(g),b=Array.isArray(f)?f:[f];m(b)?r(b):(a("Invalid structure - JSON does not match the expected format"),r([]))}catch(f){f instanceof Error&&(a(`${f.name}: ${f.message}`),r([]))}},u=g=>{g.map(f=>{const b=new FileReader;b.onload=C=>{const N=String(C.target?.result);d(N)},b.readAsText(f)})},h=g=>{if(!g.target)return;const f=g.target;a("");const b=Array.from(f.files||[]);u(b),f.value=""},v=()=>{a("")},{files:p,dragging:_}=Ro();return x(()=>{u(p)},[p]),e("div",{className:"vm-query-analyzer",children:[s&&e("div",{className:"vm-query-analyzer-header",children:[e(ou,{data:t,period:c}),e(Sr,{onOpenModal:i,onChange:h})]}),s&&e(su,{data:t,period:c}),!s&&e("div",{className:"vm-trace-page-preview",children:[e("p",{className:"vm-trace-page-preview__text",children:["Please, upload file with JSON response content.",`
`,"The file must contain query information in JSON format.",`
`,"Graph will be displayed after file upload.",`
`,"Attach files by dragging & dropping, selecting or pasting them."]}),e(Sr,{onOpenModal:i,onChange:h})]}),n&&e("div",{className:"vm-query-analyzer-error",children:[e(X,{variant:"error",children:n}),e(z,{className:"vm-query-analyzer-error__close",startIcon:e(De,{}),variant:"text",color:"error",onClick:v})]}),o&&e(Ce,{title:"Paste JSON",onClose:l,children:e(au,{onClose:l,onUpload:d})}),_&&e("div",{className:"vm-trace-page__dropzone"})]})},cu=(t,r,n)=>{const a=[`flags=${encodeURIComponent(r)}`,`metrics=${encodeURIComponent(n)}`];return`${t}/downsampling-filters-debug?${a.join("&")}`},du=()=>{const{serverUrl:t}=re(),[r,n]=de(),[a,s]=y(new Map),[o,i]=y(!1),[l,c]=y(),[m,d]=y(),[u,h]=y(),v=K(async(p,_)=>{if(c(_?"":"metrics are required"),d(p?"":"flags are required"),!_||!p)return;r.set("flags",p),r.set("metrics",_),n(r);const g=cu(t,p,_);i(!0);try{const b=await(await fetch(g)).json();s(new Map(Object.entries(b.result||{}))),c(b.error?.metrics||""),d(b.error?.flags||""),h("")}catch(f){f instanceof Error&&f.name!=="AbortError"&&h(`${f.name}: ${f.message}`)}i(!1)},[t]);return{data:a,error:u,metricsError:l,flagsError:m,loading:o,applyFilters:v}},$a={flags:`-downsampling.period={env="dev"}:7d:5m,{env="dev"}:30d:30m
-downsampling.period=30d:1m
-downsampling.period=60d:5m
`,metrics:`up
up{env="dev"}
up{env="prod"}`},mu=()=>{const[t]=de(),{data:r,loading:n,error:a,metricsError:s,flagsError:o,applyFilters:i}=du(),[l,c]=y(t.get("metrics")||""),[m,d]=y(t.get("flags")||""),u=K(g=>{c(g)},[c]),h=K(g=>{d(g)},[d]),v=K(()=>{i(m,l)},[i,m,l]),p=K(()=>{const{flags:g,metrics:f}=$a;d(g),c(f),i(g,f),t.set("flags",g),t.set("metrics",f)},[$a,d,c,t]);x(()=>{m&&l&&v()},[]);const _=[];for(const[g,f]of r)_.push(e("tr",{className:"vm-table__row",children:[e("td",{className:"vm-table-cell",children:g}),e("td",{className:M({"vm-table-cell":!0,"vm-table-cell_empty":!f}),children:f?f.join(" "):"No matching rules found!"})]}));return e("section",{className:"vm-downsampling-filters",children:[n&&e(ye,{}),e("div",{className:"vm-downsampling-filters-body vm-block",children:[e("div",{className:"vm-downsampling-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:["Provide a list of flags for downsampling configuration. Note that only ",e("code",{children:"-downsampling.period"})," and ",e("code",{children:"-dedup.minScrapeInterval"})," flags are supported"]})}),e(se,{type:"textarea",label:"Flags",value:m,error:a||o,autofocus:!0,onEnter:v,onChange:h,placeholder:"-downsampling.period=30d:1m -downsampling.period=7d:5m -dedup.minScrapeInterval=30s"})]}),e("div",{className:"vm-downsampling-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:"Provide a list of metrics to check downsampling configuration."})}),e(se,{type:"textarea",label:"Metrics",value:l,error:a||s,onEnter:v,onChange:u,placeholder:`up{env="dev"}
up{env="prod"}
`})]}),e("div",{className:"vm-downsampling-filters-body__result",children:e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{children:[e("th",{className:"vm-table-cell vm-table-cell_header",children:"Metric"}),e("th",{className:"vm-table-cell vm-table-cell_header",children:"Applied downsampling rules"})]})}),e("tbody",{className:"vm-table-body",children:_})]})}),e("div",{className:"vm-downsampling-filters-body-top",children:[e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#downsampling",rel:"help noreferrer",children:[e(ht,{}),"Documentation"]}),e(z,{variant:"text",onClick:p,children:"Try example"}),e(z,{variant:"contained",onClick:v,startIcon:e(it,{}),children:"Apply"})]})]})]})},uu=(t,r,n)=>{const a=[`flags=${encodeURIComponent(r)}`,`metrics=${encodeURIComponent(n)}`];return`${t}/retention-filters-debug?${a.join("&")}`},hu=()=>{const{serverUrl:t}=re(),[r,n]=de(),[a,s]=y(new Map),[o,i]=y(!1),[l,c]=y(),[m,d]=y(),[u,h]=y(),v=K(async(p,_)=>{if(c(_?"":"metrics are required"),d(p?"":"flags are required"),!_||!p)return;r.set("flags",p),r.set("metrics",_),n(r);const g=uu(t,p,_);i(!0);try{const b=await(await fetch(g)).json();s(new Map(Object.entries(b.result||{}))),c(b.error?.metrics||""),d(b.error?.flags||""),h("")}catch(f){f instanceof Error&&f.name!=="AbortError"&&h(`${f.name}: ${f.message}`)}i(!1)},[t]);return{data:a,error:u,metricsError:l,flagsError:m,loading:o,applyFilters:v}},Pa={flags:`-retentionPeriod=1y
-retentionFilter={env!="prod"}:2w
`,metrics:`up
up{env="dev"}
up{env="prod"}`},pu=()=>{const[t]=de(),{data:r,loading:n,error:a,metricsError:s,flagsError:o,applyFilters:i}=hu(),[l,c]=y(t.get("metrics")||""),[m,d]=y(t.get("flags")||""),u=K(g=>{c(g)},[c]),h=K(g=>{d(g)},[d]),v=K(()=>{i(m,l)},[i,m,l]),p=K(()=>{const{flags:g,metrics:f}=Pa;d(g),c(f),i(g,f),t.set("flags",g),t.set("metrics",f)},[Pa,d,c,t]);x(()=>{m&&l&&v()},[]);const _=[];for(const[g,f]of r)_.push(e("tr",{className:"vm-table__row",children:[e("td",{className:"vm-table-cell",children:g}),e("td",{className:"vm-table-cell",children:f})]}));return e("section",{className:"vm-retention-filters",children:[n&&e(ye,{}),e("div",{className:"vm-retention-filters-body vm-block",children:[e("div",{className:"vm-retention-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:["Provide a list of flags for retention configuration. Note that only ",e("code",{children:"-retentionPeriod"})," and ",e("code",{children:"-retentionFilter"})," flags are supported."]})}),e(se,{type:"textarea",label:"Flags",value:m,error:a||o,autofocus:!0,onEnter:v,onChange:h,placeholder:'-retentionPeriod=4w -retentionFilter=up{env="dev"}:2w'})]}),e("div",{className:"vm-retention-filters-body__expr",children:[e("div",{className:"vm-retention-filters-body__title",children:e("p",{children:"Provide a list of metrics to check retention configuration."})}),e(se,{type:"textarea",label:"Metrics",value:l,error:a||s,onEnter:v,onChange:u,placeholder:`up{env="dev"}
up{env="prod"}
`})]}),e("div",{className:"vm-retention-filters-body__result",children:e("table",{className:"vm-table",children:[e("thead",{className:"vm-table-header",children:e("tr",{children:[e("th",{className:"vm-table-cell vm-table-cell_header",children:"Metric"}),e("th",{className:"vm-table-cell vm-table-cell_header",children:"Applied retention"})]})}),e("tbody",{className:"vm-table-body",children:_})]})}),e("div",{className:"vm-retention-filters-body-top",children:[e("a",{className:"vm-link vm-link_with-icon",target:"_blank",href:"https://docs.victoriametrics.com/victoriametrics/single-server-victoriametrics/#retention-filters",rel:"help noreferrer",children:[e(ht,{}),"Documentation"]}),e(z,{variant:"text",onClick:p,children:"Try example"}),e(z,{variant:"contained",onClick:v,startIcon:e(it,{}),children:"Apply"})]})]})]})},vu=({hideQuery:t,showAllSeries:r})=>{const{query:n}=Le(),{period:a}=pe(),{displayType:s,reduceMemUsage:o,seriesLimits:i}=Pe(),{serverUrl:l}=re(),{showInfoMessage:c}=Ds(),[m,d]=y(!1),[u,h]=y(),[v,p]=y(),[_,g]=y([]),[f,b]=y(),C=J(new AbortController),N=D(()=>{if(p(""),g([]),!!a)if(!l)p(_e.emptyServer);else if(n.every(A=>!A.trim()))g(n.map(()=>_e.validQuery));else if(Tn(l)){const A={...a};return n.map(k=>_c(l,k,A,o))}else p(_e.validServer)},[l,a,t,o]),S=D(()=>{const A=k=>`vmui_export_${n.join("_")}_${a.start}_${a.end}.${k}`;return{csv:async()=>{const k=Cc(l,n,a,o),L=await fetch(k);try{let $=await L.text();$=`name,value,timestamp
`+$,no($,A("csv"))}catch($){console.error($),c({text:"Couldn't fetch data for CSV export. Please try again",type:"error"})}},json:async()=>{const k=Nc(l,n,a,o);try{const $=await(await fetch(k)).text();Ur($,A("json"))}catch(L){console.error(L),c({text:"Couldn't fetch data for JSON export. Please try again",type:"error"})}}}},[n,a,l,o]),w=K(async({fetchUrl:A,stateSeriesLimits:k,showAllSeries:L})=>{C.current.abort(),C.current=new AbortController;const{signal:$}=C.current;d(!0);try{const I=Math.floor(window.innerWidth/4),R=30*1024*1024,H=[],O=L?1/0:+k[s]||1/0;let U=1,W=0;for await(const me of A){if(t?.includes(U-1)){g(P=>[...P,""]),U++;continue}const ae=await fetch(me,{signal:$}),ne=await ae.text();if(new TextEncoder().encode(ne).length>R){const P="Response too large to display (over 30 MiB). Please narrow your query.";p(P),g(B=>[...B,P]);continue}if(!ae.ok||!ae.body)H.push({metric:{},values:[],group:U}),p(ne),g(P=>[...P,`${ne}`]);else{g(te=>[...te,""]);const P=O-H.length,B=ne.split(`
`).filter(te=>te),Z=B.slice(0,P).sort();for(const te of Z){const le=Mo(te);if(!le)continue;const{values:ue,timestamps:fe}=le,be=ue.length,Ne=be>I,ke=Ne?I:be,we=Ne?be/I:1,Te=Array.from({length:ke},(Ct,Re)=>{const Je=Ne?Math.floor(Re*we):Re;return[fe[Je]/1e3,ue[Je]]});H.push({group:U,metric:le.metric,values:Te})}W+=B.length}U++}const ie=`Showing ${H.length} series out of ${W} series due to performance reasons. Please narrow down the query, so it returns fewer series`;b(W>O?ie:""),h(H),d(!1)}catch(I){d(!1),I instanceof Error&&I.name!=="AbortError"&&(p(String(I)),console.error(I))}},[s,t]),T=K(A=>{if(v)return;const k={...a};S[A](l,n,k,o)},[l,n,a,o,v,S]),E=K(()=>{C.current.abort(),h([])},[C]);return x(()=>{if(!N?.length)return;const A=setTimeout(w,400,{fetchUrl:N,stateSeriesLimits:i,showAllSeries:r});return()=>{C.current?.abort(),clearTimeout(A)}},[N,i,r]),{fetchUrl:N,isLoading:m,data:u,error:v,queryErrors:_,setQueryErrors:g,warning:f,abortFetch:E,exportData:T}},fu=()=>e(Se,{href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#raw-samples",underlined:!0,children:"raw samples"}),gu=()=>e(Se,{underlined:!0,href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#query-data",children:"Query API"}),yu=()=>e(Se,{underlined:!0,href:"https://docs.victoriametrics.com/victoriametrics/keyconcepts/#filtering",children:"time series selector"}),bu=()=>{Gn();const{isMobile:t}=j(),{displayType:r}=Pe(),{query:n}=Le(),[a,s]=y([]),[o,i]=y(!n[0]),[l,c]=y(!1),[m,d]=y(!0),{data:u,error:h,isLoading:v,warning:p,queryErrors:_,setQueryErrors:g,abortFetch:f,exportData:b}=vu({hideQuery:a,showAllSeries:l}),C=J(null),N=!o&&h,S=A=>{s(A)},w=()=>{i(!1)},T=()=>{d(!1)},E=K(async A=>{A&&b(A)},[b]);return e("div",{className:M({"vm-custom-panel":!0,"vm-custom-panel_mobile":t}),children:[e(jn,{label:"Time series selector",queryErrors:o?[]:_,setQueryErrors:g,setHideError:i,stats:[],isLoading:v,onHideQuery:S,onRunQuery:w,abortFetch:f,hideButtons:{traceQuery:!0,disableCache:!0},includeFunctions:!1}),m&&e(X,{variant:"info",children:e("div",{className:"vm-explore-metrics-header-description",children:[e("ul",{children:[e("li",{children:["This page provides a dedicated view for querying and displaying ",e(fu,{})," from VictoriaMetrics."]}),e("li",{children:["It expects only ",e(yu,{})," as a query argument."]}),e("li",{children:["Deduplication can only be disabled if it was previously enabled on the server (",e("code",{children:"-dedup.minScrapeInterval"}),")."]}),e("li",{children:["Users often assume that the ",e(gu,{})," returns data exactly as stored, but data samples and timestamps may be modified by the API."]})]}),e(z,{variant:"text",size:"small",startIcon:e(De,{}),onClick:T,ariaLabel:"close tips"})]})}),N&&e(X,{variant:"error",children:h}),p&&e(qr,{warning:p,query:n,onChange:c}),e("div",{className:M({"vm-custom-panel-body":!0,"vm-custom-panel-body_mobile":t,"vm-block":!0,"vm-block_mobile":t}),children:[v&&e(Zs,{}),e("div",{className:"vm-custom-panel-body-header",ref:C,children:[e("div",{className:"vm-custom-panel-body-header__tabs",children:e(xs,{tabFilter:A=>A.value!==ge.table})}),u&&e(Do,{title:"Export query",downloadFormatOptions:["json","csv"],onDownload:E})]}),e(ko,{graphData:u,liveData:u,isHistogram:!1,displayType:r,controlsRef:C})]})]})},_u=({types:t,states:r,search:n,rule_id:a,alert_id:s,group_id:o})=>{const{setSearchParamsFromKeys:i}=et();x(()=>{const c=Br({types:t,states:r,search:n,alert_id:s,rule_id:a,group_id:o});i(c)},[t,r,n,a,o,s])},Cu=({kinds:t,search:r})=>{const{setSearchParamsFromKeys:n}=et();x(()=>{const s=Br({kinds:t,search:r});n(s)},[t,r])},Nu=t=>`${t}/vmalert/api/v1/rules?datasource_type=prometheus`,wu=(t,r,n,a)=>`${t}/vmalert/api/v1/${a}?group_id=${r}&${a}_id=${n}`,Su=(t,r)=>`${t}/vmalert/api/v1/group?group_id=${r}`,Tu=t=>`${t}/vmalert/api/v1/notifiers`,Eu=({blockFetch:t})=>{const{serverUrl:r}=re(),{period:n}=pe(),[a,s]=y([]),[o,i]=y(!1),[l,c]=y(),m=D(()=>Nu(r),[r]),d=!!a.length||!t;return x(()=>{if(t)return;(async()=>{i(!0);try{const h=await fetch(m),v=await h.json();if(h.ok){const p=v.data.groups||[];s(p.sort((_,g)=>_.name.localeCompare(g.name))),c(void 0)}else c(`${v.errorType}\r
${v?.error}`)}catch(h){h instanceof Error&&c(`${h.name}: ${h.message}`)}i(!1)})().catch(console.error)},[m,n,d]),{groups:a,isLoading:o,error:l}},Au=({types:t,allTypes:r,allStates:n,states:a,search:s,onChangeTypes:o,onChangeStates:i,onChangeSearch:l})=>{const c=D(()=>t.length?"":"No states. Please select rule states",[t]),{isMobile:m}=j();return e(V,{children:e("div",{className:M({"vm-explore-alerts-header":!0,"vm-explore-alerts-header_mobile":m,"vm-block":!0,"vm-block_mobile":m}),children:[e("div",{className:"vm-explore-alerts-header__rule_type",children:e(at,{value:t,list:r,label:"Rules type",placeholder:"Please select rule type",onChange:o,autofocus:!!t.length&&!m,includeAll:!0,searchable:!0})}),e("div",{className:"vm-explore-alerts-header__state",children:e(at,{itemClassName:"vm-badge-menu-item",value:a,list:n,label:"State",placeholder:"Please rule state",onChange:i,noOptionsText:c,includeAll:!0,searchable:!0})}),e("div",{className:"vm-explore-alerts-header-search",children:e(se,{label:"Search",value:s,placeholder:"Filter by rule, name or labels",startIcon:e($t,{}),onChange:l})})]})})},He=({items:t,children:r,align:n="start"})=>e("div",{className:"vm-badges",style:{"justify-content":n},children:[Object.entries(t).map(([a,s])=>e("span",{className:`vm-badge ${s.color}`,children:s.value?`${a}: ${s.value}`:a},a)),r]}),xu=({group:t})=>{const{isMobile:r}=j(),n=ft(),a=async()=>{n({pathname:"/rules",search:`group_id=${t.id}`})},s=M({"vm-explore-alerts-group-header":!0,"vm-explore-alerts-group-header_mobile":r});return e("div",{className:s,children:[e("div",{className:"vm-explore-alerts-group-header__desc",children:[e("div",{className:"vm-explore-alerts-group-header__name",children:t.name}),!r&&e("div",{className:"vm-explore-alerts-group-header__file",children:t.file})]}),e("div",{className:"vm-explore-alerts-controls",children:[e(He,{align:"end",items:Object.fromEntries(Object.entries(t.states||{}).map(([o,i])=>[o.toLowerCase(),{color:o.toLowerCase().replace(" ","-"),value:i}]))}),e(z,{className:"vm-button-borderless",size:"small",color:"gray",variant:"outlined",startIcon:e(Ir,{}),onClick:a})]})]})},Gr=({name:t,id:r,groupId:n,entity:a,type:s,states:o,onClose:i})=>{const{isMobile:l}=j(),{serverUrl:c}=re(),m=ft(),d=Ye(),u=()=>{m({pathname:"/rules",search:`group_id=${n}&${a}_id=${r}`})},h=async()=>{let g=`${c}/vmui/#/rules?group_id=${n}`;s&&(g=`${g}&${a}_id=${r}`),await d(g,`Link to ${a} has been copied`)},v=M({"vm-explore-alerts-item-header":!0,"vm-explore-alerts-item-header_mobile":l}),p=()=>{switch(a){case"alert":return e(Y,{title:"Alert",children:e(rs,{})});case"group":return e(Y,{title:"Group",children:e(ts,{})});default:switch(s){case"alerting":return e(Y,{title:"Alerting rule",children:e(ns,{})});default:return e(Y,{title:"Recording rule",children:e(as,{})})}}},_=D(()=>Object.fromEntries(Object.entries(o||{}).map(([g,f])=>[g,{color:g.toLowerCase().replace(" ","-"),value:f==1?0:f}])),[o]);return e("div",{className:v,id:`rule-${r}`,children:[e("div",{className:"vm-explore-alerts-item-header__title",children:[p(),e("div",{className:"vm-explore-alerts-item-header__name",children:t})]}),e("div",{className:"vm-explore-alerts-controls",children:[e(He,{align:"end",items:_}),i?e(z,{className:"vm-back-button",size:"small",variant:"outlined",color:"gray",startIcon:e(es,{}),onClick:h,children:e("span",{className:"vm-button-text",children:"Copy Link"})}):e(z,{className:"vm-button-borderless",size:"small",variant:"outlined",color:"gray",startIcon:e(Ir,{}),onClick:u})]})]})},Ut=t=>{const r=q.duration(Math.round(t*1e3)),n=[];return r.get("day")&&n.push("D[d]"),r.get("hour")&&n.push("H[h]"),r.get("minute")&&n.push("m[m]"),r.get("millisecond")?n.push("s.SSS[s]"):(!n.length||r.get("second"))&&n.push("s[s]"),r.format(n.join(" "))},Tt=t=>{const r=q(t);return r.year()<=1?"Never":r.format("DD MMM YYYY HH:mm:ss")},Oo=({item:t})=>{const r=t?.query,n=ft(),a=l=>()=>{n({pathname:"/rules",search:`group_id=${t.group_id}&alert_id=${l}`})},s=t?.labels||{},o=D(()=>Object.fromEntries(Object.entries(s).map(([l,c])=>[l,{color:"passive",value:c}])),[s]);return e("div",{className:"vm-explore-alerts-rule-item",children:[e("table",{children:[e("colgroup",{children:[e("col",{className:"vm-col-md"}),e("col",{})]}),e("tbody",{children:[e("tr",{children:e("td",{style:{"text-align":"end"},colSpan:2,children:e(z,{size:"small",variant:"outlined",color:"gray",startIcon:e($t,{}),onClick:()=>{const l={"g0.expr":r,"g0.end_time":""};window.open(`#/?${Ha(l).toString()}`,"_blank","noopener noreferrer")},children:e("span",{className:"vm-button-text",children:"Run query"})})})}),e("tr",{children:[e("td",{children:"Query"}),e("td",{children:e(Ue,{code:r})})]}),!!t.duration&&e("tr",{children:[e("td",{children:"For"}),e("td",{children:Ut(t.duration)})]}),e("tr",{children:[e("td",{children:"Last evaluation"}),e("td",{children:Tt(t.lastEvaluation)})]}),!!t.lastError&&t.health!=="ok"&&e("tr",{children:[e("td",{children:"Last error"}),e("td",{children:e(X,{variant:"error",children:t.lastError})})]}),!!Object.keys(o).length&&e("tr",{children:[e("td",{children:"Labels"}),e("td",{children:e(He,{items:o})})]})]})]}),!!Object.keys(t?.annotations||{}).length&&e(V,{children:[e("span",{className:"vm-alerts-title",children:"Annotations"}),e("table",{children:[e("colgroup",{children:[e("col",{className:"vm-col-md"}),e("col",{})]}),e("tbody",{children:Object.entries(t.annotations||{}).map(([l,c])=>e("tr",{children:[e("td",{children:l}),e("td",{children:c})]},l))})]})]}),!!t?.updates?.length&&e(V,{children:[e("span",{className:"vm-alerts-title",children:`Last updates ${t.updates.length}/${t.max_updates_entries}`}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Updated at"}),e("th",{children:"Series returned"}),e("th",{children:"Series fetched"}),e("th",{children:"Duration"}),e("th",{children:"Executed at"})]})}),e("tbody",{children:t.updates.map(l=>e("tr",{children:[e("td",{children:Tt(l.time)}),e("td",{children:l.samples}),e("td",{children:l.series_fetched}),e("td",{children:Ut(l.duration/1e9)}),e("td",{children:Tt(l.at)})]},l.at))})]})]}),!!t?.alerts?.length&&e(V,{children:[e("span",{className:"vm-alerts-title",children:"Alerts"}),e("table",{children:[e("colgroup",{children:[e("col",{className:"vm-col-sm"}),e("col",{className:"vm-col-sm"}),e("col",{className:"vm-col-sm"}),e("col",{}),e("col",{className:"vm-col-hidden"})]}),e("thead",{children:e("tr",{children:[e("th",{children:"Active since"}),e("th",{children:"State"}),e("th",{children:"Value"}),e("th",{className:"vm-alerts-title",children:"Labels"}),e("th",{})]})}),e("tbody",{children:t.alerts.map(l=>e("tr",{id:`alert-${l.id}`,children:[e("td",{children:Tt(l.activeAt)}),e("td",{children:e(He,{items:{[l.state]:{color:l.state}}})}),e("td",{children:e(He,{items:{[l.value]:{color:"passive"}}})}),e("td",{children:e(He,{align:"center",items:Object.fromEntries(Object.entries(l.labels||{}).map(([c,m])=>[c,{color:"passive",value:m}]))})}),e("td",{children:e(z,{className:"vm-button-borderless",size:"small",variant:"outlined",color:"gray",startIcon:e(Ir,{}),onClick:a(l.id)})})]},l.id))})]})]})]})},Lu=({states:t,rule:r})=>{const n=Object.keys(t).length>0?Object.keys(t)[0]:"ok";return e("div",{className:`vm-explore-alerts-rule vm-badge-item ${n.replace(" ","-")}`,children:e(_t,{title:e(Gr,{entity:"rule",type:r.type,groupId:r.group_id,states:t,id:r.id,name:r.name}),children:e(Oo,{item:r})},`rule-${r.id}`)})},zo=({groupId:t,id:r,mode:n})=>{const{serverUrl:a}=re(),{period:s}=pe(),[o,i]=y(),[l,c]=y(!1),[m,d]=y(),u=D(()=>wu(a,t,r,n),[a,t,r,n]);return x(()=>{(async()=>{c(!0);try{const v=await fetch(u),p=await v.json();v.ok?(i(p),d(void 0)):d(`${p.errorType}\r
${p?.error}`)}catch(v){v instanceof Error&&d(`${v.name}: ${v.message}`)}c(!1)})().catch(console.error)},[u,s]),{item:o,isLoading:l,error:m}},yn=(t,r)=>{if(t==="All")return[];const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),Array.from(n)},Ho=t=>{let r=t?.state||"ok";return t?.health!=="ok"?r="unhealthy":!t?.lastSamples&&!t?.lastSeriesFetched&&(r="no match"),r},Fo=t=>{const r={};return(t?.alerts?.length||0)>0?t.alerts.forEach(a=>{a.state in r?r[a.state]+=1:r[a.state]=1}):r[Ho(t)]=1,r},ku=(t,r,n,a)=>{const s=new Set,o=new Set,i=[];return t.forEach(l=>{const c=[],m={};if(l.rules.forEach(d=>{const u=d.type.charAt(0).toUpperCase()+d.type.slice(1);if(s.add(u),r?.length&&!r.includes(u))return;const h=Ho(d),v=h.charAt(0).toUpperCase()+h.slice(1);if(o.add(v),n?.length&&!n.includes(v)||a&&!d.name.toLowerCase().includes(a.toLowerCase())&&!l.name.toLowerCase().includes(a.toLowerCase())&&!l.file.toLowerCase().includes(a.toLowerCase())||(c.push(d),h!=="no match"&&h!=="unhealthy"&&h!=="firing"&&h!=="pending"))return;const p=h==="firing"||h==="pending"?d?.alerts?.length:1;v in m?m[v]+=p:m[v]=p}),c.length){const d=Object.assign({},l);d.rules=c,d.states=m,i.push(d)}}),{filteredGroups:i,allTypes:s,allStates:o}},Mu=({groupId:t,id:r,mode:n,onClose:a})=>{const{item:s,isLoading:o,error:i}=zo({groupId:t,id:r,mode:n});if(o)return e(ye,{});if(i)return e(X,{variant:"error",children:i});const l=`No rule with group ID=${t}, rule ID=${r} found!`;return e(Ce,{className:"vm-explore-alerts",title:s?e(Gr,{entity:"rule",type:s.type,groupId:s.group_id,states:Fo(s),id:s.id,name:s.name,onClose:a}):"Rule not found",onClose:a,children:e("div",{className:"vm-explore-alerts",children:s&&e(Oo,{item:s})||e(X,{variant:"info",children:l})})})},Iu=({item:t})=>{const r=t?.expression,n=t?.labels||{},a=D(()=>Object.fromEntries(Object.entries(n).map(([o,i])=>[o,{color:"passive",value:i}])),[n]);return e("div",{className:"vm-explore-alerts-alert-item",children:[e("table",{children:[e("colgroup",{children:[e("col",{className:"vm-col-md"}),e("col",{})]}),e("tbody",{children:[e("tr",{children:e("td",{style:{"text-align":"end"},colSpan:2,children:e(z,{size:"small",variant:"outlined",color:"gray",startIcon:e($t,{}),onClick:()=>{const o={"g0.expr":r,"g0.end_time":""};window.open(`#/?${Ha(o).toString()}`,"_blank","noopener noreferrer")},children:e("span",{className:"vm-button-text",children:"Run query"})})})}),e("tr",{children:[e("td",{children:"Query"}),e("td",{children:e(Ue,{code:r})})]}),e("tr",{children:[e("td",{children:"Active at"}),e("td",{children:Tt(t.activeAt)})]}),!!Object.keys(n).length&&e("tr",{children:[e("td",{children:"Labels"}),e("td",{children:e(He,{items:a})})]})]})]}),!!Object.keys(t.annotations||{}).length&&e(V,{children:[e("span",{className:"vm-alerts-title",children:"Annotations"}),e("table",{children:[e("colgroup",{children:[e("col",{className:"vm-col-md"}),e("col",{})]}),e("tbody",{children:Object.entries(t.annotations||{}).map(([o,i])=>e("tr",{children:[e("td",{children:o}),e("td",{children:i})]},o))})]})]})]})},Du=({groupId:t,id:r,mode:n,onClose:a})=>{const{item:s,isLoading:o,error:i}=zo({groupId:t,id:r,mode:n});if(o)return e(ye,{});if(i)return e(X,{variant:"error",children:i});const l=`No alert with group ID=${t}, alert ID=${r} found!`,c={firing:1};return e(Ce,{className:"vm-explore-alerts",title:s?e(Gr,{entity:"alert",type:"alerting",groupId:s.group_id,id:s.id,name:s.name,states:c,onClose:a}):"Alert not found",onClose:a,children:e("div",{className:"vm-explore-alerts",children:s&&e(Iu,{item:s})||e(X,{variant:"info",children:l})})})},$u=({id:t})=>{const{serverUrl:r}=re(),{period:n}=pe(),[a,s]=y(),[o,i]=y(!1),[l,c]=y(),m=D(()=>Su(r,t),[r,t]);return x(()=>{(async()=>{i(!0);try{const u=await fetch(m);switch(u.headers.get("Content-Type")){case"application/json":{const h=await u.json();u.ok?(s(h),c(void 0)):c(`${h.errorType}\r
${h?.error}`);break}default:{let h=await u.text();h.startsWith("unsupported path requested")?h=`Failed to show group details. Request to ${m} failed with error:  ${h.trim()}.
Make sure that vmalert is reachable at ${m} and is of the same or higher version than vmselect`:h=`${u.statusText}\r
${h}`,c(h);break}}}catch(u){u instanceof Error&&c(`${u.name}: ${u.message}`)}i(!1)})().catch(console.error)},[m,n]),{group:a,isLoading:o,error:l}},Pu=({group:t})=>{const r=t?.labels||{},n=D(()=>Object.fromEntries(Object.entries(r).map(([m,d])=>[m,{color:"passive",value:d}])),[r]),a=t?.params||[],s=D(()=>Object.fromEntries(a.map(m=>[m,{color:"passive"}])),[a]),o=t?.headers||[],i=D(()=>Object.fromEntries(o.map(m=>[m,{color:"passive"}])),[o]),l=t?.notifier_headers||[],c=D(()=>Object.fromEntries(l.map(m=>[m,{color:"passive"}])),[l]);return e("div",{className:"vm-explore-alerts-group",children:e("table",{children:e("tbody",{children:[!!t.interval&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Interval"}),e("td",{children:Ut(t.interval)})]}),e("tr",{children:[e("td",{className:"vm-col-md",children:"Last evaluation"}),e("td",{children:Tt(t.lastEvaluation)})]}),!!t.eval_offset&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Eval offset"}),e("td",{children:Ut(t.eval_offset)})]}),!!t.eval_delay&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Eval delay"}),e("td",{children:Ut(t.eval_delay)})]}),!!t.file&&e("tr",{children:[e("td",{className:"vm-col-md",children:"File"}),e("td",{children:t.file})]}),!!t.concurrency&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Concurrency"}),e("td",{children:t.concurrency})]}),!!Object.keys(r).length&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Labels"}),e("td",{children:e(He,{items:n})})]}),!!a.length&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Params"}),e("td",{children:e(He,{items:s})})]}),!!o.length&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Headers"}),e("td",{children:e(He,{items:i})})]}),!!l.length&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Notifier headers"}),e("td",{children:e(He,{items:c})})]})]})})})},Ru=({id:t,onClose:r})=>{const{group:n,isLoading:a,error:s}=$u({id:t});if(a)return e(ye,{});if(s)return e(X,{variant:"error",children:s});const o=`No group ID=${t} found!`;return e(Ce,{className:"vm-explore-alerts",title:n?e(Gr,{entity:"group",groupId:t,name:n.name,states:n.states,onClose:r}):"Rule not found",onClose:r,children:e("div",{className:"vm-explore-alerts",children:n&&e(Pu,{group:n})||e(X,{variant:"info",children:o})})})},Ou=he("types",""),zu=Ou.split("&").filter(t=>t),Hu=he("states",""),Fu=Hu.split("&").filter(t=>t),Vu=he("search",""),Uu=()=>{const t=he("group_id",""),r=he("rule_id",""),n=he("alert_id",""),[a,s]=y(Vu),[o,i]=y(zu),[l,c]=y(Fu),[m,d]=y(!0),[u,h]=de(),v=ft(),p=Ke();x(()=>{!p.hash&&t?d(!0):d(!1)},[p.hash,t]),_u({types:o.join("&"),states:l.join("&"),search:a,group_id:t,alert_id:n,rule_id:r});const _=K(H=>{s(H||"")},[a]),g=()=>{if(r!=="")return e(Mu,{groupId:t,id:r,mode:r!==""?"rule":"alert",onClose:b(`rule-${r}`)});if(n!=="")return e(Du,{groupId:t,id:n,mode:r!==""?"rule":"alert",onClose:b(`alert-${n}`)});if(t!=="")return e(Ru,{id:t,onClose:b(`group-${t}`)})},f="No rules found!",b=H=>()=>{const O=new URLSearchParams(u);O.delete("group_id"),O.delete("rule_id"),O.delete("alert_id"),h(O),d(!1),v({hash:`#${H}`})},{groups:C,isLoading:N,error:S}=Eu({blockFetch:m}),w=!N&&!S&&!!C?.length,T=localStorage.getItem("scrollTop");x(()=>{if(w)if(p.hash){const H=document.querySelector(p.hash);if(H){let O=H.closest("details");for(;O;){if(O.open=!0,!O?.parentElement)return;O=O.parentElement.closest("details")}H.scrollIntoView()}}else{T&&window.scrollTo(0,parseInt(T));const H=()=>{localStorage.setItem("scrollTop",(window.scrollY||0).toString())};return window.addEventListener("scroll",H),()=>{window.removeEventListener("scroll",H)}}},[p,T,w]);const{filteredGroups:E,allTypes:A,allStates:k}=D(()=>ku(C||[],o,l,a),[C,o,l,a]);o.every(H=>A.has(H))||i([]);const L=A.size===o.length?[]:o;l.every(H=>k.has(H))||c([]);const $=k.size===l.length?[]:l,I=K(H=>{c(yn(H,$))},[l]),R=K(H=>{i(yn(H,L))},[o]);return e(V,{children:[m&&g(),(!m||!!k?.size)&&e("div",{className:"vm-explore-alerts",children:[e(Au,{types:L,allTypes:Array.from(A),states:$,allStates:Array.from(k),search:a,onChangeTypes:R,onChangeStates:I,onChangeSearch:kt(_,500)}),N&&e(ye,{})||S&&e(X,{variant:"error",children:S})||!E.length&&e(X,{variant:"info",children:f})||e("div",{className:"vm-explore-alerts-body",children:E.map(H=>e("div",{className:"vm-explore-alert-group vm-block vm-block_empty-padding",children:e(_t,{id:`group-${H.id}`,title:e(xu,{group:H}),children:e("div",{className:"vm-explore-alerts-items",children:H.rules.map(O=>e(Lu,{rule:O,states:Fo(O)},`rule-${O.id}`))})},`group-${H.id}`)},H.id))})]})]})},qu=()=>{const{serverUrl:t}=re(),{period:r}=pe(),[n,a]=y([]),[s,o]=y(!1),[i,l]=y(),c=D(()=>Tu(t),[t]);return x(()=>{(async()=>{o(!0);try{const d=await fetch(c),u=await d.json();if(d.ok){const h=u.data.notifiers||[];a(h.sort((v,p)=>v.kind.localeCompare(p.kind))),l(void 0)}else l(`${u.errorType}\r
${u?.error}`)}catch(d){d instanceof Error&&l(`${d.name}: ${d.message}`)}o(!1)})().catch(console.error)},[c,r]),{notifiers:n,isLoading:s,error:i}},Bu=({kinds:t,allKinds:r,search:n,onChangeKinds:a,onChangeSearch:s})=>{const{isMobile:o}=j();return e(V,{children:e("div",{className:M({"vm-explore-alerts-header":!0,"vm-explore-alerts-header_mobile":o,"vm-block":!0,"vm-block_mobile":o}),children:[e("div",{className:"vm-explore-alerts-header__rule_type",children:e(at,{value:t,list:r,label:"Notifier type",placeholder:"Please select notifier type",onChange:a,autofocus:!!t.length&&!o,includeAll:!0,searchable:!0})}),e("div",{className:"vm-explore-alerts-header-search",children:e(se,{label:"Search",value:n,placeholder:"Filter by kind, address or labels",startIcon:e($t,{}),onChange:s})})]})})},Qu=({notifier:t})=>{const{isMobile:r}=j();return e("div",{className:M({"vm-explore-alerts-notifier-header":!0,"vm-explore-alerts-notifier-header_mobile":r}),children:e("div",{className:"vm-explore-alerts-notifier-header__name",children:t.kind})})},ju=({target:t})=>{const r=t?.lastError?"unhealthy":"ok",n=t?.labels||{},a=D(()=>Object.fromEntries(Object.entries(n).map(([s,o])=>[s,{value:o,color:"passive"}])),[n]);return e("div",{className:`vm-explore-alerts-target vm-badge-item ${r.replace(" ","-")}`,children:t?.labels?.length||t?.lastError?e(_t,{title:e("div",{className:"vm-explore-alerts-target-header__name",children:t.address}),children:e("div",{className:"vm-explore-alerts-target-item",children:e("table",{children:e("tbody",{children:[!!Object.keys(n).length&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Labels"}),e("td",{children:e(He,{items:a})})]}),!!t.lastError&&e("tr",{children:[e("td",{className:"vm-col-md",children:"Last error"}),e("td",{children:e(X,{variant:"error",children:t.lastError})})]})]})})})},`target-${t.address}`):e("span",{children:t.address})})},Yu=he("kinds",""),Gu=Yu.split("&").filter(t=>t),Wu=he("search",""),Ju=()=>{const{notifiers:t,isLoading:r,error:n}=qu(),[a,s]=y(Wu),[o,i]=y(Gu);Cu({kinds:o.join("&"),search:a});const l=Ke(),c=!r&&!n&&!!t?.length,m=localStorage.getItem("scrollTop");x(()=>{if(c)if(l.hash){const p=document.querySelector(l.hash);if(p){let _=p.closest("details");for(;_;){if(_.open=!0,!_?.parentElement)return;_=_.parentElement.closest("details")}p.scrollIntoView()}}else{m&&window.scrollTo(0,parseInt(m));const p=()=>{localStorage.setItem("scrollTop",(window.scrollY||0).toString())};return window.addEventListener("beforeunload",p),()=>{window.removeEventListener("beforeunload",p)}}},[l,m,c]);const d=p=>{s(p||"")},u=new Set,h=[];t.forEach(p=>{const _=[];if((p.targets||[]).forEach(f=>{u.add(p.kind),!(o?.length&&!o.includes(p.kind))&&(a&&!f.address.toLowerCase().includes(a.toLowerCase())&&!p.kind.toLowerCase().includes(a.toLowerCase())||_.push(f))}),_.length){const f=Object.assign({},p);f.targets=_,h.push(f)}});const v=p=>{i(yn(p,o))};return e("div",{className:"vm-explore-alerts",children:[e(Bu,{kinds:o,allKinds:Array.from(u),search:a,onChangeKinds:v,onChangeSearch:kt(d,500)}),r&&e(ye,{})||n&&e(X,{variant:"error",children:n})||!h.length&&e(X,{variant:"info",children:"No notifiers found!"})||e("div",{className:"vm-explore-alerts-body",children:h.map(p=>e("div",{className:"vm-explore-alert-group vm-block vm-block_empty-padding",children:e(_t,{id:`notifier-${p.kind}`,title:e(Qu,{notifier:p}),children:e("div",{className:"vm-explore-alerts-items",children:p.targets.map(_=>e(ju,{target:_},`target-${_.address}`))})},`notifier-${p.kind}`)},p.kind))})]})},Ku=()=>{const[t,r]=y(!1);return e(V,{children:e(Fa,{children:e($s,{children:e(V,{children:[e(Po,{onLoaded:r}),t&&e(Va,{children:e(ve,{path:"/",element:e(Ul,{}),children:[e(ve,{path:G.home,element:e($o,{})}),e(ve,{path:G.rawQuery,element:e(bu,{})}),e(ve,{path:G.metrics,element:e(qm,{})}),e(ve,{path:G.cardinality,element:e(gm,{})}),e(ve,{path:G.topQueries,element:e(Tm,{})}),e(ve,{path:G.trace,element:e(Am,{})}),e(ve,{path:G.queryAnalyzer,element:e(lu,{})}),e(ve,{path:G.dashboards,element:e(Yd,{})}),e(ve,{path:G.withTemplate,element:e(Wm,{})}),e(ve,{path:G.relabel,element:e(Xm,{})}),e(ve,{path:G.activeQueries,element:e(nu,{})}),e(ve,{path:G.icons,element:e(Bm,{})}),e(ve,{path:G.downsamplingDebug,element:e(mu,{})}),e(ve,{path:G.retentionDebug,element:e(pu,{})}),e(ve,{path:G.rules,element:e(Uu,{})}),e(ve,{path:G.notifiers,element:e(Ju,{})})]})})]})})})})},Zu=({displaySidebar:t,isMobile:r,headerSetup:n,accountIds:a,closeModal:s})=>e("div",{className:M({"vm-header-controls":!0,"vm-header-controls_mobile":r}),children:[n?.tenant&&e(Fs,{accountIds:a||[]}),n?.stepControl&&e(Vs,{}),n?.timeSelector&&e(qs,{}),n?.cardinalityDatePicker&&e(Bs,{}),n?.executionControls&&e(Qs,{tooltip:n?.executionControls?.tooltip,useAutorefresh:n?.executionControls?.useAutorefresh,closeModal:s}),e(js,{}),!t&&e(Qn,{})]}),Xu=()=>{const t=xe(),{isMobile:r}=j(),[n,a]=de();return Ys(),x(()=>{const{search:o,href:i}=window.location;if(o){const c=bn.parse(o,{ignoreQueryPrefix:!0});Object.entries(c).forEach(([m,d])=>n.set(m,d)),a(n),window.location.search=""}const l=i.replace(/\/\?#\//,"/#/");l!==i&&window.location.replace(l)},[]),e("section",{className:"vm-container",children:[e(zs,{controlsComponent:Zu}),e("div",{className:M({"vm-container-body":!0,"vm-container-body_mobile":r,"vm-container-body_app":t}),children:e(za,{})}),!t&&e(Hs,{})]})},eh=1,th=()=>{Gn();const{isMobile:t}=j(),{query:r}=Le(),{customStep:n}=Me(),a=J(null),[s]=y([]),[o,i]=y(!r[0]),[l,c]=y(!1),{isLoading:m,graphData:d,error:u,queryErrors:h,setQueryErrors:v,queryStats:p,warning:_}=Vr({visible:!0,customStep:n,hideQuery:s,showAllSeries:l}),g=D(()=>{if(!d)return[];const b=d.map(T=>({...io(T.metric),...T})),C=b.filter(T=>T.value===ee.actual),N=b.filter(T=>T.value===ee.anomaly),S=C.map(T=>{const E=pn(T.metric),A=N.find(k=>pn(k.metric)===E);return{group:1,metric:{...T.metric,__name__:ee.anomaly},values:T.values.filter(([k])=>{if(!A)return!1;const L=A.values.find(([$])=>$===k);return L&&Yt(L[1])>eh})}});return b.filter(T=>T.value!==ee.anomaly&&T.value).concat(S)},[d]),f=()=>{i(!1)};return e("div",{className:M({"vm-custom-panel":!0,"vm-custom-panel_mobile":t}),children:[e(jn,{queryErrors:o?[]:h,setQueryErrors:v,setHideError:i,stats:p,onRunQuery:f,hideButtons:{addQuery:!0,prettify:!1,autocomplete:!1,traceQuery:!0,anomalyConfig:!0,reduceMemUsage:!0}}),m&&e(ye,{}),!o&&u&&e(X,{variant:"error",children:u}),_&&e(qr,{warning:_,query:r,onChange:c}),e("div",{className:M({"vm-custom-panel-body":!0,"vm-custom-panel-body_mobile":t,"vm-block":!0,"vm-block_mobile":t}),children:[e("div",{className:"vm-custom-panel-body-header",ref:a,children:e("div",{})}),g&&e(Ao,{graphData:g,isHistogram:!1,controlsRef:a,isAnomalyView:!0})]})]})},rh=()=>{const[t,r]=y(!1);return e(V,{children:e(Fa,{children:e($s,{children:e(V,{children:[e(Po,{onLoaded:r}),t&&e(Va,{children:e(ve,{path:"/",element:e(Xu,{}),children:[e(ve,{path:"/",element:e(th,{})}),e(ve,{path:G.query,element:e($o,{})})]})})]})})})})},nh=()=>{switch(Mt){case gt.vmanomaly:return e(rh,{});default:return e(Ku,{})}},Ra=document.getElementById("root");Ra&&Jo(nh(),Ra);
